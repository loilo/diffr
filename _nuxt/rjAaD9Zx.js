const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CYRfCsR3.js","./DmIAt9tV.js","./editor.DR_bRGV0.css","./sKJl-7Om.js","./Cbj_R_eX.js","./B_A7LuJU.js","./CjFvkU5p.js","./Bx0c16cM.js","./BP0yKN8i.js","./C7jQ0zpd.js","./C1wsuurP.js","./Dr2DanLJ.js","./CKK20oDY.js","./CicF10Y2.js","./CyKNYudn.js","./DC0sxOmR.js","./BDJI3OX9.js"])))=>i.map(i=>d[i]);
import{$ as e,$a as t,$c as n,$d as r,$i as i,$l as a,$n as o,$o as s,$r as c,$s as l,$t as u,$u as d,A as f,Aa as p,Ac as m,Ad as h,Ai as g,Al as _,An as ee,Ao as v,Ar as te,As as y,At as ne,Au as re,B as ie,Ba as ae,Bc as oe,Bd as se,Bi as ce,Bl as le,Bn as ue,Bo as de,Br as fe,Bs as pe,Bt as me,Bu as b,C as he,Ca as ge,Cc as _e,Cd as ve,Ci as ye,Cl as be,Cn as xe,Co as Se,Cr as Ce,Cs as we,Ct as Te,Cu as Ee,D as De,Da as Oe,Dc as ke,Dd as Ae,Di as je,Dl as Me,Dn as Ne,Do as Pe,Dr as Fe,Ds as Ie,Dt as Le,Du as x,E as Re,Ea as ze,Ec as Be,Ed as Ve,Ei as He,El as Ue,En as We,Eo as Ge,Er as Ke,Es as qe,Et as Je,Eu as S,F as Ye,Fa as C,Fc as Xe,Fd as Ze,Fi as Qe,Fl as $e,Fn as et,Fo as tt,Fr as nt,Fs as w,Ft as rt,Fu as it,G as at,Ga as ot,Gc as st,Gd as ct,Gi as lt,Gl as ut,Gn as dt,Go as ft,Gr as pt,Gs as mt,Gt as ht,Gu as gt,H as _t,Ha as vt,Hc as yt,Hd as bt,Hi as xt,Hl as St,Hn as Ct,Ho as wt,Hr as Tt,Hs as Et,Ht as Dt,Hu as Ot,I as kt,Ia as At,Ic as jt,Id as Mt,Ii as Nt,Il as Pt,In as Ft,Io as It,Ir as Lt,Is as T,It as Rt,Iu as E,J as zt,Ja as Bt,Jc as Vt,Jd as Ht,Ji as Ut,Jl as Wt,Jn as Gt,Jo as D,Jr as Kt,Js as qt,Jt,Ju as Yt,K as Xt,Ka as Zt,Kc as O,Kd as Qt,Ki as $t,Kl as en,Kn as tn,Ko as nn,Kr as rn,Ks as k,Kt as an,Ku as on,L as sn,La as cn,Lc as ln,Ld as un,Li as dn,Ll as fn,Ln as pn,Lo as mn,Lr as hn,Ls as gn,Lt as _n,Lu as vn,M as yn,Ma as bn,Mc as xn,Md as Sn,Mi as Cn,Ml as wn,Mn as Tn,Mo as En,Mr as Dn,Ms as On,Mt as kn,Mu as An,N as jn,Na as Mn,Nc as Nn,Nd as Pn,Ni as Fn,Nl as In,Nn as Ln,No as Rn,Nr as zn,Ns as Bn,Nt as Vn,Nu as A,O as Hn,Oa as Un,Oc as Wn,Od as Gn,Oi as Kn,Ol as qn,On as Jn,Oo as Yn,Or as Xn,Os as Zn,Ot as Qn,Ou as $n,P as er,Pa as tr,Pc as nr,Pd as rr,Pi as ir,Pl as ar,Pn as or,Po as sr,Pr as cr,Ps as j,Pt as lr,Pu as ur,Q as dr,Qa as fr,Qc as pr,Qd as mr,Qi as hr,Ql as gr,Qn as _r,Qo as vr,Qr as yr,Qs as br,Qt as xr,Qu as Sr,R as Cr,Ra as wr,Rc as Tr,Rd as Er,Ri as Dr,Rl as Or,Rn as kr,Ro as Ar,Rr as jr,Rs as Mr,Rt as Nr,Ru as Pr,S as Fr,Sa as Ir,Sc as Lr,Sd as Rr,Si as zr,Sl as Br,Sn as Vr,So as Hr,Sr as Ur,Ss as Wr,St as Gr,Su as Kr,T as qr,Ta as Jr,Tc as Yr,Td as Xr,Ti as Zr,Tl as Qr,Tn as $r,To as ei,Tr as ti,Ts as M,Tt as ni,Tu as N,U as ri,Ua as ii,Uc as ai,Ud as oi,Ui as si,Ul as ci,Un as li,Uo as ui,Ur as di,Us as fi,Ut as pi,Uu as mi,V as hi,Va as gi,Vc as _i,Vd as vi,Vi as yi,Vl as bi,Vn as xi,Vo as Si,Vr as Ci,Vs as wi,Vt as Ti,Vu as P,W as Ei,Wa as Di,Wc as Oi,Wd as ki,Wi as Ai,Wl as ji,Wn as Mi,Wo as Ni,Wr as Pi,Ws as Fi,Wt as Ii,Wu as Li,X as Ri,Xa as zi,Xc as Bi,Xd as Vi,Xi as Hi,Xl as Ui,Xn as Wi,Xo as Gi,Xr as F,Xs as Ki,Xt as qi,Xu as Ji,Y as Yi,Ya as Xi,Yc as Zi,Yd as Qi,Yi as $i,Yl as ea,Yn as ta,Yo as na,Yr as ra,Ys as ia,Yt as aa,Yu as oa,Z as sa,Za as ca,Zc as la,Zd as ua,Zi as da,Zl as fa,Zn as pa,Zo as ma,Zr as ha,Zs as I,Zt as ga,Zu as _a,_ as va,_a as ya,_c as ba,_d as xa,_i as Sa,_l as Ca,_n as wa,_o as Ta,_r as Ea,_s as Da,_t as Oa,_u as ka,a as Aa,aa as ja,ac as Ma,ad as Na,ai as Pa,al as Fa,an as Ia,ao as La,ar as Ra,as as za,at as Ba,au as Va,b as Ha,ba as Ua,bc as Wa,bd as Ga,bi as Ka,bl as qa,bn as Ja,bo as Ya,br as Xa,bs as Za,bt as Qa,bu as $a,c as eo,ca as to,cc as no,cd as ro,ci as io,cl as ao,cn as oo,co as so,cr as co,cs as lo,ct as uo,cu as fo,d as po,da as mo,dc as ho,dd as go,di as _o,dl as vo,dn as yo,do as bo,dr as xo,ds as So,dt as Co,du as wo,ea as To,ec as Eo,ed as Do,ei as Oo,el as ko,en as Ao,eo as jo,er as Mo,es as L,et as No,eu as Po,f as Fo,fa as Io,fc as Lo,fd as Ro,fi as zo,fl as Bo,fn as Vo,fo as Ho,fr as Uo,fs as Wo,ft as Go,fu as Ko,g as qo,ga as Jo,gc as Yo,gd as Xo,gi as Zo,gl as Qo,gn as $o,go as es,gr as R,gs as ts,gt as ns,gu as rs,h as os,ha as ss,hc as cs,hd as ls,hi as us,hl as ds,hn as fs,ho as ps,hr as ms,hs,ht as gs,hu as _s,i as vs,ia as ys,ic as bs,id as xs,ii as Ss,il as Cs,in as ws,io as Ts,ir as Es,is as Ds,it as Os,iu as ks,j as As,ja as js,jc as Ms,jd as Ns,ji as Ps,jl as Fs,jn as Is,jo as Ls,jr as Rs,js as zs,jt as Bs,ju as Vs,k as Hs,ka as Us,kc as Ws,kd as Gs,ki as Ks,kl as qs,kn as Js,ko as Ys,kr as Xs,ks as Zs,kt as Qs,ku as $s,l as ec,la as tc,lc as nc,ld as rc,li as ic,ll as ac,ln as oc,lo as z,lr as sc,ls as cc,lt as lc,lu as uc,m as dc,ma as fc,mc as pc,md as B,mi as mc,ml as hc,mn as gc,mo as _c,mr as vc,ms as yc,mt as bc,mu as xc,n as Sc,na as Cc,nc as wc,nd as Tc,ni as Ec,nl as Dc,nn as Oc,no as kc,nr as Ac,ns as jc,nt as Mc,nu as Nc,o as Pc,oa as Fc,oc as V,od as Ic,oi as Lc,ol as Rc,on as zc,oo as Bc,or as Vc,os as Hc,ot as Uc,ou as Wc,p as Gc,pa as Kc,pc as qc,pd as H,pi as Jc,pl as Yc,pn as Xc,po as Zc,pr as Qc,ps as $c,pt as el,pu as tl,q as nl,qa as rl,qc as il,qd as al,qi as ol,ql as sl,qn as cl,qo as ll,qr as ul,qs as dl,qt as fl,qu as pl,r as ml,ra as hl,rc as U,rd as gl,ri as _l,rl as vl,rn as yl,ro as bl,rr as xl,rs as Sl,rt as Cl,ru as wl,s as Tl,sa as El,sc as Dl,sd as Ol,si as kl,sl as Al,sn as jl,so as W,sr as Ml,ss as Nl,st as Pl,su as Fl,t as Il,ta as Ll,tc as Rl,td as zl,ti as Bl,tl as Vl,tn as Hl,to as Ul,tr as Wl,ts as G,tt as Gl,tu as Kl,u as ql,ua as Jl,uc as Yl,ud as Xl,ui as Zl,ul as Ql,un as $l,uo as eu,ur as tu,us as nu,ut as ru,uu as iu,v as au,va as ou,vc as su,vd as K,vi as cu,vl as lu,vn as uu,vo as du,vr as fu,vs as pu,vt as mu,vu as hu,w as gu,wa as _u,wc as q,wd as vu,wi as yu,wl as bu,wn as xu,wo as Su,wr as Cu,ws as wu,wt as Tu,wu as J,x as Eu,xa as Du,xc as Ou,xd as ku,xi as Au,xl as ju,xn as Mu,xo as Nu,xr as Pu,xs as Fu,xt as Iu,xu as Lu,y as Ru,ya as zu,yc as Bu,yd as Vu,yi as Hu,yl as Uu,yn as Wu,yo as Gu,yr as Ku,ys as qu,yt as Ju,yu as Yu,z as Xu,za as Y,zc as Zu,zd as Qu,zi as $u,zl as ed,zn as td,zo as nd,zr as rd,zs as X,zt as id,zu as ad}from"./DmIAt9tV.js";import{s as Z}from"#entry";import"./C31qNIRz.js";var od=class extends we{constructor(){super({id:`diffEditor.toggleCollapseUnchangedRegions`,title:B(82,`Toggle Collapse Unchanged Regions`),icon:J.map,toggled:j.has(`config.diffEditor.hideUnchangedRegions.enabled`),precondition:j.has(`isInDiffEditor`),menu:{when:j.has(`isInDiffEditor`),id:M.EditorTitle,order:22,group:`navigation`}})}run(e,...t){let n=e.get(Ni),r=!n.getValue(`diffEditor.hideUnchangedRegions.enabled`);n.updateValue(`diffEditor.hideUnchangedRegions.enabled`,r)}},sd=class extends we{constructor(){super({id:`diffEditor.toggleShowMovedCodeBlocks`,title:B(83,`Toggle Show Moved Code Blocks`),precondition:j.has(`isInDiffEditor`)})}run(e,...t){let n=e.get(Ni),r=!n.getValue(`diffEditor.experimental.showMoves`);n.updateValue(`diffEditor.experimental.showMoves`,r)}},cd=class extends we{constructor(){super({id:`diffEditor.toggleUseInlineViewWhenSpaceIsLimited`,title:B(84,`Toggle Use Inline View When Space Is Limited`),precondition:j.has(`isInDiffEditor`)})}run(e,...t){let n=e.get(Ni),r=!n.getValue(`diffEditor.useInlineViewWhenSpaceIsLimited`);n.updateValue(`diffEditor.useInlineViewWhenSpaceIsLimited`,r)}},ld=B(85,`Diff Editor`),ud=class extends na{constructor(){super({id:`diffEditor.switchSide`,title:B(86,`Switch Side`),icon:J.arrowSwap,precondition:j.has(`isInDiffEditor`),f1:!0,category:ld})}runEditorCommand(e,t,n){let r=yd(e);if(r instanceof Re){if(n&&n.dryRun)return{destinationSelection:r.mapToOtherSide().destinationSelection};r.switchSide()}}},dd=class extends na{constructor(){super({id:`diffEditor.exitCompareMove`,title:B(87,`Exit Compare Move`),icon:J.close,precondition:F.comparingMovedCode,f1:!1,category:ld,keybinding:{weight:1e4,primary:9}})}runEditorCommand(e,t,...n){let r=yd(e);r instanceof Re&&r.exitCompareMove()}},fd=class extends na{constructor(){super({id:`diffEditor.collapseAllUnchangedRegions`,title:B(88,`Collapse All Unchanged Regions`),icon:J.fold,precondition:j.has(`isInDiffEditor`),f1:!0,category:ld})}runEditorCommand(e,t,...n){let r=yd(e);r instanceof Re&&r.collapseAllUnchangedRegions()}},pd=class extends na{constructor(){super({id:`diffEditor.showAllUnchangedRegions`,title:B(89,`Show All Unchanged Regions`),icon:J.unfold,precondition:j.has(`isInDiffEditor`),f1:!0,category:ld})}runEditorCommand(e,t,...n){let r=yd(e);r instanceof Re&&r.showAllUnchangedRegions()}},md=class extends we{constructor(){super({id:`diffEditor.revert`,title:B(90,`Revert`),f1:!1,category:ld})}run(e,t){let n=vd(e,t.originalUri,t.modifiedUri);n instanceof Re&&n.revertRangeMappings(t.mapping.innerChanges??[])}},hd=B(91,`Accessible Diff Viewer`),gd=class e extends we{static{this.id=`editor.action.accessibleDiffViewer.next`}constructor(){super({id:e.id,title:B(92,`Go to Next Difference`),category:hd,precondition:j.has(`isInDiffEditor`),keybinding:{primary:65,weight:100},f1:!0})}run(e){yd(e)?.accessibleDiffViewerNext()}},_d=class e extends we{static{this.id=`editor.action.accessibleDiffViewer.prev`}constructor(){super({id:e.id,title:B(93,`Go to Previous Difference`),category:hd,precondition:j.has(`isInDiffEditor`),keybinding:{primary:1089,weight:100},f1:!0})}run(e){yd(e)?.accessibleDiffViewerPrev()}};function vd(e,t,n){return e.get(mt).listDiffEditors().find(e=>{let r=e.getModifiedEditor(),i=e.getOriginalEditor();return r&&r.getModel()?.uri.toString()===n.toString()&&i&&i.getModel()?.uri.toString()===t.toString()})||null}function yd(e){let t=e.get(mt).listDiffEditors(),n=nc();if(n){for(let e of t)if(e.getContainerDomNode().contains(n))return e}return null}y(od),y(sd),y(cd),Ie.appendMenuItem(M.EditorTitle,{command:{id:new cd().desc.id,title:H(116,`Use Inline View When Space Is Limited`),toggled:j.has(`config.diffEditor.useInlineViewWhenSpaceIsLimited`),precondition:j.has(`isInDiffEditor`)},order:11,group:`1_diff`,when:j.and(F.diffEditorRenderSideBySideInlineBreakpointReached,j.has(`isInDiffEditor`))}),Ie.appendMenuItem(M.EditorTitle,{command:{id:new sd().desc.id,title:H(117,`Show Moved Code Blocks`),icon:J.move,toggled:Bn.create(`config.diffEditor.experimental.showMoves`,!0),precondition:j.has(`isInDiffEditor`)},order:10,group:`1_diff`,when:j.has(`isInDiffEditor`)}),y(md);for(let e of[{icon:J.arrowRight,key:F.diffEditorInlineMode.toNegated()},{icon:J.discard,key:F.diffEditorInlineMode}])Ie.appendMenuItem(M.DiffEditorHunkToolbar,{command:{id:new md().desc.id,title:H(118,`Revert Block`),icon:e.icon},when:j.and(F.diffEditorModifiedWritable,e.key),order:5,group:`primary`}),Ie.appendMenuItem(M.DiffEditorSelectionToolbar,{command:{id:new md().desc.id,title:H(119,`Revert Selection`),icon:e.icon},when:j.and(F.diffEditorModifiedWritable,e.key),order:5,group:`primary`});y(ud),y(dd),y(fd),y(pd),Ie.appendMenuItem(M.EditorTitle,{command:{id:gd.id,title:H(120,`Open Accessible Diff Viewer`),precondition:j.has(`isInDiffEditor`)},order:10,group:`2_diff`,when:j.and(F.accessibleDiffViewerVisible.negate(),j.has(`isInDiffEditor`))}),gn.registerCommandAlias(`editor.action.diffReview.next`,gd.id),y(gd),gn.registerCommandAlias(`editor.action.diffReview.prev`,_d.id),y(_d);var bd=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},xd=function(e,t){return function(n,r){t(n,r,e)}},Sd;const Cd=new T(`selectionAnchorSet`,!1);var wd=class{static{Sd=this}static{this.ID=`editor.contrib.selectionAnchorController`}static get(e){return e.getContribution(Sd.ID)}constructor(e,t){this.editor=e,this.selectionAnchorSetContextKey=Cd.bindTo(t),this.modelChangeListener=e.onDidChangeModel(()=>this.selectionAnchorSetContextKey.reset())}setSelectionAnchor(){if(this.editor.hasModel()){let e=this.editor.getPosition();this.editor.changeDecorations(t=>{this.decorationId&&t.removeDecoration(this.decorationId),this.decorationId=t.addDecoration(N.fromPositions(e,e),{description:`selection-anchor`,stickiness:1,hoverMessage:new Tn().appendText(H(791,`Selection Anchor`)),className:`selection-anchor`})}),this.selectionAnchorSetContextKey.set(!!this.decorationId),Xi(H(792,`Anchor set at {0}:{1}`,e.lineNumber,e.column))}}goToSelectionAnchor(){if(this.editor.hasModel()&&this.decorationId){let e=this.editor.getModel().getDecorationRange(this.decorationId);e&&this.editor.setPosition(e.getStartPosition())}}selectFromAnchorToCursor(){if(this.editor.hasModel()&&this.decorationId){let e=this.editor.getModel().getDecorationRange(this.decorationId);if(e){let t=this.editor.getPosition();this.editor.setSelection(N.fromPositions(e.getStartPosition(),t)),this.cancelSelectionAnchor()}}}cancelSelectionAnchor(){if(this.decorationId){let e=this.decorationId;this.editor.changeDecorations(t=>{t.removeDecoration(e),this.decorationId=void 0}),this.selectionAnchorSetContextKey.set(!1)}}dispose(){this.cancelSelectionAnchor(),this.modelChangeListener.dispose()}};wd=Sd=bd([xd(1,w)],wd);var Td=class extends D{constructor(){super({id:`editor.action.setSelectionAnchor`,label:B(793,`Set Selection Anchor`),precondition:void 0,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2080),weight:100}})}async run(e,t){wd.get(t)?.setSelectionAnchor()}},Ed=class extends D{constructor(){super({id:`editor.action.goToSelectionAnchor`,label:B(794,`Go to Selection Anchor`),precondition:Cd})}async run(e,t){wd.get(t)?.goToSelectionAnchor()}},Dd=class extends D{constructor(){super({id:`editor.action.selectFromAnchorToCursor`,label:B(795,`Select from Anchor to Cursor`),precondition:Cd,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2089),weight:100}})}async run(e,t){wd.get(t)?.selectFromAnchorToCursor()}},Od=class extends D{constructor(){super({id:`editor.action.cancelSelectionAnchor`,label:B(796,`Cancel Selection Anchor`),precondition:Cd,kbOpts:{kbExpr:F.editorTextFocus,primary:9,weight:100}})}async run(e,t){wd.get(t)?.cancelSelectionAnchor()}};G(wd.ID,wd,4),s(Td),s(Ed),s(Dd),s(Od);var kd=Y(`editorOverviewRuler.bracketMatchForeground`,`#A0A0A0`,H(797,`Overview ruler marker color for matching brackets.`)),Ad=class extends D{constructor(){super({id:`editor.action.jumpToBracket`,label:B(799,`Go to Bracket`),precondition:void 0,kbOpts:{kbExpr:F.editorTextFocus,primary:3165,weight:100}})}run(e,t){Pd.get(t)?.jumpToBracket()}},jd=class extends D{constructor(){super({id:`editor.action.selectToBracket`,label:B(800,`Select to Bracket`),precondition:void 0,metadata:{description:B(801,`Select the text inside and including the brackets or curly braces`),args:[{name:`args`,schema:{type:`object`,properties:{selectBrackets:{type:`boolean`,default:!0}}}}]}})}run(e,t,n){let r=!0;n&&n.selectBrackets===!1&&(r=!1),Pd.get(t)?.selectToBracket(r)}},Md=class extends D{constructor(){super({id:`editor.action.removeBrackets`,label:B(802,`Remove Brackets`),precondition:void 0,kbOpts:{kbExpr:F.editorTextFocus,primary:2561,weight:100}})}run(e,t){Pd.get(t)?.removeBrackets(this.id)}},Nd=class{constructor(e,t,n){this.position=e,this.brackets=t,this.options=n}},Pd=class e extends b{static{this.ID=`editor.contrib.bracketMatchingController`}static get(t){return t.getContribution(e.ID)}constructor(e){super(),this._editor=e,this._lastBracketsData=[],this._lastVersionId=0,this._decorations=this._editor.createDecorationsCollection(),this._updateBracketsSoon=this._register(new ju(()=>this._updateBrackets(),50)),this._matchBrackets=this._editor.getOption(80),this._updateBracketsSoon.schedule(),this._register(e.onDidChangeCursorPosition(e=>{this._matchBrackets!==`never`&&this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelContent(e=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModel(e=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelLanguageConfiguration(e=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeConfiguration(e=>{e.hasChanged(80)&&(this._matchBrackets=this._editor.getOption(80),this._decorations.clear(),this._lastBracketsData=[],this._lastVersionId=0,this._updateBracketsSoon.schedule())})),this._register(e.onDidBlurEditorWidget(()=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidFocusEditorWidget(()=>{this._updateBracketsSoon.schedule()}))}jumpToBracket(){if(!this._editor.hasModel())return;let e=this._editor.getModel(),t=this._editor.getSelections().map(t=>{let n=t.getStartPosition(),r=e.bracketPairs.matchBracket(n),i=null;if(r)r[0].containsPosition(n)&&!r[1].containsPosition(n)?i=r[1].getStartPosition():r[1].containsPosition(n)&&(i=r[0].getStartPosition());else{let t=e.bracketPairs.findEnclosingBrackets(n);if(t)i=t[1].getStartPosition();else{let t=e.bracketPairs.findNextBracket(n);t&&t.range&&(i=t.range.getStartPosition())}}return i?new N(i.lineNumber,i.column,i.lineNumber,i.column):new N(n.lineNumber,n.column,n.lineNumber,n.column)});this._editor.setSelections(t),this._editor.revealRange(t[0])}selectToBracket(e){if(!this._editor.hasModel())return;let t=this._editor.getModel(),n=[];this._editor.getSelections().forEach(r=>{let i=r.getStartPosition(),a=t.bracketPairs.matchBracket(i);if(!a&&(a=t.bracketPairs.findEnclosingBrackets(i),!a)){let e=t.bracketPairs.findNextBracket(i);e&&e.range&&(a=t.bracketPairs.matchBracket(e.range.getStartPosition()))}let o=null,s=null;if(a){a.sort(S.compareRangesUsingStarts);let[t,n]=a;if(o=e?t.getStartPosition():t.getEndPosition(),s=e?n.getEndPosition():n.getStartPosition(),n.containsPosition(i)){let e=o;o=s,s=e}}o&&s&&n.push(new N(o.lineNumber,o.column,s.lineNumber,s.column))}),n.length>0&&(this._editor.setSelections(n),this._editor.revealRange(n[0]))}removeBrackets(e){if(!this._editor.hasModel())return;let t=this._editor.getModel();this._editor.getSelections().forEach(n=>{let r=n.getPosition(),i=t.bracketPairs.matchBracket(r);i||=t.bracketPairs.findEnclosingBrackets(r),i&&(this._editor.pushUndoStop(),this._editor.executeEdits(e,[{range:i[0],text:``},{range:i[1],text:``}]),this._editor.pushUndoStop())})}static{this._DECORATION_OPTIONS_WITH_OVERVIEW_RULER=R.register({description:`bracket-match-overview`,stickiness:1,className:`bracket-match`,overviewRuler:{color:Kt(kd),position:En.Center}})}static{this._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER=R.register({description:`bracket-match-no-overview`,stickiness:1,className:`bracket-match`})}_updateBrackets(){if(this._matchBrackets===`never`)return;this._recomputeBrackets();let e=[],t=0;for(let n of this._lastBracketsData){let r=n.brackets;r&&(e[t++]={range:r[0],options:n.options},e[t++]={range:r[1],options:n.options})}this._decorations.set(e)}_recomputeBrackets(){if(!this._editor.hasModel()||!this._editor.hasWidgetFocus()){this._lastBracketsData=[],this._lastVersionId=0;return}let t=this._editor.getSelections();if(t.length>100){this._lastBracketsData=[],this._lastVersionId=0;return}let n=this._editor.getModel(),r=n.getVersionId(),i=[];this._lastVersionId===r&&(i=this._lastBracketsData);let a=[],o=0;for(let e=0,n=t.length;e<n;e++){let n=t[e];n.isEmpty()&&(a[o++]=n.getStartPosition())}a.length>1&&a.sort(x.compare);let s=[],c=0,l=0,u=i.length;for(let t=0,r=a.length;t<r;t++){let r=a[t];for(;l<u&&i[l].position.isBefore(r);)l++;if(l<u&&i[l].position.equals(r))s[c++]=i[l];else{let t=n.bracketPairs.matchBracket(r,20),i=e._DECORATION_OPTIONS_WITH_OVERVIEW_RULER;!t&&this._matchBrackets===`always`&&(t=n.bracketPairs.findEnclosingBrackets(r,20),i=e._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER),s[c++]=new Nd(r,t,i)}}this._lastBracketsData=s,this._lastVersionId=r}};G(Pd.ID,Pd,1),s(jd),s(Ad),s(Md),Ie.appendMenuItem(M.MenubarGoMenu,{group:`5_infile_nav`,command:{id:`editor.action.jumpToBracket`,title:H(798,`Go to &&Bracket`)},order:2});var Fd=class{constructor(e,t){this._selection=e,this._isMovingLeft=t}getEditOperations(e,t){if(this._selection.startLineNumber!==this._selection.endLineNumber||this._selection.isEmpty())return;let n=this._selection.startLineNumber,r=this._selection.startColumn,i=this._selection.endColumn;if(!(this._isMovingLeft&&r===1)&&!(!this._isMovingLeft&&i===e.getLineMaxColumn(n)))if(this._isMovingLeft){let a=new S(n,r-1,n,r),o=e.getValueInRange(a);t.addEditOperation(a,null),t.addEditOperation(new S(n,i,n,i),o)}else{let a=new S(n,i,n,i+1),o=e.getValueInRange(a);t.addEditOperation(a,null),t.addEditOperation(new S(n,r,n,r),o)}}computeCursorState(e,t){return this._isMovingLeft?new N(this._selection.startLineNumber,this._selection.startColumn-1,this._selection.endLineNumber,this._selection.endColumn-1):new N(this._selection.startLineNumber,this._selection.startColumn+1,this._selection.endLineNumber,this._selection.endColumn+1)}},Id=class extends D{constructor(e,t){super(t),this.left=e}run(e,t){if(!t.hasModel())return;let n=[],r=t.getSelections();for(let e of r)n.push(new Fd(e,this.left));t.pushUndoStop(),t.executeCommands(this.id,n),t.pushUndoStop()}},Ld=class extends Id{constructor(){super(!0,{id:`editor.action.moveCarretLeftAction`,label:B(803,`Move Selected Text Left`),precondition:F.writable})}},Rd=class extends Id{constructor(){super(!1,{id:`editor.action.moveCarretRightAction`,label:B(804,`Move Selected Text Right`),precondition:F.writable})}};s(Ld),s(Rd),s(class extends D{constructor(){super({id:`editor.action.transposeLetters`,label:B(805,`Transpose Letters`),precondition:F.writable,kbOpts:{kbExpr:F.textInputFocus,primary:0,mac:{primary:306},weight:100}})}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=[],i=t.getSelections();for(let e of i){if(!e.isEmpty())continue;let t=e.startLineNumber,i=e.startColumn,a=n.getLineMaxColumn(t);if(t===1&&(i===1||i===2&&a===2))continue;let o=i===a?e.getPosition():kl.rightPosition(n,e.getPosition().lineNumber,e.getPosition().column),s=kl.leftPosition(n,o),c=kl.leftPosition(n,s),l=n.getValueInRange(S.fromPositions(c,s)),u=n.getValueInRange(S.fromPositions(s,o)),d=S.fromPositions(c,o);r.push(new io(d,u+l))}r.length>0&&(t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop())}});const zd=dl(`productService`);function Bd(e,t){return{id:t,asString:async()=>e,asFile:()=>void 0,value:typeof e==`string`?e:void 0}}function Vd(e,t,n,r){let i={id:Jc(),name:e,uri:t,data:n};return{id:r,asString:async()=>``,asFile:()=>i,value:void 0}}var Hd=class{constructor(){this._entries=new Map}get size(){let e=0;for(let t of this._entries)e++;return e}has(e){return this._entries.has(this.toKey(e))}matches(e){let t=[...this._entries.keys()];return gl.some(this,([e,t])=>t.asFile())&&t.push(`files`),Gd(Ud(e),t)}get(e){return this._entries.get(this.toKey(e))?.[0]}append(e,t){let n=this._entries.get(e);n?n.push(t):this._entries.set(this.toKey(e),[t])}replace(e,t){this._entries.set(this.toKey(e),[t])}delete(e){this._entries.delete(this.toKey(e))}*[Symbol.iterator](){for(let[e,t]of this._entries)for(let n of t)yield[e,n]}toKey(e){return Ud(e)}};function Ud(e){return e.toLowerCase()}function Wd(e,t){return Gd(Ud(e),t.map(Ud))}function Gd(e,t){if(e===`*/*`)return t.length>0;if(t.includes(e))return!0;let n=e.match(/^([a-z]+)\/([a-z]+|\*)$/i);if(!n)return!1;let[r,i,a]=n;return a===`*`?t.some(e=>e.startsWith(i+`/`)):!1}const Kd=Object.freeze({create:e=>ki(e.map(e=>e.toString())).join(`\r
`),split:e=>e.split(`\r
`),parse:e=>Kd.split(e).filter(e=>!e.startsWith(`#`))});var qd=class e{static{this.sep=`.`}static{this.None=new e(`@@none@@`)}static{this.Empty=new e(``)}constructor(e){this.value=e}equals(e){return this.value===e.value}contains(t){return this.equals(t)||this.value===``||t.value.startsWith(this.value+e.sep)}intersects(e){return this.contains(e)||e.contains(this)}append(...t){return new e((this.value?[this.value,...t]:t).join(e.sep))}};const Jd={EDITORS:`CodeEditors`,FILES:`CodeFiles`,SYMBOLS:`application/vnd.code.symbols`,MARKERS:`application/vnd.code.diagnostics`,NOTEBOOK_CELL_OUTPUT:`notebook-cell-output`,SCM_HISTORY_ITEM:`scm-history-item`};var Yd=class{};On.add({DragAndDropContribution:`workbench.contributions.dragAndDrop`}.DragAndDropContribution,new Yd);var Xd=class e{static{this.INSTANCE=new e}constructor(){}static getInstance(){return e.INSTANCE}hasData(e){return e&&e===this.proto}getData(e){if(this.hasData(e))return this.data}};function Zd(e){if(rc&&typeof globalThis.vscode?.webUtils?.getPathForFile==`function`)return globalThis.vscode.webUtils.getPathForFile(e)}function Qd(e){let t=new Hd;for(let n of e.items){let e=n.type;if(n.kind===`string`){let r=new Promise(e=>n.getAsString(e));t.append(e,Bd(r))}else if(n.kind===`file`){let r=n.getAsFile();r&&t.append(e,$d(r))}}return t}function $d(e){let t=Zd(e),n=t?$n.parse(t):void 0;return Vd(e.name,n,async()=>new Uint8Array(await e.arrayBuffer()))}var ef=Object.freeze([Jd.EDITORS,Jd.FILES,aa.RESOURCES,aa.INTERNAL_URI_LIST]);function tf(e,t=!1){let n=Qd(e),r=n.get(aa.INTERNAL_URI_LIST);if(r)n.replace(Si.uriList,r);else if(t||!n.has(Si.uriList)){let t=[];for(let n of e.items){let e=n.getAsFile();if(e){let n=Zd(e);try{n?t.push($n.file(n).toString()):t.push($n.parse(e.name,!0).toString())}catch{}}}t.length&&n.replace(Si.uriList,Bd(Kd.create(t)))}for(let e of ef)n.delete(e);return n}var nf=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rf=function(e,t){return function(n,r){t(n,r,e)}},af=R.register({description:`inline-progress-widget`,stickiness:1,showIfCollapsed:!0,after:{content:`\xA0`,inlineClassName:`inline-editor-progress-decoration`,inlineClassNameAffectsLetterSpacing:!0}}),sf=class e extends b{static{this.baseId=`editor.widget.inlineProgressWidget`}constructor(e,t,n,r,i){super(),this.typeId=e,this.editor=t,this.range=n,this.delegate=i,this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this.create(r),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this)}create(e){this.domNode=I(`.inline-progress-widget`),this.domNode.role=`button`,this.domNode.title=e;let t=I(`span.icon`);this.domNode.append(t),t.classList.add(...X.asClassNameArray(J.loading),`codicon-modifier-spin`);let n=()=>{let e=this.editor.getOption(75);this.domNode.style.height=`${e}px`,this.domNode.style.width=`${Math.ceil(.8*e)}px`};n(),this._register(this.editor.onDidChangeConfiguration(e=>{(e.hasChanged(61)||e.hasChanged(75))&&n()})),this._register(U(this.domNode,Eo.CLICK,e=>{this.delegate.cancel()}))}getId(){return e.baseId+`.`+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:{lineNumber:this.range.startLineNumber,column:this.range.startColumn},preference:[0]}}dispose(){super.dispose(),this.editor.removeContentWidget(this)}},cf=class extends b{constructor(e,t,n){super(),this.id=e,this._editor=t,this._instantiationService=n,this._showDelay=500,this._showPromise=this._register(new Ot),this._currentWidget=this._register(new Ot),this._operationIdPool=0,this._currentDecorations=t.createDecorationsCollection()}dispose(){super.dispose(),this._currentDecorations.clear()}async showWhile(e,t,n,r,i){let a=this._operationIdPool++;this._currentOperation=a,this.clear(),this._showPromise.value=Qr(()=>{let n=S.fromPositions(e);this._currentDecorations.set([{range:n,options:af}]).length>0&&(this._currentWidget.value=this._instantiationService.createInstance(sf,this.id,this._editor,n,t,r))},i??this._showDelay);try{return await n}finally{this._currentOperation===a&&(this.clear(),this._currentOperation=void 0)}}clear(){this._showPromise.clear(),this._currentDecorations.clear(),this._currentWidget.clear()}};cf=nf([rf(2,k)],cf);var lf=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},uf=function(e,t){return function(n,r){t(n,r,e)}},df,ff=class{static{df=this}static{this.ID=`editor.contrib.messageController`}static{this.MESSAGE_VISIBLE=new T(`messageVisible`,!1,H(1274,`Whether the editor is currently showing an inline message`))}static get(e){return e.getContribution(df.ID)}constructor(e,t,n){this._openerService=n,this._messageWidget=new Ot,this._messageListeners=new P,this._mouseOverMessage=!1,this._editor=e,this._visible=df.MESSAGE_VISIBLE.bindTo(t)}dispose(){this._messageListeners.dispose(),this._messageWidget.dispose(),this._visible.reset()}showMessage(e,t){if(Xi(or(e)?e.value:e),this._visible.set(!0),this._messageWidget.clear(),this._messageListeners.clear(),or(e)){let n=this._messageListeners.add(Ne(e,{actionHandler:(e,t)=>{this.closeMessage(),We(this._openerService,e,t.isTrusted)}}));this._messageWidget.value=new mf(this._editor,t,n.element)}else this._messageWidget.value=new mf(this._editor,t,e);this._messageListeners.add(vn.debounce(this._editor.onDidBlurEditorText,(e,t)=>t,0)(()=>{this._mouseOverMessage||this._messageWidget.value&&Lr(nc(),this._messageWidget.value.getDomNode())||this.closeMessage()})),this._messageListeners.add(this._editor.onDidChangeCursorPosition(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidDispose(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidChangeModel(()=>this.closeMessage())),this._messageListeners.add(U(this._messageWidget.value.getDomNode(),Eo.MOUSE_ENTER,()=>this._mouseOverMessage=!0,!0)),this._messageListeners.add(U(this._messageWidget.value.getDomNode(),Eo.MOUSE_LEAVE,()=>this._mouseOverMessage=!1,!0));let n;this._messageListeners.add(this._editor.onMouseMove(e=>{e.target.position&&(n?n.containsPosition(e.target.position)||this.closeMessage():n=new S(t.lineNumber-3,1,e.target.position.lineNumber+3,1))}))}closeMessage(){this._visible.reset(),this._messageListeners.clear(),this._messageWidget.value&&this._messageListeners.add(mf.fadeOut(this._messageWidget.value))}};ff=df=lf([uf(1,w),uf(2,cl)],ff);var pf=Gi.bindToContribution(ff.get);L(new pf({id:`leaveEditorMessage`,precondition:ff.MESSAGE_VISIBLE,handler:e=>e.closeMessage(),kbOpts:{weight:130,primary:9}}));var mf=class{static fadeOut(e){let t=()=>{e.dispose(),clearTimeout(n),e.getDomNode().removeEventListener(`animationend`,t)},n=setTimeout(t,110);return e.getDomNode().addEventListener(`animationend`,t),e.getDomNode().classList.add(`fadeOut`),{dispose:t}}constructor(e,{lineNumber:t,column:n},r){this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._editor=e,this._editor.revealLinesInCenterIfOutsideViewport(t,t,0),this._position={lineNumber:t,column:n},this._domNode=document.createElement(`div`),this._domNode.classList.add(`monaco-editor-overlaymessage`),this._domNode.style.marginLeft=`-6px`;let i=document.createElement(`div`);i.classList.add(`anchor`,`top`),this._domNode.appendChild(i);let a=document.createElement(`div`);typeof r==`string`?(a.classList.add(`message`),a.textContent=r):(r.classList.add(`message`),a.appendChild(r)),this._domNode.appendChild(a);let o=document.createElement(`div`);o.classList.add(`anchor`,`below`),this._domNode.appendChild(o),this._editor.addContentWidget(this),this._domNode.classList.add(`fadeIn`)}dispose(){this._editor.removeContentWidget(this)}getId(){return`messageoverlay`}getDomNode(){return this._domNode}getPosition(){return{position:this._position,preference:[1,2],positionAffinity:1}}afterRender(e){this._domNode.classList.toggle(`below`,e===2)}};G(ff.ID,ff,4);var hf=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gf=function(e,t){return function(n,r){t(n,r,e)}},_f=class{constructor(e){this.copyMimeTypes=[],this.kind=e,this.providedDropEditKinds=[this.kind],this.providedPasteEditKinds=[this.kind]}async provideDocumentPasteEdits(e,t,n,r,i){let a=await this.getEdit(n,i);if(a)return{edits:[{insertText:a.insertText,title:a.title,kind:a.kind,handledMimeType:a.handledMimeType,yieldTo:a.yieldTo}],dispose(){}}}async provideDocumentDropEdits(e,t,n,r){let i=await this.getEdit(n,r);if(i)return{edits:[{insertText:i.insertText,title:i.title,kind:i.kind,handledMimeType:i.handledMimeType,yieldTo:i.yieldTo}],dispose(){}}}},vf=class e extends _f{static{this.id=`text`}constructor(){super(qd.Empty.append(`text`,`plain`)),this.id=e.id,this.dropMimeTypes=[Si.text],this.pasteMimeTypes=[Si.text]}async getEdit(e,t){let n=e.get(Si.text);if(!n||e.has(Si.uriList))return;let r=await n.asString();return{handledMimeType:Si.text,title:H(918,`Insert Plain Text`),insertText:r,kind:this.kind}}},yf=class extends _f{constructor(){super(qd.Empty.append(`uri`,`path`,`absolute`)),this.dropMimeTypes=[Si.uriList],this.pasteMimeTypes=[Si.uriList]}async getEdit(e,t){let n=await Sf(e);if(!n.length||t.isCancellationRequested)return;let r=0,i=n.map(({uri:e,originalText:t})=>e.scheme===hc.file?e.fsPath:(r++,t)).join(` `),a;return a=r>0?n.length>1?H(919,`Insert Uris`):H(920,`Insert Uri`):n.length>1?H(921,`Insert Paths`):H(922,`Insert Path`),{handledMimeType:Si.uriList,insertText:i,title:a,kind:this.kind}}},bf=class extends _f{constructor(e){super(qd.Empty.append(`uri`,`path`,`relative`)),this._workspaceContextService=e,this.dropMimeTypes=[Si.uriList],this.pasteMimeTypes=[Si.uriList]}async getEdit(e,t){let n=await Sf(e);if(!n.length||t.isCancellationRequested)return;let r=vi(n.map(({uri:e})=>{let t=this._workspaceContextService.getWorkspaceFolder(e);return t?pu(t.uri,e):void 0}));if(r.length)return{handledMimeType:Si.uriList,insertText:r.join(` `),title:n.length>1?H(923,`Insert Relative Paths`):H(924,`Insert Relative Path`),kind:this.kind}}};bf=hf([gf(0,yl)],bf);var xf=class{constructor(){this.kind=new qd(`html`),this.providedPasteEditKinds=[this.kind],this.copyMimeTypes=[],this.pasteMimeTypes=[`text/html`],this._yieldTo=[{mimeType:Si.text}]}async provideDocumentPasteEdits(e,t,n,r,i){if(r.triggerKind!==fo.PasteAs&&!r.only?.contains(this.kind))return;let a=await n.get(`text/html`)?.asString();if(!(!a||i.isCancellationRequested))return{dispose(){},edits:[{insertText:a,yieldTo:this._yieldTo,title:H(925,`Insert HTML`),kind:this.kind}]}}};async function Sf(e){let t=e.get(Si.uriList);if(!t)return[];let n=await t.asString(),r=[];for(let e of Kd.parse(n))try{r.push({uri:$n.parse(e),originalText:e})}catch{}return r}var Cf={scheme:`*`,hasAccessToAllModels:!0},wf=class extends b{constructor(e,t){super(),this._register(e.documentDropEditProvider.register(Cf,new vf)),this._register(e.documentDropEditProvider.register(Cf,new yf)),this._register(e.documentDropEditProvider.register(Cf,new bf(t)))}};wf=hf([gf(0,W),gf(1,yl)],wf);var Tf=class extends b{constructor(e,t){super(),this._register(e.documentPasteEditProvider.register(Cf,new vf)),this._register(e.documentPasteEditProvider.register(Cf,new yf)),this._register(e.documentPasteEditProvider.register(Cf,new bf(t))),this._register(e.documentPasteEditProvider.register(Cf,new xf))}};Tf=hf([gf(0,W),gf(1,yl)],Tf);var Ef=class e{constructor(){this.value=``,this.pos=0}static{this._table={36:0,58:1,44:2,123:3,125:4,92:5,47:6,124:7,43:11,45:12,63:13}}static isDigitCharacter(e){return e>=48&&e<=57}static isVariableCharacter(e){return e===95||e>=97&&e<=122||e>=65&&e<=90}text(e){this.value=e,this.pos=0}tokenText(e){return this.value.substr(e.pos,e.len)}next(){if(this.pos>=this.value.length)return{type:14,pos:this.pos,len:0};let t=this.pos,n=0,r=this.value.charCodeAt(t),i;if(i=e._table[r],typeof i==`number`)return this.pos+=1,{type:i,pos:t,len:1};if(e.isDigitCharacter(r)){i=8;do n+=1,r=this.value.charCodeAt(t+n);while(e.isDigitCharacter(r));return this.pos+=n,{type:i,pos:t,len:n}}if(e.isVariableCharacter(r)){i=9;do r=this.value.charCodeAt(t+ ++n);while(e.isVariableCharacter(r)||e.isDigitCharacter(r));return this.pos+=n,{type:i,pos:t,len:n}}i=10;do n+=1,r=this.value.charCodeAt(t+n);while(!isNaN(r)&&e._table[r]===void 0&&!e.isDigitCharacter(r)&&!e.isVariableCharacter(r));return this.pos+=n,{type:i,pos:t,len:n}}},Df=class{constructor(){this._children=[]}appendChild(e){return e instanceof Of&&this._children[this._children.length-1]instanceof Of?this._children[this._children.length-1].value+=e.value:(e.parent=this,this._children.push(e)),this}replace(e,t){let{parent:n}=e,r=n.children.indexOf(e),i=n.children.slice(0);i.splice(r,1,...t),n._children=i,(function e(t,n){for(let r of t)r.parent=n,e(r.children,r)})(t,n)}get children(){return this._children}get rightMostDescendant(){return this._children.length>0?this._children[this._children.length-1].rightMostDescendant:this}get snippet(){let e=this;for(;;){if(!e)return;if(e instanceof If)return e;e=e.parent}}toString(){return this.children.reduce((e,t)=>e+t.toString(),``)}len(){return 0}},Of=class e extends Df{constructor(e){super(),this.value=e}toString(){return this.value}len(){return this.value.length}clone(){return new e(this.value)}},kf=class extends Df{},Af=class e extends kf{static compareByIndex(e,t){return e.index===t.index?0:e.isFinalTabstop?1:t.isFinalTabstop||e.index<t.index?-1:e.index>t.index?1:0}constructor(e){super(),this.index=e}get isFinalTabstop(){return this.index===0}get choice(){return this._children.length===1&&this._children[0]instanceof jf?this._children[0]:void 0}clone(){let t=new e(this.index);return this.transform&&(t.transform=this.transform.clone()),t._children=this.children.map(e=>e.clone()),t}},jf=class e extends Df{constructor(){super(...arguments),this.options=[]}appendChild(e){return e instanceof Of&&(e.parent=this,this.options.push(e)),this}toString(){return this.options[0].value}len(){return this.options[0].len()}clone(){let t=new e;return this.options.forEach(t.appendChild,t),t}},Mf=class e extends Df{constructor(){super(...arguments),this.regexp=RegExp(``)}resolve(e){let t=this,n=!1,r=e.replace(this.regexp,function(){return n=!0,t._replace(Array.prototype.slice.call(arguments,0,-2))});return!n&&this._children.some(e=>e instanceof Nf&&!!e.elseValue)&&(r=this._replace([])),r}_replace(e){let t=``;for(let n of this._children)if(n instanceof Nf){let r=e[n.index]||``;r=n.resolve(r),t+=r}else t+=n.toString();return t}toString(){return``}clone(){let t=new e;return t.regexp=new RegExp(this.regexp.source,(this.regexp.ignoreCase?`i`:``)+(this.regexp.global?`g`:``)),t._children=this.children.map(e=>e.clone()),t}},Nf=class e extends Df{constructor(e,t,n,r){super(),this.index=e,this.shorthandName=t,this.ifValue=n,this.elseValue=r}resolve(e){return this.shorthandName===`upcase`?e?e.toLocaleUpperCase():``:this.shorthandName===`downcase`?e?e.toLocaleLowerCase():``:this.shorthandName===`capitalize`?e?e[0].toLocaleUpperCase()+e.substr(1):``:this.shorthandName===`pascalcase`?e?this._toPascalCase(e):``:this.shorthandName===`camelcase`?e?this._toCamelCase(e):``:e&&typeof this.ifValue==`string`?this.ifValue:!e&&typeof this.elseValue==`string`?this.elseValue:e||``}_toPascalCase(e){let t=e.match(/[a-z0-9]+/gi);return t?t.map(e=>e.charAt(0).toUpperCase()+e.substr(1)).join(``):e}_toCamelCase(e){let t=e.match(/[a-z0-9]+/gi);return t?t.map((e,t)=>t===0?e.charAt(0).toLowerCase()+e.substr(1):e.charAt(0).toUpperCase()+e.substr(1)).join(``):e}clone(){return new e(this.index,this.shorthandName,this.ifValue,this.elseValue)}},Pf=class e extends kf{constructor(e){super(),this.name=e}resolve(e){let t=e.resolve(this);return this.transform&&(t=this.transform.resolve(t||``)),t===void 0?!1:(this._children=[new Of(t)],!0)}clone(){let t=new e(this.name);return this.transform&&(t.transform=this.transform.clone()),t._children=this.children.map(e=>e.clone()),t}};function Ff(e,t){let n=[...e];for(;n.length>0;){let e=n.shift();if(!t(e))break;n.unshift(...e.children)}}var If=class e extends Df{get placeholderInfo(){if(!this._placeholders){let e=[],t;this.walk(function(n){return n instanceof Af&&(e.push(n),t=!t||t.index<n.index?n:t),!0}),this._placeholders={all:e,last:t}}return this._placeholders}get placeholders(){let{all:e}=this.placeholderInfo;return e}offset(e){let t=0,n=!1;return this.walk(r=>r===e?(n=!0,!1):(t+=r.len(),!0)),n?t:-1}fullLen(e){let t=0;return Ff([e],e=>(t+=e.len(),!0)),t}enclosingPlaceholders(e){let t=[],{parent:n}=e;for(;n;)n instanceof Af&&t.push(n),n=n.parent;return t}resolveVariables(e){return this.walk(t=>(t instanceof Pf&&t.resolve(e)&&(this._placeholders=void 0),!0)),this}appendChild(e){return this._placeholders=void 0,super.appendChild(e)}replace(e,t){return this._placeholders=void 0,super.replace(e,t)}clone(){let t=new e;return this._children=this.children.map(e=>e.clone()),t}walk(e){Ff(this.children,e)}},Lf=class{constructor(){this._scanner=new Ef,this._token={type:14,pos:0,len:0}}static escape(e){return e.replace(/\$|}|\\/g,`\\$&`)}static guessNeedsClipboard(e){return/\${?CLIPBOARD/.test(e)}parse(e,t,n){let r=new If;return this.parseFragment(e,r),this.ensureFinalTabstop(r,n??!1,t??!1),r}parseFragment(e,t){let n=t.children.length;for(this._scanner.text(e),this._token=this._scanner.next();this._parse(t););let r=new Map,i=[];t.walk(e=>(e instanceof Af&&(e.isFinalTabstop?r.set(0,void 0):!r.has(e.index)&&e.children.length>0?r.set(e.index,e.children):i.push(e)),!0));let a=(e,n)=>{let i=r.get(e.index);if(!i)return;let o=new Af(e.index);o.transform=e.transform;for(let e of i){let t=e.clone();o.appendChild(t),t instanceof Af&&r.has(t.index)&&!n.has(t.index)&&(n.add(t.index),a(t,n),n.delete(t.index))}t.replace(e,[o])},o=new Set;for(let e of i)a(e,o);return t.children.slice(n)}ensureFinalTabstop(e,t,n){(t||n&&e.placeholders.length>0)&&(e.placeholders.find(e=>e.index===0)||e.appendChild(new Af(0)))}_accept(e,t){if(e===void 0||this._token.type===e){let e=t?this._scanner.tokenText(this._token):!0;return this._token=this._scanner.next(),e}return!1}_backTo(e){return this._scanner.pos=e.pos+e.len,this._token=e,!1}_until(e){let t=this._token;for(;this._token.type!==e;){if(this._token.type===14)return!1;if(this._token.type===5){let e=this._scanner.next();if(e.type!==0&&e.type!==4&&e.type!==5)return!1}this._token=this._scanner.next()}let n=this._scanner.value.substring(t.pos,this._token.pos).replace(/\\(\$|}|\\)/g,`$1`);return this._token=this._scanner.next(),n}_parse(e){return this._parseEscaped(e)||this._parseTabstopOrVariableName(e)||this._parseComplexPlaceholder(e)||this._parseComplexVariable(e)||this._parseAnything(e)}_parseEscaped(e){let t;return(t=this._accept(5,!0))?(t=this._accept(0,!0)||this._accept(4,!0)||this._accept(5,!0)||t,e.appendChild(new Of(t)),!0):!1}_parseTabstopOrVariableName(e){let t,n=this._token;return this._accept(0)&&(t=this._accept(9,!0)||this._accept(8,!0))?(e.appendChild(/^\d+$/.test(t)?new Af(Number(t)):new Pf(t)),!0):this._backTo(n)}_parseComplexPlaceholder(e){let t,n=this._token;if(!(this._accept(0)&&this._accept(3)&&(t=this._accept(8,!0))))return this._backTo(n);let r=new Af(Number(t));if(this._accept(1))for(;;){if(this._accept(4))return e.appendChild(r),!0;if(!this._parse(r))return e.appendChild(new Of("${"+t+`:`)),r.children.forEach(e.appendChild,e),!0}else if(r.index>0&&this._accept(7)){let t=new jf;for(;;){if(this._parseChoiceElement(t)){if(this._accept(2))continue;if(this._accept(7)&&(r.appendChild(t),this._accept(4)))return e.appendChild(r),!0}return this._backTo(n),!1}}else if(this._accept(6))return this._parseTransform(r)?(e.appendChild(r),!0):(this._backTo(n),!1);else if(this._accept(4))return e.appendChild(r),!0;else return this._backTo(n)}_parseChoiceElement(e){let t=this._token,n=[];for(;!(this._token.type===2||this._token.type===7);){let e;if(e=(e=this._accept(5,!0))?this._accept(2,!0)||this._accept(7,!0)||this._accept(5,!0)||e:this._accept(void 0,!0),!e)return this._backTo(t),!1;n.push(e)}return n.length===0?(this._backTo(t),!1):(e.appendChild(new Of(n.join(``))),!0)}_parseComplexVariable(e){let t,n=this._token;if(!(this._accept(0)&&this._accept(3)&&(t=this._accept(9,!0))))return this._backTo(n);let r=new Pf(t);if(this._accept(1))for(;;){if(this._accept(4))return e.appendChild(r),!0;if(!this._parse(r))return e.appendChild(new Of("${"+t+`:`)),r.children.forEach(e.appendChild,e),!0}else if(this._accept(6))return this._parseTransform(r)?(e.appendChild(r),!0):(this._backTo(n),!1);else if(this._accept(4))return e.appendChild(r),!0;else return this._backTo(n)}_parseTransform(e){let t=new Mf,n=``,r=``;for(;!this._accept(6);){let e;if(e=this._accept(5,!0)){e=this._accept(6,!0)||e,n+=e;continue}if(this._token.type!==14){n+=this._accept(void 0,!0);continue}return!1}for(;!this._accept(6);){let e;if(e=this._accept(5,!0)){e=this._accept(5,!0)||this._accept(6,!0)||e,t.appendChild(new Of(e));continue}if(!(this._parseFormatString(t)||this._parseAnything(t)))return!1}for(;!this._accept(4);){if(this._token.type!==14){r+=this._accept(void 0,!0);continue}return!1}try{t.regexp=new RegExp(n,r)}catch{return!1}return e.transform=t,!0}_parseFormatString(e){let t=this._token;if(!this._accept(0))return!1;let n=!1;this._accept(3)&&(n=!0);let r=this._accept(8,!0);if(r)if(n){if(this._accept(4))return e.appendChild(new Nf(Number(r))),!0;if(!this._accept(1))return this._backTo(t),!1}else return e.appendChild(new Nf(Number(r))),!0;else return this._backTo(t),!1;if(this._accept(6)){let n=this._accept(9,!0);return!n||!this._accept(4)?(this._backTo(t),!1):(e.appendChild(new Nf(Number(r),n)),!0)}else if(this._accept(11)){let t=this._until(4);if(t)return e.appendChild(new Nf(Number(r),void 0,t,void 0)),!0}else if(this._accept(12)){let t=this._until(4);if(t)return e.appendChild(new Nf(Number(r),void 0,void 0,t)),!0}else if(this._accept(13)){let t=this._until(1);if(t){let n=this._until(4);if(n)return e.appendChild(new Nf(Number(r),void 0,t,n)),!0}}else{let t=this._until(4);if(t)return e.appendChild(new Nf(Number(r),void 0,void 0,t)),!0}return this._backTo(t),!1}_parseAnything(e){return this._token.type===14?!1:(e.appendChild(new Of(this._scanner.tokenText(this._token))),this._accept(void 0),!0)}};function Rf(e,t,n){return(typeof n.insertText==`string`?n.insertText===``:n.insertText.snippet===``)?{edits:n.additionalEdit?.edits??[]}:{edits:[...t.map(t=>new wa(e,{range:t,text:typeof n.insertText==`string`?Lf.escape(n.insertText)+`$0`:n.insertText.snippet,insertAsSnippet:!0})),...n.additionalEdit?.edits??[]]}}function zf(e){function t(e,t){return`mimeType`in e?e.mimeType===t.handledMimeType:!!t.kind&&e.kind.contains(t.kind)}let n=new Map;for(let r of e)for(let i of r.yieldTo??[])for(let a of e){if(a===r)continue;if(t(i,a)){let e=n.get(r);e||(e=[],n.set(r,e)),e.push(a)}}if(!n.size)return Array.from(e);let r=new Set,i=[];function a(e){if(!e.length)return[];let t=e[0];if(i.includes(t))return console.warn(`Yield to cycle detected`,t),e;if(r.has(t))return a(e.slice(1));let o=[],s=n.get(t);return s&&(i.push(t),o=a(s),i.pop()),r.add(t),[...o,t,...a(e.slice(1))]}return a(Array.from(e))}function Bf(e,t){return t&&(e.stack||e.stacktrace)?H(29,`{0}: {1}`,Hf(e),Vf(e.stack)||Vf(e.stacktrace)):Hf(e)}function Vf(e){return Array.isArray(e)?e.join(`
`):e}function Hf(e){return e.code===`ERR_UNC_HOST_NOT_ALLOWED`?`${e.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof e.code==`string`&&typeof e.errno==`number`&&typeof e.syscall==`string`?H(30,`A system error occurred ({0})`,e.message):e.message||H(31,`An unknown error occurred. Please consult the log for more details.`)}function Uf(e=null,t=!1){if(!e)return H(32,`An unknown error occurred. Please consult the log for more details.`);if(Array.isArray(e)){let n=vi(e),r=Uf(n[0],t);return n.length>1?H(33,`{0} ({1} errors in total)`,r,n.length):r}if(ve(e))return e;if(e.detail){let n=e.detail;if(n.error)return Bf(n.error,t);if(n.exception)return Bf(n.exception,t)}return e.stack?Bf(e,t):e.message?e.message:H(34,`An unknown error occurred. Please consult the log for more details.`)}var Wf=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Gf=function(e,t){return function(n,r){t(n,r,e)}};const Kf=`acceptSelectedCodeAction`,qf=`previewSelectedCodeAction`;var Jf=class{get templateId(){return`header`}renderTemplate(e){e.classList.add(`group-header`);let t=document.createElement(`span`);return e.append(t),{container:e,text:t}}renderElement(e,t,n){n.text.textContent=e.group?.title??e.label??``}disposeTemplate(e){}},Yf=class{get templateId(){return`separator`}renderTemplate(e){e.classList.add(`separator`);let t=document.createElement(`span`);return e.append(t),{container:e,text:t}}renderElement(e,t,n){n.text.textContent=e.label??``}disposeTemplate(e){}},Xf=class{get templateId(){return`action`}constructor(e,t){this._supportsPreview=e,this._keybindingService=t}renderTemplate(e){e.classList.add(this.templateId);let t=document.createElement(`div`);t.className=`icon`,e.append(t);let n=document.createElement(`span`);n.className=`title`,e.append(n);let r=document.createElement(`span`);r.className=`description`,e.append(r);let i=new bc(e,xs);return{container:e,icon:t,text:n,description:r,keybinding:i}}renderElement(e,t,n){if(e.group?.icon?(n.icon.className=X.asClassName(e.group.icon),e.group.icon.color&&(n.icon.style.color=C(e.group.icon.color.id))):(n.icon.className=X.asClassName(J.lightBulb),n.icon.style.color=`var(--vscode-editorLightBulb-foreground)`),!e.item||!e.label)return;Wn(!e.hideIcon,n.icon),n.text.textContent=tp(e.label),e.keybinding?(n.description.textContent=e.keybinding.getLabel(),n.description.style.display=`inline`,n.description.style.letterSpacing=`0.5px`):e.description?(n.description.textContent=tp(e.description),n.description.style.display=`inline`):(n.description.textContent=``,n.description.style.display=`none`);let r=this._keybindingService.lookupKeybinding(Kf)?.getLabel(),i=this._keybindingService.lookupKeybinding(qf)?.getLabel();n.container.classList.toggle(`option-disabled`,e.disabled),e.tooltip?n.container.title=e.tooltip:e.disabled?n.container.title=e.label:r&&i?this._supportsPreview&&e.canPreview?n.container.title=H(1635,`{0} to Apply, {1} to Preview`,r,i):n.container.title=H(1636,`{0} to Apply`,r):n.container.title=``}disposeTemplate(e){e.keybinding.dispose()}};Xf=Wf([Gf(1,zn)],Xf);var Zf=class extends UIEvent{constructor(){super(`acceptSelectedAction`)}},Qf=class extends UIEvent{constructor(){super(`previewSelectedAction`)}};function $f(e){if(e.kind===`action`)return e.label}var ep=class extends b{constructor(e,t,n,r,i,a,o,s){super(),this._delegate=r,this._contextViewService=a,this._keybindingService=o,this._layoutService=s,this._actionLineHeight=24,this._headerLineHeight=26,this._separatorLineHeight=8,this.cts=this._register(new ur),this.domNode=document.createElement(`div`),this.domNode.classList.add(`actionList`),this._list=this._register(new ht(e,this.domNode,{getHeight:e=>{switch(e.kind){case`header`:return this._headerLineHeight;case`separator`:return this._separatorLineHeight;default:return this._actionLineHeight}},getTemplateId:e=>e.kind},[new Xf(t,this._keybindingService),new Jf,new Yf],{keyboardSupport:!1,typeNavigationEnabled:!0,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:$f},accessibilityProvider:{getAriaLabel:e=>{if(e.kind===`action`){let t=e.label?tp(e?.label):``;return e.disabled&&(t=H(1637,`{0}, Disabled Reason: {1}`,t,e.disabled)),t}return null},getWidgetAriaLabel:()=>H(1638,`Action Widget`),getRole:e=>{switch(e.kind){case`action`:return`option`;case`separator`:return`separator`;default:return`separator`}},getWidgetRole:()=>`listbox`,...i}})),this._list.style(me),this._register(this._list.onMouseClick(e=>this.onListClick(e))),this._register(this._list.onMouseOver(e=>this.onListHover(e))),this._register(this._list.onDidChangeFocus(()=>this.onFocus())),this._register(this._list.onDidChangeSelection(e=>this.onListSelection(e))),this._allMenuItems=n,this._list.splice(0,this._list.length,this._allMenuItems),this._list.length&&this.focusNext()}focusCondition(e){return!e.disabled&&e.kind===`action`}hide(e){this._delegate.onHide(e),this.cts.cancel(),this._contextViewService.hideContextView()}layout(e){let t=this._allMenuItems.filter(e=>e.kind===`header`).length,n=this._allMenuItems.filter(e=>e.kind===`separator`).length,r=this._allMenuItems.length*this._actionLineHeight+t*this._headerLineHeight-t*this._actionLineHeight+n*this._separatorLineHeight-n*this._actionLineHeight;this._list.layout(r);let i=e;if(this._allMenuItems.length>=50)i=380;else{let t=this._allMenuItems.map((e,t)=>{let n=this.domNode.ownerDocument.getElementById(this._list.getElementID(t));if(n){n.style.width=`auto`;let e=n.getBoundingClientRect().width;return n.style.width=``,e}return 0});i=Math.max(...t,e)}let a=Math.min(r,this._layoutService.getContainer(su(this.domNode)).clientHeight*.7);return this._list.layout(a,i),this.domNode.style.height=`${a}px`,this._list.domFocus(),i}focusPrevious(){this._list.focusPrevious(1,!0,void 0,this.focusCondition)}focusNext(){this._list.focusNext(1,!0,void 0,this.focusCondition)}acceptSelected(e){let t=this._list.getFocus();if(t.length===0)return;let n=t[0],r=this._list.element(n);if(!this.focusCondition(r))return;let i=e?new Qf:new Zf;this._list.setSelection([n],i)}onListSelection(e){if(!e.elements.length)return;let t=e.elements[0];t.item&&this.focusCondition(t)?this._delegate.onSelect(t.item,e.browserEvent instanceof Qf):this._list.setSelection([])}onFocus(){let e=this._list.getFocus();if(e.length===0)return;let t=e[0],n=this._list.element(t);this._delegate.onFocus?.(n.item)}async onListHover(e){let t=e.element;if(t&&t.item&&this.focusCondition(t)){if(this._delegate.onHover&&!t.disabled&&t.kind===`action`){let e=await this._delegate.onHover(t.item,this.cts.token);t.canPreview=e?e.canPreview:void 0}e.index&&this._list.splice(e.index,1,[t])}this._list.setFocus(typeof e.index==`number`?[e.index]:[])}onListClick(e){e.element&&this.focusCondition(e.element)&&this._list.setFocus([])}};ep=Wf([Gf(5,Wl),Gf(6,zn),Gf(7,Uo)],ep);function tp(e){return e.replace(/\r\n|\r|\n/g,` `)}var np=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rp=function(e,t){return function(n,r){t(n,r,e)}};Y(`actionBar.toggledBackground`,ce,H(1639,`Background color for toggled action items in action bar.`));var ip={Visible:new T(`codeActionMenuVisible`,!1,H(1640,`Whether the action widget list is visible`))};const ap=dl(`actionWidgetService`);var op=class extends b{get isVisible(){return ip.Visible.getValue(this._contextKeyService)||!1}constructor(e,t,n){super(),this._contextViewService=e,this._contextKeyService=t,this._instantiationService=n,this._list=this._register(new Ot)}show(e,t,n,r,i,a,o,s){let c=ip.Visible.bindTo(this._contextKeyService),l=this._instantiationService.createInstance(ep,e,t,n,r,s);this._contextViewService.showContextView({getAnchor:()=>i,render:e=>(c.set(!0),this._renderWidget(e,l,o??[])),onHide:e=>{c.reset(),this._onWidgetClosed(e)}},a,!1)}acceptSelected(e){this._list.value?.acceptSelected(e)}focusPrevious(){this._list?.value?.focusPrevious()}focusNext(){this._list?.value?.focusNext()}hide(e){this._list.value?.hide(e),this._list.clear()}_renderWidget(e,t,n){let r=document.createElement(`div`);if(r.classList.add(`action-widget`),e.appendChild(r),this._list.value=t,this._list.value)r.appendChild(this._list.value.domNode);else throw Error(`List has no value`);let i=new P,a=document.createElement(`div`),o=e.appendChild(a);o.classList.add(`context-view-block`),i.add(U(o,Eo.MOUSE_DOWN,e=>e.stopPropagation()));let s=document.createElement(`div`),c=e.appendChild(s);c.classList.add(`context-view-pointerBlock`),i.add(U(c,Eo.POINTER_MOVE,()=>c.remove())),i.add(U(c,Eo.MOUSE_DOWN,()=>c.remove()));let l=0;if(n.length){let e=this._createActionBar(`.action-widget-action-bar`,n);e&&(r.appendChild(e.getContainer().parentElement),i.add(e),l=e.getContainer().offsetWidth)}let u=this._list.value?.layout(l);r.style.width=`${u}px`;let d=i.add(Ms(e));return i.add(d.onDidBlur(()=>this.hide(!0))),i}_createActionBar(e,t){if(!t.length)return;let n=I(e),r=new Bs(n);return r.push(t,{icon:!1,label:!0}),r}_onWidgetClosed(e){this._list.value?.hide(e)}};op=np([rp(0,Wl),rp(1,w),rp(2,k)],op),wt(ap,op,1);var sp=1100;y(class extends we{constructor(){super({id:`hideCodeActionWidget`,title:B(1641,`Hide action widget`),precondition:ip.Visible,keybinding:{weight:sp,primary:9,secondary:[1033]}})}run(e){e.get(ap).hide(!0)}}),y(class extends we{constructor(){super({id:`selectPrevCodeAction`,title:B(1642,`Select previous action`),precondition:ip.Visible,keybinding:{weight:sp,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}})}run(e){let t=e.get(ap);t instanceof op&&t.focusPrevious()}}),y(class extends we{constructor(){super({id:`selectNextCodeAction`,title:B(1643,`Select next action`),precondition:ip.Visible,keybinding:{weight:sp,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}})}run(e){let t=e.get(ap);t instanceof op&&t.focusNext()}}),y(class extends we{constructor(){super({id:Kf,title:B(1644,`Accept selected action`),precondition:ip.Visible,keybinding:{weight:sp,primary:3,secondary:[2137]}})}run(e){let t=e.get(ap);t instanceof op&&t.acceptSelected()}}),y(class extends we{constructor(){super({id:qf,title:B(1645,`Preview selected action`),precondition:ip.Visible,keybinding:{weight:sp,primary:2051}})}run(e){let t=e.get(ap);t instanceof op&&t.acceptSelected(!0)}});var cp=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},lp=function(e,t){return function(n,r){t(n,r,e)}},up,dp=class extends b{static{up=this}static{this.baseId=`editor.widget.postEditWidget`}constructor(e,t,n,r,i,a,o,s,c,l,u){super(),this.typeId=e,this.editor=t,this.showCommand=r,this.range=i,this.edits=a,this.onSelectNewEdit=o,this.additionalActions=s,this._keybindingService=l,this._actionWidgetService=u,this.allowEditorOverflow=!0,this.suppressMouseDown=!0,this.create(),this.visibleContext=n.bindTo(c),this.visibleContext.set(!0),this._register(pl(()=>this.visibleContext.reset())),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this),this._register(pl((()=>this.editor.removeContentWidget(this)))),this._register(this.editor.onDidChangeCursorPosition(e=>{this.dispose()})),this._register(vn.runAndSubscribe(l.onDidUpdateKeybindings,()=>{this._updateButtonTitle()}))}_updateButtonTitle(){let e=this._keybindingService.lookupKeybinding(this.showCommand.id)?.getLabel();this.button.element.title=this.showCommand.label+(e?` (${e})`:``)}create(){this.domNode=I(`.post-edit-widget`),this.button=this._register(new Tu(this.domNode,{supportIcons:!0})),this.button.label=`$(insert)`,this._register(U(this.domNode,Eo.CLICK,()=>this.showSelector()))}getId(){return up.baseId+`.`+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:this.range.getEndPosition(),preference:[2]}}showSelector(){let e=qc(this.button.element),t={x:e.left+e.width,y:e.top+e.height};this._actionWidgetService.show(`postEditWidget`,!1,this.edits.allEdits.map((e,t)=>({kind:`action`,item:e,label:e.title,disabled:!1,canPreview:!1,group:{title:``,icon:X.fromId(t===this.edits.activeEditIndex?J.check.id:J.blank.id)}})),{onHide:()=>{this.editor.focus()},onSelect:e=>{this._actionWidgetService.hide(!1);let t=this.edits.allEdits.findIndex(t=>t===e);if(t!==this.edits.activeEditIndex)return this.onSelectNewEdit(t)}},t,this.editor.getDomNode()??void 0,this.additionalActions)}};dp=up=cp([lp(8,w),lp(9,zn),lp(10,ap)],dp);var fp=class extends b{constructor(e,t,n,r,i,a,o,s){super(),this._id=e,this._editor=t,this._visibleContext=n,this._showCommand=r,this._getAdditionalActions=i,this._instantiationService=a,this._bulkEditService=o,this._notificationService=s,this._currentWidget=this._register(new Ot),this._register(vn.any(t.onDidChangeModel,t.onDidChangeModelContent)(()=>this.clear()))}async applyEditAndShowIfNeeded(e,t,n,r,i){if(!e.length||!this._editor.hasModel())return;let a=this._editor.getModel(),o=t.allEdits.at(t.activeEditIndex);if(!o)return;let s=async a=>{let o=this._editor.getModel();o&&(await o.undo(),this.applyEditAndShowIfNeeded(e,{activeEditIndex:a,allEdits:t.allEdits},n,r,i))},c=(r,i)=>{Pn(r)||(this._notificationService.error(i),n&&this.show(e[0],t,s))},l=new gu(this._editor,3,void 0,i),u;try{u=await qn(r(o,l.token),l.token)}catch(e){return c(e,H(929,`Error resolving edit '{0}':
{1}`,o.title,Uf(e)))}finally{l.dispose()}if(i.isCancellationRequested)return;let d=Rf(a.uri,e,u),f=e[0],p=a.deltaDecorations([],[{range:f,options:{description:`paste-line-suffix`,stickiness:0}}]);this._editor.focus();let m,h;try{m=await this._bulkEditService.apply(d,{editor:this._editor,token:i}),h=a.getDecorationRange(p[0])}catch(e){return c(e,H(930,`Error applying edit '{0}':
{1}`,o.title,Uf(e)))}finally{a.deltaDecorations(p,[])}i.isCancellationRequested||n&&m.isApplied&&t.allEdits.length>1&&this.show(h??f,t,s)}show(e,t,n){this.clear(),this._editor.hasModel()&&(this._currentWidget.value=this._instantiationService.createInstance(dp,this._id,this._editor,this._visibleContext,this._showCommand,e,t,n,this._getAdditionalActions()))}clear(){this._currentWidget.clear()}tryShowSelector(){this._currentWidget.value?.showSelector()}};fp=cp([lp(5,k),lp(6,$o),lp(7,nt)],fp);var pp=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},mp=function(e,t){return function(n,r){t(n,r,e)}},hp;const gp=`editor.changePasteType`,_p=new T(`pasteWidgetVisible`,!1,H(909,`Whether the paste widget is showing`));var vp=`application/vnd.code.copymetadata`,yp=class extends b{static{hp=this}static{this.ID=`editor.contrib.copyPasteActionController`}static get(e){return e.getContribution(hp.ID)}constructor(e,t,n,r,i,a,o,s,c,l){super(),this._logService=n,this._bulkEditService=r,this._clipboardService=i,this._commandService=a,this._configService=o,this._languageFeaturesService=s,this._quickInputService=c,this._progressService=l,this._editor=e;let u=e.getContainerDomNode();this._register(U(u,`copy`,e=>this.handleCopy(e))),this._register(U(u,`cut`,e=>this.handleCopy(e))),this._register(U(u,`paste`,e=>this.handlePaste(e),!0)),this._pasteProgressManager=this._register(new cf(`pasteIntoEditor`,e,t)),this._postPasteWidgetManager=this._register(t.createInstance(fp,`pasteIntoEditor`,e,_p,{id:gp,label:H(910,`Show paste options...`)},()=>hp._configureDefaultAction?[hp._configureDefaultAction]:[]))}changePasteType(){this._postPasteWidgetManager.tryShowSelector()}async pasteAs(e){this._logService.trace(`CopyPasteController.pasteAs`),this._editor.focus();try{this._logService.trace(`Before calling editor.action.clipboardPasteAction`),this._pasteAsActionContext={preferred:e},await this._commandService.executeCommand(`editor.action.clipboardPasteAction`)}finally{this._pasteAsActionContext=void 0}}clearWidgets(){this._postPasteWidgetManager.clear()}isPasteAsEnabled(){return this._editor.getOption(96).enabled}async finishedPaste(){await this._currentPasteOperation}handleCopy(e){let t=null;if(e.clipboardData){let[n,r]=us.getTextData(e.clipboardData);t=(r||Sa.INSTANCE.get(n))?.id||null,this._logService.trace(`CopyPasteController#handleCopy for id : `,t,` with text.length : `,n.length)}else this._logService.trace(`CopyPasteController#handleCopy`);if(!this._editor.hasTextFocus()||(this._clipboardService.clearInternalState?.(),!e.clipboardData||!this.isPasteAsEnabled()))return;let n=this._editor.getModel(),r=this._editor.getSelections();if(!n||!r?.length)return;let i=this._editor.getOption(45),a=r,o=r.length===1&&r[0].isEmpty();if(o){if(!i)return;a=[new S(a[0].startLineNumber,1,a[0].startLineNumber,1+n.getLineLength(a[0].startLineNumber))]}let s=this._editor._getViewModel()?.getPlainTextToCopy(r,i,go),c={multicursorText:Array.isArray(s)?s:null,pasteOnNewLine:o,mode:null},l=this._languageFeaturesService.documentPasteEditProvider.ordered(n).filter(e=>!!e.prepareDocumentPaste);if(!l.length){this.setCopyMetadata(e.clipboardData,{defaultPastePayload:c});return}let u=Qd(e.clipboardData),d=l.flatMap(e=>e.copyMimeTypes??[]),f=t??Jc();this.setCopyMetadata(e.clipboardData,{id:f,providerCopyMimeTypes:d,defaultPastePayload:c});let p=l.map(e=>({providerMimeTypes:e.copyMimeTypes,operation:bu(t=>e.prepareDocumentPaste(n,a,u,t).catch(e=>{console.error(e)}))}));hp._currentCopyOperation?.operations.forEach(e=>e.operation.cancel()),hp._currentCopyOperation={handle:f,operations:p}}async handlePaste(e){if(e.clipboardData){let[t,n]=us.getTextData(e.clipboardData),r=n||Sa.INSTANCE.get(t);this._logService.trace(`CopyPasteController#handlePaste for id : `,r?.id)}else this._logService.trace(`CopyPasteController#handlePaste`);if(!e.clipboardData||!this._editor.hasTextFocus())return;ff.get(this._editor)?.closeMessage(),this._currentPasteOperation?.cancel(),this._currentPasteOperation=void 0;let t=this._editor.getModel(),n=this._editor.getSelections();if(!n?.length||!t||this._editor.getOption(103)||!this.isPasteAsEnabled()&&!this._pasteAsActionContext)return;let r=this.fetchCopyMetadata(e);this._logService.trace(`CopyPasteController#handlePaste with metadata : `,r?.id,` and text.length : `,e.clipboardData.getData(`text/plain`).length);let i=tf(e.clipboardData);i.delete(vp);let a=Array.from(e.clipboardData.files).map(e=>e.type),o=[...e.clipboardData.types,...a,...r?.providerCopyMimeTypes??[],Si.uriList],s=this._languageFeaturesService.documentPasteEditProvider.ordered(t).filter(e=>{let t=this._pasteAsActionContext?.preferred;return t&&!this.providerMatchesPreference(e,t)?!1:e.pasteMimeTypes?.some(e=>Wd(e,o))});if(!s.length){this._pasteAsActionContext?.preferred&&(this.showPasteAsNoEditMessage(n,this._pasteAsActionContext.preferred),e.preventDefault(),e.stopImmediatePropagation());return}e.preventDefault(),e.stopImmediatePropagation(),this._pasteAsActionContext?this.showPasteAsPick(this._pasteAsActionContext.preferred,s,n,i,r):this.doPasteInline(s,n,i,r,e)}showPasteAsNoEditMessage(e,t){let n=`only`in t?t.only.value:`preferences`in t?t.preferences.length?t.preferences.map(e=>e.value).join(`, `):H(911,`empty`):t.providerId;ff.get(this._editor)?.showMessage(H(912,`No paste edits for '{0}' found`,n),e[0].getStartPosition())}doPasteInline(e,t,n,r,i){this._logService.trace(`CopyPasteController#doPasteInline`);let a=this._editor;if(!a.hasModel())return;let o=new gu(a,3,void 0),s=bu(async a=>{let c=this._editor;if(!c.hasModel())return;let l=c.getModel(),u=new P,d=u.add(new ur(a));u.add(o.token.onCancellationRequested(()=>d.cancel()));let f=d.token;try{if(await this.mergeInDataFromCopy(e,n,r,f),f.isCancellationRequested)return;let a=e.filter(e=>this.isSupportedPasteProvider(e,n));if(!a.length||a.length===1&&a[0]instanceof vf)return this.applyDefaultPasteHandler(n,r,f,i);let o={triggerKind:fo.Automatic},s=await this.getPasteEdits(a,n,l,t,o,f);if(u.add(s),f.isCancellationRequested)return;if(s.edits.length===1&&s.edits[0].provider instanceof vf)return this.applyDefaultPasteHandler(n,r,f,i);if(s.edits.length){let e=c.getOption(96).showPasteSelector===`afterPaste`;return this._postPasteWidgetManager.applyEditAndShowIfNeeded(t,{activeEditIndex:this.getInitialActiveEditIndex(l,s.edits),allEdits:s.edits},e,async(e,n)=>{if(!e.provider.resolveDocumentPasteEdit)return e;let r=e.provider.resolveDocumentPasteEdit(e,n),i=new Uu,a=await this._pasteProgressManager.showWhile(t[0].getEndPosition(),H(913,`Resolving paste edit for '{0}'. Click to cancel`,e.title),Me(Promise.race([i.p,r]),n),{cancel:()=>i.cancel()},0);return a&&(e.insertText=a.insertText,e.additionalEdit=a.additionalEdit),e},f)}await this.applyDefaultPasteHandler(n,r,f,i)}finally{u.dispose(),this._currentPasteOperation===s&&(this._currentPasteOperation=void 0)}});this._pasteProgressManager.showWhile(t[0].getEndPosition(),H(914,`Running paste handlers. Click to cancel and do basic paste`),s,{cancel:async()=>{s.cancel(),!o.token.isCancellationRequested&&await this.applyDefaultPasteHandler(n,r,o.token,i)}}).finally(()=>{o.dispose()}),this._currentPasteOperation=s}showPasteAsPick(e,t,n,r,i){this._logService.trace(`CopyPasteController#showPasteAsPick`);let a=bu(async o=>{let s=this._editor;if(!s.hasModel())return;let c=s.getModel(),l=new P,u=l.add(new gu(s,3,void 0,o));try{if(await this.mergeInDataFromCopy(t,r,i,u.token),u.token.isCancellationRequested)return;let a=t.filter(t=>this.isSupportedPasteProvider(t,r,e));e&&(a=a.filter(t=>this.providerMatchesPreference(t,e)));let o={triggerKind:fo.PasteAs,only:e&&`only`in e?e.only:void 0},s=l.add(await this.getPasteEdits(a,r,c,n,o,u.token));if(u.token.isCancellationRequested)return;if(e&&(s={edits:s.edits.filter(t=>`only`in e?e.only.contains(t.kind):`preferences`in e?e.preferences.some(e=>e.contains(t.kind)):e.providerId===t.provider.id),dispose:s.dispose}),!s.edits.length){e&&this.showPasteAsNoEditMessage(n,e);return}let d;if(e)d=s.edits.at(0);else{let e={id:`editor.pasteAs.default`,label:H(915,`Configure default paste action`),edit:void 0},t=await this._quickInputService.pick([...s.edits.map(e=>({label:e.title,description:e.kind?.value,edit:e})),...hp._configureDefaultAction?[Xr({type:`separator`}),{label:hp._configureDefaultAction.label,edit:void 0}]:[]],{placeHolder:H(916,`Select Paste Action`)});if(t===e){hp._configureDefaultAction?.run();return}d=t?.edit}if(!d)return;let f=Rf(c.uri,n,d);await this._bulkEditService.apply(f,{editor:this._editor})}finally{l.dispose(),this._currentPasteOperation===a&&(this._currentPasteOperation=void 0)}});this._progressService.withProgress({location:10,title:H(917,`Running paste handlers`)},()=>a)}setCopyMetadata(e,t){this._logService.trace(`CopyPasteController#setCopyMetadata new id : `,t.id),e.setData(vp,JSON.stringify(t))}fetchCopyMetadata(e){if(this._logService.trace(`CopyPasteController#fetchCopyMetadata`),!e.clipboardData)return;let t=e.clipboardData.getData(vp);if(t)try{return JSON.parse(t)}catch{return}let[n,r]=us.getTextData(e.clipboardData);if(r)return{defaultPastePayload:{mode:r.mode,multicursorText:r.multicursorText??null,pasteOnNewLine:!!r.isFromEmptySelection}}}async mergeInDataFromCopy(e,t,n,r){if(this._logService.trace(`CopyPasteController#mergeInDataFromCopy with metadata : `,n?.id),n?.id&&hp._currentCopyOperation?.handle===n.id){let n=hp._currentCopyOperation.operations.filter(t=>e.some(e=>e.pasteMimeTypes.some(e=>Wd(e,t.providerMimeTypes)))).map(e=>e.operation),i=await Promise.all(n);if(r.isCancellationRequested)return;for(let e of i.reverse())if(e)for(let[n,r]of e)t.replace(n,r)}if(!t.has(Si.uriList)){let e=await this._clipboardService.readResources();if(r.isCancellationRequested)return;e.length&&t.append(Si.uriList,Bd(Kd.create(e)))}}async getPasteEdits(e,t,n,r,i,a){let o=new P,s=await Me(Promise.all(e.map(async e=>{try{let s=await e.provideDocumentPasteEdits?.(n,r,t,i,a);return s&&o.add(s),s?.edits?.map(t=>({...t,provider:e}))}catch(e){Pn(e)||console.error(e);return}})),a),c=vi(s??[]).flat().filter(e=>!i.only||i.only.contains(e.kind));return{edits:zf(c),dispose:()=>o.dispose()}}async applyDefaultPasteHandler(e,t,n,r){let i=await(e.get(Si.text)??e.get(`text`))?.asString()??``;if(n.isCancellationRequested)return;let a={clipboardEvent:r,text:i,pasteOnNewLine:t?.defaultPastePayload.pasteOnNewLine??!1,multicursorText:t?.defaultPastePayload.multicursorText??null,mode:null};this._logService.trace(`CopyPasteController#applyDefaultPasteHandler for id : `,t?.id),this._editor.trigger(`keyboard`,`paste`,a)}isSupportedPasteProvider(e,t,n){return e.pasteMimeTypes?.some(e=>t.matches(e))?!n||this.providerMatchesPreference(e,n):!1}providerMatchesPreference(e,t){return`only`in t?e.providedPasteEditKinds.some(e=>t.only.contains(e)):`preferences`in t?t.preferences.some(e=>t.preferences.some(t=>t.contains(e))):e.id===t.providerId}getInitialActiveEditIndex(e,t){let n=this._configService.getValue(`editor.pasteAs.preferences`,{resource:e.uri});for(let e of Array.isArray(n)?n:[]){let n=new qd(e),r=t.findIndex(e=>n.contains(e.kind));if(r>=0)return r}return 0}};yp=hp=pp([mp(1,k),mp(2,za),mp(3,$o),mp(4,zt),mp(5,Mr),mp(6,Ni),mp(7,W),mp(8,xe),mp(9,yo)],yp);var bp=`9_cutcopypaste`,xp=rc||document.queryCommandSupported(`cut`),Sp=rc||document.queryCommandSupported(`copy`),Cp=navigator.clipboard===void 0||In?document.queryCommandSupported(`paste`):!0;function wp(e){return e.register(),e}const Tp=xp?wp(new ma({id:`editor.action.clipboardCutAction`,precondition:void 0,kbOpts:rc?{primary:2102,win:{primary:2102,secondary:[1044]},weight:100}:void 0,menuOpts:[{menuId:M.MenubarEditMenu,group:`2_ccp`,title:H(806,`Cu&&t`),order:1},{menuId:M.EditorContext,group:bp,title:H(807,`Cut`),when:F.writable,order:1},{menuId:M.CommandPalette,group:``,title:H(808,`Cut`),order:1},{menuId:M.SimpleEditorContext,group:bp,title:H(809,`Cut`),when:F.writable,order:1}]})):void 0,Ep=Sp?wp(new ma({id:`editor.action.clipboardCopyAction`,precondition:void 0,kbOpts:rc?{primary:2081,win:{primary:2081,secondary:[2067]},weight:100}:void 0,menuOpts:[{menuId:M.MenubarEditMenu,group:`2_ccp`,title:H(810,`&&Copy`),order:2},{menuId:M.EditorContext,group:bp,title:H(811,`Copy`),order:2},{menuId:M.CommandPalette,group:``,title:H(812,`Copy`),order:1},{menuId:M.SimpleEditorContext,group:bp,title:H(813,`Copy`),order:2}]})):void 0;Ie.appendMenuItem(M.MenubarEditMenu,{submenu:M.MenubarCopy,title:B(818,`Copy As`),group:`2_ccp`,order:3}),Ie.appendMenuItem(M.EditorContext,{submenu:M.EditorContextCopy,title:B(819,`Copy As`),group:bp,order:3}),Ie.appendMenuItem(M.EditorContext,{submenu:M.EditorContextShare,title:B(820,`Share`),group:`11_share`,order:-1,when:j.and(j.notEquals(`resourceScheme`,`output`),F.editorTextFocus)}),Ie.appendMenuItem(M.ExplorerContext,{submenu:M.ExplorerContextShare,title:B(821,`Share`),group:`11_share`,order:-1});const Dp=Cp?wp(new ma({id:`editor.action.clipboardPasteAction`,precondition:void 0,kbOpts:rc?{primary:2100,win:{primary:2100,secondary:[1043]},linux:{primary:2100,secondary:[1043]},weight:100}:void 0,menuOpts:[{menuId:M.MenubarEditMenu,group:`2_ccp`,title:H(814,`&&Paste`),order:4},{menuId:M.EditorContext,group:bp,title:H(815,`Paste`),when:F.writable,order:4},{menuId:M.CommandPalette,group:``,title:H(816,`Paste`),order:1},{menuId:M.SimpleEditorContext,group:bp,title:H(817,`Paste`),when:F.writable,order:4}]})):void 0;var Op=class extends D{constructor(){super({id:`editor.action.clipboardCopyWithSyntaxHighlightingAction`,label:B(822,`Copy with Syntax Highlighting`),precondition:void 0,kbOpts:{kbExpr:F.textInputFocus,primary:0,weight:100}})}run(e,t){let n=e.get(za);n.trace(`ExecCommandCopyWithSyntaxHighlightingAction#run`),t.hasModel()&&(!t.getOption(45)&&t.getSelection().isEmpty()||(Zo.forceCopyWithSyntaxHighlighting=!0,t.focus(),n.trace(`ExecCommandCopyWithSyntaxHighlightingAction (before execCommand copy)`),t.getContainerDomNode().ownerDocument.execCommand(`copy`),n.trace(`ExecCommandCopyWithSyntaxHighlightingAction (after execCommand copy)`),Zo.forceCopyWithSyntaxHighlighting=!1))}};function kp(e,t){e&&(e.addImplementation(1e4,`code-editor`,(e,n)=>{let r=e.get(za);r.trace(`registerExecCommandImpl (addImplementation code-editor for : `,t,`)`);let i=e.get(mt).getFocusedCodeEditor();if(i&&i.hasTextFocus()){let e=i.getOption(45),n=i.getSelection();return n&&n.isEmpty()&&!e||(i.getOption(169)&&t===`cut`?(Ap(i),r.trace(`registerExecCommandImpl (before execCommand copy)`),i.getContainerDomNode().ownerDocument.execCommand(`copy`),i.trigger(void 0,`cut`,void 0),r.trace(`registerExecCommandImpl (after execCommand copy)`)):(Ap(i),r.trace(`registerExecCommandImpl (before execCommand `+t+`)`),i.getContainerDomNode().ownerDocument.execCommand(t),r.trace(`registerExecCommandImpl (after execCommand `+t+`)`))),!0}return!1}),e.addImplementation(0,`generic-dom`,(e,n)=>{let r=e.get(za);return r.trace(`registerExecCommandImpl (addImplementation generic-dom for : `,t,`)`),r.trace(`registerExecCommandImpl (before execCommand `+t+`)`),no().execCommand(t),r.trace(`registerExecCommandImpl (after execCommand `+t+`)`),!0}))}function Ap(e){if(e.getOption(169)){let t=Xs.get(e.getId());t&&t.onWillCopy()}}kp(Tp,`cut`),kp(Ep,`copy`),Dp&&(Dp.addImplementation(1e4,`code-editor`,(e,t)=>{let n=e.get(za);n.trace(`registerExecCommandImpl (addImplementation code-editor for : paste)`);let r=e.get(mt),i=e.get(zt),a=e.get(Wr),o=e.get(zd),s=r.getFocusedCodeEditor();if(s&&s.hasModel()&&s.hasTextFocus()){if(s.getOption(169)){let e=Xs.get(s.getId());e&&e.onWillPaste()}let e=ad.create(!0);n.trace(`registerExecCommandImpl (before triggerPaste)`);let t=i.triggerPaste(Yl().vscodeWindowId);return t?(n.trace(`registerExecCommandImpl (triggerPaste defined)`),t.then(async()=>{if(n.trace(`registerExecCommandImpl (after triggerPaste)`),o.quality!==`stable`){let t=e.elapsed();a.publicLog2(`editorAsyncPaste`,{duration:t})}return yp.get(s)?.finishedPaste()??Promise.resolve()})):(n.trace(`registerExecCommandImpl (triggerPaste undefined)`),Xl?(n.trace(`registerExecCommandImpl (Paste handling on web)`),(async()=>{let e=await i.readText();if(e!==``){let t=Sa.INSTANCE.get(e),r=!1,i=null,a=null;t&&(r=s.getOption(45)&&!!t.isFromEmptySelection,i=t.multicursorText===void 0?null:t.multicursorText,a=t.mode),n.trace(`registerExecCommandImpl (clipboardText.length : `,e.length,` id : `,t?.id,`)`),s.trigger(`keyboard`,`paste`,{text:e,pasteOnNewLine:r,multicursorText:i,mode:a})}})()):!0)}return!1}),Dp.addImplementation(0,`generic-dom`,(e,t)=>(e.get(za).trace(`registerExecCommandImpl (addImplementation generic-dom for : paste)`),e.get(zt).triggerPaste(Yl().vscodeWindowId)??!1))),Sp&&s(Op);const jp=new class{constructor(){this.QuickFix=new qd(`quickfix`),this.Refactor=new qd(`refactor`),this.RefactorExtract=this.Refactor.append(`extract`),this.RefactorInline=this.Refactor.append(`inline`),this.RefactorMove=this.Refactor.append(`move`),this.RefactorRewrite=this.Refactor.append(`rewrite`),this.Notebook=new qd(`notebook`),this.Source=new qd(`source`),this.SourceOrganizeImports=this.Source.append(`organizeImports`),this.SourceFixAll=this.Source.append(`fixAll`),this.SurroundWith=this.Refactor.append(`surround`)}};var Mp;(function(e){e.Refactor=`refactor`,e.RefactorPreview=`refactor preview`,e.Lightbulb=`lightbulb`,e.Default=`other (default)`,e.SourceAction=`source action`,e.QuickFix=`quick fix action`,e.FixAll=`fix all`,e.OrganizeImports=`organize imports`,e.AutoFix=`auto fix`,e.QuickFixHover=`quick fix hover window`,e.OnSave=`save participants`,e.ProblemsView=`problems view`})(Mp||={});function Np(e,t){return!(e.include&&!e.include.intersects(t)||e.excludes&&e.excludes.some(n=>Fp(t,n,e.include))||!e.includeSourceActions&&jp.Source.contains(t))}function Pp(e,t){let n=t.kind?new qd(t.kind):void 0;return!(e.include&&(!n||!e.include.contains(n))||e.excludes&&n&&e.excludes.some(t=>Fp(n,t,e.include))||!e.includeSourceActions&&n&&jp.Source.contains(n)||e.onlyIncludePreferredActions&&!t.isPreferred)}function Fp(e,t,n){return!(!t.contains(e)||n&&t.contains(n))}var Ip=class e{static fromUser(t,n){return!t||typeof t!=`object`?new e(n.kind,n.apply,!1):new e(e.getKindFromUser(t,n.kind),e.getApplyFromUser(t,n.apply),e.getPreferredUser(t))}static getApplyFromUser(e,t){switch(typeof e.apply==`string`?e.apply.toLowerCase():``){case`first`:return`first`;case`never`:return`never`;case`ifsingle`:return`ifSingle`;default:return t}}static getKindFromUser(e,t){return typeof e.kind==`string`?new qd(e.kind):t}static getPreferredUser(e){return typeof e.preferred==`boolean`?e.preferred:!1}constructor(e,t,n){this.kind=e,this.apply=t,this.preferred=n}},Lp=class{constructor(e,t,n){this.action=e,this.provider=t,this.highlightRange=n}async resolve(e){if(this.provider?.resolveCodeAction&&!this.action.edit){let t;try{t=await this.provider.resolveCodeAction(this.action,e)}catch(e){Ze(e)}t&&(this.action.edit=t.edit)}return this}};const Rp=`editor.action.codeAction`,zp=`editor.action.quickFix`,Bp=`editor.action.refactor`,Vp=`editor.action.sourceAction`,Hp=`editor.action.organizeImports`,Up=`editor.action.fixAll`;var Wp=1e3,Gp=class e extends b{static codeActionsPreferredComparator(e,t){return e.isPreferred&&!t.isPreferred?-1:!e.isPreferred&&t.isPreferred?1:0}static codeActionsComparator({action:t},{action:n}){return t.isAI&&!n.isAI?1:!t.isAI&&n.isAI?-1:Ht(t.diagnostics)?Ht(n.diagnostics)?e.codeActionsPreferredComparator(t,n):-1:Ht(n.diagnostics)?1:e.codeActionsPreferredComparator(t,n)}constructor(t,n,r){super(),this.documentation=n,this._register(r),this.allActions=[...t].sort(e.codeActionsComparator),this.validActions=this.allActions.filter(({action:e})=>!e.disabled)}get hasAutoFix(){return this.validActions.some(({action:e})=>!!e.kind&&jp.QuickFix.contains(new qd(e.kind))&&!!e.isPreferred)}get hasAIFix(){return this.validActions.some(({action:e})=>!!e.isAI)}get allAIFixes(){return this.validActions.every(({action:e})=>!!e.isAI)}},Kp={actions:[],documentation:void 0};async function qp(e,t,n,r,i,a){let o=r.filter||{},s={...o,excludes:[...o.excludes||[],jp.Notebook]},c={only:o.include?.value,trigger:r.type},l=new qr(t,a),u=r.type===2,d=Jp(e,t,u?s:o),f=new P,p=d.map(async e=>{let r=setTimeout(()=>i.report(e),1250);try{let r=await e.provideCodeActions(t,n,c,l.token);if(l.token.isCancellationRequested)return r?.dispose(),Kp;r&&f.add(r);let i=(r?.actions||[]).filter(e=>e&&Pp(o,e)),a=Xp(e,i,o.include);return{actions:i.map(t=>new Lp(t,e)),documentation:a}}catch(e){if(Pn(e))throw e;return Ze(e),Kp}finally{clearTimeout(r)}}),m=e.onDidChange(()=>{let n=e.all(t);ct(n,d)||l.cancel()});try{let n=await Promise.all(p),i=n.map(e=>e.actions).flat(),a=[...vi(n.map(e=>e.documentation)),...Yp(e,t,r,i)],o=new Gp(i,a,f);return f.add(o),o}catch(e){throw f.dispose(),e}finally{m.dispose(),l.dispose()}}function Jp(e,t,n){return e.all(t).filter(e=>e.providedCodeActionKinds?e.providedCodeActionKinds.some(e=>Np(n,new qd(e))):!0)}function*Yp(e,t,n,r){if(t&&r.length)for(let i of e.all(t))i._getAdditionalMenuItems&&(yield*i._getAdditionalMenuItems?.({trigger:n.type,only:n.filter?.include?.value},r.map(e=>e.action)))}function Xp(e,t,n){if(!e.documentation)return;let r=e.documentation.map(e=>({kind:new qd(e.kind),command:e.command}));if(n){let e;for(let t of r)t.kind.contains(n)&&(e?e.kind.contains(t.kind)&&(e=t):e=t);if(e)return e?.command}for(let e of t){if(!e.kind)continue;for(let t of r)if(t.kind.contains(new qd(e.kind)))return t.command}}var Zp;(function(e){e.OnSave=`onSave`,e.FromProblemsView=`fromProblemsView`,e.FromCodeActions=`fromCodeActions`,e.FromAILightbulb=`fromAILightbulb`,e.FromProblemsHover=`fromProblemsHover`})(Zp||={});async function Qp(e,t,n,r,i=A.None){let a=e.get($o),o=e.get(Mr),s=e.get(Wr),c=e.get(nt),l=e.get(nl);if(s.publicLog2(`codeAction.applyCodeAction`,{codeActionTitle:t.action.title,codeActionKind:t.action.kind,codeActionIsPreferred:!!t.action.isPreferred,reason:n}),l.playSignal(Xt.codeActionTriggered),await t.resolve(i),!i.isCancellationRequested&&!(t.action.edit?.edits.length&&!(await a.apply(t.action.edit,{editor:r?.editor,label:t.action.title,quotableLabel:t.action.title,code:`undoredo.codeAction`,respectAutoSaveConfig:n!==Zp.OnSave,showPreview:r?.preview,reason:Xa.codeAction({kind:t.action.kind,providerId:ka.fromExtensionId(t.provider?.extensionId)})})).isApplied)){if(t.action.command)try{await o.executeCommand(t.action.command.id,...t.action.command.arguments||[])}catch(e){let t=$p(e);c.error(typeof t==`string`?t:H(823,`An unknown error occurred while applying the code action`))}setTimeout(()=>l.playSignal(Xt.codeActionApplied),Wp)}}function $p(e){if(typeof e==`string`)return e;if(e instanceof Error&&typeof e.message==`string`)return e.message}gn.registerCommand(`_executeCodeActionProvider`,async function(e,t,n,r,i){if(!(t instanceof $n))throw Sn();let{codeActionProvider:a}=e.get(W),o=e.get(Fi).getModel(t);if(!o)throw Sn();let s=N.isISelection(n)?N.liftSelection(n):S.isIRange(n)?o.validateRange(n):void 0;if(!s)throw Sn();let c=typeof r==`string`?new qd(r):void 0,l=await qp(a,o,s,{type:1,triggerAction:Mp.Default,filter:{includeSourceActions:!0,include:c}},Vo.None,A.None),u=[],d=Math.min(l.validActions.length,typeof i==`number`?i:0);for(let e=0;e<d;e++)u.push(l.validActions[e].resolve(A.None));try{return await Promise.all(u),l.validActions.map(e=>e.action)}finally{setTimeout(()=>l.dispose(),100)}});var em=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},tm=function(e,t){return function(n,r){t(n,r,e)}},nm,rm=class{static{nm=this}static{this.codeActionCommands=[Bp,Rp,Vp,Hp,Up]}constructor(e){this.keybindingService=e}getResolver(){let e=new Nc(()=>this.keybindingService.getKeybindings().filter(e=>nm.codeActionCommands.indexOf(e.command)>=0).filter(e=>e.resolvedKeybinding).map(e=>{let t=e.commandArgs;return e.command===`editor.action.organizeImports`?t={kind:jp.SourceOrganizeImports.value}:e.command===`editor.action.fixAll`&&(t={kind:jp.SourceFixAll.value}),{resolvedKeybinding:e.resolvedKeybinding,...Ip.fromUser(t,{kind:qd.None,apply:`never`})}}));return t=>{if(t.kind)return this.bestKeybindingForCodeAction(t,e.value)?.resolvedKeybinding}}bestKeybindingForCodeAction(e,t){if(!e.kind)return;let n=new qd(e.kind);return t.filter(e=>e.kind.contains(n)).filter(t=>t.preferred?e.isPreferred:!0).reduceRight((e,t)=>e?e.kind.contains(t.kind)?t:e:t,void 0)}};rm=nm=em([tm(0,zn)],rm),Y(`symbolIcon.arrayForeground`,Mn,H(1477,`The foreground color for array symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.booleanForeground`,Mn,H(1478,`The foreground color for boolean symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.classForeground`,{dark:`#EE9D28`,light:`#D67E00`,hcDark:`#EE9D28`,hcLight:`#D67E00`},H(1479,`The foreground color for class symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.colorForeground`,Mn,H(1480,`The foreground color for color symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.constantForeground`,Mn,H(1481,`The foreground color for constant symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.constructorForeground`,{dark:`#B180D7`,light:`#652D90`,hcDark:`#B180D7`,hcLight:`#652D90`},H(1482,`The foreground color for constructor symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.enumeratorForeground`,{dark:`#EE9D28`,light:`#D67E00`,hcDark:`#EE9D28`,hcLight:`#D67E00`},H(1483,`The foreground color for enumerator symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.enumeratorMemberForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},H(1484,`The foreground color for enumerator member symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.eventForeground`,{dark:`#EE9D28`,light:`#D67E00`,hcDark:`#EE9D28`,hcLight:`#D67E00`},H(1485,`The foreground color for event symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.fieldForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},H(1486,`The foreground color for field symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.fileForeground`,Mn,H(1487,`The foreground color for file symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.folderForeground`,Mn,H(1488,`The foreground color for folder symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.functionForeground`,{dark:`#B180D7`,light:`#652D90`,hcDark:`#B180D7`,hcLight:`#652D90`},H(1489,`The foreground color for function symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.interfaceForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},H(1490,`The foreground color for interface symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.keyForeground`,Mn,H(1491,`The foreground color for key symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.keywordForeground`,Mn,H(1492,`The foreground color for keyword symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.methodForeground`,{dark:`#B180D7`,light:`#652D90`,hcDark:`#B180D7`,hcLight:`#652D90`},H(1493,`The foreground color for method symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.moduleForeground`,Mn,H(1494,`The foreground color for module symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.namespaceForeground`,Mn,H(1495,`The foreground color for namespace symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.nullForeground`,Mn,H(1496,`The foreground color for null symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.numberForeground`,Mn,H(1497,`The foreground color for number symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.objectForeground`,Mn,H(1498,`The foreground color for object symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.operatorForeground`,Mn,H(1499,`The foreground color for operator symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.packageForeground`,Mn,H(1500,`The foreground color for package symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.propertyForeground`,Mn,H(1501,`The foreground color for property symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.referenceForeground`,Mn,H(1502,`The foreground color for reference symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.snippetForeground`,Mn,H(1503,`The foreground color for snippet symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.stringForeground`,Mn,H(1504,`The foreground color for string symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.structForeground`,Mn,H(1505,`The foreground color for struct symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.textForeground`,Mn,H(1506,`The foreground color for text symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.typeParameterForeground`,Mn,H(1507,`The foreground color for type parameter symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.unitForeground`,Mn,H(1508,`The foreground color for unit symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),Y(`symbolIcon.variableForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},H(1509,`The foreground color for variable symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`));var im=Object.freeze({kind:qd.Empty,title:H(859,`More Actions...`)}),am=Object.freeze([{kind:jp.QuickFix,title:H(860,`Quick Fix`)},{kind:jp.RefactorExtract,title:H(861,`Extract`),icon:J.wrench},{kind:jp.RefactorInline,title:H(862,`Inline`),icon:J.wrench},{kind:jp.RefactorRewrite,title:H(863,`Rewrite`),icon:J.wrench},{kind:jp.RefactorMove,title:H(864,`Move`),icon:J.wrench},{kind:jp.SurroundWith,title:H(865,`Surround With`),icon:J.surroundWith},{kind:jp.Source,title:H(866,`Source Action`),icon:J.symbolFile},im]);function om(e,t,n){if(!t)return e.map(e=>({kind:`action`,item:e,group:im,disabled:!!e.action.disabled,label:e.action.disabled||e.action.title,canPreview:!!e.action.edit?.edits.length}));let r=am.map(e=>({group:e,actions:[]}));for(let t of e){let e=t.action.kind?new qd(t.action.kind):qd.None;for(let n of r)if(n.group.kind.contains(e)){n.actions.push(t);break}}let i=[];for(let e of r)if(e.actions.length){i.push({kind:`header`,group:e.group});for(let t of e.actions){let r=e.group;i.push({kind:`action`,item:t,group:t.action.isAI?{title:r.title,kind:r.kind,icon:J.sparkle}:r,label:t.action.title,disabled:!!t.action.disabled,keybinding:n(t.action)})}}return i}const sm=new T(`supportedCodeAction`,``);var cm=class extends b{constructor(e,t,n,r=250){super(),this._editor=e,this._markerService=t,this._signalChange=n,this._delay=r,this._autoTriggerTimer=this._register(new Br),this._register(this._markerService.onMarkerChanged(e=>this._onMarkerChanges(e))),this._register(this._editor.onDidChangeCursorPosition(()=>this._tryAutoTrigger()))}trigger(e){let t=this._getRangeOfSelectionUnlessWhitespaceEnclosed(e);this._signalChange(t?{trigger:e,selection:t}:void 0)}_onMarkerChanges(e){let t=this._editor.getModel();t&&e.some(e=>hs(e,t.uri))&&this._tryAutoTrigger()}_tryAutoTrigger(){this._autoTriggerTimer.cancelAndSet(()=>{this.trigger({type:2,triggerAction:Mp.Default})},this._delay)}_getRangeOfSelectionUnlessWhitespaceEnclosed(e){if(!this._editor.hasModel())return;let t=this._editor.getSelection();if(e.type===1)return t;let n=this._editor.getOption(73).enabled;if(n!==Sr.Off){if(n===Sr.On)return t;if(n===Sr.OnCode){if(!t.isEmpty())return t;let e=this._editor.getModel(),{lineNumber:n,column:r}=t.getPosition(),i=e.getLineContent(n);if(i.length===0)return;if(r===1){if(/\s/.test(i[0]))return}else if(r===e.getLineMaxColumn(n)){if(/\s/.test(i[i.length-1]))return}else if(/\s/.test(i[r-2])&&/\s/.test(i[r-1]))return}return t}}},lm;(function(e){e.Empty={type:0};class t{constructor(e,t,n){this.trigger=e,this.position=t,this._cancellablePromise=n,this.type=1,this.actions=n.catch(e=>{if(Pn(e))return um;throw e})}cancel(){this._cancellablePromise.cancel()}}e.Triggered=t})(lm||={});var um=Object.freeze({allActions:[],validActions:[],dispose:()=>{},documentation:[],hasAutoFix:!1,hasAIFix:!1,allAIFixes:!1}),dm=class extends b{constructor(e,t,n,r,i,a){super(),this._editor=e,this._registry=t,this._markerService=n,this._progressService=i,this._configurationService=a,this._codeActionOracle=this._register(new Ot),this._state=lm.Empty,this._onDidChangeState=this._register(new E),this.onDidChangeState=this._onDidChangeState.event,this.codeActionsDisposable=this._register(new Ot),this._disposed=!1,this._supportedCodeActions=sm.bindTo(r),this._register(this._editor.onDidChangeModel(()=>this._update())),this._register(this._editor.onDidChangeModelLanguage(()=>this._update())),this._register(this._registry.onDidChange(()=>this._update())),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(73)&&this._update()})),this._update()}dispose(){this._disposed||(this._disposed=!0,super.dispose(),this.setState(lm.Empty,!0))}_settingEnabledNearbyQuickfixes(){let e=this._editor?.getModel();return this._configurationService?this._configurationService.getValue(`editor.codeActionWidget.includeNearbyQuickFixes`,{resource:e?.uri}):!1}_update(){if(this._disposed)return;this._codeActionOracle.value=void 0,this.setState(lm.Empty);let e=this._editor.getModel();if(e&&this._registry.has(e)&&!this._editor.getOption(103)){let t=this._registry.all(e).flatMap(e=>e.providedCodeActionKinds??[]);this._supportedCodeActions.set(t.join(` `)),this._codeActionOracle.value=new cm(this._editor,this._markerService,t=>{if(!t){this.setState(lm.Empty);return}let n=t.selection.getStartPosition(),r=bu(async n=>{if(this._settingEnabledNearbyQuickfixes()&&t.trigger.type===1&&(t.trigger.triggerAction===Mp.QuickFix||t.trigger.filter?.include?.contains(jp.QuickFix))){let r=await qp(this._registry,e,t.selection,t.trigger,Vo.None,n);this.codeActionsDisposable.value=r;let i=[...r.allActions];if(n.isCancellationRequested)return r.dispose(),um;let a=r.validActions?.some(e=>e.action.kind&&jp.QuickFix.contains(new qd(e.action.kind))&&!e.action.isAI),o=this._markerService.read({resource:e.uri});if(a){for(let e of r.validActions)e.action.command?.arguments?.some(e=>typeof e==`string`&&e.includes(`_typescript.applyFixAllCodeAction`))&&(e.action.diagnostics=[...o.filter(e=>e.relatedInformation)]);return{validActions:r.validActions,allActions:i,documentation:r.documentation,hasAutoFix:r.hasAutoFix,hasAIFix:r.hasAIFix,allAIFixes:r.allAIFixes,dispose:()=>{this.codeActionsDisposable.value=r}}}else if(!a&&o.length>0){let a=t.selection.getPosition(),s=a,c=Number.MAX_VALUE,l=[...r.validActions];for(let u of o){let d=u.endColumn,f=u.endLineNumber,p=u.startLineNumber;if(f===a.lineNumber||p===a.lineNumber){s=new x(f,d);let u={type:t.trigger.type,triggerAction:t.trigger.triggerAction,filter:{include:t.trigger.filter?.include?t.trigger.filter?.include:jp.QuickFix},autoApply:t.trigger.autoApply,context:{notAvailableMessage:t.trigger.context?.notAvailableMessage||``,position:s}},p=new N(s.lineNumber,s.column,s.lineNumber,s.column),m=await qp(this._registry,e,p,u,Vo.None,n);if(n.isCancellationRequested)return m.dispose(),um;if(m.validActions.length!==0){for(let e of m.validActions)e.action.command?.arguments?.some(e=>typeof e==`string`&&e.includes(`_typescript.applyFixAllCodeAction`))&&(e.action.diagnostics=[...o.filter(e=>e.relatedInformation)]);r.allActions.length===0&&i.push(...m.allActions),Math.abs(a.column-d)<c?l.unshift(...m.validActions):l.push(...m.validActions)}c=Math.abs(a.column-d)}}let u=l.filter((e,t,n)=>n.findIndex(t=>t.action.title===e.action.title)===t);return u.sort((e,t)=>e.action.isPreferred&&!t.action.isPreferred?-1:!e.action.isPreferred&&t.action.isPreferred||e.action.isAI&&!t.action.isAI?1:!e.action.isAI&&t.action.isAI?-1:0),{validActions:u,allActions:i,documentation:r.documentation,hasAutoFix:r.hasAutoFix,hasAIFix:r.hasAIFix,allAIFixes:r.allAIFixes,dispose:()=>{this.codeActionsDisposable.value=r}}}}if(t.trigger.type===1){let r=await qp(this._registry,e,t.selection,t.trigger,Vo.None,n);return this.codeActionsDisposable.value=r,r}let r=await qp(this._registry,e,t.selection,t.trigger,Vo.None,n);return this.codeActionsDisposable.value=r,r});t.trigger.type===1&&this._progressService?.showWhile(r,250);let i=new lm.Triggered(t.trigger,n,r),a=!1;this._state.type===1&&(a=this._state.trigger.type===1&&i.type===1&&i.trigger.type===2&&this._state.position!==i.position),a?setTimeout(()=>{this.setState(i)},500):this.setState(i)},void 0),this._codeActionOracle.value.trigger({type:2,triggerAction:Mp.Default})}else this._supportedCodeActions.reset()}trigger(e){this._codeActionOracle.value?.trigger(e),this.codeActionsDisposable.dispose()}setState(e,t){e!==this._state&&(this._state.type===1&&this._state.cancel(),this._state=e,!t&&!this._disposed&&this._onDidChangeState.fire(e))}},fm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},pm=function(e,t){return function(n,r){t(n,r,e)}},mm,hm=No(`gutter-lightbulb`,J.lightBulb,H(867,`Icon which spawns code actions menu from the gutter when there is no space in the editor.`)),gm=No(`gutter-lightbulb-auto-fix`,J.lightbulbAutofix,H(868,`Icon which spawns code actions menu from the gutter when there is no space in the editor and a quick fix is available.`)),_m=No(`gutter-lightbulb-sparkle`,J.lightbulbSparkle,H(869,`Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix is available.`)),vm=No(`gutter-lightbulb-aifix-auto-fix`,J.lightbulbSparkleAutofix,H(870,`Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.`)),ym=No(`gutter-lightbulb-sparkle-filled`,J.sparkleFilled,H(871,`Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.`)),bm;(function(e){e.Hidden={type:0};class t{constructor(e,t,n,r){this.actions=e,this.trigger=t,this.editorPosition=n,this.widgetPosition=r,this.type=1}}e.Showing=t})(bm||={});var xm=class extends b{static{mm=this}static{this.GUTTER_DECORATION=R.register({description:`codicon-gutter-lightbulb-decoration`,glyphMarginClassName:X.asClassName(J.lightBulb),glyphMargin:{position:v.Left},stickiness:1})}static{this.ID=`editor.contrib.lightbulbWidget`}static{this._posPref=[0]}constructor(e,t){super(),this._editor=e,this._keybindingService=t,this._onClick=this._register(new E),this.onClick=this._onClick.event,this._state=bm.Hidden,this._gutterState=bm.Hidden,this._iconClasses=[],this.lightbulbClasses=[`codicon-`+hm.id,`codicon-`+vm.id,`codicon-`+gm.id,`codicon-`+_m.id,`codicon-`+ym.id],this.gutterDecoration=mm.GUTTER_DECORATION,this._domNode=I(`div.lightBulbWidget`),this._domNode.role=`listbox`,this._register(ye.ignoreTarget(this._domNode)),this._editor.addContentWidget(this),this._register(this._editor.onDidChangeModelContent(e=>{let t=this._editor.getModel();(this.state.type!==1||!t||this.state.editorPosition.lineNumber>=t.getLineCount())&&this.hide(),(this.gutterState.type!==1||!t||this.gutterState.editorPosition.lineNumber>=t.getLineCount())&&this.gutterHide()})),this._register(bs(this._domNode,e=>{if(this.state.type!==1)return;this._editor.focus(),e.preventDefault();let{top:t,height:n}=qc(this._domNode),r=this._editor.getOption(75),i=Math.floor(r/3);this.state.widgetPosition.position!==null&&this.state.widgetPosition.position.lineNumber<this.state.editorPosition.lineNumber&&(i+=r),this._onClick.fire({x:e.posx,y:t+n+i,actions:this.state.actions,trigger:this.state.trigger})})),this._register(U(this._domNode,`mouseenter`,e=>{(e.buttons&1)==1&&this.hide()})),this._register(vn.runAndSubscribe(this._keybindingService.onDidUpdateKeybindings,()=>{this._preferredKbLabel=this._keybindingService.lookupKeybinding(`editor.action.autoFix`)?.getLabel()??void 0,this._quickFixKbLabel=this._keybindingService.lookupKeybinding(`editor.action.quickFix`)?.getLabel()??void 0,this._updateLightBulbTitleAndIcon()})),this._register(this._editor.onMouseDown(async e=>{if(!e.target.element||!this.lightbulbClasses.some(t=>e.target.element&&e.target.element.classList.contains(t))||this.gutterState.type!==1)return;this._editor.focus();let{top:t,height:n}=qc(e.target.element),r=this._editor.getOption(75),i=Math.floor(r/3);this.gutterState.widgetPosition.position!==null&&this.gutterState.widgetPosition.position.lineNumber<this.gutterState.editorPosition.lineNumber&&(i+=r),this._onClick.fire({x:e.event.posx,y:t+n+i,actions:this.gutterState.actions,trigger:this.gutterState.trigger})}))}dispose(){super.dispose(),this._editor.removeContentWidget(this),this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID)}getId(){return`LightBulbWidget`}getDomNode(){return this._domNode}getPosition(){return this._state.type===1?this._state.widgetPosition:null}update(e,t,n){if(e.validActions.length<=0||!this._editor.hasTextFocus()||!this._editor.getOptions().get(73).enabled)return this.gutterHide(),this.hide();let r=this._editor.getModel();if(!r)return this.gutterHide(),this.hide();let{lineNumber:i,column:a}=r.validatePosition(n),o=r.getOptions().tabSize,s=this._editor.getOptions().get(59),c=r.getLineContent(i),l=di(c,o),u=s.spaceWidth*l>22,d=e=>e>2&&this._editor.getTopForLineNumber(e)===this._editor.getTopForLineNumber(e-1),f=this._editor.getLineDecorations(i),p=!1;if(f)for(let e of f){let t=e.options.glyphMarginClassName;if(t&&!this.lightbulbClasses.some(e=>t.includes(e))){p=!0;break}}let m=i,h=1;if(!u){let o=e=>{let t=r.getLineContent(e);return/^\s*$|^\s+/.test(t)||t.length<=h};if(i>1&&!d(i-1)){let a=r.getLineCount(),s=i===a,c=i>1&&o(i-1),l=!s&&o(i+1),u=o(i),d=!l&&!c;if(!l&&!c&&!p)return this.gutterState=new bm.Showing(e,t,n,{position:{lineNumber:m,column:h},preference:mm._posPref}),this.renderGutterLightbub(),this.hide();c||s||c&&!u?--m:(l||d&&u)&&(m+=1)}else if(i===1&&(i===r.getLineCount()||!o(i+1)&&!o(i)))if(this.gutterState=new bm.Showing(e,t,n,{position:{lineNumber:m,column:h},preference:mm._posPref}),p)this.gutterHide();else return this.renderGutterLightbub(),this.hide();else if(i<r.getLineCount()&&!d(i+1))m+=1;else if(a*s.spaceWidth<22)return this.hide();h=/^\S\s*$/.test(r.getLineContent(m))?2:1}this.state=new bm.Showing(e,t,n,{position:{lineNumber:m,column:h},preference:mm._posPref}),this._gutterDecorationID&&(this._removeGutterDecoration(this._gutterDecorationID),this.gutterHide());let g=e.validActions,_=e.validActions[0].action.kind;if(g.length!==1||!_){this._editor.layoutContentWidget(this);return}this._editor.layoutContentWidget(this)}hide(){this.state!==bm.Hidden&&(this.state=bm.Hidden,this._editor.layoutContentWidget(this))}gutterHide(){this.gutterState!==bm.Hidden&&(this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID),this.gutterState=bm.Hidden)}get state(){return this._state}set state(e){this._state=e,this._updateLightBulbTitleAndIcon()}get gutterState(){return this._gutterState}set gutterState(e){this._gutterState=e,this._updateGutterLightBulbTitleAndIcon()}_updateLightBulbTitleAndIcon(){if(this._domNode.classList.remove(...this._iconClasses),this._iconClasses=[],this.state.type!==1)return;let e,t=!1;this.state.actions.allAIFixes?(e=J.sparkleFilled,this.state.actions.validActions.length===1&&(t=!0)):e=this.state.actions.hasAutoFix?this.state.actions.hasAIFix?J.lightbulbSparkleAutofix:J.lightbulbAutofix:this.state.actions.hasAIFix?J.lightbulbSparkle:J.lightBulb,this._updateLightbulbTitle(this.state.actions.hasAutoFix,t),this._iconClasses=X.asClassNameArray(e),this._domNode.classList.add(...this._iconClasses)}_updateGutterLightBulbTitleAndIcon(){if(this.gutterState.type!==1)return;let e,t=!1;this.gutterState.actions.allAIFixes?(e=ym,this.gutterState.actions.validActions.length===1&&(t=!0)):e=this.gutterState.actions.hasAutoFix?this.gutterState.actions.hasAIFix?vm:gm:this.gutterState.actions.hasAIFix?_m:hm,this._updateLightbulbTitle(this.gutterState.actions.hasAutoFix,t),this.gutterDecoration=R.register({description:`codicon-gutter-lightbulb-decoration`,glyphMarginClassName:X.asClassName(e),glyphMargin:{position:v.Left},stickiness:1})}renderGutterLightbub(){let e=this._editor.getSelection();e&&(this._gutterDecorationID===void 0?this._addGutterDecoration(e.startLineNumber):this._updateGutterDecoration(this._gutterDecorationID,e.startLineNumber))}_addGutterDecoration(e){this._editor.changeDecorations(t=>{this._gutterDecorationID=t.addDecoration(new S(e,0,e,0),this.gutterDecoration)})}_removeGutterDecoration(e){this._editor.changeDecorations(t=>{t.removeDecoration(e),this._gutterDecorationID=void 0})}_updateGutterDecoration(e,t){this._editor.changeDecorations(n=>{n.changeDecoration(e,new S(t,0,t,0)),n.changeDecorationOptions(e,this.gutterDecoration)})}_updateLightbulbTitle(e,t){this.state.type===1&&(t?this.title=H(872,`Run: {0}`,this.state.actions.validActions[0].action.title):e&&this._preferredKbLabel?this.title=H(873,`Show Code Actions. Preferred Quick Fix Available ({0})`,this._preferredKbLabel):!e&&this._quickFixKbLabel?this.title=H(874,`Show Code Actions ({0})`,this._quickFixKbLabel):e||(this.title=H(875,`Show Code Actions`)))}set title(e){this._domNode.title=e}};xm=mm=fm([pm(1,zn)],xm);var Sm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Cm=function(e,t){return function(n,r){t(n,r,e)}},wm,Tm=`quickfix-edit-highlight`,Em=class extends b{static{wm=this}static{this.ID=`editor.contrib.codeActionController`}static get(e){return e.getContribution(wm.ID)}constructor(e,t,n,r,i,a,o,s,c,l,u){super(),this._commandService=o,this._configurationService=s,this._actionWidgetService=c,this._instantiationService=l,this._progressService=u,this._activeCodeActions=this._register(new Ot),this._showDisabled=!1,this._disposed=!1,this._editor=e,this._model=this._register(new dm(this._editor,i.codeActionProvider,t,n,a,s)),this._register(this._model.onDidChangeState(e=>this.update(e))),this._lightBulbWidget=new Nc(()=>{let e=this._editor.getContribution(xm.ID);return e&&this._register(e.onClick(e=>this.showCodeActionsFromLightbulb(e.actions,e))),e}),this._resolver=r.createInstance(rm),this._register(this._editor.onDidLayoutChange(()=>this._actionWidgetService.hide()))}dispose(){this._disposed=!0,super.dispose()}async showCodeActionsFromLightbulb(e,t){if(e.allAIFixes&&e.validActions.length===1){let t=e.validActions[0],n=t.action.command;n&&n.id===`inlineChat.start`&&n.arguments&&n.arguments.length>=1&&(n.arguments[0]={...n.arguments[0],autoSend:!1}),await this.applyCodeAction(t,!1,!1,Zp.FromAILightbulb);return}await this.showCodeActionList(e,t,{includeDisabledActions:!1,fromLightbulb:!0})}showCodeActions(e,t,n){return this.showCodeActionList(t,n,{includeDisabledActions:!1,fromLightbulb:!1})}manualTriggerAtCurrentPosition(e,t,n,r){if(!this._editor.hasModel())return;ff.get(this._editor)?.closeMessage();let i=this._editor.getPosition();this._trigger({type:1,triggerAction:t,filter:n,autoApply:r,context:{notAvailableMessage:e,position:i}})}_trigger(e){return this._model.trigger(e)}async applyCodeAction(e,t,n,r){let i=this._progressService.show(!0,500);try{await this._instantiationService.invokeFunction(Qp,e,r,{preview:n,editor:this._editor})}finally{t&&this._trigger({type:2,triggerAction:Mp.QuickFix,filter:{}}),i.done()}}hideLightBulbWidget(){this._lightBulbWidget.rawValue?.hide(),this._lightBulbWidget.rawValue?.gutterHide()}async update(e){if(e.type!==1){this.hideLightBulbWidget();return}let t;try{t=await e.actions}catch(e){rr(e);return}if(!this._disposed&&this._editor.getSelection()?.startLineNumber===e.position.lineNumber)if(this._lightBulbWidget.value?.update(t,e.trigger,e.position),e.trigger.type===1){if(e.trigger.filter?.include){let n=this.tryGetValidActionToApply(e.trigger,t);if(n){try{this.hideLightBulbWidget(),await this.applyCodeAction(n,!1,!1,Zp.FromCodeActions)}finally{t.dispose()}return}if(e.trigger.context){let n=this.getInvalidActionThatWouldHaveBeenApplied(e.trigger,t);if(n&&n.action.disabled){ff.get(this._editor)?.showMessage(n.action.disabled,e.trigger.context.position),t.dispose();return}}}let n=!!e.trigger.filter?.include;if(e.trigger.context&&(!t.allActions.length||!n&&!t.validActions.length)){ff.get(this._editor)?.showMessage(e.trigger.context.notAvailableMessage,e.trigger.context.position),this._activeCodeActions.value=t,t.dispose();return}this._activeCodeActions.value=t,this.showCodeActionList(t,this.toCoords(e.position),{includeDisabledActions:n,fromLightbulb:!1})}else this._actionWidgetService.isVisible?t.dispose():this._activeCodeActions.value=t}getInvalidActionThatWouldHaveBeenApplied(e,t){if(t.allActions.length&&(e.autoApply===`first`&&t.validActions.length===0||e.autoApply===`ifSingle`&&t.allActions.length===1))return t.allActions.find(({action:e})=>e.disabled)}tryGetValidActionToApply(e,t){if(t.validActions.length&&(e.autoApply===`first`&&t.validActions.length>0||e.autoApply===`ifSingle`&&t.validActions.length===1))return t.validActions[0]}static{this.DECORATION=R.register({description:`quickfix-highlight`,className:Tm})}async showCodeActionList(e,t,n){let r=this._editor.createDecorationsCollection(),i=this._editor.getDomNode();if(!i)return;let a=n.includeDisabledActions&&(this._showDisabled||e.validActions.length===0)?e.allActions:e.validActions;if(!a.length)return;let o=x.isIPosition(t)?this.toCoords(t):t;this._actionWidgetService.show(`codeActionWidget`,!0,om(a,this._shouldShowHeaders(),this._resolver.getResolver()),{onSelect:async(e,t)=>{this.applyCodeAction(e,!0,!!t,n.fromLightbulb?Zp.FromAILightbulb:Zp.FromCodeActions),this._actionWidgetService.hide(!1),r.clear()},onHide:e=>{this._editor?.focus(),r.clear()},onHover:async(e,t)=>{if(t.isCancellationRequested)return;let n=!1,r=e.action.kind;if(r){let e=new qd(r);n=[jp.RefactorExtract,jp.RefactorInline,jp.RefactorRewrite,jp.RefactorMove,jp.Source].some(t=>t.contains(e))}return{canPreview:n||!!e.action.edit?.edits.length}},onFocus:e=>{if(e&&e.action){let t=e.action.ranges,n=e.action.diagnostics;if(r.clear(),t&&t.length>0){let e=n&&n?.length>1?n.map(e=>({range:e,options:wm.DECORATION})):t.map(e=>({range:e,options:wm.DECORATION}));r.set(e)}else if(n&&n.length>0){let e=n.map(e=>({range:e,options:wm.DECORATION}));r.set(e);let t=n[0];if(t.startLineNumber&&t.startColumn){let e=this._editor.getModel()?.getWordAtPosition({lineNumber:t.startLineNumber,column:t.startColumn})?.word;zi(H(856,`Context: {0} at line {1} and column {2}.`,e,t.startLineNumber,t.startColumn))}}}else r.clear()}},o,i,this._getActionBarActions(e,t,n))}toCoords(e){if(!this._editor.hasModel())return{x:0,y:0};this._editor.revealPosition(e,1),this._editor.render();let t=this._editor.getScrolledVisiblePosition(e),n=qc(this._editor.getDomNode()),r=n.left+t.left,i=n.top+t.top+t.height;return{x:r,y:i}}_shouldShowHeaders(){let e=this._editor?.getModel();return this._configurationService.getValue(`editor.codeActionWidget.showHeaders`,{resource:e?.uri})}_getActionBarActions(e,t,n){if(n.fromLightbulb)return[];let r=e.documentation.map(e=>({id:e.id,label:e.title,tooltip:e.tooltip??``,class:void 0,enabled:!0,run:()=>this._commandService.executeCommand(e.id,...e.arguments??[])}));return n.includeDisabledActions&&e.validActions.length>0&&e.allActions.length!==e.validActions.length&&r.push(this._showDisabled?{id:`hideMoreActions`,label:H(857,`Hide Disabled`),enabled:!0,tooltip:``,class:void 0,run:()=>(this._showDisabled=!1,this.showCodeActionList(e,t,n))}:{id:`showMoreActions`,label:H(858,`Show Disabled`),enabled:!0,tooltip:``,class:void 0,run:()=>(this._showDisabled=!0,this.showCodeActionList(e,t,n))}),r}};Em=wm=Sm([Cm(1,Qn),Cm(2,w),Cm(3,k),Cm(4,W),Cm(5,$l),Cm(6,Mr),Cm(7,Ni),Cm(8,ap),Cm(9,k),Cm(10,$l)],Em),ul((e,t)=>{((e,n)=>{n&&t.addRule(`.monaco-editor ${e} { background-color: ${n}; }`)})(`.quickfix-edit-highlight`,e.getColor(hl));let n=e.getColor(ys);n&&t.addRule(`.monaco-editor .quickfix-edit-highlight { border: 1px ${je(e.type)?`dotted`:`solid`} ${n}; box-sizing: border-box; }`)});function Dm(e){return j.regex(sm.keys()[0],RegExp(`(\\s|^)`+bi(e.value)+`\\b`))}var Om={type:`object`,defaultSnippets:[{body:{kind:``}}],properties:{kind:{type:`string`,description:H(824,`Kind of the code action to run.`)},apply:{type:`string`,description:H(825,`Controls when the returned actions are applied.`),default:`ifSingle`,enum:[`first`,`ifSingle`,`never`],enumDescriptions:[H(826,`Always apply the first returned code action.`),H(827,`Apply the first returned code action if it is the only one.`),H(828,`Do not apply the returned code actions.`)]},preferred:{type:`boolean`,default:!1,description:H(829,`Controls if only preferred code actions should be returned.`)}}};function km(e,t,n,r,i=Mp.Default){e.hasModel()&&Em.get(e)?.manualTriggerAtCurrentPosition(t,i,n,r)}var Am=class extends D{constructor(){super({id:zp,label:B(846,`Quick Fix...`),precondition:j.and(F.writable,F.hasCodeActionsProvider),kbOpts:{kbExpr:F.textInputFocus,primary:2137,weight:100}})}run(e,t){return km(t,H(830,`No code actions available`),void 0,void 0,Mp.QuickFix)}},jm=class extends Gi{constructor(){super({id:Rp,precondition:j.and(F.writable,F.hasCodeActionsProvider),metadata:{description:`Trigger a code action`,args:[{name:`args`,schema:Om}]}})}runEditorCommand(e,t,n){let r=Ip.fromUser(n,{kind:qd.Empty,apply:`ifSingle`});return km(t,typeof n?.kind==`string`?r.preferred?H(831,`No preferred code actions for '{0}' available`,n.kind):H(832,`No code actions for '{0}' available`,n.kind):r.preferred?H(833,`No preferred code actions available`):H(834,`No code actions available`),{include:r.kind,includeSourceActions:!0,onlyIncludePreferredActions:r.preferred},r.apply)}},Mm=class extends D{constructor(){super({id:Bp,label:B(847,`Refactor...`),precondition:j.and(F.writable,F.hasCodeActionsProvider),kbOpts:{kbExpr:F.textInputFocus,primary:3120,mac:{primary:1328},weight:100},contextMenuOpts:{group:`1_modification`,order:2,when:j.and(F.writable,Dm(jp.Refactor))},metadata:{description:`Refactor...`,args:[{name:`args`,schema:Om}]}})}run(e,t,n){let r=Ip.fromUser(n,{kind:jp.Refactor,apply:`never`});return km(t,typeof n?.kind==`string`?r.preferred?H(835,`No preferred refactorings for '{0}' available`,n.kind):H(836,`No refactorings for '{0}' available`,n.kind):r.preferred?H(837,`No preferred refactorings available`):H(838,`No refactorings available`),{include:jp.Refactor.contains(r.kind)?r.kind:qd.None,onlyIncludePreferredActions:r.preferred},r.apply,Mp.Refactor)}},Nm=class extends D{constructor(){super({id:Vp,label:B(848,`Source Action...`),precondition:j.and(F.writable,F.hasCodeActionsProvider),contextMenuOpts:{group:`1_modification`,order:2.1,when:j.and(F.writable,Dm(jp.Source))},metadata:{description:`Source Action...`,args:[{name:`args`,schema:Om}]}})}run(e,t,n){let r=Ip.fromUser(n,{kind:jp.Source,apply:`never`});return km(t,typeof n?.kind==`string`?r.preferred?H(839,`No preferred source actions for '{0}' available`,n.kind):H(840,`No source actions for '{0}' available`,n.kind):r.preferred?H(841,`No preferred source actions available`):H(842,`No source actions available`),{include:jp.Source.contains(r.kind)?r.kind:qd.None,includeSourceActions:!0,onlyIncludePreferredActions:r.preferred},r.apply,Mp.SourceAction)}},Pm=class extends D{constructor(){super({id:Hp,label:B(849,`Organize Imports`),precondition:j.and(F.writable,Dm(jp.SourceOrganizeImports)),kbOpts:{kbExpr:F.textInputFocus,primary:1581,weight:100},metadata:{description:B(850,`Organize imports in the current file. Also called 'Optimize Imports' by some tools`)}})}run(e,t){return km(t,H(843,`No organize imports action available`),{include:jp.SourceOrganizeImports,includeSourceActions:!0},`ifSingle`,Mp.OrganizeImports)}},Fm=class extends D{constructor(){super({id:Up,label:B(851,`Fix All`),precondition:j.and(F.writable,Dm(jp.SourceFixAll))})}run(e,t){return km(t,H(844,`No fix all action available`),{include:jp.SourceFixAll,includeSourceActions:!0},`ifSingle`,Mp.FixAll)}},Im=class extends D{constructor(){super({id:`editor.action.autoFix`,label:B(852,`Auto Fix...`),precondition:j.and(F.writable,Dm(jp.QuickFix)),kbOpts:{kbExpr:F.textInputFocus,primary:1625,mac:{primary:2649},weight:100}})}run(e,t){return km(t,H(845,`No auto fixes available`),{include:jp.QuickFix,onlyIncludePreferredActions:!0},`ifSingle`,Mp.AutoFix)}};G(Em.ID,Em,3),G(xm.ID,xm,4),s(Am),s(Mm),s(Nm),s(Pm),s(Im),s(Fm),L(new jm),On.as(de.Configuration).registerConfiguration({...fs,properties:{"editor.codeActionWidget.showHeaders":{type:`boolean`,scope:6,description:H(853,`Enable/disable showing group headers in the Code Action menu.`),default:!0}}}),On.as(de.Configuration).registerConfiguration({...fs,properties:{"editor.codeActionWidget.includeNearbyQuickFixes":{type:`boolean`,scope:6,description:H(854,`Enable/disable showing nearest Quick Fix within a line when not currently on a diagnostic.`),default:!0}}}),On.as(de.Configuration).registerConfiguration({...fs,properties:{"editor.codeActions.triggerOnFocusChange":{type:`boolean`,scope:6,markdownDescription:H(855,`Enable triggering {0} when {1} is set to {2}. Code Actions must be set to {3} to be triggered for window and focus changes.`,"`#editor.codeActionsOnSave#`","`#files.autoSave#`","`afterDelay`","`always`"),default:!1}}});var Lm=class e{constructor(){this.lenses=[]}static{this.Empty=new e}dispose(){this._store?.dispose()}get isDisposed(){return this._store?.isDisposed??!1}add(e,t){on(e)&&(this._store??=new P,this._store.add(e));for(let n of e.lenses)this.lenses.push({symbol:n,provider:t})}};async function Rm(e,t,n){let r=e.ordered(t),i=new Map,a=new Lm,o=r.map(async(e,r)=>{i.set(e,r);try{let r=await Promise.resolve(e.provideCodeLenses(t,n));r&&a.add(r,e)}catch(e){Ze(e)}});return await Promise.all(o),n.isCancellationRequested?(a.dispose(),Lm.Empty):(a.lenses=a.lenses.sort((e,t)=>e.symbol.range.startLineNumber<t.symbol.range.startLineNumber?-1:e.symbol.range.startLineNumber>t.symbol.range.startLineNumber?1:i.get(e.provider)<i.get(t.provider)?-1:i.get(e.provider)>i.get(t.provider)?1:e.symbol.range.startColumn<t.symbol.range.startColumn?-1:e.symbol.range.startColumn>t.symbol.range.startColumn?1:0),a)}gn.registerCommand(`_executeCodeLensProvider`,function(e,...t){let[n,r]=t;K($n.isUri(n)),K(typeof r==`number`||!r);let{codeLensProvider:i}=e.get(W),a=e.get(Fi).getModel(n);if(!a)throw Sn();let o=[],s=new P;return Rm(i,a,A.None).then(e=>{s.add(e);let t=[];for(let n of e.lenses)r==null||n.symbol.command?o.push(n.symbol):r-- >0&&n.provider.resolveCodeLens&&t.push(Promise.resolve(n.provider.resolveCodeLens(a,n.symbol,A.None)).then(e=>o.push(e||n.symbol)));return Promise.all(t)}).then(()=>o).finally(()=>{setTimeout(()=>s.dispose(),100)})});var zm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Bm=function(e,t){return function(n,r){t(n,r,e)}};const Vm=dl(`ICodeLensCache`);var Hm=class{constructor(e,t){this.lineCount=e,this.data=t}},Um=class{constructor(e){this._fakeProvider=new class{provideCodeLenses(){throw Error(`not supported`)}},this._cache=new Za(20,.75),ke(ks,()=>e.remove(`codelens/cache`,1));let t=`codelens/cache2`,n=e.get(t,1,`{}`);this._deserialize(n);let r=vn.filter(e.onWillSaveState,e=>e.reason===Vr.SHUTDOWN);vn.once(r)(n=>{e.store(t,this._serialize(),1,1)})}put(e,t){let n=t.lenses.map(e=>({range:e.symbol.range,command:e.symbol.command&&{id:``,title:e.symbol.command?.title}})),r=new Lm;r.add({lenses:n},this._fakeProvider);let i=new Hm(e.getLineCount(),r);this._cache.set(e.uri.toString(),i)}get(e){let t=this._cache.get(e.uri.toString());return t&&t.lineCount===e.getLineCount()?t.data:void 0}delete(e){this._cache.delete(e.uri.toString())}_serialize(){let e=Object.create(null);for(let[t,n]of this._cache){let r=new Set;for(let e of n.data.lenses)r.add(e.symbol.range.startLineNumber);e[t]={lineCount:n.lineCount,lines:[...r.values()]}}return JSON.stringify(e)}_deserialize(e){try{let t=JSON.parse(e);for(let e in t){let n=t[e],r=[];for(let e of n.lines)r.push({range:new S(e,1,e,11)});let i=new Lm;i.add({lenses:r},this._fakeProvider),this._cache.set(e,new Hm(n.lineCount,i))}}catch{}}};Um=zm([Bm(0,Mu)],Um),wt(Vm,Um,1);var Wm=class{constructor(e,t,n){this.afterColumn=1073741824,this.afterLineNumber=e,this.heightInPx=t,this._onHeight=n,this.suppressMouseDown=!0,this.domNode=document.createElement(`div`)}onComputedHeight(e){this._lastHeight===void 0?this._lastHeight=e:this._lastHeight!==e&&(this._lastHeight=e,this._onHeight())}isVisible(){return this._lastHeight!==0&&this.domNode.hasAttribute(`monaco-visible-view-zone`)}},Gm=class e{static{this._idPool=0}constructor(t,n){this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this._commands=new Map,this._isEmpty=!0,this._editor=t,this._id=`codelens.widget-${e._idPool++}`,this.updatePosition(n),this._domNode=document.createElement(`span`),this._domNode.className=`codelens-decoration`}withCommands(t,n){this._commands.clear();let r=[],i=!1;for(let n=0;n<t.length;n++){let a=t[n];if(a&&(i=!0,a.command)){let i=Js(a.command.title.trim());if(a.command.id){let t=`c${e._idPool++}`;r.push(I(`a`,{id:t,title:a.command.tooltip,role:`button`},...i)),this._commands.set(t,a.command)}else r.push(I(`span`,{title:a.command.tooltip},...i));n+1<t.length&&r.push(I(`span`,void 0,`\xA0|\xA0`))}}i?(Yr(this._domNode,...r),this._isEmpty&&n&&this._domNode.classList.add(`fadein`),this._isEmpty=!1):Yr(this._domNode,I(`span`,void 0,`no commands`))}getCommand(e){return e.parentElement===this._domNode?this._commands.get(e.id):void 0}getId(){return this._id}getDomNode(){return this._domNode}updatePosition(e){let t=this._editor.getModel().getLineFirstNonWhitespaceColumn(e);this._widgetPosition={position:{lineNumber:e,column:t},preference:[1]}}getPosition(){return this._widgetPosition||null}},Km=class{constructor(){this._removeDecorations=[],this._addDecorations=[],this._addDecorationsCallbacks=[]}addDecoration(e,t){this._addDecorations.push(e),this._addDecorationsCallbacks.push(t)}removeDecoration(e){this._removeDecorations.push(e)}commit(e){let t=e.deltaDecorations(this._removeDecorations,this._addDecorations);for(let e=0,n=t.length;e<n;e++)this._addDecorationsCallbacks[e](t[e])}},qm=R.register({collapseOnReplaceEdit:!0,description:`codelens`}),Jm=class{constructor(e,t,n,r,i,a){this._isDisposed=!1,this._editor=t,this._data=e,this._decorationIds=[];let o,s=[];this._data.forEach((e,t)=>{e.symbol.command&&s.push(e.symbol),n.addDecoration({range:e.symbol.range,options:qm},e=>this._decorationIds[t]=e),o=o?S.plusRange(o,e.symbol.range):S.lift(e.symbol.range)}),this._viewZone=new Wm(o.startLineNumber-1,i,a),this._viewZoneId=r.addZone(this._viewZone),s.length>0&&(this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(s,!1))}_createContentWidgetIfNecessary(){this._contentWidget?this._editor.layoutContentWidget(this._contentWidget):(this._contentWidget=new Gm(this._editor,this._viewZone.afterLineNumber+1),this._editor.addContentWidget(this._contentWidget))}dispose(e,t){this._decorationIds.forEach(e.removeDecoration,e),this._decorationIds=[],t?.removeZone(this._viewZoneId),this._contentWidget&&=(this._editor.removeContentWidget(this._contentWidget),void 0),this._isDisposed=!0}isDisposed(){return this._isDisposed}isValid(){return this._decorationIds.some((e,t)=>{let n=this._editor.getModel().getDecorationRange(e),r=this._data[t].symbol;return!!(n&&S.isEmpty(r.range)===n.isEmpty())})}updateCodeLensSymbols(e,t){this._decorationIds.forEach(t.removeDecoration,t),this._decorationIds=[],this._data=e,this._data.forEach((e,n)=>{t.addDecoration({range:e.symbol.range,options:qm},e=>this._decorationIds[n]=e)})}updateHeight(e,t){this._viewZone.heightInPx=e,t.layoutZone(this._viewZoneId),this._contentWidget&&this._editor.layoutContentWidget(this._contentWidget)}computeIfNecessary(e){if(!this._viewZone.isVisible())return null;for(let t=0;t<this._decorationIds.length;t++){let n=e.getDecorationRange(this._decorationIds[t]);n&&(this._data[t].symbol.range=n)}return this._data}updateCommands(e){this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(e,!0);for(let t=0;t<this._data.length;t++){let n=e[t];if(n){let{symbol:e}=this._data[t];e.command=n.command||e.command}}}getCommand(e){return this._contentWidget?.getCommand(e)}getLineNumber(){let e=this._editor.getModel().getDecorationRange(this._decorationIds[0]);return e?e.startLineNumber:-1}update(e){if(this.isValid()){let t=this._editor.getModel().getDecorationRange(this._decorationIds[0]);t&&(this._viewZone.afterLineNumber=t.startLineNumber-1,e.layoutZone(this._viewZoneId),this._contentWidget&&(this._contentWidget.updatePosition(t.startLineNumber),this._editor.layoutContentWidget(this._contentWidget)))}}},Ym=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Xm=function(e,t){return function(n,r){t(n,r,e)}},Zm=class{static{this.ID=`css.editor.codeLens`}constructor(e,t,n,r,i,a){this._editor=e,this._languageFeaturesService=t,this._commandService=r,this._notificationService=i,this._codeLensCache=a,this._disposables=new P,this._localToDispose=new P,this._lenses=[],this._oldCodeLensModels=new P,this._provideCodeLensDebounce=n.for(t.codeLensProvider,`CodeLensProvide`,{min:250}),this._resolveCodeLensesDebounce=n.for(t.codeLensProvider,`CodeLensResolve`,{min:250,salt:`resolve`}),this._resolveCodeLensesScheduler=new ju(()=>this._resolveCodeLensesInViewport(),this._resolveCodeLensesDebounce.default()),this._disposables.add(this._editor.onDidChangeModel(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeConfiguration(e=>{(e.hasChanged(59)||e.hasChanged(25)||e.hasChanged(24))&&this._updateLensStyle(),e.hasChanged(23)&&this._onModelChange()})),this._disposables.add(t.codeLensProvider.onDidChange(this._onModelChange,this)),this._onModelChange(),this._updateLensStyle()}dispose(){this._localDispose(),this._localToDispose.dispose(),this._disposables.dispose(),this._oldCodeLensModels.dispose(),this._currentCodeLensModel?.dispose()}_getLayoutInfo(){let e=Math.max(1.3,this._editor.getOption(75)/this._editor.getOption(61)),t=this._editor.getOption(25);return(!t||t<5)&&(t=this._editor.getOption(61)*.9|0),{fontSize:t,codeLensHeight:t*e|0}}_updateLensStyle(){let{codeLensHeight:e,fontSize:t}=this._getLayoutInfo(),n=this._editor.getOption(24),r=this._editor.getOption(59),{style:i}=this._editor.getContainerDomNode();i.setProperty(`--vscode-editorCodeLens-lineHeight`,`${e}px`),i.setProperty(`--vscode-editorCodeLens-fontSize`,`${t}px`),i.setProperty(`--vscode-editorCodeLens-fontFeatureSettings`,r.fontFeatureSettings),n&&(i.setProperty(`--vscode-editorCodeLens-fontFamily`,n),i.setProperty(`--vscode-editorCodeLens-fontFamilyDefault`,oa.fontFamily)),this._editor.changeViewZones(t=>{for(let n of this._lenses)n.updateHeight(e,t)})}_localDispose(){this._getCodeLensModelPromise?.cancel(),this._getCodeLensModelPromise=void 0,this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0,this._localToDispose.clear(),this._oldCodeLensModels.clear(),this._currentCodeLensModel?.dispose()}_onModelChange(){this._localDispose();let e=this._editor.getModel();if(!e||!this._editor.getOption(23)||e.isTooLargeForTokenization())return;let t=this._codeLensCache.get(e);if(t&&this._renderCodeLensSymbols(t),!this._languageFeaturesService.codeLensProvider.has(e)){t&&Qr(()=>{let n=this._codeLensCache.get(e);t===n&&(this._codeLensCache.delete(e),this._onModelChange())},30*1e3,this._localToDispose);return}for(let t of this._languageFeaturesService.codeLensProvider.all(e))if(typeof t.onDidChange==`function`){let e=t.onDidChange(()=>n.schedule());this._localToDispose.add(e)}let n=new ju(()=>{let t=Date.now();this._getCodeLensModelPromise?.cancel(),this._getCodeLensModelPromise=bu(t=>Rm(this._languageFeaturesService.codeLensProvider,e,t)),this._getCodeLensModelPromise.then(r=>{this._currentCodeLensModel&&this._oldCodeLensModels.add(this._currentCodeLensModel),this._currentCodeLensModel=r,this._codeLensCache.put(e,r),n.delay=this._provideCodeLensDebounce.update(e,Date.now()-t),this._renderCodeLensSymbols(r),this._resolveCodeLensesInViewportSoon()},rr)},this._provideCodeLensDebounce.get(e));this._localToDispose.add(n),this._localToDispose.add(pl(()=>this._resolveCodeLensesScheduler.cancel())),this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._editor.changeDecorations(e=>{this._editor.changeViewZones(t=>{let n=[],r=-1;this._lenses.forEach(e=>{!e.isValid()||r===e.getLineNumber()?n.push(e):(e.update(t),r=e.getLineNumber())});let i=new Km;n.forEach(e=>{e.dispose(i,t),this._lenses.splice(this._lenses.indexOf(e),1)}),i.commit(e)})}),n.schedule(),this._resolveCodeLensesScheduler.cancel(),this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0})),this._localToDispose.add(this._editor.onDidFocusEditorText(()=>{n.schedule()})),this._localToDispose.add(this._editor.onDidBlurEditorText(()=>{n.cancel()})),this._localToDispose.add(this._editor.onDidScrollChange(e=>{e.scrollTopChanged&&this._lenses.length>0&&this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(this._editor.onDidLayoutChange(()=>{this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(pl(()=>{if(this._editor.getModel()){let e=Cr.capture(this._editor);this._editor.changeDecorations(e=>{this._editor.changeViewZones(t=>{this._disposeAllLenses(e,t)})}),e.restore(this._editor)}else this._disposeAllLenses(void 0,void 0)})),this._localToDispose.add(this._editor.onMouseDown(e=>{if(e.target.type!==9)return;let t=e.target.element;if(t?.tagName===`SPAN`&&(t=t.parentElement),t?.tagName===`A`)for(let e of this._lenses){let n=e.getCommand(t);if(n){this._commandService.executeCommand(n.id,...n.arguments||[]).catch(e=>this._notificationService.error(e));break}}})),n.schedule()}_disposeAllLenses(e,t){let n=new Km;for(let e of this._lenses)e.dispose(n,t);e&&n.commit(e),this._lenses.length=0}_renderCodeLensSymbols(e){if(!this._editor.hasModel())return;let t=this._editor.getModel().getLineCount(),n=[],r;for(let i of e.lenses){let e=i.symbol.range.startLineNumber;if(e<1||e>t)continue;r&&r[r.length-1].symbol.range.startLineNumber===e?r.push(i):(r=[i],n.push(r))}if(!n.length&&!this._lenses.length)return;let i=Cr.capture(this._editor),a=this._getLayoutInfo();this._editor.changeDecorations(e=>{this._editor.changeViewZones(t=>{let r=new Km,i=0,o=0;for(;o<n.length&&i<this._lenses.length;){let e=n[o][0].symbol.range.startLineNumber,s=this._lenses[i].getLineNumber();s<e?(this._lenses[i].dispose(r,t),this._lenses.splice(i,1)):s===e?(this._lenses[i].updateCodeLensSymbols(n[o],r),o++,i++):(this._lenses.splice(i,0,new Jm(n[o],this._editor,r,t,a.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),i++,o++)}for(;i<this._lenses.length;)this._lenses[i].dispose(r,t),this._lenses.splice(i,1);for(;o<n.length;)this._lenses.push(new Jm(n[o],this._editor,r,t,a.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),o++;r.commit(e)})}),i.restore(this._editor)}_resolveCodeLensesInViewportSoon(){this._editor.getModel()&&this._resolveCodeLensesScheduler.schedule()}_resolveCodeLensesInViewport(){this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0;let e=this._editor.getModel();if(!e)return;let t=[],n=[];if(this._lenses.forEach(r=>{let i=r.computeIfNecessary(e);i&&(t.push(i),n.push(r))}),t.length===0){this._oldCodeLensModels.clear();return}let r=Date.now(),i=bu(r=>{let i=t.map((t,i)=>{let a=Array(t.length),o=t.map((t,n)=>!t.symbol.command&&typeof t.provider.resolveCodeLens==`function`?Promise.resolve(t.provider.resolveCodeLens(e,t.symbol,r)).then(e=>{a[n]=e},Ze):(a[n]=t.symbol,Promise.resolve(void 0)));return Promise.all(o).then(()=>{!r.isCancellationRequested&&!n[i].isDisposed()&&n[i].updateCommands(a)})});return Promise.all(i)});this._resolveCodeLensesPromise=i,this._resolveCodeLensesPromise.then(()=>{let t=this._resolveCodeLensesDebounce.update(e,Date.now()-r);this._resolveCodeLensesScheduler.delay=t,this._currentCodeLensModel&&this._codeLensCache.put(e,this._currentCodeLensModel),this._oldCodeLensModels.clear(),i===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)},e=>{rr(e),i===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)})}async getModel(){return await this._getCodeLensModelPromise,await this._resolveCodeLensesPromise,this._currentCodeLensModel?.isDisposed?void 0:this._currentCodeLensModel}};Zm=Ym([Xm(1,W),Xm(2,co),Xm(3,Mr),Xm(4,nt),Xm(5,Vm)],Zm),G(Zm.ID,Zm,1),s(class extends D{constructor(){super({id:`codelens.showLensesInCurrentLine`,precondition:F.hasCodeLensProvider,label:B(877,`Show CodeLens Commands for Current Line`)})}async run(e,t){if(!t.hasModel())return;let n=e.get(xe),r=e.get(Mr),i=e.get(nt),a=t.getSelection().positionLineNumber,o=t.getContribution(Zm.ID);if(!o)return;let s=await o.getModel();if(!s)return;let c=[];for(let e of s.lenses)e.symbol.command&&e.symbol.range.startLineNumber===a&&c.push({label:e.symbol.command.title,command:e.symbol.command});if(c.length===0)return;let l=await n.pick(c,{canPickMany:!1,placeHolder:H(876,`Select a command`)});if(!l)return;let u=l.command;if(s.isDisposed){let e=(await o.getModel())?.lenses.find(e=>e.symbol.range.startLineNumber===a&&e.symbol.command?.title===u.title);if(!e||!e.symbol.command)return;u=e.symbol.command}try{await r.executeCommand(u.id,...u.arguments||[])}catch(e){i.error(e)}}});var Qm=class{constructor(e,t,n,r){this.priority=e,this.range=t,this.initialMousePosX=n,this.initialMousePosY=r,this.type=1}equals(e){return e.type===1&&this.range.equalsRange(e.range)}canAdoptVisibleHover(e,t){return e.type===1&&t.lineNumber===this.range.startLineNumber}},$m=class{constructor(e,t,n,r,i,a){this.priority=e,this.owner=t,this.range=n,this.initialMousePosX=r,this.initialMousePosY=i,this.supportsMarkerHover=a,this.type=2}equals(e){return e.type===2&&this.owner===e.owner}canAdoptVisibleHover(e,t){return e.type===2&&this.owner===e.owner}},eh=class{constructor(e,t){this.renderedHoverParts=e,this.disposables=t}dispose(){for(let e of this.renderedHoverParts)e.dispose();this.disposables?.dispose()}};const th=new class{constructor(){this._participants=[]}register(e){this._participants.push(e)}getAll(){return this._participants}};var nh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rh=function(e,t){return function(n,r){t(n,r,e)}},ih=class{constructor(e){this._editorWorkerService=e}async provideDocumentColors(e,t){return this._editorWorkerService.computeDefaultDocumentColors(e.uri)}provideColorPresentations(e,t,n){let r=t.range,i=t.color,a=i.alpha,o=new z(new bo(Math.round(255*i.red),Math.round(255*i.green),Math.round(255*i.blue),a)),s=a?z.Format.CSS.formatRGBA(o):z.Format.CSS.formatRGB(o),c=a?z.Format.CSS.formatHSLA(o):z.Format.CSS.formatHSL(o),l=a?z.Format.CSS.formatHexA(o):z.Format.CSS.formatHex(o),u=[];return u.push({label:s,textEdit:{range:r,text:s}}),u.push({label:c,textEdit:{range:r,text:c}}),u.push({label:l,textEdit:{range:r,text:l}}),u}};ih=nh([rh(0,ne)],ih);var ah=class extends b{constructor(e,t){super(),this._register(e.colorProvider.register(`*`,new ih(t)))}};ah=nh([rh(0,W),rh(1,ne)],ah);async function oh(e,t,n,r=`auto`){return dh(new ch,e,t,n,r)}function sh(e,t,n,r){return Promise.resolve(n.provideColorPresentations(e,t,r))}var ch=class{constructor(){}async compute(e,t,n,r){let i=await e.provideDocumentColors(t,n);if(Array.isArray(i))for(let t of i)r.push({colorInfo:t,provider:e});return Array.isArray(i)}},lh=class{constructor(){}async compute(e,t,n,r){let i=await e.provideDocumentColors(t,n);if(Array.isArray(i))for(let e of i)r.push({range:e.range,color:[e.color.red,e.color.green,e.color.blue,e.color.alpha]});return Array.isArray(i)}},uh=class{constructor(e){this.colorInfo=e}async compute(e,t,n,r){let i=await e.provideColorPresentations(t,this.colorInfo,A.None);return Array.isArray(i)&&r.push(...i),Array.isArray(i)}};async function dh(e,t,n,r,i){let a=!1,o,s=[],c=t.ordered(n);for(let t=c.length-1;t>=0;t--){let l=c[t];if(i!==`always`&&l instanceof ih)o=l;else try{await e.compute(l,n,r,s)&&(a=!0)}catch(e){Ze(e)}}return a?s:o&&i!==`never`?(await e.compute(o,n,r,s),s):[]}function fh(e,t){let{colorProvider:n}=e.get(W),r=e.get(Fi).getModel(t);if(!r)throw Sn();let i=e.get(Ni).getValue(`editor.defaultColorDecorators`,{resource:t});return{model:r,colorProviderRegistry:n,defaultColorDecoratorsEnablement:i}}var ph=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},mh=function(e,t){return function(n,r){t(n,r,e)}},hh;const gh=Object.create({});var _h=class extends b{static{hh=this}static{this.ID=`editor.contrib.colorDetector`}static{this.RECOMPUTE_TIME=1e3}constructor(e,t,n,r){super(),this._editor=e,this._configurationService=t,this._languageFeaturesService=n,this._localToDispose=this._register(new P),this._decorationsIds=[],this._colorDatas=new Map,this._decoratorLimitReporter=this._register(new vh),this._colorDecorationClassRefs=this._register(new P),this._colorDecoratorIds=this._editor.createDecorationsCollection(),this._ruleFactory=this._register(new Kn(this._editor)),this._debounceInformation=r.for(n.colorProvider,`Document Colors`,{min:hh.RECOMPUTE_TIME}),this._register(e.onDidChangeModel(()=>{this._isColorDecoratorsEnabled=this.isEnabled(),this.updateColors()})),this._register(e.onDidChangeModelLanguage(()=>this.updateColors())),this._register(n.colorProvider.onDidChange(()=>this.updateColors())),this._register(e.onDidChangeConfiguration(e=>{let t=this._isColorDecoratorsEnabled;this._isColorDecoratorsEnabled=this.isEnabled(),this._defaultColorDecoratorsEnablement=this._editor.getOption(166);let n=t!==this._isColorDecoratorsEnabled||e.hasChanged(27),r=e.hasChanged(166);(n||r)&&(this._isColorDecoratorsEnabled?this.updateColors():this.removeAllDecorations())})),this._timeoutTimer=null,this._computePromise=null,this._isColorDecoratorsEnabled=this.isEnabled(),this._defaultColorDecoratorsEnablement=this._editor.getOption(166),this.updateColors()}isEnabled(){let e=this._editor.getModel();if(!e)return!1;let t=e.getLanguageId(),n=this._configurationService.getValue(t);if(n&&typeof n==`object`){let e=n.colorDecorators;if(e&&e.enable!==void 0&&!e.enable)return e.enable}return this._editor.getOption(26)}static get(e){return e.getContribution(this.ID)}dispose(){this.stop(),this.removeAllDecorations(),super.dispose()}updateColors(){if(this.stop(),!this._isColorDecoratorsEnabled)return;let e=this._editor.getModel();!e||!this._languageFeaturesService.colorProvider.has(e)||(this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._timeoutTimer||(this._timeoutTimer=new Br,this._timeoutTimer.cancelAndSet(()=>{this._timeoutTimer=null,this.beginCompute()},this._debounceInformation.get(e)))})),this.beginCompute())}async beginCompute(){this._computePromise=bu(async e=>{let t=this._editor.getModel();if(!t)return[];let n=new ad(!1),r=await oh(this._languageFeaturesService.colorProvider,t,e,this._defaultColorDecoratorsEnablement);return this._debounceInformation.update(t,n.elapsed()),r});try{let e=await this._computePromise;this.updateDecorations(e),this.updateColorDecorators(e),this._computePromise=null}catch(e){rr(e)}}stop(){this._timeoutTimer&&=(this._timeoutTimer.cancel(),null),this._computePromise&&=(this._computePromise.cancel(),null),this._localToDispose.clear()}updateDecorations(e){let t=e.map(e=>({range:{startLineNumber:e.colorInfo.range.startLineNumber,startColumn:e.colorInfo.range.startColumn,endLineNumber:e.colorInfo.range.endLineNumber,endColumn:e.colorInfo.range.endColumn},options:R.EMPTY}));this._editor.changeDecorations(n=>{this._decorationsIds=n.deltaDecorations(this._decorationsIds,t),this._colorDatas=new Map,this._decorationsIds.forEach((t,n)=>this._colorDatas.set(t,e[n]))})}updateColorDecorators(e){this._colorDecorationClassRefs.clear();let t=[],n=this._editor.getOption(27);for(let r=0;r<e.length&&t.length<n;r++){let{red:n,green:i,blue:a,alpha:o}=e[r].colorInfo.color,s=new bo(Math.round(n*255),Math.round(i*255),Math.round(a*255),o),c=`rgba(${s.r}, ${s.g}, ${s.b}, ${s.a})`,l=this._colorDecorationClassRefs.add(this._ruleFactory.createClassNameRef({backgroundColor:c}));t.push({range:{startLineNumber:e[r].colorInfo.range.startLineNumber,startColumn:e[r].colorInfo.range.startColumn,endLineNumber:e[r].colorInfo.range.endLineNumber,endColumn:e[r].colorInfo.range.endColumn},options:{description:`colorDetector`,before:{content:`\xA0`,inlineClassName:`${l.className} colorpicker-color-decoration`,inlineClassNameAffectsLetterSpacing:!0,attachedData:gh}}})}let r=n<e.length?n:!1;this._decoratorLimitReporter.update(e.length,r),this._colorDecoratorIds.set(t)}removeAllDecorations(){this._editor.removeDecorations(this._decorationsIds),this._decorationsIds=[],this._colorDecoratorIds.clear(),this._colorDecorationClassRefs.clear()}getColorData(e){let t=this._editor.getModel();if(!t)return null;let n=t.getDecorationsInRange(S.fromPositions(e,e)).filter(e=>this._colorDatas.has(e.id));return n.length===0?null:this._colorDatas.get(n[0].id)}isColorDecoration(e){return this._colorDecoratorIds.has(e)}};_h=hh=ph([mh(1,Ni),mh(2,W),mh(3,co)],_h);var vh=class extends b{constructor(){super(...arguments),this._onDidChange=this._register(new E),this._computed=0,this._limited=!1}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}};const yh=`editor.action.increaseHoverVerbosityLevel`,bh=H(1094,`Increase Hover Verbosity Level`),xh=`editor.action.decreaseHoverVerbosityLevel`,Sh=H(1095,`Decrease Hover Verbosity Level`),Ch=`editor.action.inlineSuggest.commit`,wh=`editor.action.inlineSuggest.showPrevious`,Th=`editor.action.inlineSuggest.showNext`,Eh=`editor.action.inlineSuggest.hide`,Dh=`editor.action.inlineSuggest.toggleShowCollapsed`;var Oh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},kh=function(e,t){return function(n,r){t(n,r,e)}},Ah,jh=class extends b{constructor(e,t,r){super(),this.editor=e,this.model=t,this.instantiationService=r,this.alwaysShowToolbar=ai(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(71).showToolbar===`always`),this.sessionPosition=void 0,this.position=O(this,e=>{let t=this.model.read(e)?.primaryGhostText.read(e);if(!this.alwaysShowToolbar.read(e)||!t||t.parts.length===0)return this.sessionPosition=void 0,null;let n=t.parts[0].column;this.sessionPosition&&this.sessionPosition.lineNumber!==t.lineNumber&&(this.sessionPosition=void 0);let r=new x(t.lineNumber,Math.min(n,this.sessionPosition?.column??2**53-1));return this.sessionPosition=r,r}),this._register(n((t,n)=>{let r=this.model.read(t);if(!r||!this.alwaysShowToolbar.read(t))return;let i=O(t=>{let n=t.store.add(this.instantiationService.createInstance(Ph.hot.read(t),this.editor,!0,this.position,r.selectedInlineCompletionIndex,r.inlineCompletionsCount,r.activeCommands,r.warning,()=>{}));return e.addContentWidget(n),t.store.add(pl(()=>e.removeContentWidget(n))),t.store.add(la(e=>{this.position.read(e)&&r.lastTriggerKind.read(e)!==xc.Explicit&&r.triggerExplicitly()})),n}),a=Zu(this,(e,t)=>!!this.position.read(e)||!!t);n.add(la(e=>{a.read(e)&&i.read(e)}))}))}};jh=Oh([kh(2,k)],jh);var Mh=No(`inline-suggestion-hints-next`,J.chevronRight,H(1195,`Icon for show next parameter hint.`)),Nh=No(`inline-suggestion-hints-previous`,J.chevronLeft,H(1196,`Icon for show previous parameter hint.`)),Ph=class extends b{static{Ah=this}static{this.hot=hi(Ah)}static{this._dropDownVisible=!1}static get dropDownVisible(){return this._dropDownVisible}static{this.id=0}createCommandAction(e,t,n){let r=new pe(e,t,n,!0,()=>this._commandService.executeCommand(e)),i=this.keybindingService.lookupKeybinding(e,this._contextKeyService),a=t;return i&&(a=H(1197,`{0} ({1})`,t,i.getLabel())),r.tooltip=a,r}constructor(e,t,n,r,i,a,o,s,c,l,u,d,f){super(),this.editor=e,this.withBorder=t,this._position=n,this._currentSuggestionIdx=r,this._suggestionCount=i,this._extraCommands=a,this._warning=o,this._relayout=s,this._commandService=c,this.keybindingService=u,this._contextKeyService=d,this._menuService=f,this.id=`InlineSuggestionHintsContentWidget${Ah.id++}`,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._warningMessageContentNode=O(e=>{let t=this._warning.read(e);if(t)return typeof t.message==`string`?t.message:e.store.add(Ne(t.message)).element}),this._warningMessageNode=q.div({class:`warningMessage`,style:{maxWidth:400,margin:4,marginBottom:4,display:O(e=>this._warning.read(e)?`block`:`none`)}},[this._warningMessageContentNode]).keepUpdated(this._store),this.nodes=Bu(`div.inlineSuggestionsHints`,{className:this.withBorder?`monaco-hover monaco-hover-content`:``},[this._warningMessageNode.element,Bu(`div@toolBar`)]),this.previousAction=this._register(this.createCommandAction(wh,H(1198,`Previous`),X.asClassName(Nh))),this.availableSuggestionCountAction=this._register(new pe(`inlineSuggestionHints.availableSuggestionCount`,``,void 0,!1)),this.nextAction=this._register(this.createCommandAction(Th,H(1199,`Next`),X.asClassName(Mh))),this.inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(M.InlineCompletionsActions,this._contextKeyService)),this.clearAvailableSuggestionCountLabelDebounced=this._register(new ju(()=>{this.availableSuggestionCountAction.label=``},100)),this.disableButtonsDebounced=this._register(new ju(()=>{this.previousAction.enabled=this.nextAction.enabled=!1},100)),this._register(la(e=>{this._warningMessageContentNode.read(e),this._warningMessageNode.readEffect(e),this._relayout()})),this.toolBar=this._register(l.createInstance(Lh,this.nodes.toolBar,M.InlineSuggestionToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:e=>e.startsWith(`primary`)},actionViewItemProvider:(e,t)=>{if(e instanceof qe)return l.createInstance(Ih,e,void 0);if(e===this.availableSuggestionCountAction){let t=new Fh(void 0,e,{label:!0,icon:!1});return t.setClass(`availableSuggestionCount`),t}},telemetrySource:`InlineSuggestionToolbar`})),this.toolBar.setPrependedPrimaryActions([this.previousAction,this.availableSuggestionCountAction,this.nextAction]),this._register(this.toolBar.onDidChangeDropdownVisibility(e=>{Ah._dropDownVisible=e})),this._register(la(e=>{this._position.read(e),this.editor.layoutContentWidget(this)})),this._register(la(e=>{let t=this._suggestionCount.read(e),n=this._currentSuggestionIdx.read(e);t===void 0?this.clearAvailableSuggestionCountLabelDebounced.schedule():(this.clearAvailableSuggestionCountLabelDebounced.cancel(),this.availableSuggestionCountAction.label=`${n+1}/${t}`),t!==void 0&&t>1?(this.disableButtonsDebounced.cancel(),this.previousAction.enabled=this.nextAction.enabled=!0):this.disableButtonsDebounced.schedule()})),this._register(la(e=>{let t=this._extraCommands.read(e).map(e=>({class:void 0,id:e.command.id,enabled:!0,tooltip:e.command.tooltip||``,label:e.command.title,run:t=>this._commandService.executeCommand(e.command.id)}));for(let[e,n]of this.inlineCompletionsActionsMenus.getActions())for(let e of n)e instanceof qe&&t.push(e);t.length>0&&t.unshift(new wi),this.toolBar.setAdditionalSecondaryActions(t)}))}getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this._position.get(),preference:[1,2],positionAffinity:3}}};Ph=Ah=Oh([kh(8,Mr),kh(9,k),kh(10,zn),kh(11,w),kh(12,wu)],Ph);var Fh=class extends Ii{constructor(){super(...arguments),this._className=void 0}setClass(e){this._className=e}render(e){super.render(e),this._className&&e.classList.add(this._className)}updateTooltip(){}},Ih=class extends kn{updateLabel(){let e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService,!0);if(!e)return super.updateLabel();if(this.label){let t=Bu(`div.keybinding`).root;this._register(new bc(t,xs,{disableTitle:!0,...gs})).set(e),this.label.textContent=this._action.label,this.label.appendChild(t),this.label.classList.add(`inlineSuggestionStatusBarItemLabel`)}}updateTooltip(){}},Lh=class extends Hs{constructor(e,t,n,r,i,a,o,s,c){super(e,{resetMenu:t,...n},r,i,a,o,s,c),this.menuId=t,this.options2=n,this.menuService=r,this.contextKeyService=i,this.menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.additionalActions=[],this.prependedPrimaryActions=[],this.additionalPrimaryActions=[],this._store.add(this.menu.onDidChange(()=>this.updateToolbar())),this.updateToolbar()}updateToolbar(){let{primary:e,secondary:t}=rt(this.menu.getActions(this.options2?.menuOptions),this.options2?.toolbarOptions?.primaryGroup,this.options2?.toolbarOptions?.shouldInlineSubmenu,this.options2?.toolbarOptions?.useSeparatorsInPrimaryActions);t.push(...this.additionalActions),e.unshift(...this.prependedPrimaryActions),e.push(...this.additionalPrimaryActions),this.setActions(e,t)}setPrependedPrimaryActions(e){ct(this.prependedPrimaryActions,e,(e,t)=>e===t)||(this.prependedPrimaryActions=e,this.updateToolbar())}setAdditionalSecondaryActions(e){ct(this.additionalActions,e,(e,t)=>e===t)||(this.additionalActions=e,this.updateToolbar())}};Lh=Oh([kh(3,wu),kh(4,w),kh(5,Mo),kh(6,zn),kh(7,Mr),kh(8,Wr)],Lh);function Rh(e,t,n){let r=qc(e);return!(t<r.left||t>r.left+r.width||n<r.top||n>r.top+r.height)}var zh=class{constructor(e,t,n,r){this.value=e,this.isComplete=t,this.hasLoadingMessage=n,this.options=r}},Bh=class extends b{constructor(e,t){super(),this._editor=e,this._computer=t,this._onResult=this._register(new E),this.onResult=this._onResult.event,this._asyncComputationScheduler=this._register(new Vh(e=>this._triggerAsyncComputation(e),0)),this._syncComputationScheduler=this._register(new Vh(e=>this._triggerSyncComputation(e),0)),this._loadingMessageScheduler=this._register(new Vh(e=>this._triggerLoadingMessage(e),0)),this._state=0,this._asyncIterable=null,this._asyncIterableDone=!1,this._result=[]}dispose(){this._asyncIterable&&=(this._asyncIterable.cancel(),null),this._options=void 0,super.dispose()}get _hoverTime(){return this._editor.getOption(69).delay}get _firstWaitTime(){return this._hoverTime/2}get _secondWaitTime(){return this._hoverTime-this._firstWaitTime}get _loadingMessageTime(){return 3*this._hoverTime}_setState(e,t){this._options=t,this._state=e,this._fireResult(t)}_triggerAsyncComputation(e){this._setState(2,e),this._syncComputationScheduler.schedule(e,this._secondWaitTime),this._computer.computeAsync?(this._asyncIterableDone=!1,this._asyncIterable=be(t=>this._computer.computeAsync(e,t)),(async()=>{try{for await(let t of this._asyncIterable)t&&(this._result.push(t),this._fireResult(e));this._asyncIterableDone=!0,(this._state===3||this._state===4)&&this._setState(0,e)}catch(e){rr(e)}})()):this._asyncIterableDone=!0}_triggerSyncComputation(e){this._computer.computeSync&&(this._result=this._result.concat(this._computer.computeSync(e))),this._setState(this._asyncIterableDone?0:3,e)}_triggerLoadingMessage(e){this._state===3&&this._setState(4,e)}_fireResult(e){if(this._state===1||this._state===2)return;let t=this._state===0,n=this._state===4;this._onResult.fire(new zh(this._result.slice(0),t,n,e))}start(e,t){if(e===0)this._state===0&&(this._setState(1,t),this._asyncComputationScheduler.schedule(t,this._firstWaitTime),this._loadingMessageScheduler.schedule(t,this._loadingMessageTime));else switch(this._state){case 0:this._triggerAsyncComputation(t),this._syncComputationScheduler.cancel(),this._triggerSyncComputation(t);break;case 2:this._syncComputationScheduler.cancel(),this._triggerSyncComputation(t);break}}cancel(){this._asyncComputationScheduler.cancel(),this._syncComputationScheduler.cancel(),this._loadingMessageScheduler.cancel(),this._asyncIterable&&=(this._asyncIterable.cancel(),null),this._result=[],this._options=void 0,this._state=0}get options(){return this._options}},Vh=class extends b{constructor(e,t){super(),this._scheduler=this._register(new ju(()=>e(this._options),t))}schedule(e,t){this._options=e,this._scheduler.schedule(t)}cancel(){this._scheduler.cancel()}},Hh=class{get onDidWillResize(){return this._onDidWillResize.event}get onDidResize(){return this._onDidResize.event}constructor(){this._onDidWillResize=new E,this._onDidResize=new E,this._sashListener=new P,this._size=new br(0,0),this._minSize=new br(0,0),this._maxSize=new br(2**53-1,2**53-1),this.domNode=document.createElement(`div`),this._eastSash=new el(this.domNode,{getVerticalSashLeft:()=>this._size.width},{orientation:0}),this._westSash=new el(this.domNode,{getVerticalSashLeft:()=>0},{orientation:0}),this._northSash=new el(this.domNode,{getHorizontalSashTop:()=>0},{orientation:1,orthogonalEdge:Go.North}),this._southSash=new el(this.domNode,{getHorizontalSashTop:()=>this._size.height},{orientation:1,orthogonalEdge:Go.South}),this._northSash.orthogonalStartSash=this._westSash,this._northSash.orthogonalEndSash=this._eastSash,this._southSash.orthogonalStartSash=this._westSash,this._southSash.orthogonalEndSash=this._eastSash;let e,t=0,n=0;this._sashListener.add(vn.any(this._northSash.onDidStart,this._eastSash.onDidStart,this._southSash.onDidStart,this._westSash.onDidStart)(()=>{e===void 0&&(this._onDidWillResize.fire(),e=this._size,t=0,n=0)})),this._sashListener.add(vn.any(this._northSash.onDidEnd,this._eastSash.onDidEnd,this._southSash.onDidEnd,this._westSash.onDidEnd)(()=>{e!==void 0&&(e=void 0,t=0,n=0,this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(this._eastSash.onDidChange(r=>{e&&(n=r.currentX-r.startX,this.layout(e.height+t,e.width+n),this._onDidResize.fire({dimension:this._size,done:!1,east:!0}))})),this._sashListener.add(this._westSash.onDidChange(r=>{e&&(n=-(r.currentX-r.startX),this.layout(e.height+t,e.width+n),this._onDidResize.fire({dimension:this._size,done:!1,west:!0}))})),this._sashListener.add(this._northSash.onDidChange(r=>{e&&(t=-(r.currentY-r.startY),this.layout(e.height+t,e.width+n),this._onDidResize.fire({dimension:this._size,done:!1,north:!0}))})),this._sashListener.add(this._southSash.onDidChange(r=>{e&&(t=r.currentY-r.startY,this.layout(e.height+t,e.width+n),this._onDidResize.fire({dimension:this._size,done:!1,south:!0}))})),this._sashListener.add(vn.any(this._eastSash.onDidReset,this._westSash.onDidReset)(e=>{this._preferredSize&&(this.layout(this._size.height,this._preferredSize.width),this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(vn.any(this._northSash.onDidReset,this._southSash.onDidReset)(e=>{this._preferredSize&&(this.layout(this._preferredSize.height,this._size.width),this._onDidResize.fire({dimension:this._size,done:!0}))}))}dispose(){this._northSash.dispose(),this._southSash.dispose(),this._eastSash.dispose(),this._westSash.dispose(),this._sashListener.dispose(),this._onDidResize.dispose(),this._onDidWillResize.dispose(),this.domNode.remove()}enableSashes(e,t,n,r){this._northSash.state=e?3:0,this._eastSash.state=t?3:0,this._southSash.state=n?3:0,this._westSash.state=r?3:0}layout(e=this.size.height,t=this.size.width){let{height:n,width:r}=this._minSize,{height:i,width:a}=this._maxSize;e=Math.max(n,Math.min(i,e)),t=Math.max(r,Math.min(a,t));let o=new br(t,e);br.equals(o,this._size)||(this.domNode.style.height=e+`px`,this.domNode.style.width=t+`px`,this._size=o,this._northSash.layout(),this._eastSash.layout(),this._southSash.layout(),this._westSash.layout())}clearSashHoverState(){this._eastSash.clearSashHoverState(),this._westSash.clearSashHoverState(),this._northSash.clearSashHoverState(),this._southSash.clearSashHoverState()}get size(){return this._size}set maxSize(e){this._maxSize=e}get maxSize(){return this._maxSize}set minSize(e){this._minSize=e}get minSize(){return this._minSize}set preferredSize(e){this._preferredSize=e}get preferredSize(){return this._preferredSize}},Uh=class extends b{constructor(e,t=new br(10,10)){super(),this._editor=e,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._resizableNode=this._register(new Hh),this._contentPosition=null,this._isResizing=!1,this._resizableNode.domNode.style.position=`absolute`,this._resizableNode.minSize=br.lift(t),this._resizableNode.layout(t.height,t.width),this._resizableNode.enableSashes(!0,!0,!0,!0),this._register(this._resizableNode.onDidResize(e=>{this._resize(new br(e.dimension.width,e.dimension.height)),e.done&&(this._isResizing=!1)})),this._register(this._resizableNode.onDidWillResize(()=>{this._isResizing=!0}))}get isResizing(){return this._isResizing}getDomNode(){return this._resizableNode.domNode}getPosition(){return this._contentPosition}get position(){return this._contentPosition?.position?x.lift(this._contentPosition.position):void 0}_availableVerticalSpaceAbove(e){let t=this._editor.getDomNode(),n=this._editor.getScrolledVisiblePosition(e);if(!(!t||!n))return qc(t).top+n.top-30}_availableVerticalSpaceBelow(e){let t=this._editor.getDomNode(),n=this._editor.getScrolledVisiblePosition(e);if(!t||!n)return;let r=qc(t),i=ho(t.ownerDocument.body),a=r.top+n.top+n.height;return i.height-a-24}_findPositionPreference(e,t){let n=Math.min(this._availableVerticalSpaceBelow(t)??1/0,e),r=Math.min(this._availableVerticalSpaceAbove(t)??1/0,e),i=Math.min(Math.max(r,n),e),a=Math.min(e,i),o;return o=this._editor.getOption(69).above?a<=r?1:2:a<=n?2:1,o===1?this._resizableNode.enableSashes(!0,!0,!1,!1):this._resizableNode.enableSashes(!1,!0,!0,!1),o}_resize(e){this._resizableNode.layout(e.height,e.width)}},Wh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Gh=function(e,t){return function(n,r){t(n,r,e)}},Kh,qh=class extends Uh{static{Kh=this}static{this.ID=`editor.contrib.resizableContentHoverWidget`}static{this._lastDimensions=new br(0,0)}get isVisibleFromKeyboard(){return this._renderedHover?.source===2}get isVisible(){return this._hoverVisibleKey.get()??!1}get isFocused(){return this._hoverFocusedKey.get()??!1}constructor(e,t,n,r,i){let a=e.getOption(75)+8,o=new br(150,a);super(e,o),this._configurationService=n,this._accessibilityService=r,this._keybindingService=i,this._hover=this._register(new pa(!0)),this._onDidResize=this._register(new E),this.onDidResize=this._onDidResize.event,this._onDidScroll=this._register(new E),this.onDidScroll=this._onDidScroll.event,this._onContentsChanged=this._register(new E),this.onContentsChanged=this._onContentsChanged.event,this._minimumSize=o,this._hoverVisibleKey=F.hoverVisible.bindTo(t),this._hoverFocusedKey=F.hoverFocused.bindTo(t),V(this._resizableNode.domNode,this._hover.containerDomNode),this._resizableNode.domNode.style.zIndex=`50`,this._resizableNode.domNode.className=`monaco-resizable-hover`,this._register(this._editor.onDidLayoutChange(()=>{this.isVisible&&this._updateMaxDimensions()})),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(59)&&this._updateFont()}));let s=this._register(Ms(this._resizableNode.domNode));this._register(s.onDidFocus(()=>{this._hoverFocusedKey.set(!0)})),this._register(s.onDidBlur(()=>{this._hoverFocusedKey.set(!1)})),this._register(this._hover.scrollbar.onScroll(e=>{this._onDidScroll.fire(e)})),this._setRenderedHover(void 0),this._editor.addContentWidget(this)}dispose(){super.dispose(),this._renderedHover?.dispose(),this._editor.removeContentWidget(this)}getId(){return Kh.ID}static _applyDimensions(e,t,n){let r=typeof t==`number`?`${t}px`:t,i=typeof n==`number`?`${n}px`:n;e.style.width=r,e.style.height=i}_setContentsDomNodeDimensions(e,t){let n=this._hover.contentsDomNode;return Kh._applyDimensions(n,e,t)}_setContainerDomNodeDimensions(e,t){let n=this._hover.containerDomNode;return Kh._applyDimensions(n,e,t)}_setScrollableElementDimensions(e,t){let n=this._hover.scrollbar.getDomNode();return Kh._applyDimensions(n,e,t)}_setHoverWidgetDimensions(e,t){this._setContainerDomNodeDimensions(e,t),this._setScrollableElementDimensions(e,t),this._setContentsDomNodeDimensions(e,t),this._layoutContentWidget()}static _applyMaxDimensions(e,t,n){let r=typeof t==`number`?`${t}px`:t,i=typeof n==`number`?`${n}px`:n;e.style.maxWidth=r,e.style.maxHeight=i}_setHoverWidgetMaxDimensions(e,t){Kh._applyMaxDimensions(this._hover.contentsDomNode,e,t),Kh._applyMaxDimensions(this._hover.scrollbar.getDomNode(),e,t),Kh._applyMaxDimensions(this._hover.containerDomNode,e,t),this._hover.containerDomNode.style.setProperty(`--vscode-hover-maxWidth`,typeof e==`number`?`${e}px`:e),this._layoutContentWidget()}_setAdjustedHoverWidgetDimensions(e){this._setHoverWidgetMaxDimensions(`none`,`none`),this._setHoverWidgetDimensions(e.width,e.height)}_updateResizableNodeMaxDimensions(){let e=this._findMaximumRenderingWidth()??1/0,t=this._findMaximumRenderingHeight()??1/0;this._resizableNode.maxSize=new br(e,t),this._setHoverWidgetMaxDimensions(e,t)}_resize(e){Kh._lastDimensions=new br(e.width,e.height),this._setAdjustedHoverWidgetDimensions(e),this._resizableNode.layout(e.height,e.width),this._updateResizableNodeMaxDimensions(),this._hover.scrollbar.scanDomNode(),this._editor.layoutContentWidget(this),this._onDidResize.fire()}_findAvailableSpaceVertically(){let e=this._renderedHover?.showAtPosition;if(e)return this._positionPreference===1?this._availableVerticalSpaceAbove(e):this._availableVerticalSpaceBelow(e)}_findMaximumRenderingHeight(){let e=this._findAvailableSpaceVertically();if(!e)return;let t=this._hover.contentsDomNode.children.length-1;return Array.from(this._hover.contentsDomNode.children).forEach(e=>{t+=e.clientHeight}),Math.min(e,t)}_isHoverTextOverflowing(){this._hover.containerDomNode.style.setProperty(`--vscode-hover-whiteSpace`,`nowrap`),this._hover.containerDomNode.style.setProperty(`--vscode-hover-sourceWhiteSpace`,`nowrap`);let e=Array.from(this._hover.contentsDomNode.children).some(e=>e.scrollWidth>e.clientWidth);return this._hover.containerDomNode.style.removeProperty(`--vscode-hover-whiteSpace`),this._hover.containerDomNode.style.removeProperty(`--vscode-hover-sourceWhiteSpace`),e}_findMaximumRenderingWidth(){if(!this._editor||!this._editor.hasModel())return;let e=this._isHoverTextOverflowing(),t=this._contentWidth===void 0?0:this._contentWidth;return e||this._hover.containerDomNode.clientWidth<t?ho(this._hover.containerDomNode.ownerDocument.body).width-14:this._hover.containerDomNode.clientWidth}isMouseGettingCloser(e,t){if(!this._renderedHover)return!1;if(this._renderedHover.initialMousePosX===void 0||this._renderedHover.initialMousePosY===void 0)return this._renderedHover.initialMousePosX=e,this._renderedHover.initialMousePosY=t,!1;let n=qc(this.getDomNode());this._renderedHover.closestMouseDistance===void 0&&(this._renderedHover.closestMouseDistance=Jh(this._renderedHover.initialMousePosX,this._renderedHover.initialMousePosY,n.left,n.top,n.width,n.height));let r=Jh(e,t,n.left,n.top,n.width,n.height);return r>this._renderedHover.closestMouseDistance+4?!1:(this._renderedHover.closestMouseDistance=Math.min(this._renderedHover.closestMouseDistance,r),!0)}_setRenderedHover(e){this._renderedHover?.dispose(),this._renderedHover=e,this._hoverVisibleKey.set(!!e),this._hover.containerDomNode.classList.toggle(`hidden`,!e)}_updateFont(){let{fontSize:e,lineHeight:t}=this._editor.getOption(59),n=this._hover.contentsDomNode;n.style.fontSize=`${e}px`,n.style.lineHeight=`${t/e}`,Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName(`code`)).forEach(e=>this._editor.applyFontInfo(e))}_updateContent(e){let t=this._hover.contentsDomNode;t.style.paddingBottom=``,t.textContent=``,t.appendChild(e)}_layoutContentWidget(){this._editor.layoutContentWidget(this),this._hover.onContentsChanged()}_updateMaxDimensions(){let e=Math.max(this._editor.getLayoutInfo().height/4,250,Kh._lastDimensions.height),t=Math.max(this._editor.getLayoutInfo().width*.66,750,Kh._lastDimensions.width);this._resizableNode.maxSize=new br(t,e),this._setHoverWidgetMaxDimensions(t,e)}_render(e){this._setRenderedHover(e),this._updateFont(),this._updateContent(e.domNode),this.handleContentsChanged(),this._editor.render()}getPosition(){return this._renderedHover?{position:this._renderedHover.showAtPosition,secondaryPosition:this._renderedHover.showAtSecondaryPosition,positionAffinity:this._renderedHover.shouldAppearBeforeContent?3:void 0,preference:[this._positionPreference??1]}:null}show(e){if(!this._editor||!this._editor.hasModel())return;this._render(e);let t=Yo(this._hover.containerDomNode),n=e.showAtPosition;this._positionPreference=this._findPositionPreference(t,n)??1,this.handleContentsChanged(),e.shouldFocus&&this._hover.containerDomNode.focus(),this._onDidResize.fire();let r=this._hover.containerDomNode.ownerDocument.activeElement===this._hover.containerDomNode&&o(this._configurationService.getValue(`accessibility.verbosity.hover`)===!0&&this._accessibilityService.isScreenReaderOptimized(),this._keybindingService.lookupKeybinding(`editor.action.accessibleView`)?.getAriaLabel()??``);r&&(this._hover.contentsDomNode.ariaLabel=this._hover.contentsDomNode.textContent+`, `+r)}hide(){if(!this._renderedHover)return;let e=this._renderedHover.shouldFocus||this._hoverFocusedKey.get();this._setRenderedHover(void 0),this._resizableNode.maxSize=new br(1/0,1/0),this._resizableNode.clearSashHoverState(),this._hoverFocusedKey.set(!1),this._editor.layoutContentWidget(this),e&&this._editor.focus()}_removeConstraintsRenderNormally(){let e=this._editor.getLayoutInfo();this._resizableNode.layout(e.height,e.width),this._setHoverWidgetDimensions(`auto`,`auto`),this._updateMaxDimensions()}setMinimumDimensions(e){this._minimumSize=new br(Math.max(this._minimumSize.width,e.width),Math.max(this._minimumSize.height,e.height)),this._updateMinimumWidth()}_updateMinimumWidth(){let e=this._contentWidth===void 0?this._minimumSize.width:Math.min(this._contentWidth,this._minimumSize.width);this._resizableNode.minSize=new br(e,this._minimumSize.height)}handleContentsChanged(){this._removeConstraintsRenderNormally();let e=this._hover.contentsDomNode,t=Yo(e),n=ba(e)+2;if(this._resizableNode.layout(t,n),this._setHoverWidgetDimensions(n,t),t=Yo(e),n=ba(e),this._contentWidth=n,this._updateMinimumWidth(),this._resizableNode.layout(t,n),this._renderedHover?.showAtPosition){let e=Yo(this._hover.containerDomNode);this._positionPreference=this._findPositionPreference(e,this._renderedHover.showAtPosition)}this._layoutContentWidget(),this._onContentsChanged.fire()}focus(){this._hover.containerDomNode.focus()}scrollUp(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(59);this._hover.scrollbar.setScrollPosition({scrollTop:e-t.lineHeight})}scrollDown(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(59);this._hover.scrollbar.setScrollPosition({scrollTop:e+t.lineHeight})}scrollLeft(){let e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e-30})}scrollRight(){let e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e+30})}pageUp(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e-t})}pageDown(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e+t})}goToTop(){this._hover.scrollbar.setScrollPosition({scrollTop:0})}goToBottom(){this._hover.scrollbar.setScrollPosition({scrollTop:this._hover.scrollbar.getScrollDimensions().scrollHeight})}};qh=Kh=Wh([Gh(1,w),Gh(2,Ni),Gh(3,Zt),Gh(4,zn)],qh);function Jh(e,t,n,r,i,a){let o=n+i/2,s=r+a/2,c=Math.max(Math.abs(e-o)-i/2,0),l=Math.max(Math.abs(t-s)-a/2,0);return Math.sqrt(c*c+l*l)}var Yh=class e{constructor(e,t){this._editor=e,this._participants=t}static _getLineDecorations(e,t){if(t.type!==1&&!t.supportsMarkerHover)return[];let n=e.getModel(),r=t.range.startLineNumber;if(r>n.getLineCount())return[];let i=n.getLineMaxColumn(r);return e.getLineDecorations(r).filter(e=>{if(e.options.isWholeLine)return!0;let n=e.range.startLineNumber===r?e.range.startColumn:1,a=e.range.endLineNumber===r?e.range.endColumn:i;if(e.options.showIfCollapsed){if(n>t.range.startColumn+1||t.range.endColumn-1>a)return!1}else if(n>t.range.startColumn||t.range.endColumn>a)return!1;return!0})}computeAsync(t,n){let r=t.anchor;if(!this._editor.hasModel()||!r)return lu.EMPTY;let i=e._getLineDecorations(this._editor,r);return lu.merge(this._participants.map(e=>e.computeAsync?e.computeAsync(r,i,t.source,n):lu.EMPTY))}computeSync(t){if(!this._editor.hasModel())return[];let n=t.anchor,r=e._getLineDecorations(this._editor,n),i=[];for(let e of this._participants)i=i.concat(e.computeSync(n,r,t.source));return vi(i)}},Xh=class{constructor(e,t,n){this.hoverParts=e,this.isComplete=t,this.options=n}filter(e){let t=this.hoverParts.filter(t=>t.isValidForHoverAnchor(e));return t.length===this.hoverParts.length?this:new Zh(this,t,this.isComplete,this.options)}},Zh=class extends Xh{constructor(e,t,n,r){super(t,n,r),this.original=e}filter(e){return this.original.filter(e)}},Qh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$h=function(e,t){return function(n,r){t(n,r,e)}},eg=I,tg=class extends b{get hasContent(){return this._hasContent}constructor(e,t){super(),this._keybindingService=e,this._hoverService=t,this.actions=[],this._hasContent=!1,this.hoverElement=eg(`div.hover-row.status-bar`),this.hoverElement.tabIndex=0,this.actionsElement=V(this.hoverElement,eg(`div.actions`))}addAction(e){let t=this._keybindingService.lookupKeybinding(e.commandId),n=t?t.getLabel():null;this._hasContent=!0;let r=this._register(Wi.render(this.actionsElement,e,n));return this._register(this._hoverService.setupManagedHover(Jt(`element`),r.actionContainer,r.actionRenderedLabel)),this.actions.push(r),r}append(e){let t=V(this.actionsElement,e);return this._hasContent=!0,t}};tg=Qh([$h(0,zn),$h(1,Ac)],tg);var ng=class{constructor(e,t,n){this.provider=e,this.hover=t,this.ordinal=n}};async function rg(e,t,n,r,i){let a=await Promise.resolve(e.provideHover(n,r,i)).catch(Ze);if(!(!a||!og(a)))return new ng(e,a,t)}function ig(e,t,n,r,i=!1){let a=e.ordered(t,i).map((e,i)=>rg(e,i,t,n,r));return lu.fromPromisesResolveOrder(a).coalesce()}async function ag(e,t,n,r,i=!1){let a=[];for await(let o of ig(e,t,n,r,i))a.push(o.hover);return a}Sl(`_executeHoverProvider`,(e,t,n)=>{let r=e.get(W);return ag(r.hoverProvider,t,n,A.None)}),Sl(`_executeHoverProvider_recursive`,(e,t,n)=>{let r=e.get(W);return ag(r.hoverProvider,t,n,A.None,!0)});function og(e){let t=e.range!==void 0,n=e.contents!==void 0&&e.contents&&e.contents.length>0;return t&&n}var sg=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},cg=function(e,t){return function(n,r){t(n,r,e)}},lg=I,ug=No(`hover-increase-verbosity`,J.add,H(1120,`Icon for increaseing hover verbosity.`)),dg=No(`hover-decrease-verbosity`,J.remove,H(1121,`Icon for decreasing hover verbosity.`)),fg=class{constructor(e,t,n,r,i,a=void 0){this.owner=e,this.range=t,this.contents=n,this.isBeforeContent=r,this.ordinal=i,this.source=a}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}},pg=class{constructor(e,t,n){this.hover=e,this.hoverProvider=t,this.hoverPosition=n}supportsVerbosityAction(e){switch(e){case iu.Increase:return this.hover.canIncreaseVerbosity??!1;case iu.Decrease:return this.hover.canDecreaseVerbosity??!1}}},mg=class{constructor(e,t,n,r,i,a,o,s){this._editor=e,this._languageService=t,this._openerService=n,this._configurationService=r,this._languageFeaturesService=i,this._keybindingService=a,this._hoverService=o,this._commandService=s,this.hoverOrdinal=3}createLoadingMessage(e){return new fg(this,e.range,[new Tn().appendText(H(1122,`Loading...`))],!1,2e3)}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1)return[];let n=this._editor.getModel(),r=e.range.startLineNumber,i=n.getLineMaxColumn(r),a=[],o=1e3,s=n.getLineLength(r),c=n.getLanguageIdAtPosition(e.range.startLineNumber,e.range.startColumn),l=this._editor.getOption(132),u=this._configurationService.getValue(`editor.maxTokenizationLineLength`,{overrideIdentifier:c}),d=!1;l>=0&&s>l&&e.range.startColumn>=l&&(d=!0,a.push(new fg(this,e.range,[{value:H(1123,"Rendering paused for long line for performance reasons. This can be configured via `editor.stopRenderingLineAfter`.")}],!1,o++))),!d&&typeof u==`number`&&s>=u&&a.push(new fg(this,e.range,[{value:H(1124,"Tokenization is skipped for long lines for performance reasons. This can be configured via `editor.maxTokenizationLineLength`.")}],!1,o++));let f=!1;for(let n of t){let t=n.range.startLineNumber===r?n.range.startColumn:1,s=n.range.endLineNumber===r?n.range.endColumn:i,c=n.options.hoverMessage;if(!c||Ln(c))continue;n.options.beforeContentClassName&&(f=!0);let l=new S(e.range.startLineNumber,t,e.range.startLineNumber,s);a.push(new fg(this,l,un(c),f,o++))}return a}computeAsync(e,t,n,r){if(!this._editor.hasModel()||e.type!==1)return lu.EMPTY;let i=this._editor.getModel(),a=this._languageFeaturesService.hoverProvider;return a.has(i)?this._getMarkdownHovers(a,i,e,r):lu.EMPTY}async*_getMarkdownHovers(e,t,n,r){let i=n.range.getStartPosition(),a=ig(e,t,i,r);for await(let e of a)if(!Ln(e.hover.contents)){let t=e.hover.range?S.lift(e.hover.range):n.range,r=new pg(e.hover,e.provider,i);yield new fg(this,t,e.hover.contents,!1,e.ordinal,r)}}renderHoverParts(e,t){return this._renderedHoverParts=new gg(t,e.fragment,this,this._editor,this._languageService,this._openerService,this._commandService,this._keybindingService,this._hoverService,this._configurationService,e.onContentsChanged),this._renderedHoverParts}handleScroll(e){this._renderedHoverParts?.handleScroll(e)}updateMarkdownHoverVerbosityLevel(e,t){return Promise.resolve(this._renderedHoverParts?.updateMarkdownHoverPartVerbosityLevel(e,t))}};mg=sg([cg(1,ui),cg(2,cl),cg(3,Ni),cg(4,W),cg(5,zn),cg(6,Ac),cg(7,Mr)],mg);var hg=class{constructor(e,t,n,r){this.hoverPart=e,this.hoverElement=t,this.disposables=n,this.actionsContainer=r}dispose(){this.disposables.dispose()}},gg=class{constructor(e,t,n,r,i,a,o,s,c,l,u){this._hoverParticipant=n,this._editor=r,this._languageService=i,this._openerService=a,this._commandService=o,this._keybindingService=s,this._hoverService=c,this._configurationService=l,this._onFinishedRendering=u,this._ongoingHoverOperations=new Map,this._disposables=new P,this.renderedHoverParts=this._renderHoverParts(e,t,this._onFinishedRendering),this._disposables.add(pl(()=>{this.renderedHoverParts.forEach(e=>{e.dispose()}),this._ongoingHoverOperations.forEach(e=>{e.tokenSource.dispose(!0)})}))}_renderHoverParts(e,t,n){return e.sort(bt(e=>e.ordinal,Qi)),e.map(e=>{let r=this._renderHoverPart(e,n);return t.appendChild(r.hoverElement),r})}_renderHoverPart(e,t){let n=this._renderMarkdownHover(e,t),r=n.hoverElement,i=e.source,a=new P;if(a.add(n),!i)return new hg(e,r,a);let o=i.supportsVerbosityAction(iu.Increase),s=i.supportsVerbosityAction(iu.Decrease);if(!o&&!s)return new hg(e,r,a);let c=lg(`div.verbosity-actions`);r.prepend(c);let l=lg(`div.verbosity-actions-inner`);return c.append(l),a.add(this._renderHoverExpansionAction(l,iu.Increase,o)),a.add(this._renderHoverExpansionAction(l,iu.Decrease,s)),new hg(e,r,a,l)}_renderMarkdownHover(e,t){return vg(this._editor,e,this._languageService,this._openerService,t)}_renderHoverExpansionAction(e,t,n){let r=new P,i=t===iu.Increase,a=V(e,lg(X.asCSSSelector(i?ug:dg)));a.tabIndex=0;let o=new xl(`mouse`,void 0,{target:e,position:{hoverPosition:0}},this._configurationService,this._hoverService);if(r.add(this._hoverService.setupManagedHover(o,a,yg(this._keybindingService,t))),!n)return a.classList.add(`disabled`),r;a.classList.add(`enabled`);let s=()=>this._commandService.executeCommand(t===iu.Increase?yh:xh,{focus:!0});return r.add(new ta(a,s)),r.add(new _r(a,s,[3,10])),r}handleScroll(e){this.renderedHoverParts.forEach(t=>{let n=t.actionsContainer;if(!n)return;let r=t.hoverElement,i=e.scrollTop+e.height,a=r.offsetTop,o=r.clientHeight,s=a+o,c;c=s<=i||a>=i?o-22:i-a-22,n.style.top=`${c}px`})}async updateMarkdownHoverPartVerbosityLevel(e,t){let n=this._editor.getModel();if(!n)return;let r=this._getRenderedHoverPartAtIndex(t),i=r?.hoverPart.source;if(!r||!i?.supportsVerbosityAction(e))return;let a=await this._fetchHover(i,n,e);if(!a)return;let o=new pg(a,i.hoverProvider,i.hoverPosition),s=r.hoverPart,c=new fg(this._hoverParticipant,s.range,a.contents,s.isBeforeContent,s.ordinal,o),l=this._updateRenderedHoverPart(t,c);if(l)return{hoverPart:c,hoverElement:l.hoverElement}}async _fetchHover(e,t,n){let r=n===iu.Increase?1:-1,i=e.hoverProvider,a=this._ongoingHoverOperations.get(i);a&&(a.tokenSource.cancel(),r+=a.verbosityDelta);let o=new ur;this._ongoingHoverOperations.set(i,{verbosityDelta:r,tokenSource:o});let s={verbosityRequest:{verbosityDelta:r,previousHover:e.hover}},c;try{c=await Promise.resolve(i.provideHover(t,e.hoverPosition,o.token,s))}catch(e){Ze(e)}return o.dispose(),this._ongoingHoverOperations.delete(i),c}_updateRenderedHoverPart(e,t){if(e>=this.renderedHoverParts.length||e<0)return;let n=this._renderHoverPart(t,this._onFinishedRendering),r=this.renderedHoverParts[e],i=r.hoverElement,a=n.hoverElement,o=Array.from(a.children);i.replaceChildren(...o);let s=new hg(t,i,n.disposables,n.actionsContainer);return r.dispose(),this.renderedHoverParts[e]=s,s}_getRenderedHoverPartAtIndex(e){return this.renderedHoverParts[e]}dispose(){this._disposables.dispose()}};function _g(e,t,n,r,i){t.sort(bt(e=>e.ordinal,Qi));let a=[];for(let o of t){let t=vg(n,o,r,i,e.onContentsChanged);e.fragment.appendChild(t.hoverElement),a.push(t)}return new eh(a)}function vg(e,t,n,r,i){let a=new P,o=lg(`div.hover-row`),s=lg(`div.hover-row-contents`);o.appendChild(s);let c=t.contents;for(let t of c){if(Ln(t))continue;let o=lg(`div.markdown-hover`),c=V(o,lg(`div.hover-contents`)),l=new $r({editor:e},n,r),u=a.add(l.render(t,{asyncRenderCallback:()=>{c.className=`hover-contents code-hover-contents`,i()}}));c.appendChild(u.element),s.appendChild(o)}return{hoverPart:t,hoverElement:o,dispose(){a.dispose()}}}function yg(e,t){switch(t){case iu.Increase:{let t=e.lookupKeybinding(yh);return t?H(1125,`Increase Hover Verbosity ({0})`,t.getLabel()):H(1126,`Increase Hover Verbosity`)}case iu.Decrease:{let t=e.lookupKeybinding(xh);return t?H(1127,`Decrease Hover Verbosity ({0})`,t.getLabel()):H(1128,`Decrease Hover Verbosity`)}}}var bg=I,xg=class extends b{constructor(e,t,n){super(),this.model=t,this.pixelRatio=n,this._onDidChange=new E,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new E,this.onColorFlushed=this._onColorFlushed.event,this._domNode=bg(`.saturation-wrap`),V(e,this._domNode),this._canvas=document.createElement(`canvas`),this._canvas.className=`saturation-box`,V(this._domNode,this._canvas),this.selection=bg(`.saturation-selection`),V(this._domNode,this.selection),this.layout(),this._register(U(this._domNode,Eo.POINTER_DOWN,e=>this.onPointerDown(e))),this._register(this.model.onDidChangeColor(this.onDidChangeColor,this)),this.monitor=null}get domNode(){return this._domNode}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;this.monitor=this._register(new gi);let t=qc(this._domNode);e.target!==this.selection&&this.onDidChangePosition(e.offsetX,e.offsetY),this.monitor.startMonitoring(e.target,e.pointerId,e.buttons,e=>this.onDidChangePosition(e.pageX-t.left,e.pageY-t.top),()=>null);let n=U(e.target.ownerDocument,Eo.POINTER_UP,()=>{this._onColorFlushed.fire(),n.dispose(),this.monitor&&=(this.monitor.stopMonitoring(!0),null)},!0)}onDidChangePosition(e,t){let n=Math.max(0,Math.min(1,e/this.width)),r=Math.max(0,Math.min(1,1-t/this.height));this.paintSelection(n,r),this._onDidChange.fire({s:n,v:r})}layout(){this.width=this._domNode.offsetWidth,this.height=this._domNode.offsetHeight,this._canvas.width=this.width*this.pixelRatio,this._canvas.height=this.height*this.pixelRatio,this.paint();let e=this.model.color.hsva;this.paintSelection(e.s,e.v)}paint(){let e=this.model.color.hsva,t=new z(new eu(e.h,1,1,1)),n=this._canvas.getContext(`2d`),r=n.createLinearGradient(0,0,this._canvas.width,0);r.addColorStop(0,`rgba(255, 255, 255, 1)`),r.addColorStop(.5,`rgba(255, 255, 255, 0.5)`),r.addColorStop(1,`rgba(255, 255, 255, 0)`);let i=n.createLinearGradient(0,0,0,this._canvas.height);i.addColorStop(0,`rgba(0, 0, 0, 0)`),i.addColorStop(1,`rgba(0, 0, 0, 1)`),n.rect(0,0,this._canvas.width,this._canvas.height),n.fillStyle=z.Format.CSS.format(t),n.fill(),n.fillStyle=r,n.fill(),n.fillStyle=i,n.fill()}paintSelection(e,t){this.selection.style.left=`${e*this.width}px`,this.selection.style.top=`${this.height-t*this.height}px`}onDidChangeColor(e){if(this.monitor&&this.monitor.isMonitoring())return;this.paint();let t=e.hsva;this.paintSelection(t.s,t.v)}},Sg=class extends b{constructor(e){super(),this._onClicked=this._register(new E),this.onClicked=this._onClicked.event,this._button=V(e,document.createElement(`button`)),this._button.classList.add(`insert-button`),this._button.textContent=`Insert`,this._register(U(this._button,Eo.CLICK,()=>{this._onClicked.fire()}))}get button(){return this._button}},Cg=I,wg=class extends b{constructor(e,t,n){super(),this.model=t,this._onDidChange=new E,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new E,this.onColorFlushed=this._onColorFlushed.event,n===`standalone`?(this.domNode=V(e,Cg(`.standalone-strip`)),this.overlay=V(this.domNode,Cg(`.standalone-overlay`))):(this.domNode=V(e,Cg(`.strip`)),this.overlay=V(this.domNode,Cg(`.overlay`))),this.slider=V(this.domNode,Cg(`.slider`)),this.slider.style.top=`0px`,this._register(U(this.domNode,Eo.POINTER_DOWN,e=>this.onPointerDown(e))),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this.layout()}layout(){this.height=this.domNode.offsetHeight-this.slider.offsetHeight;let e=this.getValue(this.model.color);this.updateSliderPosition(e)}onDidChangeColor(e){let t=this.getValue(e);this.updateSliderPosition(t)}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=this._register(new gi),n=qc(this.domNode);this.domNode.classList.add(`grabbing`),e.target!==this.slider&&this.onDidChangeTop(e.offsetY),t.startMonitoring(e.target,e.pointerId,e.buttons,e=>this.onDidChangeTop(e.pageY-n.top),()=>null);let r=U(e.target.ownerDocument,Eo.POINTER_UP,()=>{this._onColorFlushed.fire(),r.dispose(),t.stopMonitoring(!0),this.domNode.classList.remove(`grabbing`)},!0)}onDidChangeTop(e){let t=Math.max(0,Math.min(1,1-e/this.height));this.updateSliderPosition(t),this._onDidChange.fire(t)}updateSliderPosition(e){this.slider.style.top=`${(1-e)*this.height}px`}},Tg=class extends wg{constructor(e,t,n){super(e,t,n),this.domNode.classList.add(`opacity-strip`),this.onDidChangeColor(this.model.color)}onDidChangeColor(e){super.onDidChangeColor(e);let{r:t,g:n,b:r}=e.rgba,i=new z(new bo(t,n,r,1)),a=new z(new bo(t,n,r,0));this.overlay.style.background=`linear-gradient(to bottom, ${i} 0%, ${a} 100%)`}getValue(e){return e.hsva.a}},Eg=class extends wg{constructor(e,t,n){super(e,t,n),this.domNode.classList.add(`hue-strip`)}getValue(e){return 1-e.hsva.h/360}},Dg=I,Og=class extends b{constructor(e,t,n,r){super(),this.model=t,this.pixelRatio=n,this._insertButton=null,this._domNode=Dg(`.colorpicker-body`),V(e,this._domNode),this._saturationBox=new xg(this._domNode,this.model,this.pixelRatio),this._register(this._saturationBox),this._register(this._saturationBox.onDidChange(this.onDidSaturationValueChange,this)),this._register(this._saturationBox.onColorFlushed(this.flushColor,this)),this._opacityStrip=new Tg(this._domNode,this.model,r),this._register(this._opacityStrip),this._register(this._opacityStrip.onDidChange(this.onDidOpacityChange,this)),this._register(this._opacityStrip.onColorFlushed(this.flushColor,this)),this._hueStrip=new Eg(this._domNode,this.model,r),this._register(this._hueStrip),this._register(this._hueStrip.onDidChange(this.onDidHueChange,this)),this._register(this._hueStrip.onColorFlushed(this.flushColor,this)),r===`standalone`&&(this._insertButton=this._register(new Sg(this._domNode)),this._domNode.classList.add(`standalone-colorpicker`))}flushColor(){this.model.flushColor()}onDidSaturationValueChange({s:e,v:t}){let n=this.model.color.hsva;this.model.color=new z(new eu(n.h,e,t,n.a))}onDidOpacityChange(e){let t=this.model.color.hsva;this.model.color=new z(new eu(t.h,t.s,t.v,e))}onDidHueChange(e){let t=this.model.color.hsva,n=(1-e)*360;this.model.color=new z(new eu(n===360?0:n,t.s,t.v,t.a))}get domNode(){return this._domNode}get saturationBox(){return this._saturationBox}get enterButton(){return this._insertButton}layout(){this._saturationBox.layout(),this._opacityStrip.layout(),this._hueStrip.layout()}},kg=I,Ag=class extends b{constructor(e){super(),this._onClicked=this._register(new E),this.onClicked=this._onClicked.event,this._button=document.createElement(`div`),this._button.classList.add(`close-button`),V(e,this._button);let t=document.createElement(`div`);t.classList.add(`close-button-inner-div`),V(this._button,t),V(t,kg(`.button`+X.asCSSSelector(No(`color-picker-close`,J.close,H(878,`Icon to close the color picker`))))).classList.add(`close-icon`),this._register(U(this._button,Eo.CLICK,()=>{this._onClicked.fire()}))}},jg=I,Mg=class extends b{constructor(e,t,n,r){super(),this.model=t,this.type=r,this._closeButton=null,this._domNode=jg(`.colorpicker-header`),V(e,this._domNode),this._pickedColorNode=V(this._domNode,jg(`.picked-color`)),V(this._pickedColorNode,jg(`span.codicon.codicon-color-mode`)),this._pickedColorPresentation=V(this._pickedColorNode,document.createElement(`span`)),this._pickedColorPresentation.classList.add(`picked-color-presentation`);let i=H(879,`Click to toggle color options (rgb/hsl/hex)`);this._pickedColorNode.setAttribute(`title`,i),this._originalColorNode=V(this._domNode,jg(`.original-color`)),this._originalColorNode.style.backgroundColor=z.Format.CSS.format(this.model.originalColor)||``,this.backgroundColor=n.getColorTheme().getColor(to)||z.white,this._register(n.onDidColorThemeChange(e=>{this.backgroundColor=e.getColor(to)||z.white})),this._register(U(this._pickedColorNode,Eo.CLICK,()=>this.model.selectNextColorPresentation())),this._register(U(this._originalColorNode,Eo.CLICK,()=>{this.model.color=this.model.originalColor,this.model.flushColor()})),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this._register(t.onDidChangePresentation(this.onDidChangePresentation,this)),this._pickedColorNode.style.backgroundColor=z.Format.CSS.format(t.color)||``,this._pickedColorNode.classList.toggle(`light`,t.color.rgba.a<.5?this.backgroundColor.isLighter():t.color.isLighter()),this.onDidChangeColor(this.model.color),this.type===`standalone`&&(this._domNode.classList.add(`standalone-colorpicker`),this._closeButton=this._register(new Ag(this._domNode)))}get closeButton(){return this._closeButton}get pickedColorNode(){return this._pickedColorNode}get originalColorNode(){return this._originalColorNode}onDidChangeColor(e){this._pickedColorNode.style.backgroundColor=z.Format.CSS.format(e)||``,this._pickedColorNode.classList.toggle(`light`,e.rgba.a<.5?this.backgroundColor.isLighter():e.isLighter()),this.onDidChangePresentation()}onDidChangePresentation(){this._pickedColorPresentation.textContent=this.model.presentation?this.model.presentation.label:``}},Ng=I,Pg=class extends Au{constructor(e,t,n,r,i){super(),this.model=t,this.pixelRatio=n,this._register(Ki.getInstance(su(e)).onDidChange(()=>this.layout())),this._domNode=Ng(`.colorpicker-widget`),e.appendChild(this._domNode),this.header=this._register(new Mg(this._domNode,this.model,r,i)),this.body=this._register(new Og(this._domNode,this.model,this.pixelRatio,i))}layout(){this.body.layout()}get domNode(){return this._domNode}},Fg=class{get color(){return this._color}set color(e){this._color.equals(e)||(this._color=e,this._onDidChangeColor.fire(e))}get presentation(){return this.colorPresentations[this.presentationIndex]}get colorPresentations(){return this._colorPresentations}set colorPresentations(e){this._colorPresentations=e,this.presentationIndex>e.length-1&&(this.presentationIndex=0),this._onDidChangePresentation.fire(this.presentation)}constructor(e,t,n){this.presentationIndex=n,this._onColorFlushed=new E,this.onColorFlushed=this._onColorFlushed.event,this._onDidChangeColor=new E,this.onDidChangeColor=this._onDidChangeColor.event,this._onDidChangePresentation=new E,this.onDidChangePresentation=this._onDidChangePresentation.event,this.originalColor=e,this._color=e,this._colorPresentations=t}selectNextColorPresentation(){this.presentationIndex=(this.presentationIndex+1)%this.colorPresentations.length,this.flushColor(),this._onDidChangePresentation.fire(this.presentation)}guessColorPresentation(e,t){let n=-1;for(let e=0;e<this.colorPresentations.length;e++)if(t.toLowerCase()===this.colorPresentations[e].label){n=e;break}if(n===-1){let e=t.split(`(`)[0].toLowerCase();for(let t=0;t<this.colorPresentations.length;t++)if(this.colorPresentations[t].label.toLowerCase().startsWith(e)){n=t;break}}n!==-1&&n!==this.presentationIndex&&(this.presentationIndex=n,this._onDidChangePresentation.fire(this.presentation))}flushColor(){this._onColorFlushed.fire(this._color)}};async function Ig(e,t,n){let r=e.getValueInRange(t.range),{red:i,green:a,blue:o,alpha:s}=t.color,c=new bo(Math.round(i*255),Math.round(a*255),Math.round(o*255),s),l=new z(c),u=await sh(e,t,n,A.None),d=new Fg(l,[],0);return d.colorPresentations=u||[],d.guessColorPresentation(l,r),{range:S.lift(t.range),model:d,provider:n}}function Lg(e,t,n){let r=[],i=n.presentation.textEdit??{range:t,text:n.presentation.label,forceMoveMarkers:!1};r.push(i),n.presentation.additionalTextEdits&&r.push(...n.presentation.additionalTextEdits);let a=S.lift(i.range),o=e.getModel()._setTrackedRange(null,a,3);return e.executeEdits(`colorpicker`,r),e.pushUndoStop(),e.getModel()._getTrackedRange(o)??a}async function Rg(e,t,n,r,i){t.colorPresentations=await sh(e,{range:r,color:{red:n.rgba.r/255,green:n.rgba.g/255,blue:n.rgba.b/255,alpha:n.rgba.a}},i.provider,A.None)||[]}var zg=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Bg=function(e,t){return function(n,r){t(n,r,e)}},Vg=class e{constructor(e,t,n,r){this.owner=e,this.range=t,this.model=n,this.provider=r,this.forceShowAtRange=!0}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}static fromBaseColor(t,n){return new e(t,n.range,n.model,n.provider)}},Hg=class{constructor(e,t){this._editor=e,this._themeService=t,this.hoverOrdinal=2}computeSync(e,t,n){return[]}computeAsync(e,t,n,r){return lu.fromPromise(this._computeAsync(e,t,n))}async _computeAsync(e,t,n){if(!this._editor.hasModel()||!this._isValidRequest(n))return[];let r=_h.get(this._editor);if(!r)return[];for(let e of t){if(!r.isColorDecoration(e))continue;let t=r.getColorData(e.range.getStartPosition());if(t)return[Vg.fromBaseColor(this,await Ig(this._editor.getModel(),t.colorInfo,t.provider))]}return[]}_isValidRequest(e){let t=this._editor.getOption(167);switch(e){case 0:return t===`hover`||t===`clickAndHover`;case 1:return t===`click`||t===`clickAndHover`;case 2:return!0}}renderHoverParts(e,t){let n=this._editor;if(t.length===0||!n.hasModel())return new eh([]);let r=n.getOption(75)+8;e.setMinimumDimensions(new br(302,r));let i=new P,a=t[0],o=n.getModel(),s=a.model;this._colorPicker=i.add(new Pg(e.fragment,s,n.getOption(162),this._themeService,`hover`));let c=!1,l=new S(a.range.startLineNumber,a.range.startColumn,a.range.endLineNumber,a.range.endColumn);i.add(s.onColorFlushed(async e=>{await Rg(o,s,e,l,a),c=!0,l=Lg(n,l,s)})),i.add(s.onDidChangeColor(e=>{Rg(o,s,e,l,a)})),i.add(n.onDidChangeModelContent(t=>{c?c=!1:(e.hide(),n.focus())}));let u={hoverPart:Vg.fromBaseColor(this,a),hoverElement:this._colorPicker.domNode,dispose(){i.dispose()}};return new eh([u])}handleResize(){this._colorPicker?.layout()}handleContentsChanged(){this._colorPicker?.layout()}handleHide(){this._colorPicker?.dispose(),this._colorPicker=void 0}isColorPickerVisible(){return!!this._colorPicker}};Hg=zg([Bg(1,rn)],Hg);function Ug(e,t){return!!e[t]}var Wg=class{constructor(e,t){this.target=e.target,this.isLeftClick=e.event.leftButton,this.isMiddleClick=e.event.middleButton,this.isRightClick=e.event.rightButton,this.hasTriggerModifier=Ug(e.event,t.triggerModifier),this.hasSideBySideModifier=Ug(e.event,t.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=e.event.detail<=1}},Gg=class{constructor(e,t){this.keyCodeIsTriggerKey=e.keyCode===t.triggerKey,this.keyCodeIsSideBySideKey=e.keyCode===t.triggerSideBySideKey,this.hasTriggerModifier=Ug(e,t.triggerModifier)}},Kg=class{constructor(e,t,n,r){this.triggerKey=e,this.triggerModifier=t,this.triggerSideBySideKey=n,this.triggerSideBySideModifier=r}equals(e){return this.triggerKey===e.triggerKey&&this.triggerModifier===e.triggerModifier&&this.triggerSideBySideKey===e.triggerSideBySideKey&&this.triggerSideBySideModifier===e.triggerSideBySideModifier}};function qg(e){return e===`altKey`?ro?new Kg(57,`metaKey`,6,`altKey`):new Kg(5,`ctrlKey`,6,`altKey`):ro?new Kg(6,`altKey`,57,`metaKey`):new Kg(6,`altKey`,5,`ctrlKey`)}var Jg=class extends b{constructor(e,t){super(),this._onMouseMoveOrRelevantKeyDown=this._register(new E),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new E),this.onExecute=this._onExecute.event,this._onCancel=this._register(new E),this.onCancel=this._onCancel.event,this._editor=e,this._extractLineNumberFromMouseEvent=t?.extractLineNumberFromMouseEvent??(e=>e.target.position?e.target.position.lineNumber:0),this._opts=qg(this._editor.getOption(86)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration(e=>{if(e.hasChanged(86)){let e=qg(this._editor.getOption(86));if(this._opts.equals(e))return;this._opts=e,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}})),this._register(this._editor.onMouseMove(e=>this._onEditorMouseMove(new Wg(e,this._opts)))),this._register(this._editor.onMouseDown(e=>this._onEditorMouseDown(new Wg(e,this._opts)))),this._register(this._editor.onMouseUp(e=>this._onEditorMouseUp(new Wg(e,this._opts)))),this._register(this._editor.onKeyDown(e=>this._onEditorKeyDown(new Gg(e,this._opts)))),this._register(this._editor.onKeyUp(e=>this._onEditorKeyUp(new Gg(e,this._opts)))),this._register(this._editor.onMouseDrag(()=>this._resetHandler())),this._register(this._editor.onDidChangeCursorSelection(e=>this._onDidChangeCursorSelection(e))),this._register(this._editor.onDidChangeModel(e=>this._resetHandler())),this._register(this._editor.onDidChangeModelContent(()=>this._resetHandler())),this._register(this._editor.onDidScrollChange(e=>{(e.scrollTopChanged||e.scrollLeftChanged)&&this._resetHandler()}))}_onDidChangeCursorSelection(e){e.selection&&e.selection.startColumn!==e.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(e){this._lastMouseMoveEvent=e,this._onMouseMoveOrRelevantKeyDown.fire([e,null])}_onEditorMouseDown(e){this._hasTriggerKeyOnMouseDown=e.hasTriggerModifier,this._lineNumberOnMouseDown=this._extractLineNumberFromMouseEvent(e)}_onEditorMouseUp(e){let t=this._extractLineNumberFromMouseEvent(e);this._hasTriggerKeyOnMouseDown&&this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===t&&this._onExecute.fire(e)}_onEditorKeyDown(e){this._lastMouseMoveEvent&&(e.keyCodeIsTriggerKey||e.keyCodeIsSideBySideKey&&e.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,e]):e.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(e){e.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}},Yg=class{constructor(e,t){this.range=e,this.direction=t}},Xg=class e{constructor(e,t,n){this.hint=e,this.anchor=t,this.provider=n,this._isResolved=!1}with(t){let n=new e(this.hint,t.anchor,this.provider);return n._isResolved=this._isResolved,n._currentResolve=this._currentResolve,n}async resolve(e){if(typeof this.provider.resolveInlayHint==`function`){if(this._currentResolve)return await this._currentResolve,e.isCancellationRequested?void 0:this.resolve(e);this._isResolved||(this._currentResolve=this._doResolve(e).finally(()=>this._currentResolve=void 0)),await this._currentResolve}}async _doResolve(e){try{let t=await Promise.resolve(this.provider.resolveInlayHint(this.hint,e));this.hint.tooltip=t?.tooltip??this.hint.tooltip,this.hint.label=t?.label??this.hint.label,this.hint.textEdits=t?.textEdits??this.hint.textEdits,this._isResolved=!0}catch(e){Ze(e),this._isResolved=!1}}},Zg=class e{static{this._emptyInlayHintList=Object.freeze({dispose(){},hints:[]})}static async create(t,n,r,i){let a=[],o=t.ordered(n).reverse().map(t=>r.map(async r=>{try{let o=await t.provideInlayHints(n,r,i);(o?.hints.length||t.onDidChangeInlayHints)&&a.push([o??e._emptyInlayHintList,t])}catch(e){Ze(e)}}));if(await Promise.all(o.flat()),i.isCancellationRequested||n.isDisposed())throw new Ns;return new e(r,a,n)}constructor(t,n,r){this._disposables=new P,this.ranges=t,this.provider=new Set;let i=[];for(let[t,a]of n){this._disposables.add(t),this.provider.add(a);for(let n of t.hints){let t=r.validatePosition(n.position),o=`before`,s=e._getRangeAtPosition(r,t),c;s.getStartPosition().isBefore(t)?(c=S.fromPositions(s.getStartPosition(),t),o=`after`):(c=S.fromPositions(t,s.getEndPosition()),o=`before`),i.push(new Xg(n,new Yg(c,o),a))}}this.items=i.sort((e,t)=>x.compare(e.hint.position,t.hint.position))}dispose(){this._disposables.dispose()}static _getRangeAtPosition(e,t){let n=t.lineNumber,r=e.getWordAtPosition(t);if(r)return new S(n,r.startColumn,n,r.endColumn);e.tokenization.tokenizeIfCheap(n);let i=e.tokenization.getLineTokens(n),a=t.column-1,o=i.findTokenIndexAtOffset(a),s=i.getStartOffset(o),c=i.getEndOffset(o);return c-s===1&&(s===a&&o>1?(s=i.getStartOffset(o-1),c=i.getEndOffset(o-1)):c===a&&o<i.getCount()-1&&(s=i.getStartOffset(o+1),c=i.getEndOffset(o+1))),new S(n,s+1,n,c+1)}};function Qg(e){return $n.from({scheme:hc.command,path:e.id,query:e.arguments&&encodeURIComponent(JSON.stringify(e.arguments))}).toString()}var $g=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},e_=function(e,t){return function(n,r){t(n,r,e)}},t_=class extends Qc{constructor(e,t,n,r,i,a,o,s,c,l,u,d,f){super(e,{...r.getRawOptions(),overflowWidgetsDomNode:r.getOverflowWidgetsDomNode()},n,i,a,o,s,c,l,u,d,f),this._parentEditor=r,this._overwriteOptions=t,super.updateOptions(this._overwriteOptions),this._register(r.onDidChangeConfiguration(e=>this._onParentConfigurationChanged(e)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(e){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(e){Xo(this._overwriteOptions,e,!0),super.updateOptions(this._overwriteOptions)}};t_=$g([e_(4,k),e_(5,mt),e_(6,Mr),e_(7,w),e_(8,rn),e_(9,nt),e_(10,Zt),e_(11,Ar),e_(12,W)],t_);function n_(e){let t=e.get(mt).getFocusedCodeEditor();return t instanceof t_?t.getParentEditor():t}var r_=new z(new bo(0,122,204)),i_={showArrow:!0,showFrame:!0,className:``,frameColor:r_,arrowColor:r_,keepEditorSelection:!1},a_=`vs.editor.contrib.zoneWidget`,o_=class{constructor(e,t,n,r,i,a,o,s){this.id=``,this.domNode=e,this.afterLineNumber=t,this.afterColumn=n,this.heightInLines=r,this.showInHiddenAreas=o,this.ordinal=s,this._onDomNodeTop=i,this._onComputedHeight=a}onDomNodeTop(e){this._onDomNodeTop(e)}onComputedHeight(e){this._onComputedHeight(e)}},s_=class{constructor(e,t){this._id=e,this._domNode=t}getId(){return this._id}getDomNode(){return this._domNode}getPosition(){return null}},c_=class e{static{this._IdGenerator=new ee(`.arrow-decoration-`)}constructor(t){this._editor=t,this._ruleName=e._IdGenerator.nextId(),this._color=null,this._height=-1,this._decorations=this._editor.createDecorationsCollection()}dispose(){this.hide(),Di(this._ruleName)}set color(e){this._color!==e&&(this._color=e,this._updateStyle())}set height(e){this._height!==e&&(this._height=e,this._updateStyle())}_updateStyle(){Di(this._ruleName),vt(`.monaco-editor ${this._ruleName}`,`border-style: solid; border-color: transparent; border-bottom-color: ${this._color}; border-width: ${this._height}px; bottom: -${this._height}px !important; margin-left: -${this._height}px; `)}show(e){e.column===1&&(e={lineNumber:e.lineNumber,column:2}),this._decorations.set([{range:S.fromPositions(e),options:{description:`zone-widget-arrow`,className:this._ruleName,stickiness:1}}])}hide(){this._decorations.clear()}},l_=class{constructor(e,t={}){this._arrow=null,this._overlayWidget=null,this._resizeSash=null,this._isSashResizeHeight=!1,this._viewZone=null,this._disposables=new P,this.container=null,this._isShowing=!1,this.editor=e,this._positionMarkerId=this.editor.createDecorationsCollection(),this.options=ls(t),Xo(this.options,i_,!1),this.domNode=document.createElement(`div`),this.options.isAccessible||(this.domNode.setAttribute(`aria-hidden`,`true`),this.domNode.setAttribute(`role`,`presentation`)),this._disposables.add(this.editor.onDidLayoutChange(e=>{let t=this._getWidth(e);this.domNode.style.width=t+`px`,this.domNode.style.left=this._getLeft(e)+`px`,this._onWidth(t)}))}dispose(){this._overlayWidget&&=(this.editor.removeOverlayWidget(this._overlayWidget),null),this._viewZone&&this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id),this._viewZone=null}),this._positionMarkerId.clear(),this._disposables.dispose()}create(){this.domNode.classList.add(`zone-widget`),this.options.className&&this.domNode.classList.add(this.options.className),this.container=document.createElement(`div`),this.container.classList.add(`zone-widget-container`),this.domNode.appendChild(this.container),this.options.showArrow&&(this._arrow=new c_(this.editor),this._disposables.add(this._arrow)),this._fillContainer(this.container),this._initSash(),this._applyStyles()}style(e){e.frameColor&&(this.options.frameColor=e.frameColor),e.arrowColor&&(this.options.arrowColor=e.arrowColor),this._applyStyles()}_applyStyles(){if(this.container&&this.options.frameColor){let e=this.options.frameColor.toString();this.container.style.borderTopColor=e,this.container.style.borderBottomColor=e}if(this._arrow&&this.options.arrowColor){let e=this.options.arrowColor.toString();this._arrow.color=e}}_getWidth(e){return e.width-e.minimap.minimapWidth-e.verticalScrollbarWidth}_getLeft(e){return e.minimap.minimapWidth>0&&e.minimap.minimapLeft===0?e.minimap.minimapWidth:0}_onViewZoneTop(e){this.domNode.style.top=e+`px`}_onViewZoneHeight(e){if(this.domNode.style.height=`${e}px`,this.container){let t=e-this._decoratingElementsHeight();this.container.style.height=`${t}px`;let n=this.editor.getLayoutInfo();this._doLayout(t,this._getWidth(n))}this._resizeSash?.layout()}get position(){let e=this._positionMarkerId.getRange(0);if(e)return e.getStartPosition()}show(e,t){let n=S.isIRange(e)?S.lift(e):S.fromPositions(e);this._isShowing=!0,this._showImpl(n,t),this._isShowing=!1,this._positionMarkerId.set([{range:n,options:R.EMPTY}])}hide(){this._viewZone&&=(this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id)}),null),this._overlayWidget&&=(this.editor.removeOverlayWidget(this._overlayWidget),null),this._arrow?.hide(),this._positionMarkerId.clear(),this._isSashResizeHeight=!1}_decoratingElementsHeight(){let e=this.editor.getOption(75),t=0;if(this.options.showArrow){let n=Math.round(e/3);t+=2*n}if(this.options.showFrame){let n=this.options.frameWidth??Math.round(e/9);t+=2*n}return t}_getMaximumHeightInLines(){return Math.max(12,this.editor.getLayoutInfo().height/this.editor.getOption(75)*.8)}_showImpl(e,t){let n=e.getStartPosition(),r=this.editor.getLayoutInfo(),i=this._getWidth(r);this.domNode.style.width=`${i}px`,this.domNode.style.left=this._getLeft(r)+`px`;let a=document.createElement(`div`);a.style.overflow=`hidden`;let o=this.editor.getOption(75),s=this._getMaximumHeightInLines();s!==void 0&&(t=Math.min(t,s));let c=0,l=0;if(this._arrow&&this.options.showArrow&&(c=Math.round(o/3),this._arrow.height=c,this._arrow.show(n)),this.options.showFrame&&(l=Math.round(o/9)),this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id),this._overlayWidget&&=(this.editor.removeOverlayWidget(this._overlayWidget),null),this.domNode.style.top=`-1000px`,this._viewZone=new o_(a,n.lineNumber,n.column,t,e=>this._onViewZoneTop(e),e=>this._onViewZoneHeight(e),this.options.showInHiddenAreas,this.options.ordinal),this._viewZone.id=e.addZone(this._viewZone),this._overlayWidget=new s_(a_+this._viewZone.id,this.domNode),this.editor.addOverlayWidget(this._overlayWidget)}),this._updateSashEnablement(),this.container&&this.options.showFrame){let e=this.options.frameWidth?this.options.frameWidth:l;this.container.style.borderTopWidth=e+`px`,this.container.style.borderBottomWidth=e+`px`}let u=t*o-this._decoratingElementsHeight();this.container&&(this.container.style.top=c+`px`,this.container.style.height=u+`px`,this.container.style.overflow=`hidden`),this._doLayout(u,i),this.options.keepEditorSelection||this.editor.setSelection(e);let d=this.editor.getModel();if(d){let t=d.validateRange(new S(e.startLineNumber,1,e.endLineNumber+1,1));this.revealRange(t,t.startLineNumber===d.getLineCount())}}revealRange(e,t){t?this.editor.revealLineNearTop(e.endLineNumber,0):this.editor.revealRange(e,0)}setCssClass(e,t){this.container&&(t&&this.container.classList.remove(t),this.container.classList.add(e))}_onWidth(e){}_doLayout(e,t){}_relayout(e,t){let n=this._getMaximumHeightInLines(),r=t&&n!==void 0?Math.min(n,e):e;this._viewZone&&this._viewZone.heightInLines!==r&&(this.editor.changeViewZones(e=>{this._viewZone&&(this._viewZone.heightInLines=r,e.layoutZone(this._viewZone.id))}),this._updateSashEnablement())}_initSash(){if(this._resizeSash)return;this._resizeSash=this._disposables.add(new el(this.domNode,this,{orientation:1})),this.options.isResizeable||(this._resizeSash.state=0);let e;this._disposables.add(this._resizeSash.onDidStart(t=>{this._viewZone&&(e={startY:t.startY,heightInLines:this._viewZone.heightInLines,...this._getResizeBounds()})})),this._disposables.add(this._resizeSash.onDidEnd(()=>{e=void 0})),this._disposables.add(this._resizeSash.onDidChange(t=>{if(e){let n=(t.currentY-e.startY)/this.editor.getOption(75),r=n<0?Math.ceil(n):Math.floor(n),i=e.heightInLines+r;i>e.minLines&&i<e.maxLines&&(this._isSashResizeHeight=!0,this._relayout(i))}}))}_updateSashEnablement(){if(this._resizeSash){let{minLines:e,maxLines:t}=this._getResizeBounds();this._resizeSash.state=e===t?0:3}}_getResizeBounds(){return{minLines:5,maxLines:35}}getHorizontalSashLeft(){return 0}getHorizontalSashTop(){return(this.domNode.style.height===null?0:parseInt(this.domNode.style.height))-this._decoratingElementsHeight()/2}getHorizontalSashWidth(){let e=this.editor.getLayoutInfo();return e.width-e.minimap.minimapWidth}},u_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},d_=function(e,t){return function(n,r){t(n,r,e)}};const f_=dl(`IPeekViewService`);wt(f_,class{constructor(){this._widgets=new Map}addExclusiveWidget(e,t){let n=this._widgets.get(e);n&&(n.listener.dispose(),n.widget.dispose()),this._widgets.set(e,{widget:t,listener:t.onDidClose(()=>{let n=this._widgets.get(e);n&&n.widget===t&&(n.listener.dispose(),this._widgets.delete(e))})})}},1);var p_;(function(e){e.inPeekEditor=new T(`inReferenceSearchEditor`,!0,H(1303,`Whether the current code editor is embedded inside peek`)),e.notInPeekEditor=e.inPeekEditor.toNegated()})(p_||={});var m_=class{static{this.ID=`editor.contrib.referenceController`}constructor(e,t){e instanceof t_&&p_.inPeekEditor.bindTo(t)}dispose(){}};m_=u_([d_(1,w)],m_),G(m_.ID,m_,0);var h_={headerBackgroundColor:z.white,primaryHeadingColor:z.fromHex(`#333333`),secondaryHeadingColor:z.fromHex(`#6c6c6cb3`)},g_=class extends l_{constructor(e,t,n){super(e,t),this.instantiationService=n,this._onDidClose=new E,this.onDidClose=this._onDidClose.event,Xo(this.options,h_,!1);let r=f(this.editor);r.openedPeekWidgets.set(r.openedPeekWidgets.get()+1,void 0)}dispose(){if(!this.disposed){this.disposed=!0,super.dispose(),this._onDidClose.fire(this);let e=f(this.editor);e.openedPeekWidgets.set(e.openedPeekWidgets.get()-1,void 0)}}style(e){let t=this.options;e.headerBackgroundColor&&(t.headerBackgroundColor=e.headerBackgroundColor),e.primaryHeadingColor&&(t.primaryHeadingColor=e.primaryHeadingColor),e.secondaryHeadingColor&&(t.secondaryHeadingColor=e.secondaryHeadingColor),super.style(e)}_applyStyles(){super._applyStyles();let e=this.options;this._headElement&&e.headerBackgroundColor&&(this._headElement.style.backgroundColor=e.headerBackgroundColor.toString()),this._primaryHeading&&e.primaryHeadingColor&&(this._primaryHeading.style.color=e.primaryHeadingColor.toString()),this._secondaryHeading&&e.secondaryHeadingColor&&(this._secondaryHeading.style.color=e.secondaryHeadingColor.toString()),this._bodyElement&&e.frameColor&&(this._bodyElement.style.borderColor=e.frameColor.toString())}_fillContainer(e){this.setCssClass(`peekview-widget`),this._headElement=I(`.head`),this._bodyElement=I(`.body`),this._fillHead(this._headElement),this._fillBody(this._bodyElement),e.appendChild(this._headElement),e.appendChild(this._bodyElement)}_fillHead(e,t){this._titleElement=I(`.peekview-title`),this.options.supportOnTitleClick&&(this._titleElement.classList.add(`clickable`),Ma(this._titleElement,`click`,e=>this._onTitleClick(e))),V(this._headElement,this._titleElement),this._fillTitleIcon(this._titleElement),this._primaryHeading=I(`span.filename`),this._secondaryHeading=I(`span.dirname`),this._metaHeading=I(`span.meta`),V(this._titleElement,this._primaryHeading,this._secondaryHeading,this._metaHeading);let n=I(`.peekview-actions`);V(this._headElement,n);let r=this._getActionBarOptions();this._actionbarWidget=new Bs(n,r),this._disposables.add(this._actionbarWidget),t||this._actionbarWidget.push(this._disposables.add(new pe(`peekview.close`,H(1304,`Close`),X.asClassName(J.close),!0,()=>(this.dispose(),Promise.resolve()))),{label:!1,icon:!0})}_fillTitleIcon(e){}_getActionBarOptions(){return{actionViewItemProvider:lr.bind(void 0,this.instantiationService),orientation:0}}_onTitleClick(e){}setTitle(e,t){this._primaryHeading&&this._secondaryHeading&&(this._primaryHeading.innerText=e,this._primaryHeading.setAttribute(`title`,e),t?this._secondaryHeading.innerText=t:Dl(this._secondaryHeading))}setMetaTitle(e){this._metaHeading&&(e?(this._metaHeading.innerText=e,Ws(this._metaHeading)):Wa(this._metaHeading))}_doLayout(e,t){if(!this._isShowing&&e<0){this.dispose();return}let n=Math.ceil(this.editor.getOption(75)*1.2),r=Math.round(e-(n+1));this._doLayoutHead(n,t),this._doLayoutBody(r,t)}_doLayoutHead(e,t){this._headElement&&(this._headElement.style.height=`${e}px`,this._headElement.style.lineHeight=this._headElement.style.height)}_doLayoutBody(e,t){this._bodyElement&&(this._bodyElement.style.height=`${e}px`)}};g_=u_([d_(2,k)],g_);const __=Y(`peekViewTitle.background`,{dark:`#252526`,light:`#F3F3F3`,hcDark:z.black,hcLight:z.white},H(1305,`Background color of the peek view title area.`)),v_=Y(`peekViewTitleLabel.foreground`,{dark:z.white,light:z.black,hcDark:z.white,hcLight:El},H(1306,`Color of the peek view title.`)),y_=Y(`peekViewTitleDescription.foreground`,{dark:`#ccccccb3`,light:`#616161`,hcDark:`#FFFFFF99`,hcLight:`#292929`},H(1307,`Color of the peek view title info.`)),b_=Y(`peekView.border`,{dark:Io,light:Io,hcDark:js,hcLight:js},H(1308,`Color of the peek view borders and arrow.`)),x_=Y(`peekViewResult.background`,{dark:`#252526`,light:`#F3F3F3`,hcDark:z.black,hcLight:z.white},H(1309,`Background color of the peek view result list.`));Y(`peekViewResult.lineForeground`,{dark:`#bbbbbb`,light:`#646465`,hcDark:z.white,hcLight:El},H(1310,`Foreground color for line nodes in the peek view result list.`)),Y(`peekViewResult.fileForeground`,{dark:z.white,light:`#1E1E1E`,hcDark:z.white,hcLight:El},H(1311,`Foreground color for file nodes in the peek view result list.`)),Y(`peekViewResult.selectionBackground`,{dark:`#3399ff33`,light:`#3399ff33`,hcDark:null,hcLight:null},H(1312,`Background color of the selected entry in the peek view result list.`)),Y(`peekViewResult.selectionForeground`,{dark:z.white,light:`#6C6C6C`,hcDark:z.white,hcLight:El},H(1313,`Foreground color of the selected entry in the peek view result list.`));const S_=Y(`peekViewEditor.background`,{dark:`#001F33`,light:`#F2F8FC`,hcDark:z.black,hcLight:z.white},H(1314,`Background color of the peek view editor.`));Y(`peekViewEditorGutter.background`,S_,H(1315,`Background color of the gutter in the peek view editor.`)),Y(`peekViewEditorStickyScroll.background`,S_,H(1316,`Background color of sticky scroll in the peek view editor.`)),Y(`peekViewEditorStickyScrollGutter.background`,S_,H(1317,`Background color of the gutter part of sticky scroll in the peek view editor.`)),Y(`peekViewResult.matchHighlightBackground`,{dark:`#ea5c004d`,light:`#ea5c004d`,hcDark:null,hcLight:null},H(1318,`Match highlight color in the peek view result list.`)),Y(`peekViewEditor.matchHighlightBackground`,{dark:`#ff8f0099`,light:`#f5d802de`,hcDark:null,hcLight:null},H(1319,`Match highlight color in the peek view editor.`)),Y(`peekViewEditor.matchHighlightBorder`,{dark:null,light:null,hcDark:p,hcLight:p},H(1320,`Match highlight border in the peek view editor.`));var C_=class{constructor(e,t,n,r){this.isProviderFirst=e,this.parent=t,this.link=n,this._rangeCallback=r,this.id=Is.nextId()}get uri(){return this.link.uri}get range(){return this._range??this.link.targetSelectionRange??this.link.range}set range(e){this._range=e,this._rangeCallback(this)}get ariaMessage(){let e=this.parent.getPreview(this)?.preview(this.range);return e?H(1080,`{0} in {1} on line {2} at column {3}`,e.value,nu(this.uri),this.range.startLineNumber,this.range.startColumn):H(1079,`in {0} on line {1} at column {2}`,nu(this.uri),this.range.startLineNumber,this.range.startColumn)}},w_=class{constructor(e){this._modelReference=e}dispose(){this._modelReference.dispose()}preview(e,t=8){let n=this._modelReference.object.textEditorModel;if(!n)return;let{startLineNumber:r,startColumn:i,endLineNumber:a,endColumn:o}=e,s=n.getWordUntilPosition({lineNumber:r,column:i-t}),c=new S(r,s.startColumn,r,i),l=new S(a,o,a,1073741824),u=n.getValueInRange(c).replace(/^\s+/,``),d=n.getValueInRange(e),f=n.getValueInRange(l).replace(/\s+$/,``);return{value:u+d+f,highlight:{start:u.length,end:u.length+d.length}}}},T_=class{constructor(e,t){this.parent=e,this.uri=t,this.children=[],this._previews=new Fu}dispose(){gt(this._previews.values()),this._previews.clear()}getPreview(e){return this._previews.get(e.uri)}get ariaMessage(){let e=this.children.length;return e===1?H(1081,`1 symbol in {0}, full path {1}`,nu(this.uri),this.uri.fsPath):H(1082,`{0} symbols in {1}, full path {2}`,e,nu(this.uri),this.uri.fsPath)}async resolve(e){if(this._previews.size!==0)return this;for(let t of this.children){if(this._previews.has(t.uri))continue;try{let n=await e.createModelReference(t.uri);this._previews.set(t.uri,new w_(n))}catch(e){rr(e)}}return this}},E_=class e{constructor(t,n){this.groups=[],this.references=[],this._onDidChangeReferenceRange=new E,this.onDidChangeReferenceRange=this._onDidChangeReferenceRange.event,this._links=t,this._title=n;let[r]=t;t.sort(e._compareReferences);let i;for(let n of t)if((!i||!$c.isEqual(i.uri,n.uri,!0))&&(i=new T_(this,n.uri),this.groups.push(i)),i.children.length===0||e._compareReferences(n,i.children[i.children.length-1])!==0){let e=new C_(r===n,i,n,e=>this._onDidChangeReferenceRange.fire(e));this.references.push(e),i.children.push(e)}}dispose(){gt(this.groups),this._onDidChangeReferenceRange.dispose(),this.groups.length=0}clone(){return new e(this._links,this._title)}get title(){return this._title}get isEmpty(){return this.groups.length===0}get ariaMessage(){return this.isEmpty?H(1083,`No results found`):this.references.length===1?H(1084,`Found 1 symbol in {0}`,this.references[0].uri.fsPath):this.groups.length===1?H(1085,`Found {0} symbols in {1}`,this.references.length,this.groups[0].uri.fsPath):H(1086,`Found {0} symbols in {1} files`,this.references.length,this.groups.length)}nextOrPreviousReference(e,t){let{parent:n}=e,r=n.children.indexOf(e),i=n.children.length,a=n.parent.groups.length;return a===1||t&&r+1<i||!t&&r>0?(r=t?(r+1)%i:(r+i-1)%i,n.children[r]):(r=n.parent.groups.indexOf(n),t?(r=(r+1)%a,n.parent.groups[r].children[0]):(r=(r+a-1)%a,n.parent.groups[r].children[n.parent.groups[r].children.length-1]))}nearestReference(e,t){let n=this.references.map((n,r)=>({idx:r,prefixLen:$e(n.uri.toString(),e.toString()),offsetDist:Math.abs(n.range.startLineNumber-t.lineNumber)*100+Math.abs(n.range.startColumn-t.column)})).sort((e,t)=>e.prefixLen>t.prefixLen?-1:e.prefixLen<t.prefixLen?1:e.offsetDist<t.offsetDist?-1:e.offsetDist>t.offsetDist?1:0)[0];if(n)return this.references[n.idx]}referenceAt(e,t){for(let n of this.references)if(n.uri.toString()===e.toString()&&S.containsPosition(n.range,t))return n}firstReference(){for(let e of this.references)if(e.isProviderFirst)return e;return this.references[0]}static _compareReferences(e,t){return $c.compare(e.uri,t.uri)||S.compareRangesUsingStarts(e.range,t.range)}},D_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},O_=function(e,t){return function(n,r){t(n,r,e)}},k_,A_=class{constructor(e){this._resolverService=e}hasChildren(e){return e instanceof E_||e instanceof T_}getChildren(e){if(e instanceof E_)return e.groups;if(e instanceof T_)return e.resolve(this._resolverService).then(e=>e.children);throw Error(`bad tree`)}};A_=D_([O_(0,fi)],A_);var j_=class{getHeight(){return 23}getTemplateId(e){return e instanceof T_?F_.id:L_.id}},M_=class{constructor(e){this._keybindingService=e}getKeyboardNavigationLabel(e){if(e instanceof C_){let t=e.parent.getPreview(e)?.preview(e.range);if(t)return t.value}return nu(e.uri)}};M_=D_([O_(0,zn)],M_);var N_=class{getId(e){return e instanceof C_?e.id:e.uri}},P_=class extends b{constructor(e,t){super(),this._labelService=t;let n=document.createElement(`div`);n.classList.add(`reference-file`),this.file=this._register(new ns(n,{supportHighlights:!0})),this.badge=this._register(new Te(V(n,I(`.count`)),{},_n)),e.appendChild(n)}set(e,t){let n=Wo(e.uri);this.file.setLabel(this._labelService.getUriBasenameLabel(e.uri),this._labelService.getUriLabel(n,{relative:!0}),{title:this._labelService.getUriLabel(e.uri),matches:t});let r=e.children.length;this.badge.setCount(r),r>1?this.badge.setTitleFormat(H(1073,`{0} references`,r)):this.badge.setTitleFormat(H(1074,`{0} reference`,r))}};P_=D_([O_(1,Xc)],P_);var F_=class{static{k_=this}static{this.id=`FileReferencesRenderer`}constructor(e){this._instantiationService=e,this.templateId=k_.id}renderTemplate(e){return this._instantiationService.createInstance(P_,e)}renderElement(e,t,n){n.set(e.element,td(e.filterData))}disposeTemplate(e){e.dispose()}};F_=k_=D_([O_(0,k)],F_);var I_=class extends b{constructor(e){super(),this.label=this._register(new Oa(e))}set(e,t){let n=e.parent.getPreview(e)?.preview(e.range);if(!n||!n.value)this.label.set(`${nu(e.uri)}:${e.range.startLineNumber+1}:${e.range.startColumn+1}`);else{let{value:e,highlight:r}=n;t&&!Ft.isDefault(t)?(this.label.element.classList.toggle(`referenceMatch`,!1),this.label.set(e,td(t))):(this.label.element.classList.toggle(`referenceMatch`,!0),this.label.set(e,[r]))}}},L_=class e{constructor(){this.templateId=e.id}static{this.id=`OneReferenceRenderer`}renderTemplate(e){return new I_(e)}renderElement(e,t,n){n.set(e.element,e.filterData)}disposeTemplate(e){e.dispose()}},R_=class{getWidgetAriaLabel(){return H(1075,`References`)}getAriaLabel(e){return e.ariaMessage}},z_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},B_=function(e,t){return function(n,r){t(n,r,e)}},V_=class e{static{this.DecorationOptions=R.register({description:`reference-decoration`,stickiness:1,className:`reference-decoration`})}constructor(e,t){this._editor=e,this._model=t,this._decorations=new Map,this._decorationIgnoreSet=new Set,this._callOnDispose=new P,this._callOnModelChange=new P,this._callOnDispose.add(this._editor.onDidChangeModel(()=>this._onModelChanged())),this._onModelChanged()}dispose(){this._callOnModelChange.dispose(),this._callOnDispose.dispose(),this.removeDecorations()}_onModelChanged(){this._callOnModelChange.clear();let e=this._editor.getModel();if(e){for(let t of this._model.references)if(t.uri.toString()===e.uri.toString()){this._addDecorations(t.parent);return}}}_addDecorations(t){if(!this._editor.hasModel())return;this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(()=>this._onDecorationChanged()));let n=[],r=[];for(let i=0,a=t.children.length;i<a;i++){let a=t.children[i];this._decorationIgnoreSet.has(a.id)||a.uri.toString()===this._editor.getModel().uri.toString()&&(n.push({range:a.range,options:e.DecorationOptions}),r.push(i))}this._editor.changeDecorations(e=>{let i=e.deltaDecorations([],n);for(let e=0;e<i.length;e++)this._decorations.set(i[e],t.children[r[e]])})}_onDecorationChanged(){let e=[],t=this._editor.getModel();if(t){for(let[n,r]of this._decorations){let i=t.getDecorationRange(n);if(!i)continue;let a=!1;if(S.equalsRange(i,r.range))continue;if(S.spansMultipleLines(i))a=!0;else{let e=r.range.endColumn-r.range.startColumn,t=i.endColumn-i.startColumn;e!==t&&(a=!0)}a?(this._decorationIgnoreSet.add(r.id),e.push(n)):r.range=i}for(let t=0,n=e.length;t<n;t++)this._decorations.delete(e[t]);this._editor.removeDecorations(e)}}removeDecorations(){this._editor.removeDecorations([...this._decorations.keys()]),this._decorations.clear()}},H_=class{constructor(){this.ratio=.7,this.heightInLines=18}static fromJSON(e){let t,n;try{let r=JSON.parse(e);t=r.ratio,n=r.heightInLines}catch{}return{ratio:t||.7,heightInLines:n||18}}},U_=class extends Cl{},W_=class{constructor(e){this.labelService=e,this.disposables=new P}getDragURI(e){return e instanceof T_?e.uri.toString():e instanceof C_?Gt(e.uri,e.range).toString():null}getDragLabel(e){if(e.length!==0)return e.map(e=>this.labelService.getUriBasenameLabel(e.uri)).join(`, `)}onDragStart(e,t){if(!t.dataTransfer)return;let n=e.elements.map(e=>this.getDragURI(e)).filter(Boolean);n.length&&(t.dataTransfer.setData(aa.RESOURCES,JSON.stringify(n)),t.dataTransfer.setData(aa.TEXT,n.join(`
`)))}onDragOver(){return!1}drop(){}dispose(){this.disposables.dispose()}};W_=z_([B_(0,Xc)],W_);var G_=class extends g_{constructor(e,t,n,r,i,a,o,s,c){super(e,{showFrame:!1,showArrow:!0,isResizeable:!0,isAccessible:!0,supportOnTitleClick:!0},a),this._defaultTreeKeyboardSupport=t,this.layoutData=n,this._textModelResolverService=i,this._instantiationService=a,this._peekViewService=o,this._uriLabel=s,this._keybindingService=c,this._disposeOnNewModel=new P,this._callOnDispose=new P,this._onDidSelectReference=new E,this.onDidSelectReference=this._onDidSelectReference.event,this._dim=new br(0,0),this._isClosing=!1,this._applyTheme(r.getColorTheme()),this._callOnDispose.add(r.onDidColorThemeChange(this._applyTheme.bind(this))),this._peekViewService.addExclusiveWidget(e,this),this.create()}get isClosing(){return this._isClosing}dispose(){this._isClosing=!0,this.setModel(void 0),this._callOnDispose.dispose(),this._disposeOnNewModel.dispose(),gt(this._preview),gt(this._previewNotAvailableMessage),gt(this._tree),gt(this._previewModelReference),this._splitView.dispose(),super.dispose()}_applyTheme(e){let t=e.getColor(b_)||z.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(__)||z.transparent,primaryHeadingColor:e.getColor(v_),secondaryHeadingColor:e.getColor(y_)})}show(e){super.show(e,this.layoutData.heightInLines||18)}focusOnReferenceTree(){this._tree.domFocus()}focusOnPreviewEditor(){this._preview.focus()}isPreviewEditorFocused(){return this._preview.hasTextFocus()}_onTitleClick(e){this._preview&&this._preview.getModel()&&this._onDidSelectReference.fire({element:this._getFocusedReference(),kind:e.ctrlKey||e.metaKey||e.altKey?`side`:`open`,source:`title`})}_fillBody(e){this.setCssClass(`reference-zone-widget`),this._messageContainer=V(e,I(`div.messages`)),Wa(this._messageContainer),this._splitView=new Co(e,{orientation:1}),this._previewContainer=V(e,I(`div.preview.inline`)),this._preview=this._instantiationService.createInstance(t_,this._previewContainer,{scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:`auto`,useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!0},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}},{},this.editor),Wa(this._previewContainer),this._previewNotAvailableMessage=this._instantiationService.createInstance(Ea,H(1076,`no preview available`),nd,Ea.DEFAULT_CREATION_OPTIONS,null),this._treeContainer=V(e,I(`div.ref-tree.inline`));let t={keyboardSupport:this._defaultTreeKeyboardSupport,accessibilityProvider:new R_,keyboardNavigationLabelProvider:this._instantiationService.createInstance(M_),identityProvider:new N_,openOnSingleClick:!0,selectionNavigation:!0,overrideStyles:{listBackground:x_},dnd:this._instantiationService.createInstance(W_)};this._defaultTreeKeyboardSupport&&this._callOnDispose.add(Ma(this._treeContainer,`keydown`,e=>{e.equals(9)&&(this._keybindingService.dispatchEvent(e,e.target),e.stopPropagation())},!0)),this._tree=this._instantiationService.createInstance(U_,`ReferencesWidget`,this._treeContainer,new j_,[this._instantiationService.createInstance(F_),this._instantiationService.createInstance(L_)],this._instantiationService.createInstance(A_),t),this._splitView.addView({onDidChange:vn.None,element:this._previewContainer,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:e=>{this._preview.layout({height:this._dim.height,width:e})}},ru.Distribute),this._splitView.addView({onDidChange:vn.None,element:this._treeContainer,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:e=>{this._treeContainer.style.height=`${this._dim.height}px`,this._treeContainer.style.width=`${e}px`,this._tree.layout(this._dim.height,e)}},ru.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this.layoutData.ratio=this._splitView.getViewSize(0)/this._dim.width)},void 0));let n=(e,t)=>{e instanceof C_&&(t===`show`&&this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:t,source:`tree`}))};this._disposables.add(this._tree.onDidOpen(e=>{e.sideBySide?n(e.element,`side`):e.editorOptions.pinned?n(e.element,`goto`):n(e.element,`show`)})),Wa(this._treeContainer)}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._dim=new br(t,e),this.layoutData.heightInLines=this._viewZone?this._viewZone.heightInLines:this.layoutData.heightInLines,this._splitView.layout(t),this._splitView.resizeView(0,t*this.layoutData.ratio)}setSelection(e){return this._revealReference(e,!0).then(()=>{this._model&&(this._tree.setSelection([e]),this._tree.setFocus([e]))})}setModel(e){return this._disposeOnNewModel.clear(),this._model=e,this._model?this._onNewModel():Promise.resolve()}_onNewModel(){return this._model?this._model.isEmpty?(this.setTitle(``),this._messageContainer.innerText=H(1077,`No results`),Ws(this._messageContainer),Promise.resolve(void 0)):(Wa(this._messageContainer),this._decorationsManager=new V_(this._preview,this._model),this._disposeOnNewModel.add(this._decorationsManager),this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(e=>this._tree.rerender(e))),this._disposeOnNewModel.add(this._preview.onMouseDown(e=>{let{event:t,target:n}=e;if(t.detail!==2)return;let r=this._getFocusedReference();r&&this._onDidSelectReference.fire({element:{uri:r.uri,range:n.range},kind:t.ctrlKey||t.metaKey||t.altKey?`side`:`open`,source:`editor`})})),this.container.classList.add(`results-loaded`),Ws(this._treeContainer),Ws(this._previewContainer),this._splitView.layout(this._dim.width),this.focusOnReferenceTree(),this._tree.setInput(this._model.groups.length===1?this._model.groups[0]:this._model)):Promise.resolve(void 0)}_getFocusedReference(){let[e]=this._tree.getFocus();if(e instanceof C_)return e;if(e instanceof T_&&e.children.length>0)return e.children[0]}async revealReference(e){await this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:`goto`,source:`tree`})}async _revealReference(e,t){if(this._revealedReference===e)return;this._revealedReference=e,e.uri.scheme===hc.inMemory?this.setTitle(H(1078,`References`)):this.setTitle(So(e.uri),this._uriLabel.getUriLabel(Wo(e.uri)));let n=this._textModelResolverService.createModelReference(e.uri);this._tree.getInput()===e.parent?this._tree.reveal(e):(t&&this._tree.reveal(e.parent),await this._tree.expand(e.parent),this._tree.reveal(e));let r=await n;if(!this._model){r.dispose();return}gt(this._previewModelReference);let i=r.object;if(i){let t=this._preview.getModel()===i.textEditorModel?0:1,n=S.lift(e.range).collapseToStart();this._previewModelReference=r,this._preview.setModel(i.textEditorModel),this._preview.setSelection(n),this._preview.revealRangeInCenter(n,t)}else this._preview.setModel(this._previewNotAvailableMessage),r.dispose()}};G_=z_([B_(3,rn),B_(4,fi),B_(5,k),B_(6,f_),B_(7,Xc),B_(8,zn)],G_);var K_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},q_=function(e,t){return function(n,r){t(n,r,e)}},J_;const Y_=new T(`referenceSearchVisible`,!1,H(1070,`Whether reference peek is visible, like 'Peek References' or 'Peek Definition'`));var X_=class{static{J_=this}static{this.ID=`editor.contrib.referencesController`}static get(e){return e.getContribution(J_.ID)}constructor(e,t,n,r,i,a,o,s){this._defaultTreeKeyboardSupport=e,this._editor=t,this._editorService=r,this._notificationService=i,this._instantiationService=a,this._storageService=o,this._configurationService=s,this._disposables=new P,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=Y_.bindTo(n)}dispose(){this._referenceSearchVisible.reset(),this._disposables.dispose(),this._widget?.dispose(),this._model?.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(e,t,n){let r;if(this._widget&&(r=this._widget.position),this.closeWidget(),r&&e.containsPosition(r))return;this._peekMode=n,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>{this.closeWidget()})),this._disposables.add(this._editor.onDidChangeModel(()=>{this._ignoreModelChangeEvent||this.closeWidget()}));let i=`peekViewLayout`,a=H_.fromJSON(this._storageService.get(i,0,`{}`));this._widget=this._instantiationService.createInstance(G_,this._editor,this._defaultTreeKeyboardSupport,a),this._widget.setTitle(H(1071,`Loading...`)),this._widget.show(e),this._disposables.add(this._widget.onDidClose(()=>{t.cancel(),this._widget?(this._storageService.store(i,JSON.stringify(this._widget.layoutData),0,1),this._widget.isClosing||this.closeWidget(),this._widget=void 0):this.closeWidget()})),this._disposables.add(this._widget.onDidSelectReference(e=>{let{element:t,kind:r}=e;if(t)switch(r){case`open`:(e.source!==`editor`||!this._configurationService.getValue(`editor.stablePeek`))&&this.openReference(t,!1,!1);break;case`side`:this.openReference(t,!0,!1);break;case`goto`:n?this._gotoReference(t,!0):this.openReference(t,!1,!0);break}}));let o=++this._requestIdPool;t.then(t=>{if(o!==this._requestIdPool||!this._widget){t.dispose();return}return this._model?.dispose(),this._model=t,this._widget.setModel(this._model).then(()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(``):this._widget.setMetaTitle(H(1072,`{0} ({1})`,this._model.title,this._model.references.length));let t=this._editor.getModel().uri,n=new x(e.startLineNumber,e.startColumn),r=this._model.nearestReference(t,n);if(r)return this._widget.setSelection(r).then(()=>{this._widget&&this._editor.getOption(98)===`editor`&&this._widget.focusOnPreviewEditor()})}})},e=>{this._notificationService.error(e)})}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}async goToNextOrPreviousReference(e){if(!this._editor.hasModel()||!this._model||!this._widget)return;let t=this._widget.position;if(!t)return;let n=this._model.nearestReference(this._editor.getModel().uri,t);if(!n)return;let r=this._model.nextOrPreviousReference(n,e),i=this._editor.hasTextFocus(),a=this._widget.isPreviewEditorFocused();await this._widget.setSelection(r),await this._gotoReference(r,!1),i?this._editor.focus():this._widget&&a&&this._widget.focusOnPreviewEditor()}async revealReference(e){!this._editor.hasModel()||!this._model||!this._widget||await this._widget.revealReference(e)}closeWidget(e=!0){this._widget?.dispose(),this._model?.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,e&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(e,t){this._widget?.hide(),this._ignoreModelChangeEvent=!0;let n=S.lift(e.range).collapseToStart();return this._editorService.openCodeEditor({resource:e.uri,options:{selection:n,selectionSource:`code.jump`,pinned:t}},this._editor).then(e=>{if(this._ignoreModelChangeEvent=!1,!e||!this._widget){this.closeWidget();return}if(this._editor===e)this._widget.show(n),this._widget.focusOnReferenceTree();else{let t=J_.get(e),r=this._model.clone();this.closeWidget(),e.focus(),t?.toggleWidget(n,bu(e=>Promise.resolve(r)),this._peekMode??!1)}},e=>{this._ignoreModelChangeEvent=!1,rr(e)})}openReference(e,t,n){t||this.closeWidget();let{uri:r,range:i}=e;this._editorService.openCodeEditor({resource:r,options:{selection:i,selectionSource:`code.jump`,pinned:n}},this._editor,t)}};X_=J_=K_([q_(2,w),q_(3,mt),q_(4,nt),q_(5,k),q_(6,Mu),q_(7,Ni)],X_);function Z_(e,t){let n=n_(e);if(!n)return;let r=X_.get(n);r&&t(r)}zs.registerCommandAndKeybindingRule({id:`togglePeekWidgetFocus`,weight:100,primary:An(2089,60),when:j.or(Y_,p_.inPeekEditor),handler(e){Z_(e,e=>{e.changeFocusBetweenPreviewAndReferences()})}}),zs.registerCommandAndKeybindingRule({id:`goToNextReference`,weight:90,primary:62,secondary:[70],when:j.or(Y_,p_.inPeekEditor),handler(e){Z_(e,e=>{e.goToNextOrPreviousReference(!0)})}}),zs.registerCommandAndKeybindingRule({id:`goToPreviousReference`,weight:90,primary:1086,secondary:[1094],when:j.or(Y_,p_.inPeekEditor),handler(e){Z_(e,e=>{e.goToNextOrPreviousReference(!1)})}}),gn.registerCommandAlias(`goToNextReferenceFromEmbeddedEditor`,`goToNextReference`),gn.registerCommandAlias(`goToPreviousReferenceFromEmbeddedEditor`,`goToPreviousReference`),gn.registerCommandAlias(`closeReferenceSearchEditor`,`closeReferenceSearch`),gn.registerCommand(`closeReferenceSearch`,e=>Z_(e,e=>e.closeWidget())),zs.registerKeybindingRule({id:`closeReferenceSearch`,weight:-1,primary:9,secondary:[1033],when:j.and(p_.inPeekEditor,j.not(`config.editor.stablePeek`))}),zs.registerKeybindingRule({id:`closeReferenceSearch`,weight:250,primary:9,secondary:[1033],when:j.and(Y_,j.not(`config.editor.stablePeek`),j.or(F.editorTextFocus,Pl.negate()))}),zs.registerCommandAndKeybindingRule({id:`revealReference`,weight:200,primary:3,mac:{primary:3,secondary:[2066]},when:j.and(Y_,Os,Ba.negate(),Uc.negate()),handler(e){let t=e.get(Mc).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof C_&&Z_(e,e=>e.revealReference(t[0]))}}),zs.registerCommandAndKeybindingRule({id:`openReferenceToSide`,weight:100,primary:2051,mac:{primary:259},when:j.and(Y_,Os,Ba.negate(),Uc.negate()),handler(e){let t=e.get(Mc).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof C_&&Z_(e,e=>e.openReference(t[0],!0,!0))}}),gn.registerCommand(`openReference`,e=>{let t=e.get(Mc).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof C_&&Z_(e,e=>e.openReference(t[0],!1,!0))});var Q_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$_=function(e,t){return function(n,r){t(n,r,e)}};const ev=new T(`hasSymbols`,!1,H(1087,`Whether there are symbol locations that can be navigated via keyboard-only.`)),tv=dl(`ISymbolNavigationService`);var nv=class{constructor(e,t,n,r){this._editorService=t,this._notificationService=n,this._keybindingService=r,this._currentModel=void 0,this._currentIdx=-1,this._ignoreEditorChange=!1,this._ctxHasSymbols=ev.bindTo(e)}reset(){this._ctxHasSymbols.reset(),this._currentState?.dispose(),this._currentMessage?.close(),this._currentModel=void 0,this._currentIdx=-1}put(e){let t=e.parent.parent;if(t.references.length<=1){this.reset();return}this._currentModel=t,this._currentIdx=t.references.indexOf(e),this._ctxHasSymbols.set(!0),this._showMessage();let n=new rv(this._editorService),r=n.onDidChange(e=>{if(this._ignoreEditorChange)return;let n=this._editorService.getActiveCodeEditor();if(!n)return;let r=n.getModel(),i=n.getPosition();if(!r||!i)return;let a=!1,o=!1;for(let e of t.references)if(hs(e.uri,r.uri))a=!0,o||=S.containsPosition(e.range,i);else if(a)break;(!a||!o)&&this.reset()});this._currentState=Li(n,r)}revealNext(e){if(!this._currentModel)return Promise.resolve();this._currentIdx+=1,this._currentIdx%=this._currentModel.references.length;let t=this._currentModel.references[this._currentIdx];return this._showMessage(),this._ignoreEditorChange=!0,this._editorService.openCodeEditor({resource:t.uri,options:{selection:S.collapseToStart(t.range),selectionRevealType:3}},e).finally(()=>{this._ignoreEditorChange=!1})}_showMessage(){this._currentMessage?.close();let e=this._keybindingService.lookupKeybinding(`editor.gotoNextSymbolFromResult`),t=e?H(1088,`Symbol {0} of {1}, {2} for next`,this._currentIdx+1,this._currentModel.references.length,e.getLabel()):H(1089,`Symbol {0} of {1}`,this._currentIdx+1,this._currentModel.references.length);this._currentMessage=this._notificationService.status(t)}};nv=Q_([$_(0,w),$_(1,mt),$_(2,nt),$_(3,zn)],nv),wt(tv,nv,1),L(new class extends Gi{constructor(){super({id:`editor.gotoNextSymbolFromResult`,precondition:ev,kbOpts:{weight:100,primary:70}})}runEditorCommand(e,t){return e.get(tv).revealNext(t)}}),zs.registerCommandAndKeybindingRule({id:`editor.gotoNextSymbolFromResult.cancel`,weight:100,when:ev,primary:9,handler(e){e.get(tv).reset()}});var rv=class{constructor(e){this._listener=new Map,this._disposables=new P,this._onDidChange=new E,this.onDidChange=this._onDidChange.event,this._disposables.add(e.onCodeEditorRemove(this._onDidRemoveEditor,this)),this._disposables.add(e.onCodeEditorAdd(this._onDidAddEditor,this)),e.listCodeEditors().forEach(this._onDidAddEditor,this)}dispose(){this._disposables.dispose(),this._onDidChange.dispose(),gt(this._listener.values())}_onDidAddEditor(e){this._listener.set(e,Li(e.onDidChangeCursorPosition(t=>this._onDidChange.fire({editor:e})),e.onDidChangeModelContent(t=>this._onDidChange.fire({editor:e}))))}_onDidRemoveEditor(e){this._listener.get(e)?.dispose(),this._listener.delete(e)}};rv=Q_([$_(0,mt)],rv);function iv(e,t){return t.uri.scheme===e.uri.scheme?!0:!Qo(t.uri,hc.walkThroughSnippet,hc.vscodeChatCodeBlock,hc.vscodeChatCodeCompareBlock)}async function av(e,t,n,r,i){let a=n.ordered(e,r).map(n=>Promise.resolve(i(n,e,t)).then(void 0,e=>{Ze(e)})),o=await Promise.all(a);return vi(o.flat()).filter(t=>iv(e,t))}function ov(e,t,n,r,i){return av(t,n,e,r,(e,t,n)=>e.provideDefinition(t,n,i))}function sv(e,t,n,r,i){return av(t,n,e,r,(e,t,n)=>e.provideDeclaration(t,n,i))}function cv(e,t,n,r,i){return av(t,n,e,r,(e,t,n)=>e.provideImplementation(t,n,i))}function lv(e,t,n,r,i){return av(t,n,e,r,(e,t,n)=>e.provideTypeDefinition(t,n,i))}function uv(e,t,n,r,i,a){return av(t,n,e,i,async(e,t,n)=>{let i=(await e.provideReferences(t,n,{includeDeclaration:!0},a))?.filter(e=>iv(t,e));if(!r||!i||i.length!==2)return i;let o=(await e.provideReferences(t,n,{includeDeclaration:!1},a))?.filter(e=>iv(t,e));return o&&o.length===1?o:i})}async function dv(e){let t=await e(),n=new E_(t,``),r=n.references.map(e=>e.link);return n.dispose(),r}Sl(`_executeDefinitionProvider`,(e,t,n)=>{let r=e.get(W),i=ov(r.definitionProvider,t,n,!1,A.None);return dv(()=>i)}),Sl(`_executeDefinitionProvider_recursive`,(e,t,n)=>{let r=e.get(W),i=ov(r.definitionProvider,t,n,!0,A.None);return dv(()=>i)}),Sl(`_executeTypeDefinitionProvider`,(e,t,n)=>{let r=e.get(W),i=lv(r.typeDefinitionProvider,t,n,!1,A.None);return dv(()=>i)}),Sl(`_executeTypeDefinitionProvider_recursive`,(e,t,n)=>{let r=e.get(W),i=lv(r.typeDefinitionProvider,t,n,!0,A.None);return dv(()=>i)}),Sl(`_executeDeclarationProvider`,(e,t,n)=>{let r=e.get(W),i=sv(r.declarationProvider,t,n,!1,A.None);return dv(()=>i)}),Sl(`_executeDeclarationProvider_recursive`,(e,t,n)=>{let r=e.get(W),i=sv(r.declarationProvider,t,n,!0,A.None);return dv(()=>i)}),Sl(`_executeReferenceProvider`,(e,t,n)=>{let r=e.get(W),i=uv(r.referenceProvider,t,n,!1,!1,A.None);return dv(()=>i)}),Sl(`_executeReferenceProvider_recursive`,(e,t,n)=>{let r=e.get(W),i=uv(r.referenceProvider,t,n,!1,!0,A.None);return dv(()=>i)}),Sl(`_executeImplementationProvider`,(e,t,n)=>{let r=e.get(W),i=cv(r.implementationProvider,t,n,!1,A.None);return dv(()=>i)}),Sl(`_executeImplementationProvider_recursive`,(e,t,n)=>{let r=e.get(W),i=cv(r.implementationProvider,t,n,!0,A.None);return dv(()=>i)}),Ie.appendMenuItem(M.EditorContext,{submenu:M.EditorContextPeek,title:H(1030,`Peek`),group:`navigation`,order:100});var fv=class e{static is(t){return!t||typeof t!=`object`?!1:!!(t instanceof e||x.isIPosition(t.position)&&t.model)}constructor(e,t){this.model=e,this.position=t}},pv=class e extends na{static{this._allSymbolNavigationCommands=new Map}static{this._activeAlternativeCommands=new Set}static all(){return e._allSymbolNavigationCommands.values()}static _patchConfig(e){let t={...e,f1:!0};if(t.menu)for(let n of gl.wrap(t.menu))(n.id===M.EditorContext||n.id===M.EditorContextPeek)&&(n.when=j.and(e.precondition,n.when));return t}constructor(t,n){super(e._patchConfig(n)),this.configuration=t,e._allSymbolNavigationCommands.set(n.id,this)}runEditorCommand(t,n,r,i){if(!n.hasModel())return Promise.resolve(void 0);let a=t.get(nt),o=t.get(mt),s=t.get($l),c=t.get(tv),l=t.get(W),u=t.get(k),d=n.getModel(),f=n.getPosition(),p=fv.is(r)?r:new fv(d,f),m=new gu(n,5),h=Me(this._getLocationModel(l,p.model,p.position,m.token),m.token).then(async t=>{if(!t||m.token.isCancellationRequested)return;Xi(t.ariaMessage);let a;if(t.referenceAt(d.uri,f)){let t=this._getAlternativeCommand(n);t!==void 0&&!e._activeAlternativeCommands.has(t)&&e._allSymbolNavigationCommands.has(t)&&(a=e._allSymbolNavigationCommands.get(t))}let s=t.references.length;if(s===0){if(!this.configuration.muteMessage){let e=d.getWordAtPosition(f);ff.get(n)?.showMessage(this._getNoResultFoundMessage(e),f)}}else if(s===1&&a)e._activeAlternativeCommands.add(this.desc.id),u.invokeFunction(t=>a.runEditorCommand(t,n,r,i).finally(()=>{e._activeAlternativeCommands.delete(this.desc.id)}));else return this._onResult(o,c,n,t,i)},e=>{a.error(e)}).finally(()=>{m.dispose()});return s.showWhile(h,250),h}async _onResult(e,t,n,r,i){let a=this._getGoToPreference(n);if(!(n instanceof t_)&&(this.configuration.openInPeek||a===`peek`&&r.references.length>1))this._openInPeek(n,r,i);else{let o=r.firstReference(),s=r.references.length>1&&a===`gotoAndPeek`,c=await this._openReference(n,e,o,this.configuration.openToSide,!s);s&&c?this._openInPeek(c,r,i):r.dispose(),a===`goto`&&t.put(o)}}async _openReference(e,t,n,r,i){let a;if(Ee(n)&&(a=n.targetSelectionRange),a||=n.range,!a)return;let o=await t.openCodeEditor({resource:n.uri,options:{selection:S.collapseToStart(a),selectionRevealType:3,selectionSource:`code.jump`}},e,r);if(o){if(i){let e=o.getModel(),t=o.createDecorationsCollection([{range:a,options:{description:`symbol-navigate-action-highlight`,className:`symbolHighlight`}}]);setTimeout(()=>{o.getModel()===e&&t.clear()},350)}return o}}_openInPeek(e,t,n){let r=X_.get(e);r&&e.hasModel()?r.toggleWidget(n??e.getSelection(),bu(e=>Promise.resolve(t)),this.configuration.openInPeek):t.dispose()}},mv=class extends pv{async _getLocationModel(e,t,n,r){return new E_(await ov(e.definitionProvider,t,n,!1,r),H(1031,`Definitions`))}_getNoResultFoundMessage(e){return e&&e.word?H(1032,`No definition found for '{0}'`,e.word):H(1033,`No definition found`)}_getAlternativeCommand(e){return e.getOption(67).alternativeDefinitionCommand}_getGoToPreference(e){return e.getOption(67).multipleDefinitions}};y(class e extends mv{static{this.id=`editor.action.revealDefinition`}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.id,title:{...B(1057,`Go to Definition`),mnemonicTitle:H(1034,`Go to &&Definition`)},precondition:F.hasDefinitionProvider,keybinding:[{when:F.editorTextFocus,primary:70,weight:100},{when:j.and(F.editorTextFocus,uo),primary:2118,weight:100}],menu:[{id:M.EditorContext,group:`navigation`,order:1.1},{id:M.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:2}]}),gn.registerCommandAlias(`editor.action.goToDeclaration`,e.id)}}),y(class e extends mv{static{this.id=`editor.action.revealDefinitionAside`}constructor(){super({openToSide:!0,openInPeek:!1,muteMessage:!1},{id:e.id,title:B(1058,`Open Definition to the Side`),precondition:j.and(F.hasDefinitionProvider,F.isInEmbeddedEditor.toNegated()),keybinding:[{when:F.editorTextFocus,primary:An(2089,70),weight:100},{when:j.and(F.editorTextFocus,uo),primary:An(2089,2118),weight:100}]}),gn.registerCommandAlias(`editor.action.openDeclarationToTheSide`,e.id)}}),y(class e extends mv{static{this.id=`editor.action.peekDefinition`}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.id,title:B(1059,`Peek Definition`),precondition:j.and(F.hasDefinitionProvider,p_.notInPeekEditor,F.isInEmbeddedEditor.toNegated()),keybinding:{when:F.editorTextFocus,primary:582,linux:{primary:3140},weight:100},menu:{id:M.EditorContextPeek,group:`peek`,order:2}}),gn.registerCommandAlias(`editor.action.previewDeclaration`,e.id)}});var hv=class extends pv{async _getLocationModel(e,t,n,r){return new E_(await sv(e.declarationProvider,t,n,!1,r),H(1035,`Declarations`))}_getNoResultFoundMessage(e){return e&&e.word?H(1036,`No declaration found for '{0}'`,e.word):H(1037,`No declaration found`)}_getAlternativeCommand(e){return e.getOption(67).alternativeDeclarationCommand}_getGoToPreference(e){return e.getOption(67).multipleDeclarations}};y(class e extends hv{static{this.id=`editor.action.revealDeclaration`}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.id,title:{...B(1060,`Go to Declaration`),mnemonicTitle:H(1038,`Go to &&Declaration`)},precondition:j.and(F.hasDeclarationProvider,F.isInEmbeddedEditor.toNegated()),menu:[{id:M.EditorContext,group:`navigation`,order:1.3},{id:M.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:3}]})}_getNoResultFoundMessage(e){return e&&e.word?H(1039,`No declaration found for '{0}'`,e.word):H(1040,`No declaration found`)}}),y(class extends hv{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:`editor.action.peekDeclaration`,title:B(1061,`Peek Declaration`),precondition:j.and(F.hasDeclarationProvider,p_.notInPeekEditor,F.isInEmbeddedEditor.toNegated()),menu:{id:M.EditorContextPeek,group:`peek`,order:3}})}});var gv=class extends pv{async _getLocationModel(e,t,n,r){return new E_(await lv(e.typeDefinitionProvider,t,n,!1,r),H(1041,`Type Definitions`))}_getNoResultFoundMessage(e){return e&&e.word?H(1042,`No type definition found for '{0}'`,e.word):H(1043,`No type definition found`)}_getAlternativeCommand(e){return e.getOption(67).alternativeTypeDefinitionCommand}_getGoToPreference(e){return e.getOption(67).multipleTypeDefinitions}};y(class e extends gv{static{this.ID=`editor.action.goToTypeDefinition`}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.ID,title:{...B(1062,`Go to Type Definition`),mnemonicTitle:H(1044,`Go to &&Type Definition`)},precondition:F.hasTypeDefinitionProvider,keybinding:{when:F.editorTextFocus,primary:0,weight:100},menu:[{id:M.EditorContext,group:`navigation`,order:1.4},{id:M.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:3}]})}}),y(class e extends gv{static{this.ID=`editor.action.peekTypeDefinition`}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.ID,title:B(1063,`Peek Type Definition`),precondition:j.and(F.hasTypeDefinitionProvider,p_.notInPeekEditor,F.isInEmbeddedEditor.toNegated()),menu:{id:M.EditorContextPeek,group:`peek`,order:4}})}});var _v=class extends pv{async _getLocationModel(e,t,n,r){return new E_(await cv(e.implementationProvider,t,n,!1,r),H(1045,`Implementations`))}_getNoResultFoundMessage(e){return e&&e.word?H(1046,`No implementation found for '{0}'`,e.word):H(1047,`No implementation found`)}_getAlternativeCommand(e){return e.getOption(67).alternativeImplementationCommand}_getGoToPreference(e){return e.getOption(67).multipleImplementations}};y(class e extends _v{static{this.ID=`editor.action.goToImplementation`}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.ID,title:{...B(1064,`Go to Implementations`),mnemonicTitle:H(1048,`Go to &&Implementations`)},precondition:F.hasImplementationProvider,keybinding:{when:F.editorTextFocus,primary:2118,weight:100},menu:[{id:M.EditorContext,group:`navigation`,order:1.45},{id:M.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:4}]})}}),y(class e extends _v{static{this.ID=`editor.action.peekImplementation`}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.ID,title:B(1065,`Peek Implementations`),precondition:j.and(F.hasImplementationProvider,p_.notInPeekEditor,F.isInEmbeddedEditor.toNegated()),keybinding:{when:F.editorTextFocus,primary:3142,weight:100},menu:{id:M.EditorContextPeek,group:`peek`,order:5}})}});var vv=class extends pv{_getNoResultFoundMessage(e){return e?H(1049,`No references found for '{0}'`,e.word):H(1050,`No references found`)}_getAlternativeCommand(e){return e.getOption(67).alternativeReferenceCommand}_getGoToPreference(e){return e.getOption(67).multipleReferences}};y(class extends vv{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:`editor.action.goToReferences`,title:{...B(1066,`Go to References`),mnemonicTitle:H(1051,`Go to &&References`)},precondition:j.and(F.hasReferenceProvider,p_.notInPeekEditor,F.isInEmbeddedEditor.toNegated()),keybinding:{when:F.editorTextFocus,primary:1094,weight:100},menu:[{id:M.EditorContext,group:`navigation`,order:1.45},{id:M.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:5}]})}async _getLocationModel(e,t,n,r){return new E_(await uv(e.referenceProvider,t,n,!0,!1,r),H(1052,`References`))}}),y(class extends vv{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:`editor.action.referenceSearch.trigger`,title:B(1067,`Peek References`),precondition:j.and(F.hasReferenceProvider,p_.notInPeekEditor,F.isInEmbeddedEditor.toNegated()),menu:{id:M.EditorContextPeek,group:`peek`,order:6}})}async _getLocationModel(e,t,n,r){return new E_(await uv(e.referenceProvider,t,n,!1,!1,r),H(1053,`References`))}});var yv=class extends pv{constructor(e,t,n){super(e,{id:`editor.action.goToLocation`,title:B(1068,`Go to Any Symbol`),precondition:j.and(p_.notInPeekEditor,F.isInEmbeddedEditor.toNegated())}),this._references=t,this._gotoMultipleBehaviour=n}async _getLocationModel(e,t,n,r){return new E_(this._references,H(1054,`Locations`))}_getNoResultFoundMessage(e){return e&&H(1055,`No results for '{0}'`,e.word)||``}_getGoToPreference(e){return this._gotoMultipleBehaviour??e.getOption(67).multipleReferences}_getAlternativeCommand(){}};gn.registerCommand({id:`editor.action.goToLocations`,metadata:{description:`Go to locations from a position in a file`,args:[{name:`uri`,description:`The text document in which to start`,constraint:$n},{name:`position`,description:`The position at which to start`,constraint:x.isIPosition},{name:`locations`,description:`An array of locations.`,constraint:Array},{name:`multiple`,description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"},{name:`noResultsMessage`,description:`Human readable message that shows when locations is empty.`}]},handler:async(e,t,n,r,i,a,o)=>{K($n.isUri(t)),K(x.isIPosition(n)),K(Array.isArray(r)),K(i===void 0||typeof i==`string`),K(o===void 0||typeof o==`boolean`);let s=e.get(mt),c=await s.openCodeEditor({resource:t},s.getFocusedCodeEditor());if(Eu(c))return c.setPosition(n),c.revealPositionInCenterIfOutsideViewport(n,0),c.invokeWithinContext(e=>{let t=new class extends yv{_getNoResultFoundMessage(e){return a||super._getNoResultFoundMessage(e)}}({muteMessage:!a,openInPeek:!!o,openToSide:!1},r,i);e.get(k).invokeFunction(t.run.bind(t),c)})}}),gn.registerCommand({id:`editor.action.peekLocations`,metadata:{description:`Peek locations from a position in a file`,args:[{name:`uri`,description:`The text document in which to start`,constraint:$n},{name:`position`,description:`The position at which to start`,constraint:x.isIPosition},{name:`locations`,description:`An array of locations.`,constraint:Array},{name:`multiple`,description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"}]},handler:async(e,t,n,r,i)=>{e.get(Mr).executeCommand(`editor.action.goToLocations`,t,n,r,i,void 0,!0)}}),gn.registerCommand({id:`editor.action.findReferences`,handler:(e,t,n)=>{K($n.isUri(t)),K(x.isIPosition(n));let r=e.get(W),i=e.get(mt);return i.openCodeEditor({resource:t},i.getFocusedCodeEditor()).then(e=>{if(!Eu(e)||!e.hasModel())return;let t=X_.get(e);if(!t)return;let i=bu(t=>uv(r.referenceProvider,e.getModel(),x.lift(n),!1,!1,t).then(e=>new E_(e,H(1056,`References`)))),a=new S(n.lineNumber,n.column,n.lineNumber,n.column);return Promise.resolve(t.toggleWidget(a,i,!1))})}}),gn.registerCommandAlias(`editor.action.showReferences`,`editor.action.peekLocations`);async function bv(e,t,n,r){let i=e.get(fi),a=e.get(Mo),o=e.get(Mr),s=e.get(k),c=e.get(nt);if(await r.item.resolve(A.None),!r.part.location)return;let l=r.part.location,u=[],d=new Set(Ie.getMenuItems(M.EditorContext).map(e=>Zs(e)?e.command.id:Jc()));for(let e of pv.all())d.has(e.desc.id)&&u.push(new pe(e.desc.id,qe.label(e.desc,{renderShortTitle:!0}),void 0,!0,async()=>{let n=await i.createModelReference(l.uri);try{let i=new fv(n.object.textEditorModel,S.getStartPosition(l.range)),a=r.item.anchor.range;await s.invokeFunction(e.runEditorCommand.bind(e),t,i,a)}finally{n.dispose()}}));if(r.part.command){let{command:e}=r.part;u.push(new wi),u.push(new pe(e.id,e.title,void 0,!0,async()=>{try{await o.executeCommand(e.id,...e.arguments??[])}catch(e){c.notify({severity:Lt.Error,source:r.item.provider.displayName,message:e})}}))}let f=t.getOption(143);a.showContextMenu({domForShadowRoot:f?t.getDomNode()??void 0:void 0,getAnchor:()=>{let e=qc(n);return{x:e.left,y:e.top+e.height+8}},getActions:()=>u,onHide:()=>{t.focus()},autoSelectFirstItem:!0})}async function xv(e,t,n,r){let i=await e.get(fi).createModelReference(r.uri);await n.invokeWithinContext(async e=>{let a=t.hasSideBySideModifier,o=e.get(w),s=p_.inPeekEditor.getValue(o),c=!a&&n.getOption(100)&&!s;return new mv({openToSide:a,openInPeek:c,muteMessage:!0},{title:{value:``,original:``},id:``,precondition:void 0}).run(e,new fv(i.object.textEditorModel,S.getStartPosition(r.range)),S.lift(r.range))}),i.dispose()}var Sv=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Cv=function(e,t){return function(n,r){t(n,r,e)}},wv,Tv=class e{constructor(){this._entries=new Za(50)}get(t){let n=e._key(t);return this._entries.get(n)}set(t,n){let r=e._key(t);this._entries.set(r,n)}static _key(e){return`${e.uri.toString()}/${e.getVersionId()}`}},Ev=dl(`IInlayHintsCache`);wt(Ev,Tv,1);var Dv=class{constructor(e,t){this.item=e,this.index=t}get part(){let e=this.item.hint.label;return typeof e==`string`?{label:e}:e[this.index]}},Ov=class{constructor(e,t){this.part=e,this.hasTriggerModifier=t}},kv=class{static{wv=this}static{this.ID=`editor.contrib.InlayHints`}static{this._MAX_DECORATORS=1500}static{this._whitespaceData={}}static get(e){return e.getContribution(wv.ID)??void 0}constructor(e,t,n,r,i,a,o){this._editor=e,this._languageFeaturesService=t,this._inlayHintsCache=r,this._commandService=i,this._notificationService=a,this._instaService=o,this._disposables=new P,this._sessionDisposables=new P,this._decorationsMetadata=new Map,this._activeRenderMode=0,this._ruleFactory=this._disposables.add(new Kn(this._editor)),this._debounceInfo=n.for(t.inlayHintsProvider,`InlayHint`,{min:25}),this._disposables.add(t.inlayHintsProvider.onDidChange(()=>this._update())),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(e=>{e.hasChanged(158)&&this._update()})),this._update()}dispose(){this._sessionDisposables.dispose(),this._removeAllDecorations(),this._disposables.dispose()}_update(){this._sessionDisposables.clear(),this._removeAllDecorations();let e=this._editor.getOption(158);if(e.enabled===`off`)return;let t=this._editor.getModel();if(!t||!this._languageFeaturesService.inlayHintsProvider.has(t))return;if(e.enabled===`on`)this._activeRenderMode=0;else{let t,n;e.enabled===`onUnlessPressed`?(t=0,n=1):(t=1,n=0),this._activeRenderMode=t,this._sessionDisposables.add(Rl.getInstance().event(e=>{if(!this._editor.hasModel())return;let r=e.altKey&&e.ctrlKey&&!(e.shiftKey||e.metaKey)?n:t;if(r!==this._activeRenderMode){this._activeRenderMode=r;let e=this._editor.getModel(),t=this._copyInlayHintsWithCurrentAnchor(e);this._updateHintsDecorators([e.getFullModelRange()],t),a.schedule(0)}}))}let n=this._inlayHintsCache.get(t);n&&this._updateHintsDecorators([t.getFullModelRange()],n),this._sessionDisposables.add(pl(()=>{t.isDisposed()||this._cacheHintsForFastRestore(t)}));let r,i=new Set,a=new ju(async()=>{let e=Date.now();r?.dispose(!0),r=new ur;let n=t.onWillDispose(()=>r?.cancel());try{let n=r.token,o=await Zg.create(this._languageFeaturesService.inlayHintsProvider,t,this._getHintsRanges(),n);if(a.delay=this._debounceInfo.update(t,Date.now()-e),n.isCancellationRequested){o.dispose();return}for(let e of o.provider)typeof e.onDidChangeInlayHints==`function`&&!i.has(e)&&(i.add(e),this._sessionDisposables.add(e.onDidChangeInlayHints(()=>{a.isScheduled()||a.schedule()})));this._sessionDisposables.add(o),this._updateHintsDecorators(o.ranges,o.items),this._cacheHintsForFastRestore(t)}catch(e){rr(e)}finally{r.dispose(),n.dispose()}},this._debounceInfo.get(t));this._sessionDisposables.add(a),this._sessionDisposables.add(pl(()=>r?.dispose(!0))),a.schedule(0),this._sessionDisposables.add(this._editor.onDidScrollChange(e=>{(e.scrollTopChanged||!a.isScheduled())&&a.schedule()}));let o=this._sessionDisposables.add(new Ot);this._sessionDisposables.add(this._editor.onDidChangeModelContent(e=>{r?.cancel();let t=Math.max(a.delay,800);this._cursorInfo={position:this._editor.getPosition(),notEarlierThan:Date.now()+t},o.value=Qr(()=>a.schedule(0),t),a.schedule()})),this._sessionDisposables.add(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(158)&&a.schedule()})),this._sessionDisposables.add(this._installDblClickGesture(()=>a.schedule(0))),this._sessionDisposables.add(this._installLinkGesture()),this._sessionDisposables.add(this._installContextMenu())}_installLinkGesture(){let e=new P,t=e.add(new Jg(this._editor)),n=new P;return e.add(n),e.add(t.onMouseMoveOrRelevantKeyDown(e=>{let[t]=e,r=this._getInlayHintLabelPart(t),i=this._editor.getModel();if(!r||!i){n.clear();return}let a=new ur;n.add(pl(()=>a.dispose(!0))),r.item.resolve(a.token),this._activeInlayHintPart=r.part.command||r.part.location?new Ov(r,t.hasTriggerModifier):void 0;let o=i.validatePosition(r.item.hint.position).lineNumber,s=new S(o,1,o,i.getLineMaxColumn(o)),c=this._getInlineHintsForRange(s);this._updateHintsDecorators([s],c),n.add(pl(()=>{this._activeInlayHintPart=void 0,this._updateHintsDecorators([s],c)}))})),e.add(t.onCancel(()=>n.clear())),e.add(t.onExecute(async e=>{let t=this._getInlayHintLabelPart(e);if(t){let n=t.part;n.location?this._instaService.invokeFunction(xv,e,this._editor,n.location):Va.is(n.command)&&await this._invokeCommand(n.command,t.item)}})),e}_getInlineHintsForRange(e){let t=new Set;for(let n of this._decorationsMetadata.values())e.containsRange(n.item.anchor.range)&&t.add(n.item);return Array.from(t)}_installDblClickGesture(e){return this._editor.onMouseUp(async t=>{if(t.event.detail!==2)return;let n=this._getInlayHintLabelPart(t);if(n&&(t.event.preventDefault(),await n.item.resolve(A.None),Ht(n.item.hint.textEdits))){let t=n.item.hint.textEdits.map(e=>gc.replace(S.lift(e.range),e.text));this._editor.executeEdits(`inlayHint.default`,t),e()}})}_installContextMenu(){return this._editor.onContextMenu(async e=>{if(!_e(e.event.target))return;let t=this._getInlayHintLabelPart(e);t&&await this._instaService.invokeFunction(bv,this._editor,e.event.target,t)})}_getInlayHintLabelPart(e){if(e.target.type!==6)return;let t=e.target.detail.injectedText?.options;if(t instanceof ms&&t?.attachedData instanceof Dv)return t.attachedData}async _invokeCommand(e,t){try{await this._commandService.executeCommand(e.id,...e.arguments??[])}catch(e){this._notificationService.notify({severity:Lt.Error,source:t.provider.displayName,message:e})}}_cacheHintsForFastRestore(e){let t=this._copyInlayHintsWithCurrentAnchor(e);this._inlayHintsCache.set(e,t)}_copyInlayHintsWithCurrentAnchor(e){let t=new Map;for(let[n,r]of this._decorationsMetadata){if(t.has(r.item))continue;let i=e.getDecorationRange(n);if(i){let e=new Yg(i,r.item.anchor.direction),n=r.item.with({anchor:e});t.set(r.item,n)}}return Array.from(t.values())}_getHintsRanges(){let e=this._editor.getModel(),t=this._editor.getVisibleRangesPlusViewportAboveBelow(),n=[];for(let r of t.sort(S.compareRangesUsingStarts)){let t=e.validateRange(new S(r.startLineNumber-30,r.startColumn,r.endLineNumber+30,r.endColumn));n.length===0||!S.areIntersectingOrTouching(n[n.length-1],t)?n.push(t):n[n.length-1]=S.plusRange(n[n.length-1],t)}return n}_updateHintsDecorators(e,t){let n=new Map;if(this._cursorInfo&&this._cursorInfo.notEarlierThan>Date.now()&&e.some(e=>e.containsPosition(this._cursorInfo.position))){let{position:e}=this._cursorInfo;this._cursorInfo=void 0;let r=new Map;for(let t of this._editor.getLineDecorations(e.lineNumber)??[]){let n=this._decorationsMetadata.get(t.id);if(t.range.startColumn>e.column)continue;let i=n?.decoration.options[n.item.anchor.direction];if(i&&i.attachedData!==wv._whitespaceData){let e=r.get(n.item)??0;r.set(n.item,e+i.content.length)}}let i=t.filter(t=>t.anchor.range.startLineNumber===e.lineNumber&&t.anchor.range.endColumn<=e.column),a=Array.from(r.values()),o;for(;;){let e=i.shift(),t=a.shift();if(!t&&!e)break;if(e)n.set(e,t??0),o=e;else if(o&&t){let e=n.get(o);e+=t,e+=a.reduce((e,t)=>e+t,0),a.length=0;break}}}let r=[],i=(e,t,n,i,a)=>{let o={content:n,inlineClassNameAffectsLetterSpacing:!0,inlineClassName:t.className,cursorStops:i,attachedData:a};r.push({item:e,classNameRef:t,decoration:{range:e.anchor.range,options:{description:`InlayHint`,showIfCollapsed:e.anchor.range.isEmpty(),collapseOnReplaceEdit:!e.anchor.range.isEmpty(),stickiness:0,[e.anchor.direction]:this._activeRenderMode===0?o:void 0}}})},a=(e,t)=>{let n=this._ruleFactory.createClassNameRef({width:`${o/3|0}px`,display:`inline-block`});i(e,n,` `,t?Ls.Right:Ls.None,wv._whitespaceData)},{fontSize:o,fontFamily:s,padding:c,isUniform:l}=this._getLayoutInfo(),u=this._editor.getOption(158).maximumLength,d=`--code-editorInlayHintsFontFamily`;this._editor.getContainerDomNode().style.setProperty(d,s);let f={line:0,totalLen:0};for(let e=0;e<t.length;e++){let s=t[e];if(f.line!==s.anchor.range.startLineNumber&&(f={line:s.anchor.range.startLineNumber,totalLen:0}),u&&f.totalLen>u)continue;s.hint.paddingLeft&&a(s,!1);let p=typeof s.hint.label==`string`?[{label:s.hint.label}]:s.hint.label,m=n.get(s),h=0;for(let e=0;e<p.length;e++){let t=p[e],n=e===0,r=e===p.length-1,a={fontSize:`${o}px`,fontFamily:`var(${d}), ${oa.fontFamily}`,verticalAlign:l?`baseline`:`middle`,unicodeBidi:`isolate`};Ht(s.hint.textEdits)&&(a.cursor=`default`),this._fillInColors(a,s.hint),(t.command||t.location)&&this._activeInlayHintPart?.part.item===s&&this._activeInlayHintPart.part.index===e&&(a.textDecoration=`underline`,this._activeInlayHintPart.hasTriggerModifier&&(a.color=Kt(hr),a.cursor=`pointer`));let g=t.label;f.totalLen+=g.length;let _=!1,ee=u===0?0:f.totalLen-u;if(ee>0&&(g=g.slice(0,-ee)+`…`,_=!0),h+=g.length,m!==void 0){let e=h-m;e>=0&&(h-=e,g=g.slice(0,-(1+e))+`…`,_=!0)}if(c&&(n&&(r||_)?(a.padding=`1px ${Math.max(1,o/4)|0}px`,a.borderRadius=`${o/4|0}px`):n?(a.padding=`1px 0 1px ${Math.max(1,o/4)|0}px`,a.borderRadius=`${o/4|0}px 0 0 ${o/4|0}px`):r||_?(a.padding=`1px ${Math.max(1,o/4)|0}px 1px 0`,a.borderRadius=`0 ${o/4|0}px ${o/4|0}px 0`):a.padding=`1px 0 1px 0`),i(s,this._ruleFactory.createClassNameRef(a),Av(g),r&&!s.hint.paddingRight?Ls.Right:Ls.None,new Dv(s,e)),_)break}if(m!==void 0&&h<m){let e=m-h;i(s,this._ruleFactory.createClassNameRef({}),` `.repeat(e),Ls.None)}if(s.hint.paddingRight&&a(s,!0),r.length>wv._MAX_DECORATORS)break}let p=[];for(let[t,n]of this._decorationsMetadata){let r=this._editor.getModel()?.getDecorationRange(t);r&&e.some(e=>e.containsRange(r))&&(p.push(t),n.classNameRef.dispose(),this._decorationsMetadata.delete(t))}let m=Cr.capture(this._editor);this._editor.changeDecorations(e=>{let t=e.deltaDecorations(p,r.map(e=>e.decoration));for(let e=0;e<t.length;e++){let n=r[e];this._decorationsMetadata.set(t[e],n)}}),m.restore(this._editor)}_fillInColors(e,t){t.kind===wo.Parameter?(e.backgroundColor=Kt(ss),e.color=Kt(Jo)):t.kind===wo.Type?(e.backgroundColor=Kt(ya),e.color=Kt(ou)):(e.backgroundColor=Kt(Kc),e.color=Kt(fc))}_getLayoutInfo(){let e=this._editor.getOption(158),t=e.padding,n=this._editor.getOption(61),r=this._editor.getOption(58),i=e.fontSize;(!i||i<5||i>n)&&(i=n);let a=e.fontFamily||r;return{fontSize:i,fontFamily:a,padding:t,isUniform:!t&&a===r&&i===n}}_removeAllDecorations(){this._editor.removeDecorations(Array.from(this._decorationsMetadata.keys()));for(let e of this._decorationsMetadata.values())e.classNameRef.dispose();this._decorationsMetadata.clear()}};kv=wv=Sv([Cv(1,W),Cv(2,co),Cv(3,Ev),Cv(4,Mr),Cv(5,nt),Cv(6,k)],kv);function Av(e){return e.replace(/[ \t]/g,`\xA0`)}gn.registerCommand(`_executeInlayHintProvider`,async(e,...t)=>{let[n,r]=t;K($n.isUri(n)),K(S.isIRange(r));let{inlayHintsProvider:i}=e.get(W),a=await e.get(fi).createModelReference(n);try{let e=await Zg.create(i,a.object.textEditorModel,[S.lift(r)],A.None),t=e.items.map(e=>e.hint);return setTimeout(()=>e.dispose(),0),t}finally{a.dispose()}});var jv=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Mv=function(e,t){return function(n,r){t(n,r,e)}},Nv=class extends $m{constructor(e,t,n,r){super(10,t,e.item.anchor.range,n,r,!0),this.part=e}},Pv=class extends mg{constructor(e,t,n,r,i,a,o,s,c){super(e,t,n,a,s,r,i,c),this._resolverService=o,this.hoverOrdinal=6}suggestHoverAnchor(e){if(!kv.get(this._editor)||e.target.type!==6)return null;let t=e.target.detail.injectedText?.options;return t instanceof ms&&t.attachedData instanceof Dv?new Nv(t.attachedData,this,e.event.posx,e.event.posy):null}computeSync(){return[]}computeAsync(e,t,n,r){return e instanceof Nv?new lu(async t=>{let{part:n}=e;if(await n.item.resolve(r),r.isCancellationRequested)return;let i;typeof n.item.hint.tooltip==`string`?i=new Tn().appendText(n.item.hint.tooltip):n.item.hint.tooltip&&(i=n.item.hint.tooltip),i&&t.emitOne(new fg(this,e.range,[i],!1,0)),Ht(n.item.hint.textEdits)&&t.emitOne(new fg(this,e.range,[new Tn().appendText(H(1154,`Double-click to insert`))],!1,10001));let a;if(typeof n.part.tooltip==`string`?a=new Tn().appendText(n.part.tooltip):n.part.tooltip&&(a=n.part.tooltip),a&&t.emitOne(new fg(this,e.range,[a],!1,1)),n.part.location||n.part.command){let r,i=this._editor.getOption(86)===`altKey`?ro?H(1155,`cmd + click`):H(1156,`ctrl + click`):ro?H(1157,`option + click`):H(1158,`alt + click`);n.part.location&&n.part.command?r=new Tn().appendText(H(1159,`Go to Definition ({0}), right click for more`,i)):n.part.location?r=new Tn().appendText(H(1160,`Go to Definition ({0})`,i)):n.part.command&&(r=new Tn(`[${H(1161,`Execute Command`)}](${Qg(n.part.command)} "${n.part.command.title}") (${i})`,{isTrusted:!0})),r&&t.emitOne(new fg(this,e.range,[r],!1,1e4))}let o=this._resolveInlayHintLabelPartHover(n,r);for await(let e of o)t.emitOne(e)}):lu.EMPTY}async*_resolveInlayHintLabelPartHover(e,t){if(!e.part.location)return;let{uri:n,range:r}=e.part.location,i=await this._resolverService.createModelReference(n);try{let n=i.object.textEditorModel;if(!this._languageFeaturesService.hoverProvider.has(n))return;for await(let i of ig(this._languageFeaturesService.hoverProvider,n,new x(r.startLineNumber,r.startColumn),t))Ln(i.hover.contents)||(yield new fg(this,e.item.anchor.range,i.hover.contents,!1,2+i.ordinal))}finally{i.dispose()}}};Pv=jv([Mv(1,ui),Mv(2,cl),Mv(3,zn),Mv(4,Ac),Mv(5,Ni),Mv(6,fi),Mv(7,W),Mv(8,Mr)],Pv);var Fv=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Iv=function(e,t){return function(n,r){t(n,r,e)}},Lv,Rv,zv=Lv=class extends b{constructor(e,t,n,r,i,a){super();let o=t.hoverParts;this._renderedHoverParts=this._register(new Vv(e,n,o,r,i,a));let s=t.options,c=s.anchor,{showAtPosition:l,showAtSecondaryPosition:u}=Lv.computeHoverPositions(e,c.range,o);this.shouldAppearBeforeContent=o.some(e=>e.isBeforeContent),this.showAtPosition=l,this.showAtSecondaryPosition=u,this.initialMousePosX=c.initialMousePosX,this.initialMousePosY=c.initialMousePosY,this.shouldFocus=s.shouldFocus,this.source=s.source}get domNode(){return this._renderedHoverParts.domNode}get domNodeHasChildren(){return this._renderedHoverParts.domNodeHasChildren}get focusedHoverPartIndex(){return this._renderedHoverParts.focusedHoverPartIndex}get hoverPartsCount(){return this._renderedHoverParts.hoverPartsCount}focusHoverPartWithIndex(e){this._renderedHoverParts.focusHoverPartWithIndex(e)}async updateHoverVerbosityLevel(e,t,n){this._renderedHoverParts.updateHoverVerbosityLevel(e,t,n)}isColorPickerVisible(){return this._renderedHoverParts.isColorPickerVisible()}static computeHoverPositions(e,t,n){let r=1;if(e.hasModel()){let n=e._getViewModel(),i=n.coordinatesConverter,a=i.convertModelRangeToViewRange(t),o=n.getLineMinColumn(a.startLineNumber),s=new x(a.startLineNumber,o);r=i.convertViewPositionToModelPosition(s).column}let i=t.startLineNumber,a=t.startColumn,o;for(let e of n){let t=e.range,n=t.startLineNumber===i,s=t.endLineNumber===i;if(n&&s){let e=t.startColumn,n=Math.min(a,e);a=Math.max(n,r)}e.forceShowAtRange&&(o=t)}let s,c;if(o){let e=o.getStartPosition();s=e,c=e}else s=t.getStartPosition(),c=new x(i,a);return{showAtPosition:s,showAtSecondaryPosition:c}}};zv=Lv=Fv([Iv(4,zn),Iv(5,Ac)],zv);var Bv=class{constructor(e,t){this._statusBar=t,e.appendChild(this._statusBar.hoverElement)}get hoverElement(){return this._statusBar.hoverElement}get actions(){return this._statusBar.actions}dispose(){this._statusBar.dispose()}},Vv=class extends b{static{Rv=this}static{this._DECORATION_OPTIONS=R.register({description:`content-hover-highlight`,className:`hoverHighlight`})}constructor(e,t,n,r,i,a){super(),this._renderedParts=[],this._focusedHoverPartIndex=-1,this._context=r,this._fragment=document.createDocumentFragment(),this._register(this._renderParts(t,n,r,i,a)),this._register(this._registerListenersOnRenderedParts()),this._register(this._createEditorDecorations(e,n)),this._updateMarkdownAndColorParticipantInfo(t)}_createEditorDecorations(e,t){if(t.length===0)return b.None;let n=t[0].range;for(let e of t){let t=e.range;n=S.plusRange(n,t)}let r=e.createDecorationsCollection();return r.set([{range:n,options:Rv._DECORATION_OPTIONS}]),pl(()=>{r.clear()})}_renderParts(e,t,n,r,i){let a=new tg(r,i),o={fragment:this._fragment,statusBar:a,...n},s=new P;s.add(a);for(let n of e){let e=this._renderHoverPartsForParticipant(t,n,o);s.add(e);for(let t of e.renderedHoverParts)this._renderedParts.push({type:`hoverPart`,participant:n,hoverPart:t.hoverPart,hoverElement:t.hoverElement})}let c=this._renderStatusBar(this._fragment,a);return c&&(s.add(c),this._renderedParts.push({type:`statusBar`,hoverElement:c.hoverElement,actions:c.actions})),s}_renderHoverPartsForParticipant(e,t,n){let r=e.filter(e=>e.owner===t);return r.length>0?t.renderHoverParts(n,r):new eh([])}_renderStatusBar(e,t){if(t.hasContent)return new Bv(e,t)}_registerListenersOnRenderedParts(){let e=new P;return this._renderedParts.forEach((t,n)=>{let r=t.hoverElement;r.tabIndex=0,e.add(U(r,Eo.FOCUS_IN,e=>{e.stopPropagation(),this._focusedHoverPartIndex=n})),e.add(U(r,Eo.FOCUS_OUT,e=>{e.stopPropagation(),this._focusedHoverPartIndex=-1}))}),e}_updateMarkdownAndColorParticipantInfo(e){let t=e.find(e=>e instanceof mg&&!(e instanceof Pv));t&&(this._markdownHoverParticipant=t),this._colorHoverParticipant=e.find(e=>e instanceof Hg)}focusHoverPartWithIndex(e){e<0||e>=this._renderedParts.length||this._renderedParts[e].hoverElement.focus()}async updateHoverVerbosityLevel(e,t,n){if(!this._markdownHoverParticipant)return;let r;r=t>=0?{start:t,endExclusive:t+1}:this._findRangeOfMarkdownHoverParts(this._markdownHoverParticipant);for(let t=r.start;t<r.endExclusive;t++){let n=this._normalizedIndexToMarkdownHoverIndexRange(this._markdownHoverParticipant,t);if(n===void 0)continue;let r=await this._markdownHoverParticipant.updateMarkdownHoverVerbosityLevel(e,n);r&&(this._renderedParts[t]={type:`hoverPart`,participant:this._markdownHoverParticipant,hoverPart:r.hoverPart,hoverElement:r.hoverElement})}n&&(t>=0?this.focusHoverPartWithIndex(t):this._context.focus()),this._context.onContentsChanged()}isColorPickerVisible(){return this._colorHoverParticipant?.isColorPickerVisible()??!1}_normalizedIndexToMarkdownHoverIndexRange(e,t){let n=this._renderedParts[t];if(!n||n.type!==`hoverPart`||n.participant!==e)return;let r=this._renderedParts.findIndex(t=>t.type===`hoverPart`&&t.participant===e);if(r===-1)throw new h;return t-r}_findRangeOfMarkdownHoverParts(e){let t=this._renderedParts.slice(),n=t.findIndex(t=>t.type===`hoverPart`&&t.participant===e),r=t.reverse().findIndex(t=>t.type===`hoverPart`&&t.participant===e),i=r>=0?t.length-r:r;return{start:n,endExclusive:i+1}}get domNode(){return this._fragment}get domNodeHasChildren(){return this._fragment.hasChildNodes()}get focusedHoverPartIndex(){return this._focusedHoverPartIndex}get hoverPartsCount(){return this._renderedParts.length}};Vv=Rv=Fv([Iv(4,zn),Iv(5,Ac)],Vv);var Hv=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Uv=function(e,t){return function(n,r){t(n,r,e)}},Wv=class extends b{constructor(e,t,n,r){super(),this._editor=e,this._instantiationService=t,this._keybindingService=n,this._hoverService=r,this._currentResult=null,this._renderedContentHover=this._register(new Ot),this._onContentsChanged=this._register(new E),this.onContentsChanged=this._onContentsChanged.event,this._contentHoverWidget=this._register(this._instantiationService.createInstance(qh,this._editor)),this._participants=this._initializeHoverParticipants(),this._hoverOperation=this._register(new Bh(this._editor,new Yh(this._editor,this._participants))),this._registerListeners()}_initializeHoverParticipants(){let e=[];for(let t of th.getAll()){let n=this._instantiationService.createInstance(t,this._editor);e.push(n)}return e.sort((e,t)=>e.hoverOrdinal-t.hoverOrdinal),this._register(this._contentHoverWidget.onDidResize(()=>{this._participants.forEach(e=>e.handleResize?.())})),this._register(this._contentHoverWidget.onDidScroll(e=>{this._participants.forEach(t=>t.handleScroll?.(e))})),this._register(this._contentHoverWidget.onContentsChanged(()=>{this._participants.forEach(e=>e.handleContentsChanged?.())})),e}_registerListeners(){this._register(this._hoverOperation.onResult(e=>{let t=e.hasLoadingMessage?this._addLoadingMessage(e):e.value;this._withResult(new Xh(t,e.isComplete,e.options))}));let e=this._contentHoverWidget.getDomNode();this._register(Ma(e,`keydown`,e=>{e.equals(9)&&this.hide()})),this._register(Ma(e,`mouseleave`,e=>{this._onMouseLeave(e)})),this._register(Lu.onDidChange(()=>{this._contentHoverWidget.position&&this._currentResult&&this._setCurrentResult(this._currentResult)})),this._register(this._contentHoverWidget.onContentsChanged(()=>{this._onContentsChanged.fire()}))}_startShowingOrUpdateHover(e,t,n,r,i){if(!(this._contentHoverWidget.position&&this._currentResult))return e?(this._startHoverOperationIfNecessary(e,t,n,r,!1),!0):!1;let a=this._editor.getOption(69).sticky,o=i&&this._contentHoverWidget.isMouseGettingCloser(i.event.posx,i.event.posy);return a&&o?(e&&this._startHoverOperationIfNecessary(e,t,n,r,!0),!0):e?this._currentResult&&this._currentResult.options.anchor.equals(e)?!0:this._currentResult&&e.canAdoptVisibleHover(this._currentResult.options.anchor,this._contentHoverWidget.position)?(this._currentResult&&this._setCurrentResult(this._currentResult.filter(e)),this._startHoverOperationIfNecessary(e,t,n,r,!1),!0):(this._setCurrentResult(null),this._startHoverOperationIfNecessary(e,t,n,r,!1),!0):(this._setCurrentResult(null),!1)}_startHoverOperationIfNecessary(e,t,n,r,i){if(this._hoverOperation.options&&this._hoverOperation.options.anchor.equals(e))return;this._hoverOperation.cancel();let a={anchor:e,source:n,shouldFocus:r,insistOnKeepingHoverVisible:i};this._hoverOperation.start(t,a)}_setCurrentResult(e){let t=e;this._currentResult!==t&&(t&&t.hoverParts.length===0&&(t=null),this._currentResult=t,this._currentResult?this._showHover(this._currentResult):this._hideHover())}_addLoadingMessage(e){for(let t of this._participants){if(!t.createLoadingMessage)continue;let n=t.createLoadingMessage(e.options.anchor);if(!n)continue;return e.value.slice(0).concat([n])}return e.value}_withResult(e){if(this._contentHoverWidget.position&&this._currentResult&&this._currentResult.isComplete||this._setCurrentResult(e),!e.isComplete)return;let t=e.hoverParts.length===0,n=e.options.insistOnKeepingHoverVisible;t&&n||this._setCurrentResult(e)}_showHover(e){let t=this._getHoverContext();this._renderedContentHover.value=new zv(this._editor,e,this._participants,t,this._keybindingService,this._hoverService),this._renderedContentHover.value.domNodeHasChildren?this._contentHoverWidget.show(this._renderedContentHover.value):this._renderedContentHover.clear()}_hideHover(){this._contentHoverWidget.hide(),this._participants.forEach(e=>e.handleHide?.())}_getHoverContext(){return{hide:()=>{this.hide()},onContentsChanged:()=>{this._contentHoverWidget.handleContentsChanged()},setMinimumDimensions:e=>{this._contentHoverWidget.setMinimumDimensions(e)},focus:()=>this.focus()}}showsOrWillShow(e){if(this._contentHoverWidget.isResizing)return!0;let t=this._findHoverAnchorCandidates(e);if(!(t.length>0))return this._startShowingOrUpdateHover(null,0,0,!1,e);let n=t[0];return this._startShowingOrUpdateHover(n,0,0,!1,e)}_findHoverAnchorCandidates(e){let t=[];for(let n of this._participants){if(!n.suggestHoverAnchor)continue;let r=n.suggestHoverAnchor(e);if(!r)continue;t.push(r)}let n=e.target;switch(n.type){case 6:t.push(new Qm(0,n.range,e.event.posx,e.event.posy));break;case 7:{let r=this._editor.getOption(59).typicalHalfwidthCharacterWidth/2;if(!(!n.detail.isAfterLines&&typeof n.detail.horizontalDistanceToText==`number`&&n.detail.horizontalDistanceToText<r))break;t.push(new Qm(0,n.range,e.event.posx,e.event.posy));break}}return t.sort((e,t)=>t.priority-e.priority),t}_onMouseLeave(e){let t=this._editor.getDomNode();(!t||!Rh(t,e.x,e.y))&&this.hide()}startShowingAtRange(e,t,n,r){this._startShowingOrUpdateHover(new Qm(0,e,void 0,void 0),t,n,r,null)}async updateHoverVerbosityLevel(e,t,n){this._renderedContentHover.value?.updateHoverVerbosityLevel(e,t,n)}focusedHoverPartIndex(){return this._renderedContentHover.value?.focusedHoverPartIndex??-1}containsNode(e){return e?this._contentHoverWidget.getDomNode().contains(e):!1}focus(){if(this._renderedContentHover.value?.hoverPartsCount===1){this.focusHoverPartWithIndex(0);return}this._contentHoverWidget.focus()}focusHoverPartWithIndex(e){this._renderedContentHover.value?.focusHoverPartWithIndex(e)}scrollUp(){this._contentHoverWidget.scrollUp()}scrollDown(){this._contentHoverWidget.scrollDown()}scrollLeft(){this._contentHoverWidget.scrollLeft()}scrollRight(){this._contentHoverWidget.scrollRight()}pageUp(){this._contentHoverWidget.pageUp()}pageDown(){this._contentHoverWidget.pageDown()}goToTop(){this._contentHoverWidget.goToTop()}goToBottom(){this._contentHoverWidget.goToBottom()}hide(){this._hoverOperation.cancel(),this._setCurrentResult(null)}getDomNode(){return this._contentHoverWidget.getDomNode()}get isColorPickerVisible(){return this._renderedContentHover.value?.isColorPickerVisible()??!1}get isVisibleFromKeyboard(){return this._contentHoverWidget.isVisibleFromKeyboard}get isVisible(){return this._contentHoverWidget.isVisible}get isFocused(){return this._contentHoverWidget.isFocused}get isResizing(){return this._contentHoverWidget.isResizing}get widget(){return this._contentHoverWidget}};Wv=Hv([Uv(1,k),Uv(2,zn),Uv(3,Ac)],Wv);function Gv(e){let t=e.target;return!!t&&t.type===6&&t.detail.injectedText?.options.attachedData===gh}var Kv=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qv=function(e,t){return function(n,r){t(n,r,e)}},Jv,Yv=class extends b{static{Jv=this}static{this.ID=`editor.contrib.contentHover`}constructor(e,t,n,r){super(),this._editor=e,this._instantiationService=n,this._keybindingService=r,this._onHoverContentsChanged=this._register(new E),this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new P,this._isMouseDown=!1,this._ignoreMouseEvents=!1,this._reactToEditorMouseMoveRunner=this._register(new ju(()=>{this._mouseMoveEvent&&this._reactToEditorMouseMove(this._mouseMoveEvent)},0)),this._register(t.onDidShowContextMenu(()=>{this.hideContentHover(),this._ignoreMouseEvents=!0})),this._register(t.onDidHideContextMenu(()=>{this._ignoreMouseEvents=!1})),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(69)&&(this._unhookListeners(),this._hookListeners())}))}static get(e){return e.getContribution(Jv.ID)}_hookListeners(){let e=this._editor.getOption(69);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled||this._cancelSchedulerAndHide(),this._listenersStore.add(this._editor.onMouseDown(e=>this._onEditorMouseDown(e))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._listenersStore.add(this._editor.onKeyDown(e=>this._onKeyDown(e))),this._listenersStore.add(this._editor.onMouseLeave(e=>this._onEditorMouseLeave(e))),this._listenersStore.add(this._editor.onDidChangeModel(()=>this._cancelSchedulerAndHide())),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(e=>this._onEditorScrollChanged(e)))}_unhookListeners(){this._listenersStore.clear()}_cancelSchedulerAndHide(){this._cancelScheduler(),this.hideContentHover()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){this._ignoreMouseEvents||(e.scrollTopChanged||e.scrollLeftChanged)&&this.hideContentHover()}_onEditorMouseDown(e){this._ignoreMouseEvents||(this._isMouseDown=!0,!this._shouldKeepHoverWidgetVisible(e)&&this.hideContentHover())}_shouldKeepHoverWidgetVisible(e){return this._isMouseOnContentHoverWidget(e)||this._isContentWidgetResizing()||Gv(e)}_isMouseOnContentHoverWidget(e){return this._contentWidget?Rh(this._contentWidget.getDomNode(),e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._ignoreMouseEvents||(this._isMouseDown=!1)}_onEditorMouseLeave(e){this._ignoreMouseEvents||this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),!this._shouldKeepHoverWidgetVisible(e)&&this.hideContentHover())}_shouldKeepCurrentHover(e){let t=this._contentWidget;if(!t)return!1;let n=this._hoverSettings.sticky,r=(e,t)=>{let n=this._isMouseOnContentHoverWidget(e);return t&&n},i=e=>{let n=t.isColorPickerVisible,r=this._isMouseOnContentHoverWidget(e),i=n&&r,a=n&&this._isMouseDown;return i||a},a=(e,n)=>{let r=e.event.browserEvent.view;return r?n&&t.containsNode(r.document.activeElement)&&!r.getSelection()?.isCollapsed:!1},o=t.isFocused,s=t.isResizing,c=this._hoverSettings.sticky&&t.isVisibleFromKeyboard;return this.shouldKeepOpenOnEditorMouseMoveOrLeave||o||s||c||r(e,n)||i(e)||a(e,n)}_onEditorMouseMove(e){if(!this._ignoreMouseEvents){if(this._mouseMoveEvent=e,this._shouldKeepCurrentHover(e)){this._reactToEditorMouseMoveRunner.cancel();return}if(this._shouldRescheduleHoverComputation()){this._reactToEditorMouseMoveRunner.isScheduled()||this._reactToEditorMouseMoveRunner.schedule(this._hoverSettings.hidingDelay);return}this._reactToEditorMouseMove(e)}}_shouldRescheduleHoverComputation(){let e=this._hoverSettings.hidingDelay;return(this._contentWidget?.isVisible??!1)&&this._hoverSettings.sticky&&e>0}_reactToEditorMouseMove(e){this._hoverSettings.enabled&&this._getOrCreateContentWidget().showsOrWillShow(e)||this.hideContentHover()}_onKeyDown(e){if(this._ignoreMouseEvents||!this._contentWidget)return;let t=this._isPotentialKeyboardShortcut(e),n=this._isModifierKeyPressed(e);t||n||this._contentWidget.isFocused&&e.keyCode===2||this.hideContentHover()}_isPotentialKeyboardShortcut(e){if(!this._editor.hasModel()||!this._contentWidget)return!1;let t=this._keybindingService.softDispatch(e,this._editor.getDomNode()),n=t.kind===1,r=t.kind===2&&(t.commandId===`editor.action.showHover`||t.commandId===`editor.action.increaseHoverVerbosityLevel`||t.commandId===`editor.action.decreaseHoverVerbosityLevel`)&&this._contentWidget.isVisible;return n||r}_isModifierKeyPressed(e){return e.keyCode===5||e.keyCode===6||e.keyCode===57||e.keyCode===4}hideContentHover(){Ph.dropDownVisible||this._contentWidget?.hide()}_getOrCreateContentWidget(){return this._contentWidget||(this._contentWidget=this._instantiationService.createInstance(Wv,this._editor),this._listenersStore.add(this._contentWidget.onContentsChanged(()=>this._onHoverContentsChanged.fire()))),this._contentWidget}showContentHover(e,t,n,r){this._getOrCreateContentWidget().startShowingAtRange(e,t,n,r)}_isContentWidgetResizing(){return this._contentWidget?.widget.isResizing||!1}focusedHoverPartIndex(){return this._getOrCreateContentWidget().focusedHoverPartIndex()}updateHoverVerbosityLevel(e,t,n){this._getOrCreateContentWidget().updateHoverVerbosityLevel(e,t,n)}focus(){this._contentWidget?.focus()}scrollUp(){this._contentWidget?.scrollUp()}scrollDown(){this._contentWidget?.scrollDown()}scrollLeft(){this._contentWidget?.scrollLeft()}scrollRight(){this._contentWidget?.scrollRight()}pageUp(){this._contentWidget?.pageUp()}pageDown(){this._contentWidget?.pageDown()}goToTop(){this._contentWidget?.goToTop()}goToBottom(){this._contentWidget?.goToBottom()}get isColorPickerVisible(){return this._contentWidget?.isColorPickerVisible}get isHoverVisible(){return this._contentWidget?.isVisible}dispose(){super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),this._contentWidget?.dispose()}};Yv=Jv=Kv([qv(1,Mo),qv(2,k),qv(3,zn)],Yv);var Xv=class extends b{static{this.ID=`editor.contrib.colorContribution`}constructor(e){super(),this._editor=e,this._register(e.onMouseDown(e=>this.onMouseDown(e)))}dispose(){super.dispose()}onMouseDown(e){let t=this._editor.getOption(167);if(t!==`click`&&t!==`clickAndHover`||!Gv(e))return;let n=this._editor.getContribution(Yv.ID);if(!n||n.isColorPickerVisible)return;let r=e.target.range;if(!r)return;let i=new S(r.startLineNumber,r.startColumn+1,r.endLineNumber,r.endColumn+1);n.showContentHover(i,1,1,!1)}},Zv=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Qv=function(e,t){return function(n,r){t(n,r,e)}},$v=class e{constructor(e,t,n,r){this.owner=e,this.range=t,this.model=n,this.provider=r}static fromBaseColor(t,n){return new e(t,n.range,n.model,n.provider)}},ey=class extends b{constructor(e,t,n,r){super();let i=e.getModel(),a=n.model;this.color=n.model.color,this.colorPicker=this._register(new Pg(t.fragment,a,e.getOption(162),r,`standalone`)),this._register(a.onColorFlushed(e=>{this.color=e})),this._register(a.onDidChangeColor(e=>{Rg(i,a,e,n.range,n)}));let o=!1;this._register(e.onDidChangeModelContent(n=>{o?o=!1:(t.hide(),e.focus())})),Rg(i,a,this.color,n.range,n)}},ty=class{constructor(e,t){this._editor=e,this._themeService=t}async createColorHover(e,t,n){if(!this._editor.hasModel()||!_h.get(this._editor))return null;let r=await oh(n,this._editor.getModel(),A.None),i=null,a=null;for(let t of r){let n=t.colorInfo;S.containsRange(n.range,e.range)&&(i=n,a=t.provider)}let o=i??e,s=a??t,c=!!i;return{colorHover:$v.fromBaseColor(this,await Ig(this._editor.getModel(),o,s)),foundInEditor:c}}async updateEditorModel(e){if(!this._editor.hasModel())return;let t=e.model,n=new S(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn);this._color&&(await Rg(this._editor.getModel(),t,this._color,n,e),n=Lg(this._editor,n,t))}renderHoverParts(e,t){if(!(t.length===0||!this._editor.hasModel()))return this._setMinimumDimensions(e),this._renderedParts=new ey(this._editor,e,t[0],this._themeService),this._renderedParts}_setMinimumDimensions(e){let t=this._editor.getOption(75)+8;e.setMinimumDimensions(new br(302,t))}get _color(){return this._renderedParts?.color}};ty=Zv([Qv(1,rn)],ty);var ny=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ry=function(e,t){return function(n,r){t(n,r,e)}},iy,ay=class{constructor(e,t){this.value=e,this.foundInEditor=t}},oy=class extends b{static{iy=this}static{this.ID=`editor.contrib.standaloneColorPickerWidget`}constructor(e,t,n,r,i,a,o,s){super(),this._editor=e,this._standaloneColorPickerVisible=t,this._standaloneColorPickerFocused=n,this._keybindingService=i,this._languageFeaturesService=a,this._editorWorkerService=o,this._hoverService=s,this.allowEditorOverflow=!0,this._position=void 0,this._body=document.createElement(`div`),this._colorHover=null,this._selectionSetInEditor=!1,this._onResult=this._register(new E),this.onResult=this._onResult.event,this._renderedHoverParts=this._register(new Ot),this._renderedStatusBar=this._register(new Ot),this._standaloneColorPickerVisible.set(!0),this._standaloneColorPickerParticipant=r.createInstance(ty,this._editor),this._position=this._editor._getViewModel()?.getPrimaryCursorState().modelState.position;let c=this._editor.getSelection(),l=c?{startLineNumber:c.startLineNumber,startColumn:c.startColumn,endLineNumber:c.endLineNumber,endColumn:c.endColumn}:{startLineNumber:0,endLineNumber:0,endColumn:0,startColumn:0},u=this._register(Ms(this._body));this._register(u.onDidBlur(e=>{this.hide()})),this._register(u.onDidFocus(e=>{this.focus()})),this._register(this._editor.onDidChangeCursorPosition(()=>{this._selectionSetInEditor?this._selectionSetInEditor=!1:this.hide()})),this._register(this._editor.onMouseMove(e=>{let t=e.target.element?.classList;t&&t.contains(`colorpicker-color-decoration`)&&this.hide()})),this._register(this.onResult(e=>{this._render(e.value,e.foundInEditor)})),this._start(l),this._body.style.zIndex=`50`,this._editor.addContentWidget(this)}updateEditor(){this._colorHover&&this._standaloneColorPickerParticipant.updateEditorModel(this._colorHover)}getId(){return iy.ID}getDomNode(){return this._body}getPosition(){if(!this._position)return null;let e=this._editor.getOption(69).above;return{position:this._position,secondaryPosition:this._position,preference:e?[1,2]:[2,1],positionAffinity:2}}hide(){this.dispose(),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerFocused.set(!1),this._editor.removeContentWidget(this),this._editor.focus()}focus(){this._standaloneColorPickerFocused.set(!0),this._body.focus()}async _start(e){let t=await this._computeAsync(e);t&&this._onResult.fire(new ay(t.result,t.foundInEditor))}async _computeAsync(e){if(!this._editor.hasModel())return null;let t={range:e,color:{red:0,green:0,blue:0,alpha:1}},n=await this._standaloneColorPickerParticipant.createColorHover(t,new ih(this._editorWorkerService),this._languageFeaturesService.colorProvider);return n?{result:n.colorHover,foundInEditor:n.foundInEditor}:null}_render(e,t){let n=document.createDocumentFragment();this._renderedStatusBar.value=this._register(new tg(this._keybindingService,this._hoverService));let r={fragment:n,statusBar:this._renderedStatusBar.value,onContentsChanged:()=>{},setMinimumDimensions:()=>{},hide:()=>this.hide(),focus:()=>this.focus()};if(this._colorHover=e,this._renderedHoverParts.value=this._standaloneColorPickerParticipant.renderHoverParts(r,[e]),!this._renderedHoverParts.value){this._renderedStatusBar.clear(),this._renderedHoverParts.clear();return}let i=this._renderedHoverParts.value.colorPicker;this._body.classList.add(`standalone-colorpicker-body`),this._body.style.maxHeight=Math.max(this._editor.getLayoutInfo().height/4,250)+`px`,this._body.style.maxWidth=Math.max(this._editor.getLayoutInfo().width*.66,500)+`px`,this._body.tabIndex=0,this._body.appendChild(n),i.layout();let a=i.body,o=a.saturationBox.domNode.clientWidth,s=a.domNode.clientWidth-o-22-8,c=i.body.enterButton;c?.onClicked(()=>{this.updateEditor(),this.hide()});let l=i.header,u=l.pickedColorNode;u.style.width=o+8+`px`;let d=l.originalColorNode;d.style.width=s+`px`,i.header.closeButton?.onClicked(()=>{this.hide()}),t&&(c&&(c.button.textContent=`Replace`),this._selectionSetInEditor=!0,this._editor.setSelection(e.range)),this._editor.layoutContentWidget(this)}};oy=iy=ny([ry(3,k),ry(4,zn),ry(5,W),ry(6,ne),ry(7,Ac)],oy);var sy=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},cy=function(e,t){return function(n,r){t(n,r,e)}},ly,uy=class extends b{static{ly=this}static{this.ID=`editor.contrib.standaloneColorPickerController`}constructor(e,t,n){super(),this._editor=e,this._instantiationService=n,this._standaloneColorPickerWidget=null,this._standaloneColorPickerVisible=F.standaloneColorPickerVisible.bindTo(t),this._standaloneColorPickerFocused=F.standaloneColorPickerFocused.bindTo(t)}showOrFocus(){this._editor.hasModel()&&(this._standaloneColorPickerVisible.get()?this._standaloneColorPickerFocused.get()||this._standaloneColorPickerWidget?.focus():this._standaloneColorPickerWidget=this._instantiationService.createInstance(oy,this._editor,this._standaloneColorPickerVisible,this._standaloneColorPickerFocused))}hide(){this._standaloneColorPickerFocused.set(!1),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerWidget?.hide(),this._editor.focus()}insertColor(){this._standaloneColorPickerWidget?.updateEditor(),this.hide()}static get(e){return e.getContribution(ly.ID)}};uy=ly=sy([cy(1,w),cy(2,k)],uy);var dy=class extends na{constructor(){super({id:`editor.action.showOrFocusStandaloneColorPicker`,title:{...B(881,`Show or Focus Standalone Color Picker`),mnemonicTitle:H(880,`&&Show or Focus Standalone Color Picker`)},precondition:void 0,menu:[{id:M.CommandPalette}],metadata:{description:B(882,`Show or focus a standalone color picker which uses the default color provider. It displays hex/rgb/hsl colors.`)}})}runEditorCommand(e,t){uy.get(t)?.showOrFocus()}},fy=class extends D{constructor(){super({id:`editor.action.hideColorPicker`,label:B(883,`Hide the Color Picker`),precondition:F.standaloneColorPickerVisible.isEqualTo(!0),kbOpts:{primary:9,weight:100},metadata:{description:B(884,`Hide the standalone color picker.`)}})}run(e,t){uy.get(t)?.hide()}},py=class extends D{constructor(){super({id:`editor.action.insertColorWithStandaloneColorPicker`,label:B(885,`Insert Color with Standalone Color Picker`),precondition:F.standaloneColorPickerFocused.isEqualTo(!0),kbOpts:{primary:3,weight:100},metadata:{description:B(886,`Insert hex/rgb/hsl colors with the focused standalone color picker.`)}})}run(e,t){uy.get(t)?.insertColor()}};s(fy),s(py),y(dy),G(Xv.ID,Xv,2),G(uy.ID,uy,1),G(_h.ID,_h,1),at(ah),th.register(Hg),gn.registerCommand(`_executeDocumentColorProvider`,function(e,...t){let[n]=t;if(!(n instanceof $n))throw Sn();let{model:r,colorProviderRegistry:i,defaultColorDecoratorsEnablement:a}=fh(e,n);return dh(new lh,i,r,A.None,a)}),gn.registerCommand(`_executeColorPresentationProvider`,function(e,...t){let[n,r]=t,{uri:i,range:a}=r;if(!(i instanceof $n)||!Array.isArray(n)||n.length!==4||!S.isIRange(a))throw Sn();let{model:o,colorProviderRegistry:s,defaultColorDecoratorsEnablement:c}=fh(e,i),[l,u,d,f]=n;return dh(new uh({range:a,color:{red:l,green:u,blue:d,alpha:f}}),s,o,A.None,c)});var my=class e{constructor(e,t,n){this.languageConfigurationService=n,this._selection=e,this._insertSpace=t,this._usedEndToken=null}static _haystackHasNeedleAtOffset(e,t,n){if(n<0)return!1;let r=t.length,i=e.length;if(n+r>i)return!1;for(let i=0;i<r;i++){let r=e.charCodeAt(n+i),a=t.charCodeAt(i);if(r!==a&&!(r>=65&&r<=90&&r+32===a)&&!(a>=65&&a<=90&&a+32===r))return!1}return!0}_createOperationsForBlockComment(t,n,r,i,a,o){let s=t.startLineNumber,c=t.startColumn,l=t.endLineNumber,u=t.endColumn,d=a.getLineContent(s),f=a.getLineContent(l),p=d.lastIndexOf(n,c-1+n.length),m=f.indexOf(r,u-1-r.length);if(p!==-1&&m!==-1)if(s===l)d.substring(p+n.length,m).indexOf(r)>=0&&(p=-1,m=-1);else{let e=d.substring(p+n.length),t=f.substring(0,m);(e.indexOf(r)>=0||t.indexOf(r)>=0)&&(p=-1,m=-1)}let h;p!==-1&&m!==-1?(i&&p+n.length<d.length&&d.charCodeAt(p+n.length)===32&&(n+=` `),i&&m>0&&f.charCodeAt(m-1)===32&&(r=` `+r,--m),h=e._createRemoveBlockCommentOperations(new S(s,p+n.length+1,l,m+1),n,r)):(h=e._createAddBlockCommentOperations(t,n,r,this._insertSpace),this._usedEndToken=h.length===1?r:null);for(let e of h)o.addTrackedEditOperation(e.range,e.text)}static _createRemoveBlockCommentOperations(e,t,n){let r=[];return S.isEmpty(e)?r.push(gc.delete(new S(e.startLineNumber,e.startColumn-t.length,e.endLineNumber,e.endColumn+n.length))):(r.push(gc.delete(new S(e.startLineNumber,e.startColumn-t.length,e.startLineNumber,e.startColumn))),r.push(gc.delete(new S(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn+n.length)))),r}static _createAddBlockCommentOperations(e,t,n,r){let i=[];return S.isEmpty(e)?i.push(gc.replace(new S(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),t+`  `+n)):(i.push(gc.insert(new x(e.startLineNumber,e.startColumn),t+(r?` `:``))),i.push(gc.insert(new x(e.endLineNumber,e.endColumn),(r?` `:``)+n))),i}getEditOperations(e,t){let n=this._selection.startLineNumber,r=this._selection.startColumn;e.tokenization.tokenizeIfCheap(n);let i=e.getLanguageIdAtPosition(n,r),a=this.languageConfigurationService.getLanguageConfiguration(i).comments;!a||!a.blockCommentStartToken||!a.blockCommentEndToken||this._createOperationsForBlockComment(this._selection,a.blockCommentStartToken,a.blockCommentEndToken,this._insertSpace,e,t)}computeCursorState(e,t){let n=t.getInverseEditOperations();if(n.length===2){let e=n[0],t=n[1];return new N(e.range.endLineNumber,e.range.endColumn,t.range.startLineNumber,t.range.startColumn)}else{let e=n[0].range,t=this._usedEndToken?-this._usedEndToken.length-1:0;return new N(e.endLineNumber,e.endColumn+t,e.endLineNumber,e.endColumn+t)}}},hy=class e{constructor(e,t,n,r,i,a,o){this.languageConfigurationService=e,this._selection=t,this._indentSize=n,this._type=r,this._insertSpace=i,this._selectionId=null,this._deltaColumn=0,this._moveEndPositionDown=!1,this._ignoreEmptyLines=a,this._ignoreFirstLine=o||!1}static _gatherPreflightCommentStrings(e,t,n,r){e.tokenization.tokenizeIfCheap(t);let i=e.getLanguageIdAtPosition(t,1),a=r.getLanguageConfiguration(i).comments,o=a?a.lineCommentToken:null;if(!o)return null;let s=[];for(let e=0,r=n-t+1;e<r;e++)s[e]={ignore:!1,commentStr:o,commentStrOffset:0,commentStrLength:o.length};return s}static _analyzeLines(e,t,n,r,i,a,o,s,c){let l=!0,u=s.getLanguageConfiguration(c).comments?.lineCommentNoIndent??!1,d;d=e===0?!0:e!==1;for(let s=0,c=r.length;s<c;s++){let c=r[s],f=i+s;if(f===i&&o){c.ignore=!0;continue}let p=n.getLineContent(f),m=St(p);if(m===-1){c.ignore=a,c.commentStrOffset=u?0:p.length;continue}l=!1;let h=u?0:m;if(c.ignore=!1,c.commentStrOffset=h,d&&!my._haystackHasNeedleAtOffset(p,c.commentStr,h)&&(e===0?d=!1:e===1||(c.ignore=!0)),d&&t){let e=m+c.commentStrLength;e<p.length&&p.charCodeAt(e)===32&&(c.commentStrLength+=1)}}if(e===0&&l){d=!1;for(let e=0,t=r.length;e<t;e++)r[e].ignore=!1}return{supported:!0,shouldRemoveComments:d,lines:r}}static _gatherPreflightData(t,n,r,i,a,o,s,c){let l=e._gatherPreflightCommentStrings(r,i,a,c),u=r.getLanguageIdAtPosition(i,1);return l===null?{supported:!1}:e._analyzeLines(t,n,r,l,i,o,s,c,u)}_executeLineComments(t,n,r,i){let a;r.shouldRemoveComments?a=e._createRemoveLineCommentsOperations(r.lines,i.startLineNumber):(e._normalizeInsertionPoint(t,r.lines,i.startLineNumber,this._indentSize),a=this._createAddLineCommentsOperations(r.lines,i.startLineNumber));let o=new x(i.positionLineNumber,i.positionColumn);for(let e=0,r=a.length;e<r;e++)n.addEditOperation(a[e].range,a[e].text),S.isEmpty(a[e].range)&&S.getStartPosition(a[e].range).equals(o)&&t.getLineContent(o.lineNumber).length+1===o.column&&(this._deltaColumn=(a[e].text||``).length);this._selectionId=n.trackSelection(i)}_attemptRemoveBlockComment(e,t,n,r){let i=t.startLineNumber,a=t.endLineNumber,o=r.length+Math.max(e.getLineFirstNonWhitespaceColumn(t.startLineNumber),t.startColumn),s=e.getLineContent(i).lastIndexOf(n,o-1),c=e.getLineContent(a).indexOf(r,t.endColumn-1-n.length);return s!==-1&&c===-1&&(c=e.getLineContent(i).indexOf(r,s+n.length),a=i),s===-1&&c!==-1&&(s=e.getLineContent(a).lastIndexOf(n,c),i=a),t.isEmpty()&&(s===-1||c===-1)&&(s=e.getLineContent(i).indexOf(n),s!==-1&&(c=e.getLineContent(i).indexOf(r,s+n.length))),s!==-1&&e.getLineContent(i).charCodeAt(s+n.length)===32&&(n+=` `),c!==-1&&e.getLineContent(a).charCodeAt(c-1)===32&&(r=` `+r,--c),s!==-1&&c!==-1?my._createRemoveBlockCommentOperations(new S(i,s+n.length+1,a,c+1),n,r):null}_executeBlockComment(e,t,n){e.tokenization.tokenizeIfCheap(n.startLineNumber);let r=e.getLanguageIdAtPosition(n.startLineNumber,1),i=this.languageConfigurationService.getLanguageConfiguration(r).comments;if(!i||!i.blockCommentStartToken||!i.blockCommentEndToken)return;let a=i.blockCommentStartToken,o=i.blockCommentEndToken,s=this._attemptRemoveBlockComment(e,n,a,o);if(!s){if(n.isEmpty()){let t=e.getLineContent(n.startLineNumber),r=St(t);r===-1&&(r=t.length),s=my._createAddBlockCommentOperations(new S(n.startLineNumber,r+1,n.startLineNumber,t.length+1),a,o,this._insertSpace)}else s=my._createAddBlockCommentOperations(new S(n.startLineNumber,e.getLineFirstNonWhitespaceColumn(n.startLineNumber),n.endLineNumber,e.getLineMaxColumn(n.endLineNumber)),a,o,this._insertSpace);s.length===1&&(this._deltaColumn=a.length+1)}this._selectionId=t.trackSelection(n);for(let e of s)t.addEditOperation(e.range,e.text)}getEditOperations(t,n){let r=this._selection;if(this._moveEndPositionDown=!1,r.startLineNumber===r.endLineNumber&&this._ignoreFirstLine){n.addEditOperation(new S(r.startLineNumber,t.getLineMaxColumn(r.startLineNumber),r.startLineNumber+1,1),r.startLineNumber===t.getLineCount()?``:`
`),this._selectionId=n.trackSelection(r);return}r.startLineNumber<r.endLineNumber&&r.endColumn===1&&(this._moveEndPositionDown=!0,r=r.setEndPosition(r.endLineNumber-1,t.getLineMaxColumn(r.endLineNumber-1)));let i=e._gatherPreflightData(this._type,this._insertSpace,t,r.startLineNumber,r.endLineNumber,this._ignoreEmptyLines,this._ignoreFirstLine,this.languageConfigurationService);return i.supported?this._executeLineComments(t,n,i,r):this._executeBlockComment(t,n,r)}computeCursorState(e,t){let n=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(n=n.setEndPosition(n.endLineNumber+1,1)),new N(n.selectionStartLineNumber,n.selectionStartColumn+this._deltaColumn,n.positionLineNumber,n.positionColumn+this._deltaColumn)}static _createRemoveLineCommentsOperations(e,t){let n=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];i.ignore||n.push(gc.delete(new S(t+r,i.commentStrOffset+1,t+r,i.commentStrOffset+i.commentStrLength+1)))}return n}_createAddLineCommentsOperations(e,t){let n=[],r=this._insertSpace?` `:``;for(let i=0,a=e.length;i<a;i++){let a=e[i];a.ignore||n.push(gc.insert(new x(t+i,a.commentStrOffset+1),a.commentStr+r))}return n}static nextVisibleColumn(e,t,n,r){return n?e+(t-e%t):e+r}static _normalizeInsertionPoint(t,n,r,i){let a=1073741824,o,s;for(let o=0,s=n.length;o<s;o++){if(n[o].ignore)continue;let s=t.getLineContent(r+o),c=0;for(let t=0,r=n[o].commentStrOffset;c<a&&t<r;t++)c=e.nextVisibleColumn(c,i,s.charCodeAt(t)===9,1);c<a&&(a=c)}a=Math.floor(a/i)*i;for(let c=0,l=n.length;c<l;c++){if(n[c].ignore)continue;let l=t.getLineContent(r+c),u=0;for(o=0,s=n[c].commentStrOffset;u<a&&o<s;o++)u=e.nextVisibleColumn(u,i,l.charCodeAt(o)===9,1);u>a?n[c].commentStrOffset=o-1:n[c].commentStrOffset=o}}},gy=class extends D{constructor(e,t){super(t),this._type=e}run(e,t){let n=e.get(Ar);if(!t.hasModel())return;let r=t.getModel(),i=[],a=r.getOptions(),o=t.getOption(29),s=t.getSelections().map((e,t)=>({selection:e,index:t,ignoreFirstLine:!1}));s.sort((e,t)=>S.compareRangesUsingStarts(e.selection,t.selection));let c=s[0];for(let e=1;e<s.length;e++){let t=s[e];c.selection.endLineNumber===t.selection.startLineNumber&&(c.index<t.index?t.ignoreFirstLine=!0:(c.ignoreFirstLine=!0,c=t))}for(let e of s)i.push(new hy(n,e.selection,a.indentSize,this._type,o.insertSpace,o.ignoreEmptyLines,e.ignoreFirstLine));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},_y=class extends gy{constructor(){super(0,{id:`editor.action.commentLine`,label:B(889,`Toggle Line Comment`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:2138,weight:100},menuOpts:{menuId:M.MenubarEditMenu,group:`5_insert`,title:H(887,`&&Toggle Line Comment`),order:1}})}},vy=class extends gy{constructor(){super(1,{id:`editor.action.addCommentLine`,label:B(890,`Add Line Comment`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2081),weight:100}})}},yy=class extends gy{constructor(){super(2,{id:`editor.action.removeCommentLine`,label:B(891,`Remove Line Comment`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2099),weight:100}})}},by=class extends D{constructor(){super({id:`editor.action.blockComment`,label:B(892,`Toggle Block Comment`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:1567,linux:{primary:3103},weight:100},menuOpts:{menuId:M.MenubarEditMenu,group:`5_insert`,title:H(888,`Toggle &&Block Comment`),order:2}})}run(e,t){let n=e.get(Ar);if(!t.hasModel())return;let r=t.getOption(29),i=[],a=t.getSelections();for(let e of a)i.push(new my(e,r.insertSpace,n));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}};s(_y),s(vy),s(yy),s(by);var xy=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Sy=function(e,t){return function(n,r){t(n,r,e)}},Cy,wy=class{static{Cy=this}static{this.ID=`editor.contrib.contextmenu`}static get(e){return e.getContribution(Cy.ID)}constructor(e,t,n,r,i,a,o,s){this._contextMenuService=t,this._contextViewService=n,this._contextKeyService=r,this._keybindingService=i,this._menuService=a,this._configurationService=o,this._workspaceContextService=s,this._toDispose=new P,this._contextMenuIsBeingShownCount=0,this._editor=e,this._toDispose.add(this._editor.onContextMenu(e=>this._onContextMenu(e))),this._toDispose.add(this._editor.onMouseWheel(e=>{if(this._contextMenuIsBeingShownCount>0){let t=this._contextViewService.getContextViewElement(),n=e.srcElement;n.shadowRoot&&pc(t)===n.shadowRoot||this._contextViewService.hideContextView()}})),this._toDispose.add(this._editor.onKeyDown(e=>{this._editor.getOption(30)&&e.keyCode===58&&(e.preventDefault(),e.stopPropagation(),this.showContextMenu())}))}_onContextMenu(e){if(!this._editor.hasModel())return;if(!this._editor.getOption(30)){this._editor.focus(),e.target.position&&!this._editor.getSelection().containsPosition(e.target.position)&&this._editor.setPosition(e.target.position);return}if(e.target.type===12||e.target.type===6&&e.target.detail.injectedText)return;if(e.event.preventDefault(),e.event.stopPropagation(),e.target.type===11)return this._showScrollbarContextMenu(e.event);if(e.target.type!==6&&e.target.type!==7&&e.target.type!==1)return;if(this._editor.focus(),e.target.position){let t=!1;for(let n of this._editor.getSelections())if(n.containsPosition(e.target.position)){t=!0;break}t||this._editor.setPosition(e.target.position)}let t=null;e.target.type!==1&&(t=e.event),this.showContextMenu(t)}showContextMenu(e){if(!this._editor.getOption(30)||!this._editor.hasModel())return;let t=this._getMenuActions(this._editor.getModel(),this._editor.contextMenuId);t.length>0&&this._doShowContextMenu(t,e)}_getMenuActions(e,t){let n=[],r=this._menuService.getMenuActions(t,this._contextKeyService,{arg:e.uri});for(let t of r){let[,r]=t,i=0;for(let t of r)if(t instanceof Zn){let r=this._getMenuActions(e,t.item.submenu);r.length>0&&(n.push(new Et(t.id,t.label,r)),i++)}else n.push(t),i++;i&&n.push(new wi)}return n.length&&n.pop(),n}_doShowContextMenu(e,t=null){if(!this._editor.hasModel())return;let n=t;if(!n){this._editor.revealPosition(this._editor.getPosition(),1),this._editor.render();let e=this._editor.getScrolledVisiblePosition(this._editor.getPosition()),t=qc(this._editor.getDomNode()),r=t.left+e.left,i=t.top+e.top+e.height;n={x:r,y:i}}let r=this._editor.getOption(143)&&!Na;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:r?this._editor.getOverflowWidgetsDomNode()??this._editor.getDomNode():void 0,getAnchor:()=>n,getActions:()=>e,getActionViewItem:e=>{let t=this._keybindingFor(e);if(t)return new Ii(e,e,{label:!0,keybinding:t.getLabel(),isMenu:!0});let n=e;return typeof n.getActionViewItem==`function`?n.getActionViewItem():new Ii(e,e,{icon:!0,label:!0,isMenu:!0})},getKeyBinding:e=>this._keybindingFor(e),onHide:e=>{this._contextMenuIsBeingShownCount--}})}_showScrollbarContextMenu(e){if(!this._editor.hasModel()||jl(this._workspaceContextService.getWorkspace()))return;let t=this._editor.getOption(81),n=0,r=e=>({id:`menu-action-${++n}`,label:e.label,tooltip:``,class:void 0,enabled:e.enabled===void 0?!0:e.enabled,checked:e.checked,run:e.run}),i=(e,t)=>new Et(`menu-action-${++n}`,e,t,void 0),a=(e,t,n,a,o)=>{if(!t)return r({label:e,enabled:t,run:()=>{}});let s=e=>()=>{this._configurationService.updateValue(n,e)},c=[];for(let e of o)c.push(r({label:e.label,checked:a===e.value,run:s(e.value)}));return i(e,c)},o=[];o.push(r({label:H(893,`Minimap`),checked:t.enabled,run:()=>{this._configurationService.updateValue(`editor.minimap.enabled`,!t.enabled)}})),o.push(new wi),o.push(r({label:H(894,`Render Characters`),enabled:t.enabled,checked:t.renderCharacters,run:()=>{this._configurationService.updateValue(`editor.minimap.renderCharacters`,!t.renderCharacters)}})),o.push(a(H(895,`Vertical size`),t.enabled,`editor.minimap.size`,t.size,[{label:H(896,`Proportional`),value:`proportional`},{label:H(897,`Fill`),value:`fill`},{label:H(898,`Fit`),value:`fit`}])),o.push(a(H(899,`Slider`),t.enabled,`editor.minimap.showSlider`,t.showSlider,[{label:H(900,`Mouse Over`),value:`mouseover`},{label:H(901,`Always`),value:`always`}]));let s=this._editor.getOption(143)&&!Na;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:s?this._editor.getDomNode():void 0,getAnchor:()=>e,getActions:()=>o,onHide:e=>{this._contextMenuIsBeingShownCount--,this._editor.focus()}})}_keybindingFor(e){return this._keybindingService.lookupKeybinding(e.id)}dispose(){this._contextMenuIsBeingShownCount>0&&this._contextViewService.hideContextView(),this._toDispose.dispose()}};wy=Cy=xy([Sy(1,Mo),Sy(2,Wl),Sy(3,w),Sy(4,zn),Sy(5,wu),Sy(6,Ni),Sy(7,yl)],wy);var Ty=class extends D{constructor(){super({id:`editor.action.showContextMenu`,label:B(902,`Show Editor Context Menu`),precondition:void 0,kbOpts:{kbExpr:F.textInputFocus,primary:1092,weight:100}})}run(e,t){wy.get(t)?.showContextMenu()}};G(wy.ID,wy,2),s(Ty);var Ey=class{constructor(e){this.selections=e}equals(e){let t=this.selections.length,n=e.selections.length;if(t!==n)return!1;for(let n=0;n<t;n++)if(!this.selections[n].equalsSelection(e.selections[n]))return!1;return!0}},Dy=class{constructor(e,t,n){this.cursorState=e,this.scrollTop=t,this.scrollLeft=n}},Oy=class e extends b{static{this.ID=`editor.contrib.cursorUndoRedoController`}static get(t){return t.getContribution(e.ID)}constructor(e){super(),this._editor=e,this._isCursorUndoRedo=!1,this._undoStack=[],this._redoStack=[],this._register(e.onDidChangeModel(e=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeModelContent(e=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeCursorSelection(t=>{if(this._isCursorUndoRedo||!t.oldSelections||t.oldModelVersionId!==t.modelVersionId)return;let n=new Ey(t.oldSelections);this._undoStack.length>0&&this._undoStack[this._undoStack.length-1].cursorState.equals(n)||(this._undoStack.push(new Dy(n,e.getScrollTop(),e.getScrollLeft())),this._redoStack=[],this._undoStack.length>50&&this._undoStack.shift())}))}cursorUndo(){!this._editor.hasModel()||this._undoStack.length===0||(this._redoStack.push(new Dy(new Ey(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._undoStack.pop()))}cursorRedo(){!this._editor.hasModel()||this._redoStack.length===0||(this._undoStack.push(new Dy(new Ey(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._redoStack.pop()))}_applyState(e){this._isCursorUndoRedo=!0,this._editor.setSelections(e.cursorState.selections),this._editor.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}),this._isCursorUndoRedo=!1}},ky=class extends D{constructor(){super({id:`cursorUndo`,label:B(903,`Cursor Undo`),precondition:void 0,kbOpts:{kbExpr:F.textInputFocus,primary:2099,weight:100}})}run(e,t,n){Oy.get(t)?.cursorUndo()}},Ay=class extends D{constructor(){super({id:`cursorRedo`,label:B(904,`Cursor Redo`),precondition:void 0})}run(e,t,n){Oy.get(t)?.cursorRedo()}};G(Oy.ID,Oy,0),s(ky),s(Ay);var jy=class{constructor(e,t,n){this.selection=e,this.targetPosition=t,this.copy=n,this.targetSelection=null}getEditOperations(e,t){let n=e.getValueInRange(this.selection);if(this.copy||t.addEditOperation(this.selection,null),t.addEditOperation(new S(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column),n),this.selection.containsPosition(this.targetPosition)&&!(this.copy&&(this.selection.getEndPosition().equals(this.targetPosition)||this.selection.getStartPosition().equals(this.targetPosition)))){this.targetSelection=this.selection;return}if(this.copy){this.targetSelection=new N(this.targetPosition.lineNumber,this.targetPosition.column,this.selection.endLineNumber-this.selection.startLineNumber+this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber>this.selection.endLineNumber){this.targetSelection=new N(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber<this.selection.endLineNumber){this.targetSelection=new N(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber+this.selection.endLineNumber-this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}this.selection.endColumn<=this.targetPosition.column?this.targetSelection=new N(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,(this.selection.startLineNumber,this.selection.endLineNumber,this.targetPosition.column-this.selection.endColumn+this.selection.startColumn),this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column:this.selection.endColumn):this.targetSelection=new N(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column+this.selection.endColumn-this.selection.startColumn)}computeCursorState(e,t){return this.targetSelection}};function My(e){return ro?e.altKey:e.ctrlKey}var Ny=class e extends b{static{this.ID=`editor.contrib.dragAndDrop`}static{this.TRIGGER_KEY_VALUE=ro?6:5}constructor(e){super(),this._editor=e,this._dndDecorationIds=this._editor.createDecorationsCollection(),this._register(this._editor.onMouseDown(e=>this._onEditorMouseDown(e))),this._register(this._editor.onMouseUp(e=>this._onEditorMouseUp(e))),this._register(this._editor.onMouseDrag(e=>this._onEditorMouseDrag(e))),this._register(this._editor.onMouseDrop(e=>this._onEditorMouseDrop(e))),this._register(this._editor.onMouseDropCanceled(()=>this._onEditorMouseDropCanceled())),this._register(this._editor.onKeyDown(e=>this.onEditorKeyDown(e))),this._register(this._editor.onKeyUp(e=>this.onEditorKeyUp(e))),this._register(this._editor.onDidBlurEditorWidget(()=>this.onEditorBlur())),this._register(this._editor.onDidBlurEditorText(()=>this.onEditorBlur())),this._mouseDown=!1,this._modifierPressed=!1,this._dragSelection=null}onEditorBlur(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1}onEditorKeyDown(e){!this._editor.getOption(42)||this._editor.getOption(28)||(My(e)&&(this._modifierPressed=!0),this._mouseDown&&My(e)&&this._editor.updateOptions({mouseStyle:`copy`}))}onEditorKeyUp(t){!this._editor.getOption(42)||this._editor.getOption(28)||(My(t)&&(this._modifierPressed=!1),this._mouseDown&&t.keyCode===e.TRIGGER_KEY_VALUE&&this._editor.updateOptions({mouseStyle:`default`}))}_onEditorMouseDown(e){this._mouseDown=!0}_onEditorMouseUp(e){this._mouseDown=!1,this._editor.updateOptions({mouseStyle:`text`})}_onEditorMouseDrag(e){let t=e.target;if(this._dragSelection===null){let e=(this._editor.getSelections()||[]).filter(e=>t.position&&e.containsPosition(t.position));if(e.length===1)this._dragSelection=e[0];else return}My(e.event)?this._editor.updateOptions({mouseStyle:`copy`}):this._editor.updateOptions({mouseStyle:`default`}),t.position&&(this._dragSelection.containsPosition(t.position)?this._removeDecoration():this.showAt(t.position))}_onEditorMouseDropCanceled(){this._editor.updateOptions({mouseStyle:`text`}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}_onEditorMouseDrop(t){if(t.target&&(this._hitContent(t.target)||this._hitMargin(t.target))&&t.target.position){let n=new x(t.target.position.lineNumber,t.target.position.column);if(this._dragSelection===null){let e=null;if(t.event.shiftKey){let t=this._editor.getSelection();if(t){let{selectionStartLineNumber:r,selectionStartColumn:i}=t;e=[new N(r,i,n.lineNumber,n.column)]}}else e=(this._editor.getSelections()||[]).map(e=>e.containsPosition(n)?new N(n.lineNumber,n.column,n.lineNumber,n.column):e);this._editor.setSelections(e||[],`mouse`,3)}else (!this._dragSelection.containsPosition(n)||(My(t.event)||this._modifierPressed)&&(this._dragSelection.getEndPosition().equals(n)||this._dragSelection.getStartPosition().equals(n)))&&(this._editor.pushUndoStop(),this._editor.executeCommand(e.ID,new jy(this._dragSelection,n,My(t.event)||this._modifierPressed)),this._editor.pushUndoStop())}this._editor.updateOptions({mouseStyle:`text`}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}static{this._DECORATION_OPTIONS=R.register({description:`dnd-target`,className:`dnd-target`})}showAt(t){this._dndDecorationIds.set([{range:new S(t.lineNumber,t.column,t.lineNumber,t.column),options:e._DECORATION_OPTIONS}]),this._editor.revealPosition(t,1)}_removeDecoration(){this._dndDecorationIds.clear()}_hitContent(e){return e.type===6||e.type===7}_hitMargin(e){return e.type===2||e.type===3||e.type===4}dispose(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1,super.dispose()}};G(Ny.ID,Ny,2),G(yp.ID,yp,0),at(Tf),L(new class extends Gi{constructor(){super({id:gp,precondition:_p,kbOpts:{weight:100,primary:2137}})}runEditorCommand(e,t){return yp.get(t)?.changePasteType()}}),L(new class extends Gi{constructor(){super({id:`editor.hidePasteWidget`,precondition:_p,kbOpts:{weight:100,primary:9}})}runEditorCommand(e,t){yp.get(t)?.clearWidgets()}}),s(class e extends D{static{this.argsSchema={oneOf:[{type:`object`,required:[`kind`],properties:{kind:{type:`string`,description:H(905,`The kind of the paste edit to try pasting with.
If there are multiple edits for this kind, the editor will show a picker. If there are no edits of this kind, the editor will show an error message.`)}}},{type:`object`,required:[`preferences`],properties:{preferences:{type:`array`,description:H(906,`List of preferred paste edit kind to try applying.
The first edit matching the preferences will be applied.`),items:{type:`string`}}}}]}}constructor(){super({id:`editor.action.pasteAs`,label:B(907,`Paste As...`),precondition:F.writable,metadata:{description:`Paste as`,args:[{name:`args`,schema:e.argsSchema}]}})}run(e,t,n){let r;return n&&(`kind`in n?r={only:new qd(n.kind)}:`preferences`in n&&(r={preferences:n.preferences.map(e=>new qd(e))})),yp.get(t)?.pasteAs(r)}}),s(class extends D{constructor(){super({id:`editor.action.pasteAsText`,label:B(908,`Paste as Text`),precondition:F.writable})}run(e,t){return yp.get(t)?.pasteAs({providerId:vf.id})}});var Py=class{constructor(){this._dragOperations=new Map}removeDragOperationTransfer(e){if(e&&this._dragOperations.has(e)){let t=this._dragOperations.get(e);return this._dragOperations.delete(e),t}}},Fy=class{constructor(e){this.identifier=e}};const Iy=dl(`treeViewsDndService`);wt(Iy,Py,1);var Ly=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ry=function(e,t){return function(n,r){t(n,r,e)}},zy;const By=`editor.changeDropType`,Vy=new T(`dropWidgetVisible`,!1,H(926,`Whether the drop widget is showing`));var Hy=class extends b{static{zy=this}static{this.ID=`editor.contrib.dropIntoEditorController`}static get(e){return e.getContribution(zy.ID)}constructor(e,t,n,r,i){super(),this._configService=n,this._languageFeaturesService=r,this._treeViewsDragAndDropService=i,this.treeItemsTransfer=Xd.getInstance(),this._dropProgressManager=this._register(t.createInstance(cf,`dropIntoEditor`,e)),this._postDropWidgetManager=this._register(t.createInstance(fp,`dropIntoEditor`,e,Vy,{id:By,label:H(927,`Show drop options...`)},()=>zy._configureDefaultAction?[zy._configureDefaultAction]:[])),this._register(e.onDropIntoEditor(t=>this.onDropIntoEditor(e,t.position,t.event)))}clearWidgets(){this._postDropWidgetManager.clear()}changeDropType(){this._postDropWidgetManager.tryShowSelector()}async onDropIntoEditor(e,t,n){if(!n.dataTransfer||!e.hasModel())return;zy._currentDropOperation?.cancel(),e.focus(),e.setPosition(t);let r=bu(async i=>{let a=new P,o=a.add(new gu(e,1,void 0,i));try{let r=await this.extractDataTransferData(n);if(r.size===0||o.token.isCancellationRequested)return;let s=e.getModel();if(!s)return;let c=this._languageFeaturesService.documentDropEditProvider.ordered(s).filter(e=>e.dropMimeTypes?e.dropMimeTypes.some(e=>r.matches(e)):!0),l=a.add(await this.getDropEdits(c,s,t,r,o.token));if(o.token.isCancellationRequested)return;if(l.edits.length){let n=this.getInitialActiveEditIndex(s,l.edits),r=e.getOption(43).showDropSelector===`afterDrop`;await this._postDropWidgetManager.applyEditAndShowIfNeeded([S.fromPositions(t)],{activeEditIndex:n,allEdits:l.edits},r,async e=>e,i)}}finally{a.dispose(),zy._currentDropOperation===r&&(zy._currentDropOperation=void 0)}});this._dropProgressManager.showWhile(t,H(928,`Running drop handlers. Click to cancel`),r,{cancel:()=>r.cancel()}),zy._currentDropOperation=r}async getDropEdits(e,t,n,r,i){let a=new P,o=await Me(Promise.all(e.map(async e=>{try{let o=await e.provideDocumentDropEdits(t,n,r,i);return o&&a.add(o),o?.edits.map(t=>({...t,providerId:e.id}))}catch(e){Pn(e)||console.error(e),console.error(e)}})),i),s=vi(o??[]).flat();return{edits:zf(s),dispose:()=>a.dispose()}}getInitialActiveEditIndex(e,t){let n=this._configService.getValue(`editor.dropIntoEditor.preferences`,{resource:e.uri});for(let e of Array.isArray(n)?n:[]){let n=new qd(e),r=t.findIndex(e=>e.kind&&n.contains(e.kind));if(r>=0)return r}return 0}async extractDataTransferData(e){if(!e.dataTransfer)return new Hd;let t=tf(e.dataTransfer);if(this.treeItemsTransfer.hasData(Fy.prototype)){let e=this.treeItemsTransfer.getData(Fy.prototype);if(Array.isArray(e))for(let n of e){let e=await this._treeViewsDragAndDropService.removeDragOperationTransfer(n.identifier);if(e)for(let[n,r]of e)t.replace(n,r)}}return t}};Hy=zy=Ly([Ry(1,k),Ry(2,Ni),Ry(3,W),Ry(4,Iy)],Hy),G(Hy.ID,Hy,2),at(wf),L(new class extends Gi{constructor(){super({id:By,precondition:Vy,kbOpts:{weight:100,primary:2137}})}runEditorCommand(e,t,n){Hy.get(t)?.changeDropType()}}),L(new class extends Gi{constructor(){super({id:`editor.hideDropWidget`,precondition:Vy,kbOpts:{weight:100,primary:9}})}runEditorCommand(e,t,n){Hy.get(t)?.clearWidgets()}});var Uy=class e{constructor(e){this._editor=e,this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null,this._startPosition=this._editor.getPosition()}dispose(){this._editor.removeDecorations(this._allDecorations()),this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}reset(){this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}getCount(){return this._decorations.length}getFindScope(){return this._findScopeDecorationIds[0]?this._editor.getModel().getDecorationRange(this._findScopeDecorationIds[0]):null}getFindScopes(){if(this._findScopeDecorationIds.length){let e=this._findScopeDecorationIds.map(e=>this._editor.getModel().getDecorationRange(e)).filter(e=>!!e);if(e.length)return e}return null}getStartPosition(){return this._startPosition}setStartPosition(e){this._startPosition=e,this.setCurrentFindMatch(null)}_getDecorationIndex(e){let t=this._decorations.indexOf(e);return t>=0?t+1:1}getDecorationRangeAt(e){let t=e<this._decorations.length?this._decorations[e]:null;return t?this._editor.getModel().getDecorationRange(t):null}getCurrentMatchesPosition(t){let n=this._editor.getModel().getDecorationsInRange(t);for(let t of n){let n=t.options;if(n===e._FIND_MATCH_DECORATION||n===e._CURRENT_FIND_MATCH_DECORATION)return this._getDecorationIndex(t.id)}return 0}setCurrentFindMatch(t){let n=null,r=0;if(t)for(let e=0,i=this._decorations.length;e<i;e++){let i=this._editor.getModel().getDecorationRange(this._decorations[e]);if(t.equalsRange(i)){n=this._decorations[e],r=e+1;break}}return(this._highlightedDecorationId!==null||n!==null)&&this._editor.changeDecorations(t=>{if(this._highlightedDecorationId!==null&&(t.changeDecorationOptions(this._highlightedDecorationId,e._FIND_MATCH_DECORATION),this._highlightedDecorationId=null),n!==null&&(this._highlightedDecorationId=n,t.changeDecorationOptions(this._highlightedDecorationId,e._CURRENT_FIND_MATCH_DECORATION)),this._rangeHighlightDecorationId!==null&&(t.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),n!==null){let r=this._editor.getModel().getDecorationRange(n);if(r.startLineNumber!==r.endLineNumber&&r.endColumn===1){let e=r.endLineNumber-1,t=this._editor.getModel().getLineMaxColumn(e);r=new S(r.startLineNumber,r.startColumn,e,t)}this._rangeHighlightDecorationId=t.addDecoration(r,e._RANGE_HIGHLIGHT_DECORATION)}}),r}set(t,n){this._editor.changeDecorations(r=>{let i=e._FIND_MATCH_DECORATION,a=[];if(t.length>1e3){i=e._FIND_MATCH_NO_OVERVIEW_DECORATION;let n=this._editor.getModel().getLineCount(),r=this._editor.getLayoutInfo().height/n,o=Math.max(2,Math.ceil(3/r)),s=t[0].range.startLineNumber,c=t[0].range.endLineNumber;for(let n=1,r=t.length;n<r;n++){let r=t[n].range;c+o>=r.startLineNumber?r.endLineNumber>c&&(c=r.endLineNumber):(a.push({range:new S(s,1,c,1),options:e._FIND_MATCH_ONLY_OVERVIEW_DECORATION}),s=r.startLineNumber,c=r.endLineNumber)}a.push({range:new S(s,1,c,1),options:e._FIND_MATCH_ONLY_OVERVIEW_DECORATION})}let o=Array(t.length);for(let e=0,n=t.length;e<n;e++)o[e]={range:t[e].range,options:i};this._decorations=r.deltaDecorations(this._decorations,o),this._overviewRulerApproximateDecorations=r.deltaDecorations(this._overviewRulerApproximateDecorations,a),this._rangeHighlightDecorationId&&=(r.removeDecoration(this._rangeHighlightDecorationId),null),this._findScopeDecorationIds.length&&(this._findScopeDecorationIds.forEach(e=>r.removeDecoration(e)),this._findScopeDecorationIds=[]),n?.length&&(this._findScopeDecorationIds=n.map(t=>r.addDecoration(t,e._FIND_SCOPE_DECORATION)))})}matchBeforePosition(e){if(this._decorations.length===0)return null;for(let t=this._decorations.length-1;t>=0;t--){let n=this._decorations[t],r=this._editor.getModel().getDecorationRange(n);if(!(!r||r.endLineNumber>e.lineNumber)&&(r.endLineNumber<e.lineNumber||!(r.endColumn>e.column)))return r}return this._editor.getModel().getDecorationRange(this._decorations[this._decorations.length-1])}matchAfterPosition(e){if(this._decorations.length===0)return null;for(let t=0,n=this._decorations.length;t<n;t++){let n=this._decorations[t],r=this._editor.getModel().getDecorationRange(n);if(!(!r||r.startLineNumber<e.lineNumber)&&(r.startLineNumber>e.lineNumber||!(r.startColumn<e.column)))return r}return this._editor.getModel().getDecorationRange(this._decorations[0])}_allDecorations(){let e=[];return e=e.concat(this._decorations),e=e.concat(this._overviewRulerApproximateDecorations),this._findScopeDecorationIds.length&&e.push(...this._findScopeDecorationIds),this._rangeHighlightDecorationId&&e.push(this._rangeHighlightDecorationId),e}static{this._CURRENT_FIND_MATCH_DECORATION=R.register({description:`current-find-match`,stickiness:1,zIndex:13,className:`currentFindMatch`,inlineClassName:`currentFindMatchInline`,showIfCollapsed:!0,overviewRuler:{color:Kt(Jr),position:En.Center},minimap:{color:Kt(ol),position:1}})}static{this._FIND_MATCH_DECORATION=R.register({description:`find-match`,stickiness:1,zIndex:10,className:`findMatch`,inlineClassName:`findMatchInline`,showIfCollapsed:!0,overviewRuler:{color:Kt(Jr),position:En.Center},minimap:{color:Kt(ol),position:1}})}static{this._FIND_MATCH_NO_OVERVIEW_DECORATION=R.register({description:`find-match-no-overview`,stickiness:1,className:`findMatch`,showIfCollapsed:!0})}static{this._FIND_MATCH_ONLY_OVERVIEW_DECORATION=R.register({description:`find-match-only-overview`,stickiness:1,overviewRuler:{color:Kt(Jr),position:En.Center}})}static{this._RANGE_HIGHLIGHT_DECORATION=R.register({description:`find-range-highlight`,stickiness:1,className:`rangeHighlight`,isWholeLine:!0})}static{this._FIND_SCOPE_DECORATION=R.register({description:`find-scope`,className:`findScope`,isWholeLine:!0})}},Wy=class{constructor(e,t,n){this._editorSelection=e,this._ranges=t,this._replaceStrings=n,this._trackedEditorSelectionId=null}getEditOperations(e,t){if(this._ranges.length>0){let e=[];for(let t=0;t<this._ranges.length;t++)e.push({range:this._ranges[t],text:this._replaceStrings[t]});e.sort((e,t)=>S.compareRangesUsingStarts(e.range,t.range));let n=[],r=e[0];for(let t=1;t<e.length;t++)r.range.endLineNumber===e[t].range.startLineNumber&&r.range.endColumn===e[t].range.startColumn?(r.range=r.range.plusRange(e[t].range),r.text+=e[t].text):(n.push(r),r=e[t]);n.push(r);for(let e of n)t.addEditOperation(e.range,e.text)}this._trackedEditorSelectionId=t.trackSelection(this._editorSelection)}computeCursorState(e,t){return t.getTrackedSelection(this._trackedEditorSelectionId)}};function Gy(e,t){if(e&&e[0]!==``){let n=Ky(e,t,`-`),r=Ky(e,t,`_`);return n&&!r?qy(e,t,`-`):!n&&r?qy(e,t,`_`):e[0].toUpperCase()===e[0]?t.toUpperCase():e[0].toLowerCase()===e[0]?t.toLowerCase():le(e[0][0])&&t.length>0?t[0].toUpperCase()+t.substr(1):e[0][0].toUpperCase()!==e[0][0]&&t.length>0?t[0].toLowerCase()+t.substr(1):t}else return t}function Ky(e,t,n){return e[0].indexOf(n)!==-1&&t.indexOf(n)!==-1&&e[0].split(n).length===t.split(n).length}function qy(e,t,n){let r=t.split(n),i=e[0].split(n),a=``;return r.forEach((e,t)=>{a+=Gy([i[t]],e)+n}),a.slice(0,-1)}var Jy=class{constructor(e){this.staticValue=e,this.kind=0}},Yy=class{constructor(e){this.pieces=e,this.kind=1}},Xy=class e{static fromStaticValue(t){return new e([Zy.staticValue(t)])}get hasReplacementPatterns(){return this._state.kind===1}constructor(e){!e||e.length===0?this._state=new Jy(``):e.length===1&&e[0].staticValue!==null?this._state=new Jy(e[0].staticValue):this._state=new Yy(e)}buildReplaceString(t,n){if(this._state.kind===0)return n?Gy(t,this._state.staticValue):this._state.staticValue;let r=``;for(let n=0,i=this._state.pieces.length;n<i;n++){let i=this._state.pieces[n];if(i.staticValue!==null){r+=i.staticValue;continue}let a=e._substitute(i.matchIndex,t);if(i.caseOps!==null&&i.caseOps.length>0){let e=[],t=i.caseOps.length,n=0;for(let r=0,o=a.length;r<o;r++){if(n>=t){e.push(a.slice(r));break}switch(i.caseOps[n]){case`U`:e.push(a[r].toUpperCase());break;case`u`:e.push(a[r].toUpperCase()),n++;break;case`L`:e.push(a[r].toLowerCase());break;case`l`:e.push(a[r].toLowerCase()),n++;break;default:e.push(a[r])}}a=e.join(``)}r+=a}return r}static _substitute(e,t){if(t===null)return``;if(e===0)return t[0];let n=``;for(;e>0;){if(e<t.length)return(t[e]||``)+n;n=String(e%10)+n,e=Math.floor(e/10)}return`$`+n}},Zy=class e{static staticValue(t){return new e(t,-1,null)}static caseOps(t,n){return new e(null,t,n)}constructor(e,t,n){this.staticValue=e,this.matchIndex=t,!n||n.length===0?this.caseOps=null:this.caseOps=n.slice(0)}},Qy=class{constructor(e){this._source=e,this._lastCharIndex=0,this._result=[],this._resultLen=0,this._currentStaticPiece=``}emitUnchanged(e){this._emitStatic(this._source.substring(this._lastCharIndex,e)),this._lastCharIndex=e}emitStatic(e,t){this._emitStatic(e),this._lastCharIndex=t}_emitStatic(e){e.length!==0&&(this._currentStaticPiece+=e)}emitMatchIndex(e,t,n){this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=Zy.staticValue(this._currentStaticPiece),this._currentStaticPiece=``),this._result[this._resultLen++]=Zy.caseOps(e,n),this._lastCharIndex=t}finalize(){return this.emitUnchanged(this._source.length),this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=Zy.staticValue(this._currentStaticPiece),this._currentStaticPiece=``),new Xy(this._result)}};function $y(e){if(!e||e.length===0)return new Xy(null);let t=[],n=new Qy(e);for(let r=0,i=e.length;r<i;r++){let a=e.charCodeAt(r);if(a===92){if(r++,r>=i)break;let a=e.charCodeAt(r);switch(a){case 92:n.emitUnchanged(r-1),n.emitStatic(`\\`,r+1);break;case 110:n.emitUnchanged(r-1),n.emitStatic(`
`,r+1);break;case 116:n.emitUnchanged(r-1),n.emitStatic(`	`,r+1);break;case 117:case 85:case 108:case 76:n.emitUnchanged(r-1),n.emitStatic(``,r+1),t.push(String.fromCharCode(a));break}continue}if(a===36){if(r++,r>=i)break;let a=e.charCodeAt(r);if(a===36){n.emitUnchanged(r-1),n.emitStatic(`$`,r+1);continue}if(a===48||a===38){n.emitUnchanged(r-1),n.emitMatchIndex(0,r+1,t),t.length=0;continue}if(49<=a&&a<=57){let o=a-48;if(r+1<i){let i=e.charCodeAt(r+1);if(48<=i&&i<=57){r++,o=o*10+(i-48),n.emitUnchanged(r-2),n.emitMatchIndex(o,r+1,t),t.length=0;continue}}n.emitUnchanged(r-1),n.emitMatchIndex(o,r+1,t),t.length=0;continue}}}return n.finalize()}const eb=new T(`findWidgetVisible`,!1);eb.toNegated();const tb=new T(`findInputFocussed`,!1),nb=new T(`replaceInputFocussed`,!1),rb={primary:545,mac:{primary:2593}},ib={primary:565,mac:{primary:2613}},ab={primary:560,mac:{primary:2608}},ob={primary:554,mac:{primary:2602}},sb={primary:558,mac:{primary:2606}},cb={StartFindAction:`actions.find`,StartFindWithSelection:`actions.findWithSelection`,StartFindWithArgs:`editor.actions.findWithArgs`,NextMatchFindAction:`editor.action.nextMatchFindAction`,PreviousMatchFindAction:`editor.action.previousMatchFindAction`,GoToMatchFindAction:`editor.action.goToMatchFindAction`,NextSelectionMatchFindAction:`editor.action.nextSelectionMatchFindAction`,PreviousSelectionMatchFindAction:`editor.action.previousSelectionMatchFindAction`,StartFindReplaceAction:`editor.action.startFindReplaceAction`,CloseFindWidgetCommand:`closeFindWidget`,ToggleCaseSensitiveCommand:`toggleFindCaseSensitive`,ToggleWholeWordCommand:`toggleFindWholeWord`,ToggleRegexCommand:`toggleFindRegex`,ToggleSearchScopeCommand:`toggleFindInSelection`,TogglePreserveCaseCommand:`togglePreserveCase`,ReplaceOneAction:`editor.action.replaceOne`,ReplaceAllAction:`editor.action.replaceAll`,SelectAllMatchesAction:`editor.action.selectAllMatches`},lb=19999;var ub=class e{constructor(e,t){this._toDispose=new P,this._editor=e,this._state=t,this._isDisposed=!1,this._startSearchingTimer=new Br,this._decorations=new Uy(e),this._toDispose.add(this._decorations),this._updateDecorationsScheduler=new ju(()=>{if(this._editor.hasModel())return this.research(!1)},100),this._toDispose.add(this._updateDecorationsScheduler),this._toDispose.add(this._editor.onDidChangeCursorPosition(e=>{(e.reason===3||e.reason===5||e.reason===6)&&this._decorations.setStartPosition(this._editor.getPosition())})),this._ignoreModelContentChanged=!1,this._toDispose.add(this._editor.onDidChangeModelContent(e=>{this._ignoreModelContentChanged||(e.isFlush&&this._decorations.reset(),this._decorations.setStartPosition(this._editor.getPosition()),this._updateDecorationsScheduler.schedule())})),this._toDispose.add(this._state.onFindReplaceStateChange(e=>this._onStateChanged(e))),this.research(!1,this._state.searchScope)}dispose(){this._isDisposed=!0,gt(this._startSearchingTimer),this._toDispose.dispose()}_onStateChanged(e){this._isDisposed||this._editor.hasModel()&&(e.searchString||e.isReplaceRevealed||e.isRegex||e.wholeWord||e.matchCase||e.searchScope)&&(this._editor.getModel().isTooLargeForSyncing()?(this._startSearchingTimer.cancel(),this._startSearchingTimer.setIfNotSet(()=>{e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor)},240)):e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor))}static _getSearchRange(e,t){return t||e.getFullModelRange()}research(e,t){let n=null;t===void 0?n=this._decorations.getFindScopes():t!==null&&(n=Array.isArray(t)?t:[t]),n!==null&&(n=n.map(e=>{if(e.startLineNumber!==e.endLineNumber){let t=e.endLineNumber;return e.endColumn===1&&--t,new S(e.startLineNumber,1,t,this._editor.getModel().getLineMaxColumn(t))}return e}));let r=this._findMatches(n,!1,lb);this._decorations.set(r,n);let i=this._editor.getSelection(),a=this._decorations.getCurrentMatchesPosition(i);if(a===0&&r.length>0){let e=Nu(r.map(e=>e.range),e=>S.compareRangesUsingStarts(e,i)>=0);a=e>0?e-1+1:a}this._state.changeMatchInfo(a,this._decorations.getCount(),void 0),e&&this._editor.getOption(50).cursorMoveOnType&&this._moveToNextMatch(this._decorations.getStartPosition())}_hasMatches(){return this._state.matchesCount>0}_cannotFind(){if(!this._hasMatches()){let e=this._decorations.getFindScope();return e&&this._editor.revealRangeInCenterIfOutsideViewport(e,0),!0}return!1}_setCurrentFindMatch(e){let t=this._decorations.setCurrentFindMatch(e);this._state.changeMatchInfo(t,this._decorations.getCount(),e),this._editor.setSelection(e),this._editor.revealRangeInCenterIfOutsideViewport(e,0)}_prevSearchPosition(e){let t=this._state.isRegex&&(this._state.searchString.indexOf(`^`)>=0||this._state.searchString.indexOf(`$`)>=0),{lineNumber:n,column:r}=e,i=this._editor.getModel();return t||r===1?(n===1?n=i.getLineCount():n--,r=i.getLineMaxColumn(n)):r--,new x(n,r)}_moveToPrevMatch(t,n=!1){if(!this._state.canNavigateBack()){let e=this._decorations.matchAfterPosition(t);e&&this._setCurrentFindMatch(e);return}if(this._decorations.getCount()<19999){let e=this._decorations.matchBeforePosition(t);e&&e.isEmpty()&&e.getStartPosition().equals(t)&&(t=this._prevSearchPosition(t),e=this._decorations.matchBeforePosition(t)),e&&this._setCurrentFindMatch(e);return}if(this._cannotFind())return;let r=this._decorations.getFindScope(),i=e._getSearchRange(this._editor.getModel(),r);i.getEndPosition().isBefore(t)&&(t=i.getEndPosition()),t.isBefore(i.getStartPosition())&&(t=i.getEndPosition());let{lineNumber:a,column:o}=t,s=this._editor.getModel(),c=new x(a,o),l=s.findPreviousMatch(this._state.searchString,c,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(147):null,!1);if(l&&l.range.isEmpty()&&l.range.getStartPosition().equals(c)&&(c=this._prevSearchPosition(c),l=s.findPreviousMatch(this._state.searchString,c,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(147):null,!1)),l){if(!n&&!i.containsRange(l.range))return this._moveToPrevMatch(l.range.getStartPosition(),!0);this._setCurrentFindMatch(l.range)}}moveToPrevMatch(){this._moveToPrevMatch(this._editor.getSelection().getStartPosition())}_nextSearchPosition(e){let t=this._state.isRegex&&(this._state.searchString.indexOf(`^`)>=0||this._state.searchString.indexOf(`$`)>=0),{lineNumber:n,column:r}=e,i=this._editor.getModel();return t||r===i.getLineMaxColumn(n)?(n===i.getLineCount()?n=1:n++,r=1):r++,new x(n,r)}_moveToNextMatch(e){if(!this._state.canNavigateForward()){let t=this._decorations.matchBeforePosition(e);t&&this._setCurrentFindMatch(t);return}if(this._decorations.getCount()<19999){let t=this._decorations.matchAfterPosition(e);t&&t.isEmpty()&&t.getStartPosition().equals(e)&&(e=this._nextSearchPosition(e),t=this._decorations.matchAfterPosition(e)),t&&this._setCurrentFindMatch(t);return}let t=this._getNextMatch(e,!1,!0);t&&this._setCurrentFindMatch(t.range)}_getNextMatch(t,n,r,i=!1){if(this._cannotFind())return null;let a=this._decorations.getFindScope(),o=e._getSearchRange(this._editor.getModel(),a);o.getEndPosition().isBefore(t)&&(t=o.getStartPosition()),t.isBefore(o.getStartPosition())&&(t=o.getStartPosition());let{lineNumber:s,column:c}=t,l=this._editor.getModel(),u=new x(s,c),d=l.findNextMatch(this._state.searchString,u,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(147):null,n);return r&&d&&d.range.isEmpty()&&d.range.getStartPosition().equals(u)&&(u=this._nextSearchPosition(u),d=l.findNextMatch(this._state.searchString,u,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(147):null,n)),d?!i&&!o.containsRange(d.range)?this._getNextMatch(d.range.getEndPosition(),n,r,!0):d:null}moveToNextMatch(){this._moveToNextMatch(this._editor.getSelection().getEndPosition())}_moveToMatch(e){let t=this._decorations.getDecorationRangeAt(e);t&&this._setCurrentFindMatch(t)}moveToMatch(e){this._moveToMatch(e)}_getReplacePattern(){return this._state.isRegex?$y(this._state.replaceString):Xy.fromStaticValue(this._state.replaceString)}replace(){if(!this._hasMatches())return;let e=this._getReplacePattern(),t=this._editor.getSelection(),n=this._getNextMatch(t.getStartPosition(),!0,!1);if(n)if(t.equalsRange(n.range)){let r=e.buildReplaceString(n.matches,this._state.preserveCase),i=new io(t,r);this._executeEditorCommand(`replace`,i),this._decorations.setStartPosition(new x(t.startLineNumber,t.startColumn+r.length)),this.research(!0)}else this._decorations.setStartPosition(this._editor.getPosition()),this._setCurrentFindMatch(n.range)}_findMatches(t,n,r){let i=(t||[null]).map(t=>e._getSearchRange(this._editor.getModel(),t));return this._editor.getModel().findMatches(this._state.searchString,i,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(147):null,n,r)}replaceAll(){if(!this._hasMatches())return;let e=this._decorations.getFindScopes();e===null&&this._state.matchesCount>=19999?this._largeReplaceAll():this._regularReplaceAll(e),this.research(!1)}_largeReplaceAll(){let e=new Ys(this._state.searchString,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(147):null).parseSearchRequest();if(!e)return;let t=e.regex;if(!t.multiline){let e=`mu`;t.ignoreCase&&(e+=`i`),t.global&&(e+=`g`),t=new RegExp(t.source,e)}let n=this._editor.getModel(),r=n.getValue(1),i=n.getFullModelRange(),a=this._getReplacePattern(),o,s=this._state.preserveCase;o=a.hasReplacementPatterns||s?r.replace(t,function(){return a.buildReplaceString(arguments,s)}):r.replace(t,a.buildReplaceString(null,s));let c=new ic(i,o,this._editor.getSelection());this._executeEditorCommand(`replaceAll`,c)}_regularReplaceAll(e){let t=this._getReplacePattern(),n=this._findMatches(e,t.hasReplacementPatterns||this._state.preserveCase,1073741824),r=[];for(let e=0,i=n.length;e<i;e++)r[e]=t.buildReplaceString(n[e].matches,this._state.preserveCase);let i=new Wy(this._editor.getSelection(),n.map(e=>e.range),r);this._executeEditorCommand(`replaceAll`,i)}selectAllMatches(){if(!this._hasMatches())return;let e=this._decorations.getFindScopes(),t=this._findMatches(e,!1,1073741824).map(e=>new N(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn)),n=this._editor.getSelection();for(let e=0,r=t.length;e<r;e++)if(t[e].equalsRange(n)){t=[n].concat(t.slice(0,e),t.slice(e+1));break}this._editor.setSelections(t)}_executeEditorCommand(e,t){try{this._ignoreModelContentChanged=!0,this._editor.pushUndoStop(),this._editor.executeCommand(e,t),this._editor.pushUndoStop()}finally{this._ignoreModelContentChanged=!1}}},db=class e extends Au{static{this.ID=`editor.contrib.findOptionsWidget`}constructor(e,t,n){super(),this._hideSoon=this._register(new ju(()=>this._hide(),2e3)),this._isVisible=!1,this._editor=e,this._state=t,this._keybindingService=n,this._domNode=document.createElement(`div`),this._domNode.className=`findOptionsWidget`,this._domNode.style.display=`none`,this._domNode.style.top=`10px`,this._domNode.style.zIndex=`12`,this._domNode.setAttribute(`role`,`presentation`),this._domNode.setAttribute(`aria-hidden`,`true`);let r={inputActiveOptionBorder:C(yi),inputActiveOptionForeground:C(xt),inputActiveOptionBackground:C(ce)},i=this._register(fl());this.caseSensitive=this._register(new Qa({appendTitle:this._keybindingLabelFor(cb.ToggleCaseSensitiveCommand),isChecked:this._state.matchCase,hoverDelegate:i,...r})),this._domNode.appendChild(this.caseSensitive.domNode),this._register(this.caseSensitive.onChange(()=>{this._state.change({matchCase:this.caseSensitive.checked},!1)})),this.wholeWords=this._register(new Gr({appendTitle:this._keybindingLabelFor(cb.ToggleWholeWordCommand),isChecked:this._state.wholeWord,hoverDelegate:i,...r})),this._domNode.appendChild(this.wholeWords.domNode),this._register(this.wholeWords.onChange(()=>{this._state.change({wholeWord:this.wholeWords.checked},!1)})),this.regex=this._register(new Iu({appendTitle:this._keybindingLabelFor(cb.ToggleRegexCommand),isChecked:this._state.isRegex,hoverDelegate:i,...r})),this._domNode.appendChild(this.regex.domNode),this._register(this.regex.onChange(()=>{this._state.change({isRegex:this.regex.checked},!1)})),this._editor.addOverlayWidget(this),this._register(this._state.onFindReplaceStateChange(e=>{let t=!1;e.isRegex&&(this.regex.checked=this._state.isRegex,t=!0),e.wholeWord&&(this.wholeWords.checked=this._state.wholeWord,t=!0),e.matchCase&&(this.caseSensitive.checked=this._state.matchCase,t=!0),!this._state.isRevealed&&t&&this._revealTemporarily()})),this._register(U(this._domNode,Eo.MOUSE_LEAVE,e=>this._onMouseLeave())),this._register(U(this._domNode,`mouseover`,e=>this._onMouseOver()))}_keybindingLabelFor(e){let t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:``}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return e.ID}getDomNode(){return this._domNode}getPosition(){return{preference:0}}highlightFindOptions(){this._revealTemporarily()}_revealTemporarily(){this._show(),this._hideSoon.schedule()}_onMouseLeave(){this._hideSoon.schedule()}_onMouseOver(){this._hideSoon.cancel()}_show(){this._isVisible||(this._isVisible=!0,this._domNode.style.display=`block`)}_hide(){this._isVisible&&(this._isVisible=!1,this._domNode.style.display=`none`)}};function fb(e,t){return e===1?!0:e===2?!1:t}var pb=class extends b{get searchString(){return this._searchString}get replaceString(){return this._replaceString}get isRevealed(){return this._isRevealed}get isReplaceRevealed(){return this._isReplaceRevealed}get isRegex(){return fb(this._isRegexOverride,this._isRegex)}get wholeWord(){return fb(this._wholeWordOverride,this._wholeWord)}get matchCase(){return fb(this._matchCaseOverride,this._matchCase)}get preserveCase(){return fb(this._preserveCaseOverride,this._preserveCase)}get actualIsRegex(){return this._isRegex}get actualWholeWord(){return this._wholeWord}get actualMatchCase(){return this._matchCase}get actualPreserveCase(){return this._preserveCase}get searchScope(){return this._searchScope}get matchesPosition(){return this._matchesPosition}get matchesCount(){return this._matchesCount}get currentMatch(){return this._currentMatch}constructor(){super(),this._onFindReplaceStateChange=this._register(new E),this.onFindReplaceStateChange=this._onFindReplaceStateChange.event,this._searchString=``,this._replaceString=``,this._isRevealed=!1,this._isReplaceRevealed=!1,this._isRegex=!1,this._isRegexOverride=0,this._wholeWord=!1,this._wholeWordOverride=0,this._matchCase=!1,this._matchCaseOverride=0,this._preserveCase=!1,this._preserveCaseOverride=0,this._searchScope=null,this._matchesPosition=0,this._matchesCount=0,this._currentMatch=null,this._loop=!0,this._isSearching=!1,this._filters=null}changeMatchInfo(e,t,n){let r={moveCursor:!1,updateHistory:!1,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1},i=!1;t===0&&(e=0),e>t&&(e=t),this._matchesPosition!==e&&(this._matchesPosition=e,r.matchesPosition=!0,i=!0),this._matchesCount!==t&&(this._matchesCount=t,r.matchesCount=!0,i=!0),n!==void 0&&(S.equalsRange(this._currentMatch,n)||(this._currentMatch=n,r.currentMatch=!0,i=!0)),i&&this._onFindReplaceStateChange.fire(r)}change(e,t,n=!0){let r={moveCursor:t,updateHistory:n,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1},i=!1,a=this.isRegex,o=this.wholeWord,s=this.matchCase,c=this.preserveCase;e.searchString!==void 0&&this._searchString!==e.searchString&&(this._searchString=e.searchString,r.searchString=!0,i=!0),e.replaceString!==void 0&&this._replaceString!==e.replaceString&&(this._replaceString=e.replaceString,r.replaceString=!0,i=!0),e.isRevealed!==void 0&&this._isRevealed!==e.isRevealed&&(this._isRevealed=e.isRevealed,r.isRevealed=!0,i=!0),e.isReplaceRevealed!==void 0&&this._isReplaceRevealed!==e.isReplaceRevealed&&(this._isReplaceRevealed=e.isReplaceRevealed,r.isReplaceRevealed=!0,i=!0),e.isRegex!==void 0&&(this._isRegex=e.isRegex),e.wholeWord!==void 0&&(this._wholeWord=e.wholeWord),e.matchCase!==void 0&&(this._matchCase=e.matchCase),e.preserveCase!==void 0&&(this._preserveCase=e.preserveCase),e.searchScope!==void 0&&(e.searchScope?.every(e=>this._searchScope?.some(t=>!S.equalsRange(t,e)))||(this._searchScope=e.searchScope,r.searchScope=!0,i=!0)),e.loop!==void 0&&this._loop!==e.loop&&(this._loop=e.loop,r.loop=!0,i=!0),e.isSearching!==void 0&&this._isSearching!==e.isSearching&&(this._isSearching=e.isSearching,r.isSearching=!0,i=!0),e.filters!==void 0&&(this._filters?this._filters.update(e.filters):this._filters=e.filters,r.filters=!0,i=!0),this._isRegexOverride=e.isRegexOverride===void 0?0:e.isRegexOverride,this._wholeWordOverride=e.wholeWordOverride===void 0?0:e.wholeWordOverride,this._matchCaseOverride=e.matchCaseOverride===void 0?0:e.matchCaseOverride,this._preserveCaseOverride=e.preserveCaseOverride===void 0?0:e.preserveCaseOverride,a!==this.isRegex&&(i=!0,r.isRegex=!0),o!==this.wholeWord&&(i=!0,r.wholeWord=!0),s!==this.matchCase&&(i=!0,r.matchCase=!0),c!==this.preserveCase&&(i=!0,r.preserveCase=!0),i&&this._onFindReplaceStateChange.fire(r)}canNavigateBack(){return this.canNavigateInLoop()||this.matchesPosition!==1}canNavigateForward(){return this.canNavigateInLoop()||this.matchesPosition<this.matchesCount}canNavigateInLoop(){return this._loop||this.matchesCount>=19999}},mb=H(5,`input`),hb=H(6,`Preserve Case`),gb=class extends ni{constructor(e){super({icon:J.preserveCase,title:hb+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??Jt(`element`),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}},_b=class extends Au{get onDidOptionChange(){return this._onDidOptionChange.event}get onKeyDown(){return this._onKeyDown.event}get onPreserveCaseKeyDown(){return this._onPreserveCaseKeyDown.event}constructor(e,t,n,r){super(),this._showOptionButtons=n,this.fixFocusOnOptionClickEnabled=!0,this.cachedOptionsWidth=0,this._onDidOptionChange=this._register(new E),this._onKeyDown=this._register(new E),this._onMouseDown=this._register(new E),this._onInput=this._register(new E),this._onKeyUp=this._register(new E),this._onPreserveCaseKeyDown=this._register(new E),this.contextViewProvider=t,this.placeholder=r.placeholder||``,this.validation=r.validation,this.label=r.label||mb;let i=r.appendPreserveCaseLabel||``,a=r.history||new Set([]),o=!!r.flexibleHeight,s=!!r.flexibleWidth,c=r.flexibleMaxHeight;this.domNode=document.createElement(`div`),this.domNode.classList.add(`monaco-findInput`),this.inputBox=this._register(new Ju(this.domNode,this.contextViewProvider,{ariaLabel:this.label||``,placeholder:this.placeholder||``,validationOptions:{validation:this.validation},history:a,showHistoryHint:r.showHistoryHint,flexibleHeight:o,flexibleWidth:s,flexibleMaxHeight:c,inputBoxStyles:r.inputBoxStyles})),this.preserveCase=this._register(new gb({appendTitle:i,isChecked:!1,...r.toggleStyles})),this._register(this.preserveCase.onChange(e=>{this._onDidOptionChange.fire(e),!e&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.preserveCase.onKeyDown(e=>{this._onPreserveCaseKeyDown.fire(e)})),this._showOptionButtons?this.cachedOptionsWidth=this.preserveCase.width():this.cachedOptionsWidth=0;let u=[this.preserveCase.domNode];this.onkeydown(this.domNode,e=>{if(e.equals(15)||e.equals(17)||e.equals(9)){let t=u.indexOf(this.domNode.ownerDocument.activeElement);if(t>=0){let n=-1;e.equals(17)?n=(t+1)%u.length:e.equals(15)&&(n=t===0?u.length-1:t-1),e.equals(9)?(u[t].blur(),this.inputBox.focus()):n>=0&&u[n].focus(),l.stop(e,!0)}}});let d=document.createElement(`div`);d.className=`controls`,d.style.display=this._showOptionButtons?`block`:`none`,d.appendChild(this.preserveCase.domNode),this.domNode.appendChild(d),e?.appendChild(this.domNode),this.onkeydown(this.inputBox.inputElement,e=>this._onKeyDown.fire(e)),this.onkeyup(this.inputBox.inputElement,e=>this._onKeyUp.fire(e)),this.oninput(this.inputBox.inputElement,e=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,e=>this._onMouseDown.fire(e))}enable(){this.domNode.classList.remove(`disabled`),this.inputBox.enable(),this.preserveCase.enable()}disable(){this.domNode.classList.add(`disabled`),this.inputBox.disable(),this.preserveCase.disable()}setEnabled(e){e?this.enable():this.disable()}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getPreserveCase(){return this.preserveCase.checked}setPreserveCase(e){this.preserveCase.checked=e}focusOnPreserve(){this.preserveCase.focus()}validate(){this.inputBox?.validate()}set width(e){this.inputBox.paddingRight=this.cachedOptionsWidth,this.domNode.style.width=e+`px`}dispose(){super.dispose()}},vb=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},yb=function(e,t){return function(n,r){t(n,r,e)}};const bb=new T(`suggestWidgetVisible`,!1,H(1681,`Whether suggestion are visible`));var xb=`historyNavigationWidgetFocus`,Sb=`historyNavigationForwardsEnabled`,Cb=`historyNavigationBackwardsEnabled`,wb=void 0,Tb=[];function Eb(e,t){if(Tb.includes(t))throw Error(`Cannot register the same widget multiple times`);Tb.push(t);let n=new P,r=new T(xb,!1).bindTo(e),i=new T(Sb,!0).bindTo(e),a=new T(Cb,!0).bindTo(e),o=()=>{r.set(!0),wb=t},s=()=>{r.set(!1),wb===t&&(wb=void 0)};return Ou(t.element)&&o(),n.add(t.onDidFocus(()=>o())),n.add(t.onDidBlur(()=>s())),n.add(pl(()=>{Tb.splice(Tb.indexOf(t),1),s()})),{historyNavigationForwardsEnablement:i,historyNavigationBackwardsEnablement:a,dispose(){n.dispose()}}}var Db=class extends mu{constructor(e,t,n,r){super(e,t,n);let i=this._register(r.createScoped(this.inputBox.element));this._register(Eb(i,this.inputBox))}};Db=vb([yb(3,w)],Db);var Ob=class extends _b{constructor(e,t,n,r,i=!1){super(e,t,i,n);let a=this._register(r.createScoped(this.inputBox.element));this._register(Eb(a,this.inputBox))}};Ob=vb([yb(3,w)],Ob),zs.registerCommandAndKeybindingRule({id:`history.showPrevious`,weight:200,when:j.and(j.has(xb),j.equals(Cb,!0),j.not(`isComposing`),bb.isEqualTo(!1)),primary:16,secondary:[528],handler:e=>{wb?.showPreviousValue()}}),zs.registerCommandAndKeybindingRule({id:`history.showNext`,weight:200,when:j.and(j.has(xb),j.equals(Sb,!0),j.not(`isComposing`),bb.isEqualTo(!1)),primary:18,secondary:[530],handler:e=>{wb?.showNextValue()}});function kb(e){return e.lookupKeybinding(`history.showPrevious`)?.getElectronAccelerator()===`Up`&&e.lookupKeybinding(`history.showNext`)?.getElectronAccelerator()===`Down`}var Ab=No(`find-collapsed`,J.chevronRight,H(948,`Icon to indicate that the editor find widget is collapsed.`)),jb=No(`find-expanded`,J.chevronDown,H(949,`Icon to indicate that the editor find widget is expanded.`));const Mb=No(`find-selection`,J.selection,H(950,`Icon for 'Find in Selection' in the editor find widget.`)),Nb=No(`find-replace`,J.replace,H(951,`Icon for 'Replace' in the editor find widget.`)),Pb=No(`find-replace-all`,J.replaceAll,H(952,`Icon for 'Replace All' in the editor find widget.`)),Fb=No(`find-previous-match`,J.arrowUp,H(953,`Icon for 'Find Previous' in the editor find widget.`)),Ib=No(`find-next-match`,J.arrowDown,H(954,`Icon for 'Find Next' in the editor find widget.`));var Lb=H(955,`Find / Replace`),Rb=H(956,`Find`),zb=H(957,`Find`),Bb=H(958,`Previous Match`),Vb=H(959,`Next Match`),Hb=H(960,`Find in Selection`),Ub=H(961,`Close`),Wb=H(962,`Replace`),Gb=H(963,`Replace`),Kb=H(964,`Replace`),qb=H(965,`Replace All`),Jb=H(966,`Toggle Replace`),Yb=H(967,`Only the first {0} results are highlighted, but all find operations work on the entire text.`,lb);const Xb=H(968,`{0} of {1}`),Zb=H(969,`No results`);var Qb=69,$b=ro?256:2048,ex=class{constructor(e){this.afterLineNumber=e,this.heightInPx=33,this.suppressMouseDown=!1,this.domNode=document.createElement(`div`),this.domNode.className=`dock-find-viewzone`}};function tx(e,t,n){let r=!!t.match(/\n/);if(n&&r&&n.selectionStart>0){e.stopPropagation();return}}function nx(e,t,n){let r=!!t.match(/\n/);if(n&&r&&n.selectionEnd<n.value.length){e.stopPropagation();return}}var rx=class e extends Au{static{this.ID=`editor.contrib.findWidget`}constructor(e,t,n,r,i,a,o,s,c){super(),this._hoverService=o,this._findWidgetSearchHistory=s,this._replaceWidgetHistory=c,this._cachedHeight=null,this._revealTimeouts=[],this._codeEditor=e,this._controller=t,this._state=n,this._contextViewProvider=r,this._keybindingService=i,this._contextKeyService=a,this._isVisible=!1,this._isReplaceVisible=!1,this._ignoreChangeEvent=!1,this._updateHistoryDelayer=new qa(500),this._register(pl(()=>this._updateHistoryDelayer.cancel())),this._register(this._state.onFindReplaceStateChange(e=>this._onStateChanged(e))),this._buildDomNode(),this._updateButtons(),this._tryUpdateWidgetWidth(),this._findInput.inputBox.layout(),this._register(this._codeEditor.onDidChangeConfiguration(e=>{if(e.hasChanged(103)&&(this._codeEditor.getOption(103)&&this._state.change({isReplaceRevealed:!1},!1),this._updateButtons()),e.hasChanged(164)&&this._tryUpdateWidgetWidth(),e.hasChanged(2)&&this.updateAccessibilitySupport(),e.hasChanged(50)){let e=this._codeEditor.getOption(50).loop;this._state.change({loop:e},!1);let t=this._codeEditor.getOption(50).addExtraSpaceOnTop;t&&!this._viewZone&&(this._viewZone=new ex(0),this._showViewZone()),!t&&this._viewZone&&this._removeViewZone()}})),this.updateAccessibilitySupport(),this._register(this._codeEditor.onDidChangeCursorSelection(()=>{this._isVisible&&this._updateToggleSelectionFindButton()})),this._register(this._codeEditor.onDidFocusEditorWidget(async()=>{if(this._isVisible){let e=await this._controller.getGlobalBufferTerm();e&&e!==this._state.searchString&&(this._state.change({searchString:e},!1),this._findInput.select())}})),this._findInputFocused=tb.bindTo(a),this._findFocusTracker=this._register(Ms(this._findInput.inputBox.inputElement)),this._register(this._findFocusTracker.onDidFocus(()=>{this._findInputFocused.set(!0),this._updateSearchScope()})),this._register(this._findFocusTracker.onDidBlur(()=>{this._findInputFocused.set(!1)})),this._replaceInputFocused=nb.bindTo(a),this._replaceFocusTracker=this._register(Ms(this._replaceInput.inputBox.inputElement)),this._register(this._replaceFocusTracker.onDidFocus(()=>{this._replaceInputFocused.set(!0),this._updateSearchScope()})),this._register(this._replaceFocusTracker.onDidBlur(()=>{this._replaceInputFocused.set(!1)})),this._codeEditor.addOverlayWidget(this),this._codeEditor.getOption(50).addExtraSpaceOnTop&&(this._viewZone=new ex(0)),this._register(this._codeEditor.onDidChangeModel(()=>{this._isVisible&&(this._viewZoneId=void 0)})),this._register(this._codeEditor.onDidScrollChange(e=>{if(e.scrollTopChanged){this._layoutViewZone();return}setTimeout(()=>{this._layoutViewZone()},0)}))}getId(){return e.ID}getDomNode(){return this._domNode}getPosition(){return this._isVisible?{preference:0}:null}_onStateChanged(e){if(e.searchString){try{this._ignoreChangeEvent=!0,this._findInput.setValue(this._state.searchString)}finally{this._ignoreChangeEvent=!1}this._updateButtons()}if(e.replaceString&&(this._replaceInput.inputBox.value=this._state.replaceString),e.isRevealed&&(this._state.isRevealed?this._reveal():this._hide(!0)),e.isReplaceRevealed&&(this._state.isReplaceRevealed?!this._codeEditor.getOption(103)&&!this._isReplaceVisible&&(this._isReplaceVisible=!0,this._replaceInput.width=ba(this._findInput.domNode),this._updateButtons(),this._replaceInput.inputBox.layout()):this._isReplaceVisible&&(this._isReplaceVisible=!1,this._updateButtons())),(e.isRevealed||e.isReplaceRevealed)&&(this._state.isRevealed||this._state.isReplaceRevealed)&&this._tryUpdateHeight()&&this._showViewZone(),e.isRegex&&this._findInput.setRegex(this._state.isRegex),e.wholeWord&&this._findInput.setWholeWords(this._state.wholeWord),e.matchCase&&this._findInput.setCaseSensitive(this._state.matchCase),e.preserveCase&&this._replaceInput.setPreserveCase(this._state.preserveCase),e.searchScope&&(this._state.searchScope?this._toggleSelectionFind.checked=!0:this._toggleSelectionFind.checked=!1,this._updateToggleSelectionFindButton()),e.searchString||e.matchesCount||e.matchesPosition){let e=this._state.searchString.length>0&&this._state.matchesCount===0;this._domNode.classList.toggle(`no-results`,e),this._updateMatchesCount(),this._updateButtons()}(e.searchString||e.currentMatch)&&this._layoutViewZone(),e.updateHistory&&this._delayedUpdateHistory(),e.loop&&this._updateButtons()}_delayedUpdateHistory(){this._updateHistoryDelayer.trigger(this._updateHistory.bind(this)).then(void 0,rr)}_updateHistory(){this._state.searchString&&this._findInput.inputBox.addToHistory(),this._state.replaceString&&this._replaceInput.inputBox.addToHistory()}_updateMatchesCount(){this._matchesCount.style.minWidth=Qb+`px`,this._state.matchesCount>=19999?this._matchesCount.title=Yb:this._matchesCount.title=``,this._matchesCount.firstChild?.remove();let e;if(this._state.matchesCount>0){let t=String(this._state.matchesCount);this._state.matchesCount>=19999&&(t+=`+`);let n=String(this._state.matchesPosition);n===`0`&&(n=`?`),e=ci(Xb,n,t)}else e=Zb;this._matchesCount.appendChild(document.createTextNode(e)),Xi(this._getAriaLabel(e,this._state.currentMatch,this._state.searchString)),Qb=Math.max(Qb,this._matchesCount.clientWidth)}_getAriaLabel(e,t,n){if(e===Zb)return n===``?H(970,`{0} found`,e):H(971,`{0} found for '{1}'`,e,n);if(t){let r=H(972,`{0} found for '{1}', at {2}`,e,n,t.startLineNumber+`:`+t.startColumn),i=this._codeEditor.getModel();return i&&t.startLineNumber<=i.getLineCount()&&t.startLineNumber>=1?`${i.getLineContent(t.startLineNumber)}, ${r}`:r}return H(973,`{0} found for '{1}'`,e,n)}_updateToggleSelectionFindButton(){let e=this._codeEditor.getSelection(),t=e?e.startLineNumber!==e.endLineNumber||e.startColumn!==e.endColumn:!1,n=this._toggleSelectionFind.checked;this._isVisible&&(n||t)?this._toggleSelectionFind.enable():this._toggleSelectionFind.disable()}_updateButtons(){this._findInput.setEnabled(this._isVisible),this._replaceInput.setEnabled(this._isVisible&&this._isReplaceVisible),this._updateToggleSelectionFindButton(),this._closeBtn.setEnabled(this._isVisible);let e=this._state.searchString.length>0,t=!!this._state.matchesCount;this._prevBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateBack()),this._nextBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateForward()),this._replaceBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._replaceAllBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._domNode.classList.toggle(`replaceToggled`,this._isReplaceVisible),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);let n=!this._codeEditor.getOption(103);this._toggleReplaceBtn.setEnabled(this._isVisible&&n)}_reveal(){if(this._revealTimeouts.forEach(e=>{clearTimeout(e)}),this._revealTimeouts=[],!this._isVisible){this._isVisible=!0;let e=this._codeEditor.getSelection();switch(this._codeEditor.getOption(50).autoFindInSelection){case`always`:this._toggleSelectionFind.checked=!0;break;case`never`:this._toggleSelectionFind.checked=!1;break;case`multiline`:{let t=!!e&&e.startLineNumber!==e.endLineNumber;this._toggleSelectionFind.checked=t;break}default:break}this._tryUpdateWidgetWidth(),this._updateButtons(),this._revealTimeouts.push(setTimeout(()=>{this._domNode.classList.add(`visible`),this._domNode.setAttribute(`aria-hidden`,`false`)},0)),this._revealTimeouts.push(setTimeout(()=>{this._findInput.validate()},200)),this._codeEditor.layoutOverlayWidget(this);let t=!0;if(this._codeEditor.getOption(50).seedSearchStringFromSelection&&e){let n=this._codeEditor.getDomNode();if(n){let r=qc(n),i=this._codeEditor.getScrolledVisiblePosition(e.getStartPosition()),a=r.left+(i?i.left:0),o=i?i.top:0;if(this._viewZone&&o<this._viewZone.heightInPx){e.endLineNumber>e.startLineNumber&&(t=!1);let n=cs(this._domNode).left;a>n&&(t=!1);let i=this._codeEditor.getScrolledVisiblePosition(e.getEndPosition());r.left+(i?i.left:0)>n&&(t=!1)}}}this._showViewZone(t)}}_hide(e){this._revealTimeouts.forEach(e=>{clearTimeout(e)}),this._revealTimeouts=[],this._isVisible&&(this._isVisible=!1,this._updateButtons(),this._domNode.classList.remove(`visible`),this._domNode.setAttribute(`aria-hidden`,`true`),this._findInput.clearMessage(),e&&this._codeEditor.focus(),this._codeEditor.layoutOverlayWidget(this),this._removeViewZone())}_layoutViewZone(e){if(!this._codeEditor.getOption(50).addExtraSpaceOnTop){this._removeViewZone();return}if(!this._isVisible)return;let t=this._viewZone;this._viewZoneId!==void 0||!t||this._codeEditor.changeViewZones(n=>{t.heightInPx=this._getHeight(),this._viewZoneId=n.addZone(t),this._codeEditor.setScrollTop(e||this._codeEditor.getScrollTop()+t.heightInPx)})}_showViewZone(e=!0){if(!this._isVisible||!this._codeEditor.getOption(50).addExtraSpaceOnTop)return;this._viewZone===void 0&&(this._viewZone=new ex(0));let t=this._viewZone;this._codeEditor.changeViewZones(n=>{if(this._viewZoneId!==void 0){let r=this._getHeight();if(r===t.heightInPx)return;let i=r-t.heightInPx;t.heightInPx=r,n.layoutZone(this._viewZoneId),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+i);return}else{let r=this._getHeight();if(r-=this._codeEditor.getOption(95).top,r<=0)return;t.heightInPx=r,this._viewZoneId=n.addZone(t),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+r)}})}_removeViewZone(){this._codeEditor.changeViewZones(e=>{this._viewZoneId!==void 0&&(e.removeZone(this._viewZoneId),this._viewZoneId=void 0,this._viewZone&&=(this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()-this._viewZone.heightInPx),void 0))})}_tryUpdateWidgetWidth(){if(!this._isVisible||!this._domNode.isConnected)return;let e=this._codeEditor.getLayoutInfo();if(e.contentWidth<=0){this._domNode.classList.add(`hiddenEditor`);return}else this._domNode.classList.contains(`hiddenEditor`)&&this._domNode.classList.remove(`hiddenEditor`);let t=e.width,n=e.minimap.minimapWidth,r=!1,i=!1,a=!1;if(this._resized&&ba(this._domNode)>419){this._domNode.style.maxWidth=`${t-28-n-15}px`,this._replaceInput.width=ba(this._findInput.domNode);return}if(447+n>=t&&(i=!0),447+n-Qb>=t&&(a=!0),447+n-Qb>=t+50&&(r=!0),this._domNode.classList.toggle(`collapsed-find-widget`,r),this._domNode.classList.toggle(`narrow-find-widget`,a),this._domNode.classList.toggle(`reduced-find-widget`,i),!a&&!r&&(this._domNode.style.maxWidth=`${t-28-n-15}px`),this._findInput.layout({collapsedFindWidget:r,narrowFindWidget:a,reducedFindWidget:i}),this._resized){let e=this._findInput.inputBox.element.clientWidth;e>0&&(this._replaceInput.width=e)}else this._isReplaceVisible&&(this._replaceInput.width=ba(this._findInput.domNode))}_getHeight(){let e=0;return e+=4,e+=this._findInput.inputBox.height+2,this._isReplaceVisible&&(e+=4,e+=this._replaceInput.inputBox.height+2),e+=4,e}_tryUpdateHeight(){let e=this._getHeight();return this._cachedHeight!==null&&this._cachedHeight===e?!1:(this._cachedHeight=e,this._domNode.style.height=`${e}px`,!0)}focusFindInput(){this._findInput.select(),this._findInput.focus()}focusReplaceInput(){this._replaceInput.select(),this._replaceInput.focus()}highlightFindOptions(){this._findInput.highlightFindOptions()}_updateSearchScope(){if(this._codeEditor.hasModel()&&this._toggleSelectionFind.checked){let e=this._codeEditor.getSelections();e.map(e=>{e.endColumn===1&&e.endLineNumber>e.startLineNumber&&(e=e.setEndPosition(e.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(e.endLineNumber-1)));let t=this._state.currentMatch;return e.startLineNumber!==e.endLineNumber&&!S.equalsRange(e,t)?e:null}).filter(e=>!!e),e.length&&this._state.change({searchScope:e},!0)}}_onFindInputMouseDown(e){e.middleButton&&e.stopPropagation()}_onFindInputKeyDown(e){if(e.equals($b|3))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._findInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(2)){this._isReplaceVisible?this._replaceInput.focus():this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(2066)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(16))return tx(e,this._findInput.getValue(),this._findInput.domNode.querySelector(`textarea`));if(e.equals(18))return nx(e,this._findInput.getValue(),this._findInput.domNode.querySelector(`textarea`))}_onReplaceInputKeyDown(e){if(e.equals($b|3))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._replaceInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(2)){this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(1026)){this._findInput.focus(),e.preventDefault();return}if(e.equals(2066)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(16))return tx(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector(`textarea`));if(e.equals(18))return nx(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector(`textarea`))}getVerticalSashLeft(e){return 0}_keybindingLabelFor(e){let t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:``}_buildDomNode(){let e=this._codeEditor.getOption(50).history,t=this._codeEditor.getOption(50).replaceHistory;this._findInput=this._register(new Db(null,this._contextViewProvider,{width:221,label:Rb,placeholder:zb,appendCaseSensitiveLabel:this._keybindingLabelFor(cb.ToggleCaseSensitiveCommand),appendWholeWordsLabel:this._keybindingLabelFor(cb.ToggleWholeWordCommand),appendRegexLabel:this._keybindingLabelFor(cb.ToggleRegexCommand),validation:e=>{if(e.length===0||!this._findInput.getRegex())return null;try{return new RegExp(e,`gu`),null}catch(e){return{content:e.message}}},flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showCommonFindToggles:!0,showHistoryHint:()=>kb(this._keybindingService),inputBoxStyles:Nr,toggleStyles:Ti,history:e===`workspace`?this._findWidgetSearchHistory:new Set([])},this._contextKeyService)),this._findInput.setRegex(!!this._state.isRegex),this._findInput.setCaseSensitive(!!this._state.matchCase),this._findInput.setWholeWords(!!this._state.wholeWord),this._register(this._findInput.onKeyDown(e=>{e.equals(3)&&!this._codeEditor.getOption(50).findOnType&&this._state.change({searchString:this._findInput.getValue()},!0),this._onFindInputKeyDown(e)})),this._register(this._findInput.inputBox.onDidChange(()=>{this._ignoreChangeEvent||!this._codeEditor.getOption(50).findOnType||this._state.change({searchString:this._findInput.getValue()},!0)})),this._register(this._findInput.onDidOptionChange(()=>{this._state.change({isRegex:this._findInput.getRegex(),wholeWord:this._findInput.getWholeWords(),matchCase:this._findInput.getCaseSensitive()},!0)})),this._register(this._findInput.onCaseSensitiveKeyDown(e=>{e.equals(1026)&&this._isReplaceVisible&&(this._replaceInput.focus(),e.preventDefault())})),this._register(this._findInput.onRegexKeyDown(e=>{e.equals(2)&&this._isReplaceVisible&&(this._replaceInput.focusOnPreserve(),e.preventDefault())})),this._register(this._findInput.inputBox.onDidHeightChange(e=>{this._tryUpdateHeight()&&this._showViewZone()})),Ic&&this._register(this._findInput.onMouseDown(e=>this._onFindInputMouseDown(e))),this._matchesCount=document.createElement(`div`),this._matchesCount.className=`matchesCount`,this._updateMatchesCount();let n=this._register(fl());this._prevBtn=this._register(new ix({label:Bb+this._keybindingLabelFor(cb.PreviousMatchFindAction),icon:Fb,hoverDelegate:n,onTrigger:()=>{xa(this._codeEditor.getAction(cb.PreviousMatchFindAction)).run().then(void 0,rr)}},this._hoverService)),this._nextBtn=this._register(new ix({label:Vb+this._keybindingLabelFor(cb.NextMatchFindAction),icon:Ib,hoverDelegate:n,onTrigger:()=>{xa(this._codeEditor.getAction(cb.NextMatchFindAction)).run().then(void 0,rr)}},this._hoverService));let r=document.createElement(`div`);r.className=`find-part`,r.appendChild(this._findInput.domNode);let i=document.createElement(`div`);i.className=`find-actions`,r.appendChild(i),i.appendChild(this._matchesCount),i.appendChild(this._prevBtn.domNode),i.appendChild(this._nextBtn.domNode),this._toggleSelectionFind=this._register(new ni({icon:Mb,title:Hb+this._keybindingLabelFor(cb.ToggleSearchScopeCommand),isChecked:!1,hoverDelegate:n,inputActiveOptionBackground:C(ce),inputActiveOptionBorder:C(yi),inputActiveOptionForeground:C(xt)})),this._register(this._toggleSelectionFind.onChange(()=>{if(this._toggleSelectionFind.checked){if(this._codeEditor.hasModel()){let e=this._codeEditor.getSelections();e=e.map(e=>(e.endColumn===1&&e.endLineNumber>e.startLineNumber&&(e=e.setEndPosition(e.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(e.endLineNumber-1))),e.isEmpty()?null:e)).filter(e=>!!e),e.length&&this._state.change({searchScope:e},!0)}}else this._state.change({searchScope:null},!0)})),i.appendChild(this._toggleSelectionFind.domNode),this._closeBtn=this._register(new ix({label:Ub+this._keybindingLabelFor(cb.CloseFindWidgetCommand),icon:Gl,hoverDelegate:n,onTrigger:()=>{this._state.change({isRevealed:!1,searchScope:null},!1)},onKeyDown:e=>{e.equals(2)&&this._isReplaceVisible&&(this._replaceBtn.isEnabled()?this._replaceBtn.focus():this._codeEditor.focus(),e.preventDefault())}},this._hoverService)),this._replaceInput=this._register(new Ob(null,void 0,{label:Wb,placeholder:Gb,appendPreserveCaseLabel:this._keybindingLabelFor(cb.TogglePreserveCaseCommand),history:t===`workspace`?this._replaceWidgetHistory:new Set([]),flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showHistoryHint:()=>kb(this._keybindingService),inputBoxStyles:Nr,toggleStyles:Ti},this._contextKeyService,!0)),this._replaceInput.setPreserveCase(!!this._state.preserveCase),this._register(this._replaceInput.onKeyDown(e=>this._onReplaceInputKeyDown(e))),this._register(this._replaceInput.inputBox.onDidChange(()=>{this._state.change({replaceString:this._replaceInput.inputBox.value},!1)})),this._register(this._replaceInput.inputBox.onDidHeightChange(e=>{this._isReplaceVisible&&this._tryUpdateHeight()&&this._showViewZone()})),this._register(this._replaceInput.onDidOptionChange(()=>{this._state.change({preserveCase:this._replaceInput.getPreserveCase()},!0)})),this._register(this._replaceInput.onPreserveCaseKeyDown(e=>{e.equals(2)&&(this._prevBtn.isEnabled()?this._prevBtn.focus():this._nextBtn.isEnabled()?this._nextBtn.focus():this._toggleSelectionFind.enabled?this._toggleSelectionFind.focus():this._closeBtn.isEnabled()&&this._closeBtn.focus(),e.preventDefault())}));let a=this._register(fl());this._replaceBtn=this._register(new ix({label:Kb+this._keybindingLabelFor(cb.ReplaceOneAction),icon:Nb,hoverDelegate:a,onTrigger:()=>{this._controller.replace()},onKeyDown:e=>{e.equals(1026)&&(this._closeBtn.focus(),e.preventDefault())}},this._hoverService)),this._replaceAllBtn=this._register(new ix({label:qb+this._keybindingLabelFor(cb.ReplaceAllAction),icon:Pb,hoverDelegate:a,onTrigger:()=>{this._controller.replaceAll()}},this._hoverService));let o=document.createElement(`div`);o.className=`replace-part`,o.appendChild(this._replaceInput.domNode);let s=document.createElement(`div`);s.className=`replace-actions`,o.appendChild(s),s.appendChild(this._replaceBtn.domNode),s.appendChild(this._replaceAllBtn.domNode),this._toggleReplaceBtn=this._register(new ix({label:Jb,className:`codicon toggle left`,onTrigger:()=>{this._state.change({isReplaceRevealed:!this._isReplaceVisible},!1),this._isReplaceVisible&&(this._replaceInput.width=ba(this._findInput.domNode),this._replaceInput.inputBox.layout()),this._showViewZone()}},this._hoverService)),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible),this._domNode=document.createElement(`div`),this._domNode.className=`editor-widget find-widget`,this._domNode.setAttribute(`aria-hidden`,`true`),this._domNode.ariaLabel=Lb,this._domNode.role=`dialog`,this._domNode.style.width=`419px`,this._domNode.appendChild(this._toggleReplaceBtn.domNode),this._domNode.appendChild(r),this._domNode.appendChild(this._closeBtn.domNode),this._domNode.appendChild(o),this._resizeSash=this._register(new el(this._domNode,this,{orientation:0,size:2})),this._resized=!1;let c=419;this._register(this._resizeSash.onDidStart(()=>{c=ba(this._domNode)})),this._register(this._resizeSash.onDidChange(e=>{this._resized=!0;let t=c+e.startX-e.currentX;if(t<419)return;let n=parseFloat(Lo(this._domNode).maxWidth)||0;t>n||(this._domNode.style.width=`${t}px`,this._isReplaceVisible&&(this._replaceInput.width=ba(this._findInput.domNode)),this._findInput.inputBox.layout(),this._tryUpdateHeight())})),this._register(this._resizeSash.onDidReset(()=>{let e=ba(this._domNode);if(e<419)return;let t=419;if(!this._resized||e===419){let e=this._codeEditor.getLayoutInfo();t=e.width-28-e.minimap.minimapWidth-15,this._resized=!0}this._domNode.style.width=`${t}px`,this._isReplaceVisible&&(this._replaceInput.width=ba(this._findInput.domNode)),this._findInput.inputBox.layout()}))}updateAccessibilitySupport(){let e=this._codeEditor.getOption(2);this._findInput.setFocusInputOnOptionClick(e!==2)}getViewState(){let e=!1;return this._viewZone&&this._viewZoneId&&(e=this._viewZone.heightInPx>this._codeEditor.getScrollTop()),{widgetViewZoneVisible:e,scrollTop:this._codeEditor.getScrollTop()}}setViewState(e){e&&e.widgetViewZoneVisible&&this._layoutViewZone(e.scrollTop)}},ix=class extends Au{constructor(e,t){super(),this._opts=e;let n=`button`;this._opts.className&&(n=n+` `+this._opts.className),this._opts.icon&&(n=n+` `+X.asClassName(this._opts.icon)),this._domNode=document.createElement(`div`),this._domNode.tabIndex=0,this._domNode.className=n,this._domNode.setAttribute(`role`,`button`),this._domNode.setAttribute(`aria-label`,this._opts.label),this._register(t.setupManagedHover(e.hoverDelegate??Jt(`element`),this._domNode,this._opts.label)),this.onclick(this._domNode,e=>{this._opts.onTrigger(),e.preventDefault()}),this.onkeydown(this._domNode,e=>{if(e.equals(10)||e.equals(3)){this._opts.onTrigger(),e.preventDefault();return}this._opts.onKeyDown?.(e)})}get domNode(){return this._domNode}isEnabled(){return this._domNode.tabIndex>=0}focus(){this._domNode.focus()}setEnabled(e){this._domNode.classList.toggle(`disabled`,!e),this._domNode.setAttribute(`aria-disabled`,String(!e)),this._domNode.tabIndex=e?0:-1}setExpanded(e){this._domNode.setAttribute(`aria-expanded`,String(!!e)),e?(this._domNode.classList.remove(...X.asClassNameArray(Ab)),this._domNode.classList.add(...X.asClassNameArray(jb))):(this._domNode.classList.remove(...X.asClassNameArray(jb)),this._domNode.classList.add(...X.asClassNameArray(Ab)))}};ul((e,t)=>{let n=e.getColor(ys);n&&t.addRule(`.monaco-editor .findMatch { border: 1px ${je(e.type)?`dotted`:`solid`} ${n}; box-sizing: border-box; }`);let r=e.getColor(Fc);r&&t.addRule(`.monaco-editor .findScope { border: 1px ${je(e.type)?`dashed`:`solid`} ${r}; }`);let i=e.getColor(js);i&&t.addRule(`.monaco-editor .find-widget { border: 1px solid ${i}; }`);let a=e.getColor(Cc);a&&t.addRule(`.monaco-editor .findMatchInline { color: ${a}; }`);let o=e.getColor(ja);o&&t.addRule(`.monaco-editor .currentFindMatchInline { color: ${o}; }`)});var ax=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ox=function(e,t){return function(n,r){t(n,r,e)}},sx,cx=class{static{sx=this}static{this.FIND_HISTORY_KEY=`workbench.find.history`}static{this._instance=null}static getOrCreate(e){return sx._instance||=new sx(e),sx._instance}constructor(e){this.storageService=e,this.inMemoryValues=new Set,this._onDidChangeEmitter=new E,this.onDidChange=this._onDidChangeEmitter.event,this.load()}delete(e){let t=this.inMemoryValues.delete(e);return this.save(),t}add(e){return this.inMemoryValues.add(e),this.save(),this}has(e){return this.inMemoryValues.has(e)}forEach(e,t){return this.load(),this.inMemoryValues.forEach(e)}replace(e){this.inMemoryValues=new Set(e),this.save()}load(){let e,t=this.storageService.get(sx.FIND_HISTORY_KEY,1);if(t)try{e=JSON.parse(t)}catch{}this.inMemoryValues=new Set(e||[])}save(){let e=[];return this.inMemoryValues.forEach(t=>e.push(t)),new Promise(t=>{this.storageService.store(sx.FIND_HISTORY_KEY,JSON.stringify(e),1,0),this._onDidChangeEmitter.fire(e),t()})}};cx=sx=ax([ox(0,Mu)],cx);var lx=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ux=function(e,t){return function(n,r){t(n,r,e)}},dx,fx=class{static{dx=this}static{this.FIND_HISTORY_KEY=`workbench.replace.history`}static{this._instance=null}static getOrCreate(e){return dx._instance||=new dx(e),dx._instance}constructor(e){this.storageService=e,this.inMemoryValues=new Set,this._onDidChangeEmitter=new E,this.onDidChange=this._onDidChangeEmitter.event,this.load()}delete(e){let t=this.inMemoryValues.delete(e);return this.save(),t}add(e){return this.inMemoryValues.add(e),this.save(),this}has(e){return this.inMemoryValues.has(e)}forEach(e,t){return this.load(),this.inMemoryValues.forEach(e)}replace(e){this.inMemoryValues=new Set(e),this.save()}load(){let e,t=this.storageService.get(dx.FIND_HISTORY_KEY,1);if(t)try{e=JSON.parse(t)}catch{}this.inMemoryValues=new Set(e||[])}save(){let e=[];return this.inMemoryValues.forEach(t=>e.push(t)),new Promise(t=>{this.storageService.store(dx.FIND_HISTORY_KEY,JSON.stringify(e),1,0),this._onDidChangeEmitter.fire(e),t()})}};fx=dx=lx([ux(0,Mu)],fx);var px=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},mx=function(e,t){return function(n,r){t(n,r,e)}},hx;function gx(e,t=`single`,n=!1){if(!e.hasModel())return null;let r=e.getSelection();if(t===`single`&&r.startLineNumber===r.endLineNumber||t===`multiple`){if(r.isEmpty()){let t=e.getConfiguredWordAtPosition(r.getStartPosition());if(t&&!1===n)return t.word}else if(e.getModel().getValueLengthInRange(r)<524288)return e.getModel().getValueInRange(r)}return null}var _x=class extends b{static{hx=this}static{this.ID=`editor.contrib.findController`}get editor(){return this._editor}static get(e){return e.getContribution(hx.ID)}constructor(e,t,n,r,i,a){super(),this._editor=e,this._findWidgetVisible=eb.bindTo(t),this._contextKeyService=t,this._storageService=n,this._clipboardService=r,this._notificationService=i,this._hoverService=a,this._updateHistoryDelayer=new qa(500),this._state=this._register(new pb),this.loadQueryState(),this._register(this._state.onFindReplaceStateChange(e=>this._onStateChanged(e))),this._model=null,this._register(this._editor.onDidChangeModel(()=>{let e=this._editor.getModel()&&this._state.isRevealed;this.disposeModel(),this._state.change({searchScope:null,matchCase:this._storageService.getBoolean(`editor.matchCase`,1,!1),wholeWord:this._storageService.getBoolean(`editor.wholeWord`,1,!1),isRegex:this._storageService.getBoolean(`editor.isRegex`,1,!1),preserveCase:this._storageService.getBoolean(`editor.preserveCase`,1,!1)},!1),e&&this._start({forceRevealReplace:!1,seedSearchStringFromSelection:`none`,seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!1,updateSearchScope:!1,loop:this._editor.getOption(50).loop})}))}dispose(){this.disposeModel(),super.dispose()}disposeModel(){this._model&&=(this._model.dispose(),null)}_onStateChanged(e){this.saveQueryState(e),e.isRevealed&&(this._state.isRevealed?this._findWidgetVisible.set(!0):(this._findWidgetVisible.reset(),this.disposeModel())),e.searchString&&this.setGlobalBufferTerm(this._state.searchString)}saveQueryState(e){e.isRegex&&this._storageService.store(`editor.isRegex`,this._state.actualIsRegex,1,1),e.wholeWord&&this._storageService.store(`editor.wholeWord`,this._state.actualWholeWord,1,1),e.matchCase&&this._storageService.store(`editor.matchCase`,this._state.actualMatchCase,1,1),e.preserveCase&&this._storageService.store(`editor.preserveCase`,this._state.actualPreserveCase,1,1)}loadQueryState(){this._state.change({matchCase:this._storageService.getBoolean(`editor.matchCase`,1,this._state.matchCase),wholeWord:this._storageService.getBoolean(`editor.wholeWord`,1,this._state.wholeWord),isRegex:this._storageService.getBoolean(`editor.isRegex`,1,this._state.isRegex),preserveCase:this._storageService.getBoolean(`editor.preserveCase`,1,this._state.preserveCase)},!1)}isFindInputFocused(){return!!tb.getValue(this._contextKeyService)}getState(){return this._state}closeFindWidget(){this._state.change({isRevealed:!1,searchScope:null},!1),this._editor.focus()}toggleCaseSensitive(){this._state.change({matchCase:!this._state.matchCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleWholeWords(){this._state.change({wholeWord:!this._state.wholeWord},!1),this._state.isRevealed||this.highlightFindOptions()}toggleRegex(){this._state.change({isRegex:!this._state.isRegex},!1),this._state.isRevealed||this.highlightFindOptions()}togglePreserveCase(){this._state.change({preserveCase:!this._state.preserveCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleSearchScope(){if(this._state.searchScope)this._state.change({searchScope:null},!0);else if(this._editor.hasModel()){let e=this._editor.getSelections();e=e.map(e=>(e.endColumn===1&&e.endLineNumber>e.startLineNumber&&(e=e.setEndPosition(e.endLineNumber-1,this._editor.getModel().getLineMaxColumn(e.endLineNumber-1))),e.isEmpty()?null:e)).filter(e=>!!e),e.length&&this._state.change({searchScope:e},!0)}}setSearchString(e){this._state.isRegex&&(e=bi(e)),this._state.change({searchString:e},!1)}highlightFindOptions(e=!1){}async _start(e,t){if(this.disposeModel(),!this._editor.hasModel())return;let n={...t,isRevealed:!0};if(e.seedSearchStringFromSelection===`single`){let t=gx(this._editor,e.seedSearchStringFromSelection,e.seedSearchStringFromNonEmptySelection);t&&(this._state.isRegex?n.searchString=bi(t):n.searchString=t)}else if(e.seedSearchStringFromSelection===`multiple`&&!e.updateSearchScope){let t=gx(this._editor,e.seedSearchStringFromSelection);t&&(n.searchString=t)}if(!n.searchString&&e.seedSearchStringFromGlobalClipboard){let e=await this.getGlobalBufferTerm();if(!this._editor.hasModel())return;e&&(n.searchString=e)}if(e.forceRevealReplace||n.isReplaceRevealed?n.isReplaceRevealed=!0:this._findWidgetVisible.get()||(n.isReplaceRevealed=!1),e.updateSearchScope){let e=this._editor.getSelections();e.some(e=>!e.isEmpty())&&(n.searchScope=e)}n.loop=e.loop,this._state.change(n,!1),this._model||=new ub(this._editor,this._state)}start(e,t){return this._start(e,t)}moveToNextMatch(){return this._model?(this._model.moveToNextMatch(),!0):!1}moveToPrevMatch(){return this._model?(this._model.moveToPrevMatch(),!0):!1}goToMatch(e){return this._model?(this._model.moveToMatch(e),!0):!1}replace(){return this._model?(this._model.replace(),!0):!1}replaceAll(){return this._model?this._editor.getModel()?.isTooLargeForHeapOperation()?(this._notificationService.warn(H(932,`The file is too large to perform a replace all operation.`)),!1):(this._model.replaceAll(),!0):!1}selectAllMatches(){return this._model?(this._model.selectAllMatches(),this._editor.focus(),!0):!1}async getGlobalBufferTerm(){return this._editor.getOption(50).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()?this._clipboardService.readFindText():``}setGlobalBufferTerm(e){this._editor.getOption(50).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()&&this._clipboardService.writeFindText(e)}};_x=hx=px([mx(1,w),mx(2,Mu),mx(3,zt),mx(4,nt),mx(5,Ac)],_x);var vx=class extends _x{constructor(e,t,n,r,i,a,o,s){super(e,n,a,o,i,s),this._contextViewService=t,this._keybindingService=r,this._widget=null,this._findOptionsWidget=null,this._findWidgetSearchHistory=cx.getOrCreate(a),this._replaceWidgetHistory=fx.getOrCreate(a)}async _start(e,t){this._widget||this._createFindWidget();let n=this._editor.getSelection(),r=!1;switch(this._editor.getOption(50).autoFindInSelection){case`always`:r=!0;break;case`never`:r=!1;break;case`multiline`:r=!!n&&n.startLineNumber!==n.endLineNumber;break;default:break}e.updateSearchScope=e.updateSearchScope||r,await super._start(e,t),this._widget&&(e.shouldFocus===2?this._widget.focusReplaceInput():e.shouldFocus===1&&this._widget.focusFindInput())}highlightFindOptions(e=!1){this._widget||this._createFindWidget(),this._state.isRevealed&&!e?this._widget.highlightFindOptions():this._findOptionsWidget.highlightFindOptions()}_createFindWidget(){this._widget=this._register(new rx(this._editor,this,this._state,this._contextViewService,this._keybindingService,this._contextKeyService,this._hoverService,this._findWidgetSearchHistory,this._replaceWidgetHistory)),this._findOptionsWidget=this._register(new db(this._editor,this._state,this._keybindingService))}saveViewState(){return this._widget?.getViewState()}restoreViewState(e){this._widget?.setViewState(e)}};vx=px([mx(1,Wl),mx(2,w),mx(3,zn),mx(4,nt),mx(5,Mu),mx(6,zt),mx(7,Ac)],vx),Ds(new vr({id:cb.StartFindAction,label:B(939,`Find`),precondition:j.or(F.focus,j.has(`editorIsOpen`)),kbOpts:{kbExpr:null,primary:2084,weight:100},menuOpts:{menuId:M.MenubarEditMenu,group:`3_find`,title:H(933,`&&Find`),order:1}})).addImplementation(0,(e,t,n)=>{let r=_x.get(t);return r?r.start({forceRevealReplace:!1,seedSearchStringFromSelection:t.getOption(50).seedSearchStringFromSelection===`never`?`none`:`single`,seedSearchStringFromNonEmptySelection:t.getOption(50).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:t.getOption(50).globalFindClipboard,shouldFocus:1,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}):!1});var yx={description:`Open a new In-Editor Find Widget.`,args:[{name:`Open a new In-Editor Find Widget args`,schema:{properties:{searchString:{type:`string`},replaceString:{type:`string`},isRegex:{type:`boolean`},matchWholeWord:{type:`boolean`},isCaseSensitive:{type:`boolean`},preserveCase:{type:`boolean`},findInSelection:{type:`boolean`}}}}]},bx=class extends D{constructor(){super({id:cb.StartFindWithArgs,label:B(940,`Find with Arguments`),precondition:void 0,kbOpts:{kbExpr:null,primary:0,weight:100},metadata:yx})}async run(e,t,n){let r=_x.get(t);if(r){let e=n?{searchString:n.searchString,replaceString:n.replaceString,isReplaceRevealed:n.replaceString!==void 0,isRegex:n.isRegex,wholeWord:n.matchWholeWord,matchCase:n.isCaseSensitive,preserveCase:n.preserveCase}:{};await r.start({forceRevealReplace:!1,seedSearchStringFromSelection:r.getState().searchString.length===0&&t.getOption(50).seedSearchStringFromSelection!==`never`?`single`:`none`,seedSearchStringFromNonEmptySelection:t.getOption(50).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:!0,shouldFocus:1,shouldAnimate:!0,updateSearchScope:n?.findInSelection||!1,loop:t.getOption(50).loop},e),r.setGlobalBufferTerm(r.getState().searchString)}}},xx=class extends D{constructor(){super({id:cb.StartFindWithSelection,label:B(941,`Find with Selection`),precondition:void 0,kbOpts:{kbExpr:null,primary:0,mac:{primary:2083},weight:100}})}async run(e,t){let n=_x.get(t);n&&(await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:`multiple`,seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}),n.setGlobalBufferTerm(n.getState().searchString))}},Sx=class extends D{async run(e,t){let n=_x.get(t);n&&!this._run(n)&&(await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:n.getState().searchString.length===0&&t.getOption(50).seedSearchStringFromSelection!==`never`?`single`:`none`,seedSearchStringFromNonEmptySelection:t.getOption(50).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:!0,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}),this._run(n))}},Cx=class extends Sx{constructor(){super({id:cb.NextMatchFindAction,label:B(942,`Find Next`),precondition:void 0,kbOpts:[{kbExpr:F.focus,primary:61,mac:{primary:2085,secondary:[61]},weight:100},{kbExpr:j.and(F.focus,tb),primary:3,weight:100}]})}_run(e){return e.moveToNextMatch()?(e.editor.pushUndoStop(),!0):!1}},wx=class extends Sx{constructor(){super({id:cb.PreviousMatchFindAction,label:B(943,`Find Previous`),precondition:void 0,kbOpts:[{kbExpr:F.focus,primary:1085,mac:{primary:3109,secondary:[1085]},weight:100},{kbExpr:j.and(F.focus,tb),primary:1027,weight:100}]})}_run(e){return e.moveToPrevMatch()}},Tx=class extends D{constructor(){super({id:cb.GoToMatchFindAction,label:B(944,`Go to Match...`),precondition:eb}),this._highlightDecorations=[]}run(e,t,n){let r=_x.get(t);if(!r)return;let i=r.getState().matchesCount;if(i<1){e.get(nt).notify({severity:Lt.Warning,message:H(934,`No matches. Try searching for something else.`)});return}let a=e.get(xe),o=new P,s=o.add(a.createInputBox());s.placeholder=H(935,`Type a number to go to a specific match (between 1 and {0})`,i);let c=e=>{let t=parseInt(e);if(isNaN(t))return;let n=r.getState().matchesCount;if(t>0&&t<=n)return t-1;if(t<0&&t>=-n)return n+t},l=e=>{let n=c(e);if(typeof n==`number`){s.validationMessage=void 0,r.goToMatch(n);let e=r.getState().currentMatch;e&&this.addDecorations(t,e)}else s.validationMessage=H(936,`Please type a number between 1 and {0}`,r.getState().matchesCount),this.clearDecorations(t)};o.add(s.onDidChangeValue(e=>{l(e)})),o.add(s.onDidAccept(()=>{let e=c(s.value);typeof e==`number`?(r.goToMatch(e),s.hide()):s.validationMessage=H(937,`Please type a number between 1 and {0}`,r.getState().matchesCount)})),o.add(s.onDidHide(()=>{this.clearDecorations(t),o.dispose()})),s.show()}clearDecorations(e){e.changeDecorations(e=>{this._highlightDecorations=e.deltaDecorations(this._highlightDecorations,[])})}addDecorations(e,t){e.changeDecorations(e=>{this._highlightDecorations=e.deltaDecorations(this._highlightDecorations,[{range:t,options:{description:`find-match-quick-access-range-highlight`,className:`rangeHighlight`,isWholeLine:!0}},{range:t,options:{description:`find-match-quick-access-range-highlight-overview`,overviewRuler:{color:Kt(pt),position:En.Full}}}])})}},Ex=class extends D{async run(e,t){let n=_x.get(t);if(!n)return;let r=gx(t,`single`,!1);r&&n.setSearchString(r),this._run(n)||(await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:`none`,seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}),this._run(n))}},Dx=class extends Ex{constructor(){super({id:cb.NextSelectionMatchFindAction,label:B(945,`Find Next Selection`),precondition:void 0,kbOpts:{kbExpr:F.focus,primary:2109,weight:100}})}_run(e){return e.moveToNextMatch()}},Ox=class extends Ex{constructor(){super({id:cb.PreviousSelectionMatchFindAction,label:B(946,`Find Previous Selection`),precondition:void 0,kbOpts:{kbExpr:F.focus,primary:3133,weight:100}})}_run(e){return e.moveToPrevMatch()}};Ds(new vr({id:cb.StartFindReplaceAction,label:B(947,`Replace`),precondition:j.or(F.focus,j.has(`editorIsOpen`)),kbOpts:{kbExpr:null,primary:2086,mac:{primary:2596},weight:100},menuOpts:{menuId:M.MenubarEditMenu,group:`3_find`,title:H(938,`&&Replace`),order:2}})).addImplementation(0,(e,t,n)=>{if(!t.hasModel()||t.getOption(103))return!1;let r=_x.get(t);if(!r)return!1;let i=t.getSelection(),a=r.isFindInputFocused(),o=!i.isEmpty()&&i.startLineNumber===i.endLineNumber&&t.getOption(50).seedSearchStringFromSelection!==`never`&&!a,s=a||o?2:1;return r.start({forceRevealReplace:!0,seedSearchStringFromSelection:o?`single`:`none`,seedSearchStringFromNonEmptySelection:t.getOption(50).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:t.getOption(50).seedSearchStringFromSelection!==`never`,shouldFocus:s,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop})}),G(_x.ID,vx,0),s(bx),s(xx),s(Cx),s(wx),s(Tx),s(Dx),s(Ox);var kx=Gi.bindToContribution(_x.get);L(new kx({id:cb.CloseFindWidgetCommand,precondition:eb,handler:e=>e.closeFindWidget(),kbOpts:{weight:105,kbExpr:j.and(F.focus,j.not(`isComposing`)),primary:9,secondary:[1033]}})),L(new kx({id:cb.ToggleCaseSensitiveCommand,precondition:void 0,handler:e=>e.toggleCaseSensitive(),kbOpts:{weight:105,kbExpr:F.focus,primary:rb.primary,mac:rb.mac,win:rb.win,linux:rb.linux}})),L(new kx({id:cb.ToggleWholeWordCommand,precondition:void 0,handler:e=>e.toggleWholeWords(),kbOpts:{weight:105,kbExpr:F.focus,primary:ib.primary,mac:ib.mac,win:ib.win,linux:ib.linux}})),L(new kx({id:cb.ToggleRegexCommand,precondition:void 0,handler:e=>e.toggleRegex(),kbOpts:{weight:105,kbExpr:F.focus,primary:ab.primary,mac:ab.mac,win:ab.win,linux:ab.linux}})),L(new kx({id:cb.ToggleSearchScopeCommand,precondition:void 0,handler:e=>e.toggleSearchScope(),kbOpts:{weight:105,kbExpr:F.focus,primary:ob.primary,mac:ob.mac,win:ob.win,linux:ob.linux}})),L(new kx({id:cb.TogglePreserveCaseCommand,precondition:void 0,handler:e=>e.togglePreserveCase(),kbOpts:{weight:105,kbExpr:F.focus,primary:sb.primary,mac:sb.mac,win:sb.win,linux:sb.linux}})),L(new kx({id:cb.ReplaceOneAction,precondition:eb,handler:e=>e.replace(),kbOpts:{weight:105,kbExpr:F.focus,primary:3094}})),L(new kx({id:cb.ReplaceOneAction,precondition:eb,handler:e=>e.replace(),kbOpts:{weight:105,kbExpr:j.and(F.focus,nb),primary:3}})),L(new kx({id:cb.ReplaceAllAction,precondition:eb,handler:e=>e.replaceAll(),kbOpts:{weight:105,kbExpr:F.focus,primary:2563}})),L(new kx({id:cb.ReplaceAllAction,precondition:eb,handler:e=>e.replaceAll(),kbOpts:{weight:105,kbExpr:j.and(F.focus,nb),primary:void 0,mac:{primary:2051}}})),L(new kx({id:cb.SelectAllMatchesAction,precondition:eb,handler:e=>e.selectAllMatches(),kbOpts:{weight:105,kbExpr:F.focus,primary:515}}));const Ax={0:` `,1:`u`,2:`r`},jx=16777215;var Mx=4278190080,Nx=class{constructor(e){let t=Math.ceil(e/32);this._states=new Uint32Array(t)}get(e){let t=e/32|0,n=e%32;return(this._states[t]&1<<n)!=0}set(e,t){let n=e/32|0,r=e%32,i=this._states[n];t?this._states[n]=i|1<<r:this._states[n]=i&~(1<<r)}},Px=class e{constructor(e,t,n){if(e.length!==t.length||e.length>65535)throw Error(`invalid startIndexes or endIndexes size`);this._startIndexes=e,this._endIndexes=t,this._collapseStates=new Nx(e.length),this._userDefinedStates=new Nx(e.length),this._recoveredStates=new Nx(e.length),this._types=n,this._parentsComputed=!1}ensureParentIndices(){if(!this._parentsComputed){this._parentsComputed=!0;let e=[],t=(t,n)=>{let r=e[e.length-1];return this.getStartLineNumber(r)<=t&&this.getEndLineNumber(r)>=n};for(let n=0,r=this._startIndexes.length;n<r;n++){let r=this._startIndexes[n],i=this._endIndexes[n];if(r>16777215||i>16777215)throw Error(`startLineNumber or endLineNumber must not exceed `+jx);for(;e.length>0&&!t(r,i);)e.pop();let a=e.length>0?e[e.length-1]:-1;e.push(n),this._startIndexes[n]=r+((a&255)<<24),this._endIndexes[n]=i+((a&65280)<<16)}}}get length(){return this._startIndexes.length}getStartLineNumber(e){return this._startIndexes[e]&jx}getEndLineNumber(e){return this._endIndexes[e]&jx}getType(e){return this._types?this._types[e]:void 0}hasTypes(){return!!this._types}isCollapsed(e){return this._collapseStates.get(e)}setCollapsed(e,t){this._collapseStates.set(e,t)}isUserDefined(e){return this._userDefinedStates.get(e)}setUserDefined(e,t){return this._userDefinedStates.set(e,t)}isRecovered(e){return this._recoveredStates.get(e)}setRecovered(e,t){return this._recoveredStates.set(e,t)}getSource(e){return this.isUserDefined(e)?1:this.isRecovered(e)?2:0}setSource(e,t){t===1?(this.setUserDefined(e,!0),this.setRecovered(e,!1)):t===2?(this.setUserDefined(e,!1),this.setRecovered(e,!0)):(this.setUserDefined(e,!1),this.setRecovered(e,!1))}setCollapsedAllOfType(e,t){let n=!1;if(this._types)for(let r=0;r<this._types.length;r++)this._types[r]===e&&(this.setCollapsed(r,t),n=!0);return n}toRegion(e){return new Fx(this,e)}getParentIndex(e){this.ensureParentIndices();let t=((this._startIndexes[e]&Mx)>>>24)+((this._endIndexes[e]&Mx)>>>16);return t===65535?-1:t}contains(e,t){return this.getStartLineNumber(e)<=t&&this.getEndLineNumber(e)>=t}findIndex(e){let t=0,n=this._startIndexes.length;if(n===0)return-1;for(;t<n;){let r=Math.floor((t+n)/2);e<this.getStartLineNumber(r)?n=r:t=r+1}return t-1}findRange(e){let t=this.findIndex(e);if(t>=0){if(this.getEndLineNumber(t)>=e)return t;for(t=this.getParentIndex(t);t!==-1;){if(this.contains(t,e))return t;t=this.getParentIndex(t)}}return-1}toString(){let e=[];for(let t=0;t<this.length;t++)e[t]=`[${Ax[this.getSource(t)]}${this.isCollapsed(t)?`+`:`-`}] ${this.getStartLineNumber(t)}/${this.getEndLineNumber(t)}`;return e.join(`, `)}toFoldRange(e){return{startLineNumber:this._startIndexes[e]&jx,endLineNumber:this._endIndexes[e]&jx,type:this._types?this._types[e]:void 0,isCollapsed:this.isCollapsed(e),source:this.getSource(e)}}static fromFoldRanges(t){let n=t.length,r=new Uint32Array(n),i=new Uint32Array(n),a=[],o=!1;for(let e=0;e<n;e++){let n=t[e];r[e]=n.startLineNumber,i[e]=n.endLineNumber,a.push(n.type),n.type&&(o=!0)}o||(a=void 0);let s=new e(r,i,a);for(let e=0;e<n;e++)t[e].isCollapsed&&s.setCollapsed(e,!0),s.setSource(e,t[e].source);return s}static sanitizeAndMerge(e,t,n,r){n??=Number.MAX_VALUE;let i=(e,t)=>Array.isArray(e)?(n=>n<t?e[n]:void 0):(n=>n<t?e.toFoldRange(n):void 0),a=i(e,e.length),o=i(t,t.length),s=0,c=0,l=a(0),u=o(0),d=[],f,p=0,m=[];for(;l||u;){let e;if(u&&(!l||l.startLineNumber>=u.startLineNumber))l&&l.startLineNumber===u.startLineNumber?(u.source===1?e=u:(e=l,e.isCollapsed=u.isCollapsed&&(l.endLineNumber===u.endLineNumber||!r?.startsInside(l.startLineNumber+1,l.endLineNumber+1)),e.source=0),l=a(++s)):(e=u,u.isCollapsed&&u.source===0&&(e.source=2)),u=o(++c);else{let t=c,n=u;for(;;){if(!n||n.startLineNumber>l.endLineNumber){e=l;break}if(n.source===1&&n.endLineNumber>l.endLineNumber)break;n=o(++t)}l=a(++s)}if(e){for(;f&&f.endLineNumber<e.startLineNumber;)f=d.pop();e.endLineNumber>e.startLineNumber&&e.startLineNumber>p&&e.endLineNumber<=n&&(!f||f.endLineNumber>=e.endLineNumber)&&(m.push(e),p=e.startLineNumber,f&&d.push(f),f=e)}}return m}},Fx=class{constructor(e,t){this.ranges=e,this.index=t}get startLineNumber(){return this.ranges.getStartLineNumber(this.index)}get endLineNumber(){return this.ranges.getEndLineNumber(this.index)}get regionIndex(){return this.index}get parentIndex(){return this.ranges.getParentIndex(this.index)}get isCollapsed(){return this.ranges.isCollapsed(this.index)}containedBy(e){return e.startLineNumber<=this.startLineNumber&&e.endLineNumber>=this.endLineNumber}containsLine(e){return this.startLineNumber<=e&&e<=this.endLineNumber}},Ix=class{get regions(){return this._regions}get textModel(){return this._textModel}constructor(e,t){this._updateEventEmitter=new E,this.onDidChange=this._updateEventEmitter.event,this._textModel=e,this._decorationProvider=t,this._regions=new Px(new Uint32Array,new Uint32Array),this._editorDecorationIds=[]}toggleCollapseState(e){if(!e.length)return;e=e.sort((e,t)=>e.regionIndex-t.regionIndex);let t={};this._decorationProvider.changeDecorations(n=>{let r=0,i=-1,a=-1,o=e=>{for(;r<e;){let e=this._regions.getEndLineNumber(r),t=this._regions.isCollapsed(r);if(e<=i){let i=this.regions.getSource(r)!==0;n.changeDecorationOptions(this._editorDecorationIds[r],this._decorationProvider.getDecorationOption(t,e<=a,i))}t&&e>a&&(a=e),r++}};for(let n of e){let e=n.regionIndex,r=this._editorDecorationIds[e];if(r&&!t[r]){t[r]=!0,o(e);let n=!this._regions.isCollapsed(e);this._regions.setCollapsed(e,n),i=Math.max(i,this._regions.getEndLineNumber(e))}}o(this._regions.length)}),this._updateEventEmitter.fire({model:this,collapseStateChanged:e})}removeManualRanges(e){let t=[],n=t=>{for(let n of e)if(!(n.startLineNumber>t.endLineNumber||t.startLineNumber>n.endLineNumber))return!0;return!1};for(let e=0;e<this._regions.length;e++){let r=this._regions.toFoldRange(e);(r.source===0||!n(r))&&t.push(r)}this.updatePost(Px.fromFoldRanges(t))}update(e,t){let n=this._currentFoldedOrManualRanges(t),r=Px.sanitizeAndMerge(e,n,this._textModel.getLineCount(),t);this.updatePost(Px.fromFoldRanges(r))}updatePost(e){let t=[],n=-1;for(let r=0,i=e.length;r<i;r++){let i=e.getStartLineNumber(r),a=e.getEndLineNumber(r),o=e.isCollapsed(r),s=e.getSource(r)!==0,c={startLineNumber:i,startColumn:this._textModel.getLineMaxColumn(i),endLineNumber:a,endColumn:this._textModel.getLineMaxColumn(a)+1};t.push({range:c,options:this._decorationProvider.getDecorationOption(o,a<=n,s)}),o&&a>n&&(n=a)}this._decorationProvider.changeDecorations(e=>this._editorDecorationIds=e.deltaDecorations(this._editorDecorationIds,t)),this._regions=e,this._updateEventEmitter.fire({model:this})}_currentFoldedOrManualRanges(e){let t=[];for(let n=0,r=this._regions.length;n<r;n++){let r=this.regions.isCollapsed(n),i=this.regions.getSource(n);if(r||i!==0){let a=this._regions.toFoldRange(n),o=this._textModel.getDecorationRange(this._editorDecorationIds[n]);o&&(r&&e?.startsInside(o.startLineNumber+1,o.endLineNumber)&&(r=!1),t.push({startLineNumber:o.startLineNumber,endLineNumber:o.endLineNumber,type:a.type,isCollapsed:r,source:i}))}}return t}getMemento(){let e=this._currentFoldedOrManualRanges(),t=[],n=this._textModel.getLineCount();for(let r=0,i=e.length;r<i;r++){let i=e[r];if(i.startLineNumber>=i.endLineNumber||i.startLineNumber<1||i.endLineNumber>n)continue;let a=this._getLinesChecksum(i.startLineNumber+1,i.endLineNumber);t.push({startLineNumber:i.startLineNumber,endLineNumber:i.endLineNumber,isCollapsed:i.isCollapsed,source:i.source,checksum:a})}return t.length>0?t:void 0}applyMemento(e){if(!Array.isArray(e))return;let t=[],n=this._textModel.getLineCount();for(let r of e){if(r.startLineNumber>=r.endLineNumber||r.startLineNumber<1||r.endLineNumber>n)continue;let e=this._getLinesChecksum(r.startLineNumber+1,r.endLineNumber);(!r.checksum||e===r.checksum)&&t.push({startLineNumber:r.startLineNumber,endLineNumber:r.endLineNumber,type:void 0,isCollapsed:r.isCollapsed??!0,source:r.source??0})}let r=Px.sanitizeAndMerge(this._regions,t,n);this.updatePost(Px.fromFoldRanges(r))}_getLinesChecksum(e,t){return Bo(this._textModel.getLineContent(e)+this._textModel.getLineContent(t))%1e6}dispose(){this._decorationProvider.removeDecorations(this._editorDecorationIds)}getAllRegionsAtLine(e,t){let n=[];if(this._regions){let r=this._regions.findRange(e),i=1;for(;r>=0;){let e=this._regions.toRegion(r);(!t||t(e,i))&&n.push(e),i++,r=e.parentIndex}}return n}getRegionAtLine(e){if(this._regions){let t=this._regions.findRange(e);if(t>=0)return this._regions.toRegion(t)}return null}getRegionsInside(e,t){let n=[],r=e?e.regionIndex+1:0,i=e?e.endLineNumber:Number.MAX_VALUE;if(t&&t.length===2){let e=[];for(let a=r,o=this._regions.length;a<o;a++){let r=this._regions.toRegion(a);if(this._regions.getStartLineNumber(a)<i){for(;e.length>0&&!r.containedBy(e[e.length-1]);)e.pop();e.push(r),t(r,e.length)&&n.push(r)}else break}}else for(let e=r,a=this._regions.length;e<a;e++){let r=this._regions.toRegion(e);if(this._regions.getStartLineNumber(e)<i)(!t||t(r))&&n.push(r);else break}return n}};function Lx(e,t,n){let r=[];for(let i of n){let n=e.getRegionAtLine(i);if(n){let i=!n.isCollapsed;if(r.push(n),t>1){let a=e.getRegionsInside(n,(e,n)=>e.isCollapsed!==i&&n<t);r.push(...a)}}}e.toggleCollapseState(r)}function Rx(e,t,n=Number.MAX_VALUE,r){let i=[];if(r&&r.length>0)for(let a of r){let r=e.getRegionAtLine(a);if(r&&(r.isCollapsed!==t&&i.push(r),n>1)){let a=e.getRegionsInside(r,(e,r)=>e.isCollapsed!==t&&r<n);i.push(...a)}}else{let r=e.getRegionsInside(null,(e,r)=>e.isCollapsed!==t&&r<n);i.push(...r)}e.toggleCollapseState(i)}function zx(e,t,n,r){let i=[];for(let a of r){let r=e.getAllRegionsAtLine(a,(e,r)=>e.isCollapsed!==t&&r<=n);i.push(...r)}e.toggleCollapseState(i)}function Bx(e,t,n){let r=[];for(let i of n){let n=e.getAllRegionsAtLine(i,e=>e.isCollapsed!==t);n.length>0&&r.push(n[0])}e.toggleCollapseState(r)}function Vx(e,t,n,r){let i=e.getRegionsInside(null,(e,i)=>i===t&&e.isCollapsed!==n&&!r.some(t=>e.containsLine(t)));e.toggleCollapseState(i)}function Hx(e,t,n){let r=[];for(let t of n){let n=e.getAllRegionsAtLine(t,void 0);n.length>0&&r.push(n[0])}let i=e.getRegionsInside(null,e=>r.every(t=>!t.containedBy(e)&&!e.containedBy(t))&&e.isCollapsed!==t);e.toggleCollapseState(i)}function Ux(e,t,n){let r=e.textModel,i=e.regions,a=[];for(let e=i.length-1;e>=0;e--)if(n!==i.isCollapsed(e)){let n=i.getStartLineNumber(e);t.test(r.getLineContent(n))&&a.push(i.toRegion(e))}e.toggleCollapseState(a)}function Wx(e,t,n){let r=e.regions,i=[];for(let e=r.length-1;e>=0;e--)n!==r.isCollapsed(e)&&t===r.getType(e)&&i.push(r.toRegion(e));e.toggleCollapseState(i)}function Gx(e,t){let n=null,r=t.getRegionAtLine(e);if(r!==null&&(n=r.startLineNumber,e===n)){let e=r.parentIndex;n=e===-1?null:t.regions.getStartLineNumber(e)}return n}function Kx(e,t){let n=t.getRegionAtLine(e);if(n!==null&&n.startLineNumber===e){if(e!==n.startLineNumber)return n.startLineNumber;{let e=n.parentIndex,r=0;for(e!==-1&&(r=t.regions.getStartLineNumber(n.parentIndex));n!==null;)if(n.regionIndex>0){if(n=t.regions.toRegion(n.regionIndex-1),n.startLineNumber<=r)return null;if(n.parentIndex===e)return n.startLineNumber}else return null}}else if(t.regions.length>0)for(n=t.regions.toRegion(t.regions.length-1);n!==null;){if(n.startLineNumber<e)return n.startLineNumber;n=n.regionIndex>0?t.regions.toRegion(n.regionIndex-1):null}return null}function qx(e,t){let n=t.getRegionAtLine(e);if(n!==null&&n.startLineNumber===e){let e=n.parentIndex,r=0;if(e!==-1)r=t.regions.getEndLineNumber(n.parentIndex);else if(t.regions.length===0)return null;else r=t.regions.getEndLineNumber(t.regions.length-1);for(;n!==null;)if(n.regionIndex<t.regions.length){if(n=t.regions.toRegion(n.regionIndex+1),n.startLineNumber>=r)return null;if(n.parentIndex===e)return n.startLineNumber}else return null}else if(t.regions.length>0)for(n=t.regions.toRegion(0);n!==null;){if(n.startLineNumber>e)return n.startLineNumber;n=n.regionIndex<t.regions.length?t.regions.toRegion(n.regionIndex+1):null}return null}var Jx=class{get onDidChange(){return this._updateEventEmitter.event}get hiddenRanges(){return this._hiddenRanges}constructor(e){this._updateEventEmitter=new E,this._hasLineChanges=!1,this._foldingModel=e,this._foldingModelListener=e.onDidChange(e=>this.updateHiddenRanges()),this._hiddenRanges=[],e.regions.length&&this.updateHiddenRanges()}notifyChangeModelContent(e){this._hiddenRanges.length&&!this._hasLineChanges&&(this._hasLineChanges=e.changes.some(e=>e.range.endLineNumber!==e.range.startLineNumber||Xn(e.text)[0]!==0))}updateHiddenRanges(){let e=!1,t=[],n=0,r=0,i=Number.MAX_VALUE,a=-1,o=this._foldingModel.regions;for(;n<o.length;n++){if(!o.isCollapsed(n))continue;let s=o.getStartLineNumber(n)+1,c=o.getEndLineNumber(n);i<=s&&c<=a||(!e&&r<this._hiddenRanges.length&&this._hiddenRanges[r].startLineNumber===s&&this._hiddenRanges[r].endLineNumber===c?(t.push(this._hiddenRanges[r]),r++):(e=!0,t.push(new S(s,1,c,1))),i=s,a=c)}(this._hasLineChanges||e||r<this._hiddenRanges.length)&&this.applyHiddenRanges(t)}applyHiddenRanges(e){this._hiddenRanges=e,this._hasLineChanges=!1,this._updateEventEmitter.fire(e)}hasRanges(){return this._hiddenRanges.length>0}isHidden(e){return Xx(this._hiddenRanges,e)!==null}adjustSelections(e){let t=!1,n=this._foldingModel.textModel,r=null,i=e=>((!r||!Yx(e,r))&&(r=Xx(this._hiddenRanges,e)),r?r.startLineNumber-1:null);for(let r=0,a=e.length;r<a;r++){let a=e[r],o=i(a.startLineNumber);o&&(a=a.setStartPosition(o,n.getLineMaxColumn(o)),t=!0);let s=i(a.endLineNumber);s&&(a=a.setEndPosition(s,n.getLineMaxColumn(s)),t=!0),e[r]=a}return t}dispose(){this.hiddenRanges.length>0&&(this._hiddenRanges=[],this._updateEventEmitter.fire(this._hiddenRanges)),this._foldingModelListener&&=(this._foldingModelListener.dispose(),null)}};function Yx(e,t){return e>=t.startLineNumber&&e<=t.endLineNumber}function Xx(e,t){let n=Nu(e,e=>t<e.startLineNumber)-1;return n>=0&&e[n].endLineNumber>=t?e[n]:null}var Zx=5e3,Qx=`indent`,$x=class{constructor(e,t,n){this.editorModel=e,this.languageConfigurationService=t,this.foldingRangesLimit=n,this.id=Qx}dispose(){}compute(e){let t=this.languageConfigurationService.getLanguageConfiguration(this.editorModel.getLanguageId()).foldingRules,n=t&&!!t.offSide,r=t&&t.markers;return Promise.resolve(nS(this.editorModel,n,r,this.foldingRangesLimit))}},eS=class{constructor(e){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=e}insertFirst(e,t,n){if(e>16777215||t>16777215)return;let r=this._length;this._startIndexes[r]=e,this._endIndexes[r]=t,this._length++,n<1e3&&(this._indentOccurrences[n]=(this._indentOccurrences[n]||0)+1)}toIndentRanges(e){let t=this._foldingRangesLimit.limit;if(this._length<=t){this._foldingRangesLimit.update(this._length,!1);let e=new Uint32Array(this._length),t=new Uint32Array(this._length);for(let n=this._length-1,r=0;n>=0;n--,r++)e[r]=this._startIndexes[n],t[r]=this._endIndexes[n];return new Px(e,t)}else{this._foldingRangesLimit.update(this._length,t);let n=0,r=this._indentOccurrences.length;for(let e=0;e<this._indentOccurrences.length;e++){let i=this._indentOccurrences[e];if(i){if(i+n>t){r=e;break}n+=i}}let i=e.getOptions().tabSize,a=new Uint32Array(t),o=new Uint32Array(t);for(let s=this._length-1,c=0;s>=0;s--){let l=this._startIndexes[s],u=e.getLineContent(l),d=di(u,i);(d<r||d===r&&n++<t)&&(a[c]=l,o[c]=this._endIndexes[s],c++)}return new Px(a,o)}}},tS={limit:Zx,update:()=>{}};function nS(e,t,n,r=tS){let i=e.getOptions().tabSize,a=new eS(r),o;n&&(o=RegExp(`(${n.start.source})|(?:${n.end.source})`));let s=[],c=e.getLineCount()+1;s.push({indent:-1,endAbove:c,line:c});for(let n=e.getLineCount();n>0;n--){let r=e.getLineContent(n),c=di(r,i),l=s[s.length-1];if(c===-1){t&&(l.endAbove=n);continue}let u;if(o&&(u=r.match(o)))if(u[1]){let e=s.length-1;for(;e>0&&s[e].indent!==-2;)e--;if(e>0){s.length=e+1,l=s[e],a.insertFirst(n,l.line,c),l.line=n,l.indent=c,l.endAbove=n;continue}}else{s.push({indent:-2,endAbove:n,line:n});continue}if(l.indent>c){do s.pop(),l=s[s.length-1];while(l.indent>c);let e=l.endAbove-1;e-n>=1&&a.insertFirst(n,e,c)}l.indent===c?l.endAbove=n:s.push({indent:c,endAbove:n,line:n})}return a.toIndentRanges(e)}var rS=Y(`editor.foldBackground`,{light:ae(zu,.3),dark:ae(zu,.3),hcDark:null,hcLight:null},H(994,`Background color behind folded ranges. The color must not be opaque so as not to hide underlying decorations.`),!0);Y(`editor.foldPlaceholderForeground`,{light:`#808080`,dark:`#808080`,hcDark:null,hcLight:null},H(995,`Color of the collapsed text after the first line of a folded range.`)),Y(`editorGutter.foldingControlForeground`,tr,H(996,`Color of the folding control in the editor gutter.`));const iS=No(`folding-expanded`,J.chevronDown,H(997,`Icon for expanded ranges in the editor glyph margin.`)),aS=No(`folding-collapsed`,J.chevronRight,H(998,`Icon for collapsed ranges in the editor glyph margin.`)),oS=No(`folding-manual-collapsed`,aS,H(999,`Icon for manually collapsed ranges in the editor glyph margin.`)),sS=No(`folding-manual-expanded`,iS,H(1e3,`Icon for manually expanded ranges in the editor glyph margin.`));var cS={color:Kt(rS),position:1},lS=H(1001,`Click to expand the range.`),uS=H(1002,`Click to collapse the range.`),dS=class e{static{this.COLLAPSED_VISUAL_DECORATION=R.register({description:`folding-collapsed-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,isWholeLine:!0,linesDecorationsTooltip:lS,firstLineDecorationClassName:X.asClassName(aS)})}static{this.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=R.register({description:`folding-collapsed-highlighted-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,className:`folded-background`,minimap:cS,isWholeLine:!0,linesDecorationsTooltip:lS,firstLineDecorationClassName:X.asClassName(aS)})}static{this.MANUALLY_COLLAPSED_VISUAL_DECORATION=R.register({description:`folding-manually-collapsed-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,isWholeLine:!0,linesDecorationsTooltip:lS,firstLineDecorationClassName:X.asClassName(oS)})}static{this.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=R.register({description:`folding-manually-collapsed-highlighted-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,className:`folded-background`,minimap:cS,isWholeLine:!0,linesDecorationsTooltip:lS,firstLineDecorationClassName:X.asClassName(oS)})}static{this.NO_CONTROLS_COLLAPSED_RANGE_DECORATION=R.register({description:`folding-no-controls-range-decoration`,stickiness:0,afterContentClassName:`inline-folded`,isWholeLine:!0,linesDecorationsTooltip:lS})}static{this.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION=R.register({description:`folding-no-controls-range-decoration`,stickiness:0,afterContentClassName:`inline-folded`,className:`folded-background`,minimap:cS,isWholeLine:!0,linesDecorationsTooltip:lS})}static{this.EXPANDED_VISUAL_DECORATION=R.register({description:`folding-expanded-visual-decoration`,stickiness:1,isWholeLine:!0,firstLineDecorationClassName:`alwaysShowFoldIcons `+X.asClassName(iS),linesDecorationsTooltip:uS})}static{this.EXPANDED_AUTO_HIDE_VISUAL_DECORATION=R.register({description:`folding-expanded-auto-hide-visual-decoration`,stickiness:1,isWholeLine:!0,firstLineDecorationClassName:X.asClassName(iS),linesDecorationsTooltip:uS})}static{this.MANUALLY_EXPANDED_VISUAL_DECORATION=R.register({description:`folding-manually-expanded-visual-decoration`,stickiness:0,isWholeLine:!0,firstLineDecorationClassName:`alwaysShowFoldIcons `+X.asClassName(sS),linesDecorationsTooltip:uS})}static{this.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION=R.register({description:`folding-manually-expanded-auto-hide-visual-decoration`,stickiness:0,isWholeLine:!0,firstLineDecorationClassName:X.asClassName(sS),linesDecorationsTooltip:uS})}static{this.NO_CONTROLS_EXPANDED_RANGE_DECORATION=R.register({description:`folding-no-controls-range-decoration`,stickiness:0,isWholeLine:!0})}static{this.HIDDEN_RANGE_DECORATION=R.register({description:`folding-hidden-range-decoration`,stickiness:1})}constructor(e){this.editor=e,this.showFoldingControls=`mouseover`,this.showFoldingHighlights=!0}getDecorationOption(t,n,r){return n?e.HIDDEN_RANGE_DECORATION:this.showFoldingControls===`never`?t?this.showFoldingHighlights?e.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION:e.NO_CONTROLS_COLLAPSED_RANGE_DECORATION:e.NO_CONTROLS_EXPANDED_RANGE_DECORATION:t?r?this.showFoldingHighlights?e.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:e.MANUALLY_COLLAPSED_VISUAL_DECORATION:this.showFoldingHighlights?e.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:e.COLLAPSED_VISUAL_DECORATION:this.showFoldingControls===`mouseover`?r?e.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION:e.EXPANDED_AUTO_HIDE_VISUAL_DECORATION:r?e.MANUALLY_EXPANDED_VISUAL_DECORATION:e.EXPANDED_VISUAL_DECORATION}changeDecorations(e){return this.editor.changeDecorations(e)}removeDecorations(e){this.editor.removeDecorations(e)}},fS={},pS=`syntax`,mS=class{constructor(e,t,n,r,i){this.editorModel=e,this.providers=t,this.handleFoldingRangesChange=n,this.foldingRangesLimit=r,this.fallbackRangeProvider=i,this.id=pS,this.disposables=new P,i&&this.disposables.add(i);for(let e of t)typeof e.onDidChange==`function`&&this.disposables.add(e.onDidChange(n))}compute(e){return hS(this.providers,this.editorModel,e).then(t=>this.editorModel.isDisposed()?null:t?_S(t,this.foldingRangesLimit):this.fallbackRangeProvider?.compute(e)??null)}dispose(){this.disposables.dispose()}};function hS(e,t,n){let r=null,i=e.map((e,i)=>Promise.resolve(e.provideFoldingRanges(t,fS,n)).then(e=>{if(!n.isCancellationRequested&&Array.isArray(e)){Array.isArray(r)||(r=[]);let n=t.getLineCount();for(let t of e)t.start>0&&t.end>t.start&&t.end<=n&&r.push({start:t.start,end:t.end,rank:i,kind:t.kind})}},Ze));return Promise.all(i).then(e=>r)}var gS=class{constructor(e){this._startIndexes=[],this._endIndexes=[],this._nestingLevels=[],this._nestingLevelCounts=[],this._types=[],this._length=0,this._foldingRangesLimit=e}add(e,t,n,r){if(e>16777215||t>16777215)return;let i=this._length;this._startIndexes[i]=e,this._endIndexes[i]=t,this._nestingLevels[i]=r,this._types[i]=n,this._length++,r<30&&(this._nestingLevelCounts[r]=(this._nestingLevelCounts[r]||0)+1)}toIndentRanges(){let e=this._foldingRangesLimit.limit;if(this._length<=e){this._foldingRangesLimit.update(this._length,!1);let e=new Uint32Array(this._length),t=new Uint32Array(this._length);for(let n=0;n<this._length;n++)e[n]=this._startIndexes[n],t[n]=this._endIndexes[n];return new Px(e,t,this._types)}else{this._foldingRangesLimit.update(this._length,e);let t=0,n=this._nestingLevelCounts.length;for(let r=0;r<this._nestingLevelCounts.length;r++){let i=this._nestingLevelCounts[r];if(i){if(i+t>e){n=r;break}t+=i}}let r=new Uint32Array(e),i=new Uint32Array(e),a=[];for(let o=0,s=0;o<this._length;o++){let c=this._nestingLevels[o];(c<n||c===n&&t++<e)&&(r[s]=this._startIndexes[o],i[s]=this._endIndexes[o],a[s]=this._types[o],s++)}return new Px(r,i,a)}}};function _S(e,t){let n=e.sort((e,t)=>{let n=e.start-t.start;return n===0&&(n=e.rank-t.rank),n}),r=new gS(t),i,a=[];for(let e of n)if(!i)i=e,r.add(e.start,e.end,e.kind&&e.kind.value,a.length);else if(e.start>i.start)if(e.end<=i.end)a.push(i),i=e,r.add(e.start,e.end,e.kind&&e.kind.value,a.length);else{if(e.start>i.end){do i=a.pop();while(i&&e.start>i.end);i&&a.push(i),i=e}r.add(e.start,e.end,e.kind&&e.kind.value,a.length)}return r.toIndentRanges()}var vS=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},yS=function(e,t){return function(n,r){t(n,r,e)}},bS,xS=new T(`foldingEnabled`,!1),SS=class extends b{static{bS=this}static{this.ID=`editor.contrib.folding`}static get(e){return e.getContribution(bS.ID)}static getFoldingRangeProviders(e,t){let n=e.foldingRangeProvider.ordered(t);return bS._foldingRangeSelector?.(n,t)??n}constructor(e,t,n,r,i,a){super(),this.contextKeyService=t,this.languageConfigurationService=n,this.languageFeaturesService=a,this.localToDispose=this._register(new P),this.editor=e,this._foldingLimitReporter=this._register(new CS(e));let o=this.editor.getOptions();this._isEnabled=o.get(52),this._useFoldingProviders=o.get(53)!==`indentation`,this._unfoldOnClickAfterEndOfLine=o.get(57),this._restoringViewState=!1,this._currentModelHasFoldedImports=!1,this._foldingImportsByDefault=o.get(55),this.updateDebounceInfo=i.for(a.foldingRangeProvider,`Folding`,{min:200}),this.foldingModel=null,this.hiddenRangeModel=null,this.rangeProvider=null,this.foldingRegionPromise=null,this.foldingModelPromise=null,this.updateScheduler=null,this.cursorChangedScheduler=null,this.mouseDownInfo=null,this.foldingDecorationProvider=new dS(e),this.foldingDecorationProvider.showFoldingControls=o.get(125),this.foldingDecorationProvider.showFoldingHighlights=o.get(54),this.foldingEnabled=xS.bindTo(this.contextKeyService),this.foldingEnabled.set(this._isEnabled),this._register(this.editor.onDidChangeModel(()=>this.onModelChanged())),this._register(this.editor.onDidChangeConfiguration(e=>{if(e.hasChanged(52)&&(this._isEnabled=this.editor.getOptions().get(52),this.foldingEnabled.set(this._isEnabled),this.onModelChanged()),e.hasChanged(56)&&this.onModelChanged(),e.hasChanged(125)||e.hasChanged(54)){let e=this.editor.getOptions();this.foldingDecorationProvider.showFoldingControls=e.get(125),this.foldingDecorationProvider.showFoldingHighlights=e.get(54),this.triggerFoldingModelChanged()}e.hasChanged(53)&&(this._useFoldingProviders=this.editor.getOptions().get(53)!==`indentation`,this.onFoldingStrategyChanged()),e.hasChanged(57)&&(this._unfoldOnClickAfterEndOfLine=this.editor.getOptions().get(57)),e.hasChanged(55)&&(this._foldingImportsByDefault=this.editor.getOptions().get(55))})),this.onModelChanged()}saveViewState(){let e=this.editor.getModel();if(!e||!this._isEnabled||e.isTooLargeForTokenization())return{};if(this.foldingModel){let t=this.foldingModel.getMemento(),n=this.rangeProvider?this.rangeProvider.id:void 0;return{collapsedRegions:t,lineCount:e.getLineCount(),provider:n,foldedImports:this._currentModelHasFoldedImports}}}restoreViewState(e){let t=this.editor.getModel();if(!(!t||!this._isEnabled||t.isTooLargeForTokenization()||!this.hiddenRangeModel)&&e&&(this._currentModelHasFoldedImports=!!e.foldedImports,e.collapsedRegions&&e.collapsedRegions.length>0&&this.foldingModel)){this._restoringViewState=!0;try{this.foldingModel.applyMemento(e.collapsedRegions)}finally{this._restoringViewState=!1}}}onModelChanged(){this.localToDispose.clear();let e=this.editor.getModel();!this._isEnabled||!e||e.isTooLargeForTokenization()||(this._currentModelHasFoldedImports=!1,this.foldingModel=new Ix(e,this.foldingDecorationProvider),this.localToDispose.add(this.foldingModel),this.hiddenRangeModel=new Jx(this.foldingModel),this.localToDispose.add(this.hiddenRangeModel),this.localToDispose.add(this.hiddenRangeModel.onDidChange(e=>this.onHiddenRangesChanges(e))),this.updateScheduler=new qa(this.updateDebounceInfo.get(e)),this.cursorChangedScheduler=new ju(()=>this.revealCursor(),200),this.localToDispose.add(this.cursorChangedScheduler),this.localToDispose.add(this.languageFeaturesService.foldingRangeProvider.onDidChange(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelContent(e=>this.onDidChangeModelContent(e))),this.localToDispose.add(this.editor.onDidChangeCursorPosition(()=>this.onCursorPositionChanged())),this.localToDispose.add(this.editor.onMouseDown(e=>this.onEditorMouseDown(e))),this.localToDispose.add(this.editor.onMouseUp(e=>this.onEditorMouseUp(e))),this.localToDispose.add({dispose:()=>{this.foldingRegionPromise&&=(this.foldingRegionPromise.cancel(),null),this.updateScheduler?.cancel(),this.updateScheduler=null,this.foldingModel=null,this.foldingModelPromise=null,this.hiddenRangeModel=null,this.cursorChangedScheduler=null,this.rangeProvider?.dispose(),this.rangeProvider=null}}),this.triggerFoldingModelChanged())}onFoldingStrategyChanged(){this.rangeProvider?.dispose(),this.rangeProvider=null,this.triggerFoldingModelChanged()}getRangeProvider(e){if(this.rangeProvider)return this.rangeProvider;let t=new $x(e,this.languageConfigurationService,this._foldingLimitReporter);if(this.rangeProvider=t,this._useFoldingProviders&&this.foldingModel){let n=bS.getFoldingRangeProviders(this.languageFeaturesService,e);n.length>0&&(this.rangeProvider=new mS(e,n,()=>this.triggerFoldingModelChanged(),this._foldingLimitReporter,t))}return this.rangeProvider}getFoldingModel(){return this.foldingModelPromise}onDidChangeModelContent(e){this.hiddenRangeModel?.notifyChangeModelContent(e),this.triggerFoldingModelChanged()}triggerFoldingModelChanged(){this.updateScheduler&&(this.foldingRegionPromise&&=(this.foldingRegionPromise.cancel(),null),this.foldingModelPromise=this.updateScheduler.trigger(()=>{let e=this.foldingModel;if(!e)return null;let t=new ad,n=this.getRangeProvider(e.textModel),r=this.foldingRegionPromise=bu(e=>n.compute(e));return r.then(n=>{if(n&&r===this.foldingRegionPromise){let r;if(this._foldingImportsByDefault&&!this._currentModelHasFoldedImports){let e=n.setCollapsedAllOfType(uc.Imports.value,!0);e&&(r=Cr.capture(this.editor),this._currentModelHasFoldedImports=e)}let i=this.editor.getSelections();e.update(n,TS(i)),r?.restore(this.editor);let a=this.updateDebounceInfo.update(e.textModel,t.elapsed());this.updateScheduler&&(this.updateScheduler.defaultDelay=a)}return e})}).then(void 0,e=>(rr(e),null)))}onHiddenRangesChanges(e){if(this.hiddenRangeModel&&e.length&&!this._restoringViewState){let e=this.editor.getSelections();e&&this.hiddenRangeModel.adjustSelections(e)&&this.editor.setSelections(e)}this.editor.setHiddenAreas(e,this)}onCursorPositionChanged(){this.hiddenRangeModel&&this.hiddenRangeModel.hasRanges()&&this.cursorChangedScheduler.schedule()}revealCursor(){let e=this.getFoldingModel();e&&e.then(e=>{if(e){let t=this.editor.getSelections();if(t&&t.length>0){let n=[];for(let r of t){let t=r.selectionStartLineNumber;this.hiddenRangeModel&&this.hiddenRangeModel.isHidden(t)&&n.push(...e.getAllRegionsAtLine(t,e=>e.isCollapsed&&t>e.startLineNumber))}n.length&&(e.toggleCollapseState(n),this.reveal(t[0].getPosition()))}}}).then(void 0,rr)}onEditorMouseDown(e){if(this.mouseDownInfo=null,!this.hiddenRangeModel||!e.target||!e.target.range||!e.event.leftButton&&!e.event.middleButton)return;let t=e.target.range,n=!1;switch(e.target.type){case 4:{let t=e.target.detail,r=e.target.element.offsetLeft;if(t.offsetX-r<4)return;n=!0;break}case 7:if(this._unfoldOnClickAfterEndOfLine&&this.hiddenRangeModel.hasRanges()&&!e.target.detail.isAfterLines)break;return;case 6:if(this.hiddenRangeModel.hasRanges()){let e=this.editor.getModel();if(e&&t.startColumn===e.getLineMaxColumn(t.startLineNumber))break}return;default:return}this.mouseDownInfo={lineNumber:t.startLineNumber,iconClicked:n}}onEditorMouseUp(e){let t=this.foldingModel;if(!t||!this.mouseDownInfo||!e.target)return;let n=this.mouseDownInfo.lineNumber,r=this.mouseDownInfo.iconClicked,i=e.target.range;if(!i||i.startLineNumber!==n)return;if(r){if(e.target.type!==4)return}else{let e=this.editor.getModel();if(!e||i.startColumn!==e.getLineMaxColumn(n))return}let a=t.getRegionAtLine(n);if(a&&a.startLineNumber===n){let i=a.isCollapsed;if(r||i){let r=e.event.altKey,o=[];if(r){let e=t.getRegionsInside(null,e=>!e.containedBy(a)&&!a.containedBy(e));for(let t of e)t.isCollapsed&&o.push(t);o.length===0&&(o=e)}else{let n=e.event.middleButton||e.event.shiftKey;if(n)for(let e of t.getRegionsInside(a))e.isCollapsed===i&&o.push(e);(i||!n||o.length===0)&&o.push(a)}t.toggleCollapseState(o),this.reveal({lineNumber:n,column:1})}}}reveal(e){this.editor.revealPositionInCenterIfOutsideViewport(e,0)}};SS=bS=vS([yS(1,w),yS(2,Ar),yS(3,nt),yS(4,co),yS(5,W)],SS);var CS=class extends b{constructor(e){super(),this.editor=e,this._onDidChange=this._register(new E),this._computed=0,this._limited=!1}get limit(){return this.editor.getOptions().get(56)}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}},wS=class extends D{runEditorCommand(e,t,n){let r=e.get(Ar),i=SS.get(t);if(!i)return;let a=i.getFoldingModel();if(a)return this.reportTelemetry(e,t),a.then(e=>{if(e){this.invoke(i,e,t,n,r);let a=t.getSelection();a&&i.reveal(a.getStartPosition())}})}getSelectedLines(e){let t=e.getSelections();return t?t.map(e=>e.startLineNumber):[]}getLineNumbers(e,t){return e&&e.selectionLines?e.selectionLines.map(e=>e+1):this.getSelectedLines(t)}run(e,t){}};function TS(e){return!e||e.length===0?{startsInside:()=>!1}:{startsInside(t,n){for(let r of e){let e=r.startLineNumber;if(e>=t&&e<=n)return!0}return!1}}}function ES(e){if(!vu(e)){if(!Rr(e))return!1;let t=e;if(!vu(t.levels)&&!ku(t.levels)||!vu(t.direction)&&!ve(t.direction)||!vu(t.selectionLines)&&(!Array.isArray(t.selectionLines)||!t.selectionLines.every(ku)))return!1}return!0}var DS=class extends wS{constructor(){super({id:`editor.unfold`,label:B(974,`Unfold`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:3166,mac:{primary:2654},weight:100},metadata:{description:`Unfold the content in the editor`,args:[{name:`Unfold editor argument`,description:`Property-value pairs that can be passed through this argument:
						* 'levels': Number of levels to unfold. If not set, defaults to 1.
						* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.
						* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.
						`,constraint:ES,schema:{type:`object`,properties:{levels:{type:`number`,default:1},direction:{type:`string`,enum:[`up`,`down`],default:`down`},selectionLines:{type:`array`,items:{type:`number`}}}}}]}})}invoke(e,t,n,r){let i=r&&r.levels||1,a=this.getLineNumbers(r,n);r&&r.direction===`up`?zx(t,!1,i,a):Rx(t,!1,i,a)}},OS=class extends wS{constructor(){super({id:`editor.unfoldRecursively`,label:B(975,`Unfold Recursively`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2142),weight:100}})}invoke(e,t,n,r){Rx(t,!1,Number.MAX_VALUE,this.getSelectedLines(n))}},kS=class extends wS{constructor(){super({id:`editor.fold`,label:B(976,`Fold`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:3164,mac:{primary:2652},weight:100},metadata:{description:`Fold the content in the editor`,args:[{name:`Fold editor argument`,description:`Property-value pairs that can be passed through this argument:
							* 'levels': Number of levels to fold.
							* 'direction': If 'up', folds given number of levels up otherwise folds down.
							* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.
							If no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.
						`,constraint:ES,schema:{type:`object`,properties:{levels:{type:`number`},direction:{type:`string`,enum:[`up`,`down`]},selectionLines:{type:`array`,items:{type:`number`}}}}}]}})}invoke(e,t,n,r){let i=this.getLineNumbers(r,n),a=r&&r.levels,o=r&&r.direction;typeof a!=`number`&&typeof o!=`string`?Bx(t,!0,i):o===`up`?zx(t,!0,a||1,i):Rx(t,!0,a||1,i)}},AS=class extends wS{constructor(){super({id:`editor.toggleFold`,label:B(977,`Toggle Fold`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2090),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);Lx(t,1,r)}},jS=class extends wS{constructor(){super({id:`editor.foldRecursively`,label:B(978,`Fold Recursively`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2140),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);Rx(t,!0,Number.MAX_VALUE,r)}},MS=class extends wS{constructor(){super({id:`editor.toggleFoldRecursively`,label:B(979,`Toggle Fold Recursively`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,3114),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);Lx(t,Number.MAX_VALUE,r)}},NS=class extends wS{constructor(){super({id:`editor.foldAllBlockComments`,label:B(980,`Fold All Block Comments`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2138),weight:100}})}invoke(e,t,n,r,i){if(t.regions.hasTypes())Wx(t,uc.Comment.value,!0);else{let e=n.getModel();if(!e)return;let r=i.getLanguageConfiguration(e.getLanguageId()).comments;if(r&&r.blockCommentStartToken){let e=RegExp(`^\\s*`+bi(r.blockCommentStartToken));Ux(t,e,!0)}}}},PS=class extends wS{constructor(){super({id:`editor.foldAllMarkerRegions`,label:B(981,`Fold All Regions`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2077),weight:100}})}invoke(e,t,n,r,i){if(t.regions.hasTypes())Wx(t,uc.Region.value,!0);else{let e=n.getModel();if(!e)return;let r=i.getLanguageConfiguration(e.getLanguageId()).foldingRules;if(r&&r.markers&&r.markers.start){let e=new RegExp(r.markers.start);Ux(t,e,!0)}}}},FS=class extends wS{constructor(){super({id:`editor.unfoldAllMarkerRegions`,label:B(982,`Unfold All Regions`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2078),weight:100}})}invoke(e,t,n,r,i){if(t.regions.hasTypes())Wx(t,uc.Region.value,!1);else{let e=n.getModel();if(!e)return;let r=i.getLanguageConfiguration(e.getLanguageId()).foldingRules;if(r&&r.markers&&r.markers.start){let e=new RegExp(r.markers.start);Ux(t,e,!1)}}}},IS=class extends wS{constructor(){super({id:`editor.foldAllExcept`,label:B(983,`Fold All Except Selected`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2136),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);Hx(t,!0,r)}},LS=class extends wS{constructor(){super({id:`editor.unfoldAllExcept`,label:B(984,`Unfold All Except Selected`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2134),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);Hx(t,!1,r)}},RS=class extends wS{constructor(){super({id:`editor.foldAll`,label:B(985,`Fold All`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2069),weight:100}})}invoke(e,t,n){Rx(t,!0)}},zS=class extends wS{constructor(){super({id:`editor.unfoldAll`,label:B(986,`Unfold All`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2088),weight:100}})}invoke(e,t,n){Rx(t,!1)}},BS=class e extends wS{static{this.ID_PREFIX=`editor.foldLevel`}static{this.ID=t=>e.ID_PREFIX+t}getFoldingLevel(){return parseInt(this.id.substr(e.ID_PREFIX.length))}invoke(e,t,n){Vx(t,this.getFoldingLevel(),!0,this.getSelectedLines(n))}},VS=class extends wS{constructor(){super({id:`editor.gotoParentFold`,label:B(987,`Go to Parent Fold`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);if(r.length>0){let e=Gx(r[0],t);e!==null&&n.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}},HS=class extends wS{constructor(){super({id:`editor.gotoPreviousFold`,label:B(988,`Go to Previous Folding Range`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);if(r.length>0){let e=Kx(r[0],t);e!==null&&n.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}},US=class extends wS{constructor(){super({id:`editor.gotoNextFold`,label:B(989,`Go to Next Folding Range`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);if(r.length>0){let e=qx(r[0],t);e!==null&&n.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}},WS=class extends wS{constructor(){super({id:`editor.createFoldingRangeFromSelection`,label:B(990,`Create Folding Range from Selection`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2135),weight:100}})}invoke(e,t,n){let r=[],i=n.getSelections();if(i){for(let e of i){let t=e.endLineNumber;e.endColumn===1&&--t,t>e.startLineNumber&&(r.push({startLineNumber:e.startLineNumber,endLineNumber:t,type:void 0,isCollapsed:!0,source:1}),n.setSelection({startLineNumber:e.startLineNumber,startColumn:1,endLineNumber:e.startLineNumber,endColumn:1}))}if(r.length>0){r.sort((e,t)=>e.startLineNumber-t.startLineNumber);let e=Px.sanitizeAndMerge(t.regions,r,n.getModel()?.getLineCount());t.updatePost(Px.fromFoldRanges(e))}}}},GS=class extends wS{constructor(){super({id:`editor.removeManualFoldingRanges`,label:B(991,`Remove Manual Folding Ranges`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2137),weight:100}})}invoke(e,t,n){let r=n.getSelections();if(r){let n=[];for(let e of r){let{startLineNumber:t,endLineNumber:r}=e;n.push(r>=t?{startLineNumber:t,endLineNumber:r}:{endLineNumber:r,startLineNumber:t})}t.removeManualRanges(n),e.triggerFoldingModelChanged()}}},KS=class extends wS{constructor(){super({id:`editor.toggleImportFold`,label:B(992,`Toggle Import Fold`),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,weight:100}})}async invoke(e,t){let n=[],r=t.regions;for(let e=r.length-1;e>=0;e--)r.getType(e)===uc.Imports.value&&n.push(r.toRegion(e));t.toggleCollapseState(n),e.triggerFoldingModelChanged()}};G(SS.ID,SS,0),s(DS),s(OS),s(kS),s(jS),s(MS),s(RS),s(zS),s(NS),s(PS),s(FS),s(IS),s(LS),s(AS),s(VS),s(HS),s(US),s(WS),s(GS),s(KS);for(let e=1;e<=7;e++)jc(new BS({id:BS.ID(e),label:B(993,`Fold Level {0}`,e),precondition:xS,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2048|21+e),weight:100}}));gn.registerCommand(`_executeFoldingRangeProvider`,async function(e,...t){let[n]=t;if(!(n instanceof $n))throw Sn();let r=e.get(W),i=e.get(Fi).getModel(n);if(!i)throw Sn();let a=e.get(Ni);if(!a.getValue(`editor.folding`,{resource:n}))return[];let o=e.get(Ar),s=a.getValue(`editor.foldingStrategy`,{resource:n}),c={get limit(){return a.getValue(`editor.foldingMaximumRegions`,{resource:n})},update:(e,t)=>{}},l=new $x(i,o,c),u=l;if(s!==`indentation`){let e=SS.getFoldingRangeProviders(r,i);e.length&&(u=new mS(i,e,()=>{},c,l))}let d=await u.compute(A.None),f=[];try{if(d)for(let e=0;e<d.length;e++){let t=d.getType(e);f.push({start:d.getStartLineNumber(e),end:d.getEndLineNumber(e),kind:t?uc.fromValue(t):void 0})}return f}finally{u.dispose()}});var qS=class extends D{constructor(){super({id:`editor.action.fontZoomIn`,label:B(1003,`Increase Editor Font Size`),precondition:void 0})}run(e,t){qt.setZoomLevel(qt.getZoomLevel()+1)}},JS=class extends D{constructor(){super({id:`editor.action.fontZoomOut`,label:B(1004,`Decrease Editor Font Size`),precondition:void 0})}run(e,t){qt.setZoomLevel(qt.getZoomLevel()-1)}},YS=class extends D{constructor(){super({id:`editor.action.fontZoomReset`,label:B(1005,`Reset Editor Font Size`),precondition:void 0})}run(e,t){qt.setZoomLevel(0)}};s(qS),s(JS),s(YS);var XS=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ZS=function(e,t){return function(n,r){t(n,r,e)}},QS=class{static{this.ID=`editor.contrib.autoFormat`}constructor(e,t,n,r){this._editor=e,this._languageFeaturesService=t,this._workerService=n,this._accessibilitySignalService=r,this._disposables=new P,this._sessionDisposables=new P,this._disposables.add(t.onTypeFormattingEditProvider.onDidChange(this._update,this)),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(e=>{e.hasChanged(65)&&this._update()})),this._update()}dispose(){this._disposables.dispose(),this._sessionDisposables.dispose()}_update(){if(this._sessionDisposables.clear(),!this._editor.getOption(65)||!this._editor.hasModel())return;let e=this._editor.getModel(),[t]=this._languageFeaturesService.onTypeFormattingEditProvider.ordered(e);if(!t||!t.autoFormatTriggerCharacters)return;let n=new It;for(let e of t.autoFormatTriggerCharacters)n.add(e.charCodeAt(0));this._sessionDisposables.add(this._editor.onDidType(e=>{let t=e.charCodeAt(e.length-1);n.has(t)&&this._trigger(String.fromCharCode(t))}))}_trigger(e){if(!this._editor.hasModel()||this._editor.getSelections().length>1||!this._editor.getSelection().isEmpty())return;let t=this._editor.getModel(),n=this._editor.getPosition(),r=new ur,i=this._editor.onDidChangeModelContent(e=>{if(e.isFlush){r.cancel(),i.dispose();return}for(let t=0,a=e.changes.length;t<a;t++)if(e.changes[t].range.endLineNumber<=n.lineNumber){r.cancel(),i.dispose();return}});au(this._workerService,this._languageFeaturesService,t,n,e,t.getFormattingOptions(),r.token).then(e=>{r.token.isCancellationRequested||Ht(e)&&(this._accessibilitySignalService.playSignal(Xt.format,{userGesture:!1}),Ru.execute(this._editor,e,!0))}).finally(()=>{i.dispose()})}};QS=XS([ZS(1,W),ZS(2,ne),ZS(3,nl)],QS);var $S=class{static{this.ID=`editor.contrib.formatOnPaste`}constructor(e,t,n){this.editor=e,this._languageFeaturesService=t,this._instantiationService=n,this._callOnDispose=new P,this._callOnModel=new P,this._callOnDispose.add(e.onDidChangeConfiguration(()=>this._update())),this._callOnDispose.add(e.onDidChangeModel(()=>this._update())),this._callOnDispose.add(e.onDidChangeModelLanguage(()=>this._update())),this._callOnDispose.add(t.documentRangeFormattingEditProvider.onDidChange(this._update,this))}dispose(){this._callOnDispose.dispose(),this._callOnModel.dispose()}_update(){this._callOnModel.clear(),this.editor.getOption(64)&&this.editor.hasModel()&&this._languageFeaturesService.documentRangeFormattingEditProvider.has(this.editor.getModel())&&this._callOnModel.add(this.editor.onDidPaste(({range:e})=>this._trigger(e)))}_trigger(e){this.editor.hasModel()&&(this.editor.getSelections().length>1||this._instantiationService.invokeFunction(qo,this.editor,e,2,Vo.None,A.None,!1).catch(rr))}};$S=XS([ZS(1,W),ZS(2,k)],$S);var eC=class extends D{constructor(){super({id:`editor.action.formatDocument`,label:B(1006,`Format Document`),precondition:j.and(F.notInCompositeEditor,F.writable,F.hasDocumentFormattingProvider),kbOpts:{kbExpr:F.editorTextFocus,primary:1572,linux:{primary:3111},weight:100},contextMenuOpts:{group:`1_modification`,order:1.3}})}async run(e,t){if(t.hasModel()){let n=e.get(k);await e.get($l).showWhile(n.invokeFunction(va,t,1,Vo.None,A.None,!0),250)}}},tC=class extends D{constructor(){super({id:`editor.action.formatSelection`,label:B(1007,`Format Selection`),precondition:j.and(F.writable,F.hasDocumentSelectionFormattingProvider),kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2084),weight:100},contextMenuOpts:{when:F.hasNonEmptySelection,group:`1_modification`,order:1.31}})}async run(e,t){if(!t.hasModel())return;let n=e.get(k),r=t.getModel(),i=t.getSelections().map(e=>e.isEmpty()?new S(e.startLineNumber,1,e.startLineNumber,r.getLineMaxColumn(e.startLineNumber)):e);await e.get($l).showWhile(n.invokeFunction(qo,t,i,1,Vo.None,A.None,!0),250)}};G(QS.ID,QS,2),G($S.ID,$S,2),s(eC),s(tC),gn.registerCommand(`editor.action.format`,async e=>{let t=e.get(mt).getFocusedCodeEditor();if(!t||!t.hasModel())return;let n=e.get(Mr);t.getSelection().isEmpty()?await n.executeCommand(`editor.action.formatDocument`):await n.executeCommand(`editor.action.formatSelection`)});var nC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rC=function(e,t){return function(n,r){t(n,r,e)}},iC=class{remove(){this.parent?.children.delete(this.id)}static findId(e,t){let n;typeof e==`string`?n=`${t.id}/${e}`:(n=`${t.id}/${e.name}`,t.children.get(n)!==void 0&&(n=`${t.id}/${e.name}_${e.range.startLineNumber}_${e.range.startColumn}`));let r=n;for(let e=0;t.children.get(r)!==void 0;e++)r=`${n}_${e}`;return r}static empty(e){return e.children.size===0}},aC=class extends iC{constructor(e,t,n){super(),this.id=e,this.parent=t,this.symbol=n,this.children=new Map}},oC=class extends iC{constructor(e,t,n,r){super(),this.id=e,this.parent=t,this.label=n,this.order=r,this.children=new Map}},sC=class e extends iC{static create(t,n,r){let i=new ur(r),a=new e(n.uri),o=t.ordered(n),s=o.map((t,r)=>{let o=iC.findId(`provider_${r}`,a),s=new oC(o,a,t.displayName??`Unknown Outline Provider`,r);return Promise.resolve(t.provideDocumentSymbols(n,i.token)).then(t=>{for(let n of t||[])e._makeOutlineElement(n,s);return s},e=>(Ze(e),s)).then(e=>{iC.empty(e)?e.remove():a._groups.set(o,e)})}),c=t.onDidChange(()=>{let e=t.ordered(n);ct(e,o)||i.cancel()});return Promise.all(s).then(()=>i.token.isCancellationRequested&&!r.isCancellationRequested?e.create(t,n,r):a._compact()).finally(()=>{i.dispose(),c.dispose(),i.dispose()})}static _makeOutlineElement(t,n){let r=iC.findId(t,n),i=new aC(r,n,t);if(t.children)for(let n of t.children)e._makeOutlineElement(n,i);n.children.set(i.id,i)}constructor(e){super(),this.uri=e,this.id=`root`,this.parent=void 0,this._groups=new Map,this.children=new Map,this.id=`root`,this.parent=void 0}_compact(){let e=0;for(let[t,n]of this._groups)n.children.size===0?this._groups.delete(t):e+=1;if(e!==1)this.children=this._groups;else{let e=gl.first(this._groups.values());for(let[,t]of e.children)t.parent=this,this.children.set(t.id,t)}return this}getTopLevelSymbols(){let e=[];for(let t of this.children.values())t instanceof aC?e.push(t.symbol):e.push(...gl.map(t.children.values(),e=>e.symbol));return e.sort((e,t)=>S.compareRangesUsingStarts(e.range,t.range))}asListOfDocumentSymbols(){let t=this.getTopLevelSymbols(),n=[];return e._flattenDocumentSymbols(n,t,``),n.sort((e,t)=>x.compare(S.getStartPosition(e.range),S.getStartPosition(t.range))||x.compare(S.getEndPosition(t.range),S.getEndPosition(e.range)))}static _flattenDocumentSymbols(t,n,r){for(let i of n)t.push({kind:i.kind,tags:i.tags,name:i.name,detail:i.detail,containerName:i.containerName||r,range:i.range,selectionRange:i.selectionRange,children:void 0}),i.children&&e._flattenDocumentSymbols(t,i.children,i.name)}};const cC=dl(`IOutlineModelService`);var lC=class{constructor(e,t,n){this._languageFeaturesService=e,this._disposables=new P,this._cache=new Za(15,.7),this._debounceInformation=t.for(e.documentSymbolProvider,`DocumentSymbols`,{min:350}),this._disposables.add(n.onModelRemoved(e=>{this._cache.delete(e.id)}))}dispose(){this._disposables.dispose()}async getOrCreate(e,t){let n=this._languageFeaturesService.documentSymbolProvider,r=n.ordered(e),i=this._cache.get(e.id);if(!i||i.versionId!==e.getVersionId()||!ct(i.provider,r)){let t=new ur;i={versionId:e.getVersionId(),provider:r,promiseCnt:0,source:t,promise:sC.create(n,e,t.token),model:void 0},this._cache.set(e.id,i);let a=Date.now();i.promise.then(t=>{i.model=t,this._debounceInformation.update(e,Date.now()-a)}).catch(t=>{this._cache.delete(e.id)})}if(i.model)return i.model;i.promiseCnt+=1;let a=t.onCancellationRequested(()=>{--i.promiseCnt===0&&(i.source.cancel(),this._cache.delete(e.id))});try{return await i.promise}finally{a.dispose()}}};lC=nC([rC(0,W),rC(1,co),rC(2,Fi)],lC),wt(cC,lC,1),gn.registerCommand(`_executeDocumentSymbolProvider`,async function(e,...t){let[n]=t;K($n.isUri(n));let r=e.get(cC),i=await e.get(fi).createModelReference(n);try{return(await r.getOrCreate(i.object.textEditorModel,A.None)).getTopLevelSymbols()}finally{i.dispose()}});const uC=new class{constructor(){this._implementations=[]}register(e){return this._implementations.push(e),{dispose:()=>{let t=this._implementations.indexOf(e);t!==-1&&this._implementations.splice(t,1)}}}getImplementations(){return this._implementations}};var dC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fC=function(e,t){return function(n,r){t(n,r,e)}};function pC(e){return e instanceof mC?e._instance:e}var mC=class{constructor(e){this.instantiationService=e}init(...e){}};function hC(e,t){return class extends t{constructor(){super(...arguments),this._autorun=void 0}init(...t){this._autorun=n((n,r)=>{let i=e.read(n);this._instance=r.add(this.instantiationService.createInstance(i,...t))})}dispose(){this._autorun?.dispose()}}}function gC(e){return ri()?hC(e,_C):e.get()}var _C=class extends mC{constructor(e,t){super(t),this.init(e)}};_C=dC([fC(1,k)],_C);const Q={Visible:bb,HasFocusedSuggestion:new T(`suggestWidgetHasFocusedSuggestion`,!1,H(1437,`Whether any suggestion is focused`)),DetailsVisible:new T(`suggestWidgetDetailsVisible`,!1,H(1438,`Whether suggestion details are visible`)),MultipleSuggestions:new T(`suggestWidgetMultipleSuggestions`,!1,H(1439,`Whether there are multiple suggestions to pick from`)),MakesTextEdit:new T(`suggestionMakesTextEdit`,!0,H(1440,`Whether inserting the current suggestion yields in a change or has everything already been typed`)),AcceptSuggestionsOnEnter:new T(`acceptSuggestionOnEnter`,!0,H(1441,`Whether suggestions are inserted when pressing Enter`)),HasInsertAndReplaceRange:new T(`suggestionHasInsertAndReplaceRange`,!1,H(1442,`Whether the current suggestion has insert and replace behaviour`)),InsertMode:new T(`suggestionInsertMode`,void 0,{type:`string`,description:H(1443,`Whether the default behaviour is to insert or replace`)}),CanResolve:new T(`suggestionCanResolve`,!1,H(1444,`Whether the current suggestion supports to resolve further details`))},vC=new M(`suggestWidgetStatusBar`);var yC=class{constructor(e,t,n,r){this.position=e,this.completion=t,this.container=n,this.provider=r,this.isInvalid=!1,this.score=Ft.Default,this.distance=0,this.textLabel=typeof t.label==`string`?t.label:t.label?.label,this.labelLow=this.textLabel.toLowerCase(),this.isInvalid=!this.textLabel,this.sortTextLow=t.sortText&&t.sortText.toLowerCase(),this.filterTextLow=t.filterText&&t.filterText.toLowerCase(),this.extensionId=t.extensionId,S.isIRange(t.range)?(this.editStart=new x(t.range.startLineNumber,t.range.startColumn),this.editInsertEnd=new x(t.range.endLineNumber,t.range.endColumn),this.editReplaceEnd=new x(t.range.endLineNumber,t.range.endColumn),this.isInvalid=this.isInvalid||S.spansMultipleLines(t.range)||t.range.startLineNumber!==e.lineNumber):(this.editStart=new x(t.range.insert.startLineNumber,t.range.insert.startColumn),this.editInsertEnd=new x(t.range.insert.endLineNumber,t.range.insert.endColumn),this.editReplaceEnd=new x(t.range.replace.endLineNumber,t.range.replace.endColumn),this.isInvalid=this.isInvalid||S.spansMultipleLines(t.range.insert)||S.spansMultipleLines(t.range.replace)||t.range.insert.startLineNumber!==e.lineNumber||t.range.replace.startLineNumber!==e.lineNumber||t.range.insert.startColumn!==t.range.replace.startColumn),typeof r.resolveCompletionItem!=`function`&&(this._resolveCache=Promise.resolve(),this._resolveDuration=0)}get isResolved(){return this._resolveDuration!==void 0}get resolveDuration(){return this._resolveDuration===void 0?-1:this._resolveDuration}async resolve(e){if(!this._resolveCache){let t=e.onCancellationRequested(()=>{this._resolveCache=void 0,this._resolveDuration=void 0}),n=new ad(!0);this._resolveCache=Promise.resolve(this.provider.resolveCompletionItem(this.completion,e)).then(e=>{Object.assign(this.completion,e),this._resolveDuration=n.elapsed()},e=>{Pn(e)&&(this._resolveCache=void 0,this._resolveDuration=void 0)}).finally(()=>{t.dispose()})}return this._resolveCache}},bC=class e{static{this.default=new e}constructor(e=2,t=new Set,n=new Set,r=new Map,i=!0){this.snippetSortOrder=e,this.kindFilter=t,this.providerFilter=n,this.providerItemsToReuse=r,this.showDeprecated=i}},xC;function SC(){return xC}var CC=class{constructor(e,t,n,r){this.items=e,this.needsClipboard=t,this.durations=n,this.disposable=r}};async function wC(e,t,n,r=bC.default,i={triggerKind:0},a=A.None){let o=new ad;n=n.clone();let s=t.getWordAtPosition(n),c=s?new S(n.lineNumber,s.startColumn,n.lineNumber,s.endColumn):S.fromPositions(n),l={replace:c,insert:c.setEndPosition(n.lineNumber,n.column)},u=[],d=new P,f=[],p=!1,m=(e,t,i)=>{let a=!1;if(!t)return a;for(let i of t.suggestions)if(!r.kindFilter.has(i.kind)){if(!r.showDeprecated&&i?.tags?.includes(1))continue;i.range||=l,i.sortText||=typeof i.label==`string`?i.label:i.label.label,!p&&i.insertTextRules&&i.insertTextRules&4&&(p=Lf.guessNeedsClipboard(i.insertText)),u.push(new yC(n,i,t,e)),a=!0}return on(t)&&d.add(t),f.push({providerName:e._debugDisplayName??`unknown_provider`,elapsedProvider:t.duration??-1,elapsedOverall:i.elapsed()}),a},h=(async()=>{})();for(let o of e.orderedGroups(t)){let e=!1;if(await Promise.all(o.map(async o=>{if(r.providerItemsToReuse.has(o)){let t=r.providerItemsToReuse.get(o);t.forEach(e=>u.push(e)),e||=t.length>0;return}if(!(r.providerFilter.size>0&&!r.providerFilter.has(o)))try{let r=new ad,s=await o.provideCompletionItems(t,n,i,a);e=m(o,s,r)||e}catch(e){Ze(e)}})),e||a.isCancellationRequested)break}return await h,a.isCancellationRequested?(d.dispose(),Promise.reject(new Ns)):new CC(u.sort(kC(r.snippetSortOrder)),p,{entries:f,elapsed:o.elapsed()},d)}function TC(e,t){if(e.sortTextLow&&t.sortTextLow){if(e.sortTextLow<t.sortTextLow)return-1;if(e.sortTextLow>t.sortTextLow)return 1}return e.textLabel<t.textLabel?-1:e.textLabel>t.textLabel?1:e.completion.kind-t.completion.kind}function EC(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===28)return-1;if(t.completion.kind===28)return 1}return TC(e,t)}function DC(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===28)return 1;if(t.completion.kind===28)return-1}return TC(e,t)}var OC=new Map;OC.set(0,EC),OC.set(2,DC),OC.set(1,TC);function kC(e){return OC.get(e)}gn.registerCommand(`_executeCompletionItemProvider`,async(e,...t)=>{let[n,r,i,a]=t;K($n.isUri(n)),K(x.isIPosition(r)),K(typeof i==`string`||!i),K(typeof a==`number`||!a);let{completionProvider:o}=e.get(W),s=await e.get(fi).createModelReference(n);try{let e={incomplete:!1,suggestions:[]},t=[],n=s.object.textEditorModel.validatePosition(r),c=await wC(o,s.object.textEditorModel,n,void 0,{triggerCharacter:i??void 0,triggerKind:i?1:0});for(let n of c.items)t.length<(a??0)&&t.push(n.resolve(A.None)),e.incomplete=e.incomplete||n.container.incomplete,e.suggestions.push(n.completion);try{return await Promise.all(t),e}finally{setTimeout(()=>c.disposable.dispose(),100)}}finally{s.dispose()}});function AC(e,t){e.getContribution(`editor.contrib.suggestController`)?.triggerSuggest(new Set().add(t),void 0,!0)}var jC=class{static isAllOff(e){return e.other===`off`&&e.comments===`off`&&e.strings===`off`}static isAllOn(e){return e.other===`on`&&e.comments===`on`&&e.strings===`on`}static valueFor(e,t){switch(t){case 1:return e.comments;case 2:return e.strings;default:return e.other}}},MC=class{static{this.inlineSuggestionVisible=new T(`inlineSuggestionVisible`,!1,H(1181,`Whether an inline suggestion is visible`))}static{this.inlineSuggestionHasIndentation=new T(`inlineSuggestionHasIndentation`,!1,H(1182,`Whether the inline suggestion starts with whitespace`))}static{this.inlineSuggestionHasIndentationLessThanTabSize=new T(`inlineSuggestionHasIndentationLessThanTabSize`,!0,H(1183,`Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab`))}static{this.suppressSuggestions=new T(`inlineSuggestionSuppressSuggestions`,void 0,H(1184,`Whether suggestions should be suppressed for the current suggestion`))}static{this.cursorBeforeGhostText=new T(`cursorBeforeGhostText`,!1,H(1185,`Whether the cursor is at ghost text`))}static{this.cursorInIndentation=new T(`cursorInIndentation`,!1,H(1186,`Whether the cursor is in indentation`))}static{this.hasSelection=new T(`editor.hasSelection`,!1,H(1187,`Whether the editor has a selection`))}static{this.cursorAtInlineEdit=new T(`cursorAtInlineEdit`,!1,H(1188,`Whether the cursor is at an inline edit`))}static{this.inlineEditVisible=new T(`inlineEditIsVisible`,!1,H(1189,`Whether an inline edit is visible`))}static{this.tabShouldJumpToInlineEdit=new T(`tabShouldJumpToInlineEdit`,!1,H(1190,`Whether tab should jump to an inline edit.`))}static{this.tabShouldAcceptInlineEdit=new T(`tabShouldAcceptInlineEdit`,!1,H(1191,`Whether tab should accept the inline edit.`))}static{this.inInlineEditsPreviewEditor=new T(`inInlineEditsPreviewEditor`,!0,H(1192,`Whether the current code editor is showing an inline edits preview`))}},NC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},PC=function(e,t){return function(n,r){t(n,r,e)}};function FC(e){return e.sourceId+` @@ `+JSON.stringify({...e,modelUri:e.modelUri?.toString(),sourceId:void 0})}var IC=class extends b{static cast(){return this}constructor(e,t,n){super(),this._key=e,this._contextKeyService=t,this._dataChannelService=n,this._isEnabledContextKeyValue=LC(`structuredLogger.enabled:`+this._key,this._contextKeyService).recomputeInitiallyAndOnChange(this._store),this.isEnabled=this._isEnabledContextKeyValue.map(e=>e!==void 0)}log(e){return this._isEnabledContextKeyValue.get()?(this._dataChannelService.getDataChannel(`structuredLogger:`+this._key).sendData(e),!0):!1}};IC=NC([PC(1,w),PC(2,Ei)],IC);function LC(e,t){return ai(t.onDidChangeContext,()=>t.getContextKeyValue(e))}var RC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},zC=function(e,t){return function(n,r){t(n,r,e)}},BC=class extends b{constructor(e,t,n){super(),this._editor=e,this._instantiationService=t,this._loggerService=n,this._structuredLogger=this._register(this._instantiationService.createInstance(IC.cast(),`editor.inlineSuggest.logChangeReason.commandId`));let r=this._loggerService?.createLogger(`textModelChanges`,{hidden:!1,name:`Text Model Changes Reason`}),i=ai(this,r.onDidChangeLogLevel,()=>r.getLevel());this._register(la(e=>{lo(i.read(e),Nl.Trace)&&e.store.add(this._editor.onDidChangeModelContent(e=>{this._editor.getModel()?.uri.scheme!==`output`&&r.trace(`onDidChangeModelContent: `+e.detailedReasons.map(e=>e.toKey(Number.MAX_VALUE)).join(`, `))}))})),this._register(la(e=>{this._editor instanceof Qc&&this._structuredLogger.isEnabled.read(e)&&e.store.add(this._editor.onDidChangeModelContent(e=>{let t=this._editor.getModel();if(!t)return;let n=e.detailedReasons[0],r={...n.metadata,sourceId:`TextModel.setChangeReason`,source:n.metadata.source,time:Date.now(),modelUri:t.uri,modelVersion:t.getVersionId()};setTimeout(()=>{this._structuredLogger.log(r)},0)}))}))}};BC=RC([zC(1,k),zC(2,Hc)],BC);function VC(e,t=go){return qu(e,t)?e.charAt(0).toUpperCase()+e.slice(1):e}var HC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},UC=function(e,t){return function(n,r){t(n,r,e)}};Object.freeze({CURRENT_YEAR:!0,CURRENT_YEAR_SHORT:!0,CURRENT_MONTH:!0,CURRENT_DATE:!0,CURRENT_HOUR:!0,CURRENT_MINUTE:!0,CURRENT_SECOND:!0,CURRENT_DAY_NAME:!0,CURRENT_DAY_NAME_SHORT:!0,CURRENT_MONTH_NAME:!0,CURRENT_MONTH_NAME_SHORT:!0,CURRENT_SECONDS_UNIX:!0,CURRENT_TIMEZONE_OFFSET:!0,SELECTION:!0,CLIPBOARD:!0,TM_SELECTED_TEXT:!0,TM_CURRENT_LINE:!0,TM_CURRENT_WORD:!0,TM_LINE_INDEX:!0,TM_LINE_NUMBER:!0,TM_FILENAME:!0,TM_FILENAME_BASE:!0,TM_DIRECTORY:!0,TM_FILEPATH:!0,CURSOR_INDEX:!0,CURSOR_NUMBER:!0,RELATIVE_FILEPATH:!0,BLOCK_COMMENT_START:!0,BLOCK_COMMENT_END:!0,LINE_COMMENT:!0,WORKSPACE_NAME:!0,WORKSPACE_FOLDER:!0,RANDOM:!0,RANDOM_HEX:!0,UUID:!0});var WC=class{constructor(e){this._delegates=e}resolve(e){for(let t of this._delegates){let n=t.resolve(e);if(n!==void 0)return n}}},GC=class{constructor(e,t,n,r){this._model=e,this._selection=t,this._selectionIdx=n,this._overtypingCapturer=r}resolve(e){let{name:t}=e;if(t===`SELECTION`||t===`TM_SELECTED_TEXT`){let t=this._model.getValueInRange(this._selection)||void 0,n=this._selection.startLineNumber!==this._selection.endLineNumber;if(!t&&this._overtypingCapturer){let e=this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);e&&(t=e.value,n=e.multiline)}if(t&&n&&e.snippet){let n=this._model.getLineContent(this._selection.startLineNumber),r=ji(n,0,this._selection.startColumn-1),i=r;e.snippet.walk(t=>t===e?!1:(t instanceof Of&&(i=ji(a(t.value).pop())),!0));let o=$e(i,r);t=t.replace(/(\r\n|\r|\n)(.*)/g,(e,t,n)=>`${t}${i.substr(o)}${n}`)}return t}else if(t===`TM_CURRENT_LINE`)return this._model.getLineContent(this._selection.positionLineNumber);else if(t===`TM_CURRENT_WORD`){let e=this._model.getWordAtPosition({lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn});return e&&e.word||void 0}else if(t===`TM_LINE_INDEX`)return String(this._selection.positionLineNumber-1);else if(t===`TM_LINE_NUMBER`)return String(this._selection.positionLineNumber);else if(t===`CURSOR_INDEX`)return String(this._selectionIdx);else if(t===`CURSOR_NUMBER`)return String(this._selectionIdx+1)}},KC=class{constructor(e,t){this._labelService=e,this._model=t}resolve(e){let{name:t}=e;if(t===`TM_FILENAME`)return $s(this._model.uri.fsPath);if(t===`TM_FILENAME_BASE`){let e=$s(this._model.uri.fsPath),t=e.lastIndexOf(`.`);return t<=0?e:e.slice(0,t)}else if(t===`TM_DIRECTORY`)return re(this._model.uri.fsPath)===`.`?``:this._labelService.getUriLabel(Wo(this._model.uri));else if(t===`TM_FILEPATH`)return this._labelService.getUriLabel(this._model.uri);else if(t===`RELATIVE_FILEPATH`)return this._labelService.getUriLabel(this._model.uri,{relative:!0,noPrefix:!0})}},qC=class{constructor(e,t,n,r){this._readClipboardText=e,this._selectionIdx=t,this._selectionCount=n,this._spread=r}resolve(e){if(e.name!==`CLIPBOARD`)return;let t=this._readClipboardText();if(t){if(this._spread){let e=t.split(/\r\n|\n|\r/).filter(e=>!en(e));if(e.length===this._selectionCount)return e[this._selectionIdx]}return t}}},JC=class{constructor(e,t,n){this._model=e,this._selection=t,this._languageConfigurationService=n}resolve(e){let{name:t}=e,n=this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber,this._selection.selectionStartColumn),r=this._languageConfigurationService.getLanguageConfiguration(n).comments;if(r){if(t===`LINE_COMMENT`)return r.lineCommentToken||void 0;if(t===`BLOCK_COMMENT_START`)return r.blockCommentStartToken||void 0;if(t===`BLOCK_COMMENT_END`)return r.blockCommentEndToken||void 0}}};JC=HC([UC(2,Ar)],JC);var YC=class e{constructor(){this._date=new Date}static{this.dayNames=[H(1388,`Sunday`),H(1389,`Monday`),H(1390,`Tuesday`),H(1391,`Wednesday`),H(1392,`Thursday`),H(1393,`Friday`),H(1394,`Saturday`)]}static{this.dayNamesShort=[H(1395,`Sun`),H(1396,`Mon`),H(1397,`Tue`),H(1398,`Wed`),H(1399,`Thu`),H(1400,`Fri`),H(1401,`Sat`)]}static{this.monthNames=[H(1402,`January`),H(1403,`February`),H(1404,`March`),H(1405,`April`),H(1406,`May`),H(1407,`June`),H(1408,`July`),H(1409,`August`),H(1410,`September`),H(1411,`October`),H(1412,`November`),H(1413,`December`)]}static{this.monthNamesShort=[H(1414,`Jan`),H(1415,`Feb`),H(1416,`Mar`),H(1417,`Apr`),H(1418,`May`),H(1419,`Jun`),H(1420,`Jul`),H(1421,`Aug`),H(1422,`Sep`),H(1423,`Oct`),H(1424,`Nov`),H(1425,`Dec`)]}resolve(t){let{name:n}=t;if(n===`CURRENT_YEAR`)return String(this._date.getFullYear());if(n===`CURRENT_YEAR_SHORT`)return String(this._date.getFullYear()).slice(-2);if(n===`CURRENT_MONTH`)return String(this._date.getMonth().valueOf()+1).padStart(2,`0`);if(n===`CURRENT_DATE`)return String(this._date.getDate().valueOf()).padStart(2,`0`);if(n===`CURRENT_HOUR`)return String(this._date.getHours().valueOf()).padStart(2,`0`);if(n===`CURRENT_MINUTE`)return String(this._date.getMinutes().valueOf()).padStart(2,`0`);if(n===`CURRENT_SECOND`)return String(this._date.getSeconds().valueOf()).padStart(2,`0`);if(n===`CURRENT_DAY_NAME`)return e.dayNames[this._date.getDay()];if(n===`CURRENT_DAY_NAME_SHORT`)return e.dayNamesShort[this._date.getDay()];if(n===`CURRENT_MONTH_NAME`)return e.monthNames[this._date.getMonth()];if(n===`CURRENT_MONTH_NAME_SHORT`)return e.monthNamesShort[this._date.getMonth()];if(n===`CURRENT_SECONDS_UNIX`)return String(Math.floor(this._date.getTime()/1e3));if(n===`CURRENT_TIMEZONE_OFFSET`){let e=this._date.getTimezoneOffset(),t=e>0?`-`:`+`,n=Math.trunc(Math.abs(e/60)),r=n<10?`0`+n:n,i=Math.abs(e)-n*60,a=i<10?`0`+i:i;return t+r+`:`+a}}},XC=class{constructor(e){this._workspaceService=e}resolve(e){if(!this._workspaceService)return;let t=oo(this._workspaceService.getWorkspace());if(!Ia(t)){if(e.name===`WORKSPACE_NAME`)return this._resolveWorkspaceName(t);if(e.name===`WORKSPACE_FOLDER`)return this._resoveWorkspacePath(t)}}_resolveWorkspaceName(e){if(zc(e))return $s(e.uri.path);let t=$s(e.configPath.path);return t.endsWith(`code-workspace`)&&(t=t.substr(0,t.length-ws.length-1)),t}_resoveWorkspacePath(e){if(zc(e))return VC(e.uri.fsPath);let t=$s(e.configPath.path),n=e.configPath.fsPath;return n.endsWith(t)&&(n=n.substr(0,n.length-t.length-1)),n?VC(n):`/`}},ZC=class{resolve(e){let{name:t}=e;if(t===`RANDOM`)return Math.random().toString().slice(-6);if(t===`RANDOM_HEX`)return Math.random().toString(16).slice(-6);if(t===`UUID`)return Jc()}},QC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$C=function(e,t){return function(n,r){t(n,r,e)}},ew,tw=class e{static{this._decor={active:R.register({description:`snippet-placeholder-1`,stickiness:0,className:`snippet-placeholder`}),inactive:R.register({description:`snippet-placeholder-2`,stickiness:1,className:`snippet-placeholder`}),activeFinal:R.register({description:`snippet-placeholder-3`,stickiness:1,className:`finish-snippet-placeholder`}),inactiveFinal:R.register({description:`snippet-placeholder-4`,stickiness:1,className:`finish-snippet-placeholder`})}}constructor(e,t,n){this._editor=e,this._snippet=t,this._snippetLineLeadingWhitespace=n,this._offset=-1,this._nestingLevel=1,this._placeholderGroups=Qt(t.placeholders,Af.compareByIndex),this._placeholderGroupsIdx=-1}initialize(e){this._offset=e.newPosition}dispose(){this._placeholderDecorations&&this._editor.removeDecorations([...this._placeholderDecorations.values()]),this._placeholderGroups.length=0}_initDecorations(){if(this._offset===-1)throw Error(`Snippet not initialized!`);if(this._placeholderDecorations)return;this._placeholderDecorations=new Map;let t=this._editor.getModel();this._editor.changeDecorations(n=>{for(let r of this._snippet.placeholders){let i=this._snippet.offset(r),a=this._snippet.fullLen(r),o=S.fromPositions(t.getPositionAt(this._offset+i),t.getPositionAt(this._offset+i+a)),s=r.isFinalTabstop?e._decor.inactiveFinal:e._decor.inactive,c=n.addDecoration(o,s);this._placeholderDecorations.set(r,c)}})}move(t){if(!this._editor.hasModel())return[];if(this._initDecorations(),this._placeholderGroupsIdx>=0){let e=[];for(let t of this._placeholderGroups[this._placeholderGroupsIdx])if(t.transform){let n=this._placeholderDecorations.get(t),r=this._editor.getModel().getDecorationRange(n),i=this._editor.getModel().getValueInRange(r),a=t.transform.resolve(i).split(/\r\n|\r|\n/);for(let e=1;e<a.length;e++)a[e]=this._editor.getModel().normalizeIndentation(this._snippetLineLeadingWhitespace+a[e]);e.push(gc.replace(r,a.join(this._editor.getModel().getEOL())))}e.length>0&&this._editor.executeEdits(`snippet.placeholderTransform`,e)}let n=!1;t===!0&&this._placeholderGroupsIdx<this._placeholderGroups.length-1?(this._placeholderGroupsIdx+=1,n=!0):t===!1&&this._placeholderGroupsIdx>0&&(--this._placeholderGroupsIdx,n=!0);let r=this._editor.getModel().changeDecorations(t=>{let r=new Set,i=[];for(let a of this._placeholderGroups[this._placeholderGroupsIdx]){let o=this._placeholderDecorations.get(a),s=this._editor.getModel().getDecorationRange(o);i.push(new N(s.startLineNumber,s.startColumn,s.endLineNumber,s.endColumn)),n&&=this._hasPlaceholderBeenCollapsed(a),t.changeDecorationOptions(o,a.isFinalTabstop?e._decor.activeFinal:e._decor.active),r.add(a);for(let n of this._snippet.enclosingPlaceholders(a)){let i=this._placeholderDecorations.get(n);t.changeDecorationOptions(i,n.isFinalTabstop?e._decor.activeFinal:e._decor.active),r.add(n)}}for(let[n,i]of this._placeholderDecorations)r.has(n)||t.changeDecorationOptions(i,n.isFinalTabstop?e._decor.inactiveFinal:e._decor.inactive);return i});return n?this.move(t):r??[]}_hasPlaceholderBeenCollapsed(e){let t=e;for(;t;){if(t instanceof Af){let e=this._placeholderDecorations.get(t);if(this._editor.getModel().getDecorationRange(e).isEmpty()&&t.toString().length>0)return!0}t=t.parent}return!1}get isAtFirstPlaceholder(){return this._placeholderGroupsIdx<=0||this._placeholderGroups.length===0}get isAtLastPlaceholder(){return this._placeholderGroupsIdx===this._placeholderGroups.length-1}get hasPlaceholder(){return this._snippet.placeholders.length>0}get isTrivialSnippet(){if(this._snippet.placeholders.length===0)return!0;if(this._snippet.placeholders.length===1){let[e]=this._snippet.placeholders;if(e.isFinalTabstop&&this._snippet.rightMostDescendant===e)return!0}return!1}computePossibleSelections(){let e=new Map;for(let t of this._placeholderGroups){let n;for(let r of t){if(r.isFinalTabstop)break;n||(n=[],e.set(r.index,n));let t=this._placeholderDecorations.get(r),i=this._editor.getModel().getDecorationRange(t);if(!i){e.delete(r.index);break}n.push(i)}}return e}get activeChoice(){if(!this._placeholderDecorations)return;let e=this._placeholderGroups[this._placeholderGroupsIdx][0];if(!e?.choice)return;let t=this._placeholderDecorations.get(e);if(!t)return;let n=this._editor.getModel().getDecorationRange(t);if(n)return{range:n,choice:e.choice}}get hasChoice(){let e=!1;return this._snippet.walk(t=>(e=t instanceof jf,!e)),e}merge(t){let n=this._editor.getModel();this._nestingLevel*=10,this._editor.changeDecorations(r=>{for(let i of this._placeholderGroups[this._placeholderGroupsIdx]){let a=t.shift();console.assert(a._offset!==-1),console.assert(!a._placeholderDecorations);let o=a._snippet.placeholderInfo.last.index;for(let e of a._snippet.placeholderInfo.all)e.isFinalTabstop?e.index=i.index+(o+1)/this._nestingLevel:e.index=i.index+e.index/this._nestingLevel;this._snippet.replace(i,a._snippet.children);let s=this._placeholderDecorations.get(i);r.removeDecoration(s),this._placeholderDecorations.delete(i);for(let t of a._snippet.placeholders){let i=a._snippet.offset(t),o=a._snippet.fullLen(t),s=S.fromPositions(n.getPositionAt(a._offset+i),n.getPositionAt(a._offset+i+o)),c=r.addDecoration(s,e._decor.inactive);this._placeholderDecorations.set(t,c)}}this._placeholderGroups=Qt(this._snippet.placeholders,Af.compareByIndex)})}},nw={overwriteBefore:0,overwriteAfter:0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0},rw=ew=class{static adjustWhitespace(e,t,n,r,i){let a=e.getLineContent(t.lineNumber),o=ji(a,0,t.column-1),s;return r.walk(t=>{if(!(t instanceof Of)||t.parent instanceof jf||i&&!i.has(t))return!0;let a=t.value.split(/\r\n|\r|\n/);if(n){let n=r.offset(t);if(n===0)a[0]=e.normalizeIndentation(a[0]);else{s??=r.toString();let t=s.charCodeAt(n-1);(t===10||t===13)&&(a[0]=e.normalizeIndentation(o+a[0]))}for(let t=1;t<a.length;t++)a[t]=e.normalizeIndentation(o+a[t])}let c=a.join(e.getEOL());return c!==t.value&&(t.parent.replace(t,[new Of(c)]),s=void 0),!0}),o}static adjustSelection(e,t,n,r){if(n!==0||r!==0){let{positionLineNumber:i,positionColumn:a}=t,o=a-n,s=a+r,c=e.validateRange({startLineNumber:i,startColumn:o,endLineNumber:i,endColumn:s});t=N.createWithDirection(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn,t.getDirection())}return t}static createEditsAndSnippetsFromSelections(e,t,n,r,i,a,o,s,c){let l=[],u=[];if(!e.hasModel())return{edits:l,snippets:u};let d=e.getModel(),f=e.invokeWithinContext(e=>e.get(yl)),p=e.invokeWithinContext(e=>new KC(e.get(Xc),d)),m=()=>o,h=d.getValueInRange(ew.adjustSelection(d,e.getSelection(),n,0)),g=d.getValueInRange(ew.adjustSelection(d,e.getSelection(),0,r)),_=d.getLineFirstNonWhitespaceColumn(e.getSelection().positionLineNumber),ee=e.getSelections().map((e,t)=>({selection:e,idx:t})).sort((e,t)=>S.compareRangesUsingStarts(e.selection,t.selection));for(let{selection:o,idx:v}of ee){let te=ew.adjustSelection(d,o,n,0),y=ew.adjustSelection(d,o,0,r);h!==d.getValueInRange(te)&&(te=o),g!==d.getValueInRange(y)&&(y=o);let ne=o.setStartPosition(te.startLineNumber,te.startColumn).setEndPosition(y.endLineNumber,y.endColumn),re=new Lf().parse(t,!0,i),ie=ne.getStartPosition(),ae=ew.adjustWhitespace(d,ie,a||v>0&&_!==d.getLineFirstNonWhitespaceColumn(o.positionLineNumber),re);re.resolveVariables(new WC([p,new qC(m,v,ee.length,e.getOption(87)===`spread`),new GC(d,o,v,s),new JC(d,o,c),new YC,new XC(f),new ZC])),l[v]=gc.replace(ne,re.toString()),l[v].identifier={major:v,minor:0},l[v]._isTracked=!0,u[v]=new tw(e,re,ae)}return{edits:l,snippets:u}}static createEditsAndSnippetsFromEdits(e,t,n,r,i,a,o){if(!e.hasModel()||t.length===0)return{edits:[],snippets:[]};let s=[],c=e.getModel(),l=new Lf,u=new If,d=new WC([e.invokeWithinContext(e=>new KC(e.get(Xc),c)),new qC(()=>i,0,e.getSelections().length,e.getOption(87)===`spread`),new GC(c,e.getSelection(),0,a),new JC(c,e.getSelection(),o),new YC,new XC(e.invokeWithinContext(e=>e.get(yl))),new ZC]);t=t.sort((e,t)=>S.compareRangesUsingStarts(e.range,t.range));let f=0;for(let e=0;e<t.length;e++){let{range:n,template:i,keepWhitespace:a}=t[e];if(e>0){let r=t[e-1].range,i=S.fromPositions(r.getEndPosition(),n.getStartPosition()),a=new Of(c.getValueInRange(i));u.appendChild(a),f+=a.value.length}let o=l.parseFragment(i,u);ew.adjustWhitespace(c,n.getStartPosition(),a===void 0?r:!a,u,new Set(o)),u.resolveVariables(d);let p=u.toString(),m=p.slice(f);f=p.length;let h=gc.replace(n,m);h.identifier={major:e,minor:0},h._isTracked=!0,s.push(h)}return l.ensureFinalTabstop(u,n,!0),{edits:s,snippets:[new tw(e,u,``)]}}constructor(e,t,n=nw,r){this._editor=e,this._template=t,this._options=n,this._languageConfigurationService=r,this._templateMerges=[],this._snippets=[]}dispose(){gt(this._snippets)}_logInfo(){return`template="${this._template}", merged_templates="${this._templateMerges.join(` -> `)}"`}insert(e){if(!this._editor.hasModel())return;let{edits:t,snippets:n}=typeof this._template==`string`?ew.createEditsAndSnippetsFromSelections(this._editor,this._template,this._options.overwriteBefore,this._options.overwriteAfter,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService):ew.createEditsAndSnippetsFromEdits(this._editor,this._template,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService);this._snippets=n,this._editor.executeEdits(e??Xa.snippet(),t,e=>{let t=e.filter(e=>!!e.identifier);for(let e=0;e<n.length;e++)n[e].initialize(t[e].textChange);return this._snippets[0].hasPlaceholder?this._move(!0):t.map(e=>N.fromPositions(e.range.getEndPosition()))}),this._editor.revealRange(this._editor.getSelections()[0])}merge(e,t=nw){if(!this._editor.hasModel())return;this._templateMerges.push([this._snippets[0]._nestingLevel,this._snippets[0]._placeholderGroupsIdx,e]);let{edits:n,snippets:r}=ew.createEditsAndSnippetsFromSelections(this._editor,e,t.overwriteBefore,t.overwriteAfter,!0,t.adjustWhitespace,t.clipboardText,t.overtypingCapturer,this._languageConfigurationService);this._editor.executeEdits(`snippet`,n,e=>{let t=e.filter(e=>!!e.identifier);for(let e=0;e<r.length;e++)r[e].initialize(t[e].textChange);let n=r[0].isTrivialSnippet;if(!n){for(let e of this._snippets)e.merge(r);console.assert(r.length===0)}return this._snippets[0].hasPlaceholder&&!n?this._move(void 0):t.map(e=>N.fromPositions(e.range.getEndPosition()))})}next(){let e=this._move(!0);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}prev(){let e=this._move(!1);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}_move(e){let t=[];for(let n of this._snippets){let r=n.move(e);t.push(...r)}return t}get isAtFirstPlaceholder(){return this._snippets[0].isAtFirstPlaceholder}get isAtLastPlaceholder(){return this._snippets[0].isAtLastPlaceholder}get hasPlaceholder(){return this._snippets[0].hasPlaceholder}get hasChoice(){return this._snippets[0].hasChoice}get activeChoice(){return this._snippets[0].activeChoice}isSelectionWithinPlaceholders(){if(!this.hasPlaceholder)return!1;let e=this._editor.getSelections();if(e.length<this._snippets.length)return!1;let t=new Map;for(let n of this._snippets){let r=n.computePossibleSelections();if(t.size===0)for(let[n,i]of r){i.sort(S.compareRangesUsingStarts);for(let r of e)if(i[0].containsRange(r)){t.set(n,[]);break}}if(t.size===0)return!1;t.forEach((e,t)=>{e.push(...r.get(t))})}e.sort(S.compareRangesUsingStarts);for(let[n,r]of t){if(r.length!==e.length){t.delete(n);continue}r.sort(S.compareRangesUsingStarts);for(let i=0;i<r.length;i++)if(!r[i].containsRange(e[i])){t.delete(n);continue}}return t.size>0}};rw=ew=QC([$C(3,Ar)],rw);var iw=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},aw=function(e,t){return function(n,r){t(n,r,e)}},ow,sw={overwriteBefore:0,overwriteAfter:0,undoStopBefore:!0,undoStopAfter:!0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0},cw=class{static{ow=this}static{this.ID=`snippetController2`}static get(e){return e.getContribution(ow.ID)}static{this.InSnippetMode=new T(`inSnippetMode`,!1,H(1384,`Whether the editor in current in snippet mode`))}static{this.HasNextTabstop=new T(`hasNextTabstop`,!1,H(1385,`Whether there is a next tab stop when in snippet mode`))}static{this.HasPrevTabstop=new T(`hasPrevTabstop`,!1,H(1386,`Whether there is a previous tab stop when in snippet mode`))}constructor(e,t,n,r,i){this._editor=e,this._logService=t,this._languageFeaturesService=n,this._languageConfigurationService=i,this._snippetListener=new P,this._modelVersionId=-1,this._inSnippet=ow.InSnippetMode.bindTo(r),this._hasNextTabstop=ow.HasNextTabstop.bindTo(r),this._hasPrevTabstop=ow.HasPrevTabstop.bindTo(r)}dispose(){this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._session?.dispose(),this._snippetListener.dispose()}insert(e,t){try{this._doInsert(e,t===void 0?sw:{...sw,...t})}catch(t){this.cancel(),this._logService.error(t),this._logService.error(`snippet_error`),this._logService.error(`insert_template=`,e),this._logService.error(`existing_template=`,this._session?this._session._logInfo():`<no_session>`)}}_doInsert(e,t){if(this._editor.hasModel()){if(this._snippetListener.clear(),t.undoStopBefore&&this._editor.getModel().pushStackElement(),this._session&&typeof e!=`string`&&this.cancel(),this._session?(K(typeof e==`string`),this._session.merge(e,t)):(this._modelVersionId=this._editor.getModel().getAlternativeVersionId(),this._session=new rw(this._editor,e,t,this._languageConfigurationService),this._session.insert(t.reason)),t.undoStopAfter&&this._editor.getModel().pushStackElement(),this._session?.hasChoice){let e={_debugDisplayName:`snippetChoiceCompletions`,provideCompletionItems:(e,t)=>{if(!this._session||e!==this._editor.getModel()||!x.equals(this._editor.getPosition(),t))return;let{activeChoice:n}=this._session;if(!n||n.choice.options.length===0)return;let r=e.getValueInRange(n.range),i=!!n.choice.options.find(e=>e.value===r),a=[];for(let e=0;e<n.choice.options.length;e++){let t=n.choice.options[e];a.push({kind:13,label:t.value,insertText:t.value,sortText:`a`.repeat(e+1),range:n.range,filterText:i?`${r}_${t.value}`:void 0,command:{id:`jumpToNextSnippetPlaceholder`,title:H(1387,`Go to next placeholder...`)}})}return{suggestions:a}}},t=this._editor.getModel(),n,r=!1;this._choiceCompletions={provider:e,enable:()=>{r||=(n=this._languageFeaturesService.completionProvider.register({language:t.getLanguageId(),pattern:t.uri.fsPath,scheme:t.uri.scheme,exclusive:!0},e),this._snippetListener.add(n),!0)},disable:()=>{n?.dispose(),r=!1}}}this._updateState(),this._snippetListener.add(this._editor.onDidChangeModelContent(e=>e.isFlush&&this.cancel())),this._snippetListener.add(this._editor.onDidChangeModel(()=>this.cancel())),this._snippetListener.add(this._editor.onDidChangeCursorSelection(()=>this._updateState()))}}_updateState(){if(!(!this._session||!this._editor.hasModel())){if(this._modelVersionId===this._editor.getModel().getAlternativeVersionId()||!this._session.hasPlaceholder)return this.cancel();if(this._session.isAtLastPlaceholder||!this._session.isSelectionWithinPlaceholders())return this._editor.getModel().pushStackElement(),this.cancel();this._inSnippet.set(!0),this._hasPrevTabstop.set(!this._session.isAtFirstPlaceholder),this._hasNextTabstop.set(!this._session.isAtLastPlaceholder),this._handleChoice()}}_handleChoice(){if(!this._session||!this._editor.hasModel()){this._currentChoice=void 0;return}let{activeChoice:e}=this._session;if(!e||!this._choiceCompletions){this._choiceCompletions?.disable(),this._currentChoice=void 0;return}this._currentChoice!==e.choice&&(this._currentChoice=e.choice,this._choiceCompletions.enable(),queueMicrotask(()=>{AC(this._editor,this._choiceCompletions.provider)}))}finish(){for(;this._inSnippet.get();)this.next()}cancel(e=!1){this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._snippetListener.clear(),this._currentChoice=void 0,this._session?.dispose(),this._session=void 0,this._modelVersionId=-1,e&&this._editor.setSelections([this._editor.getSelection()])}prev(){this._session?.prev(),this._updateState()}next(){this._session?.next(),this._updateState()}isInSnippet(){return!!this._inSnippet.get()}};cw=ow=iw([aw(1,za),aw(2,W),aw(3,w),aw(4,Ar)],cw),G(cw.ID,cw,4);var lw=Gi.bindToContribution(cw.get);L(new lw({id:`jumpToNextSnippetPlaceholder`,precondition:j.and(cw.InSnippetMode,cw.HasNextTabstop),handler:e=>e.next(),kbOpts:{weight:130,kbExpr:F.textInputFocus,primary:2}})),L(new lw({id:`jumpToPrevSnippetPlaceholder`,precondition:j.and(cw.InSnippetMode,cw.HasPrevTabstop),handler:e=>e.prev(),kbOpts:{weight:130,kbExpr:F.textInputFocus,primary:1026}})),L(new lw({id:`leaveSnippet`,precondition:cw.InSnippetMode,handler:e=>e.cancel(!0),kbOpts:{weight:130,kbExpr:F.textInputFocus,primary:9,secondary:[1033]}})),L(new lw({id:`acceptSnippet`,precondition:cw.InSnippetMode,handler:e=>e.finish()}));function uw(e){return new dw(e)}var dw=class extends du{constructor(e){super(),this._textModel=e}getOffset(e){return this._textModel.getOffsetAt(e)}getPosition(e){return this._textModel.getPositionAt(e)}},fw=[];function pw(){return fw}function mw(e){return hw(e).map(e=>e.getEndPosition())}function hw(e){let t=Mt.createSortPermutation(e,bt(e=>e.range,S.compareRangesUsingStarts)),n=new ps(t.apply(e)).getNewRanges();return t.inverse().apply(n)}function gw(e,t){let n=uw(t),r=t.getValue();return e.map(e=>n.getStringReplacement(e)).map(e=>e.removeCommonSuffixPrefix(r)).map(e=>n.getTextReplacement(e))}function _w(e,t){let n=Vl(`result`,[]),r=[];return t.add(la(t=>{let i=e.read(t);Fa(e=>{if(i.length!==r.length){r.length=i.length;for(let e=0;e<r.length;e++)r[e]||(r[e]=Vl(`item`,i[e]));n.set([...r],e)}r.forEach((t,n)=>t.set(i[n],e))})})),n}var vw=class{constructor(e){this._contextKeyService=e}bind(e,t){return Xu(e,this._contextKeyService,t instanceof Function?t:e=>t.read(e))}};function yw(e,t){return new Promise(n=>{let r,i=setTimeout(()=>{r&&r.dispose(),n()},e);t&&(r=t.onCancellationRequested(()=>{clearTimeout(i),r&&r.dispose(),n()}))})}var bw=class{constructor(e,t,n,r=xw){this.startValue=e,this.endValue=t,this.durationMs=n,this._interpolationFunction=r,this.startTimeMs=Date.now(),e===t&&(this.durationMs=0)}isFinished(){return Date.now()>=this.startTimeMs+this.durationMs}getValue(){let e=Date.now()-this.startTimeMs;return e>=this.durationMs?this.endValue:this._interpolationFunction(e,this.startValue,this.endValue-this.startValue,this.durationMs)}};function xw(e,t,n,r){return e===r?t+n:n*(-(2**(-10*e/r))+1)+t}function Sw(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t}var Cw=class{constructor(e){this._value=Vl(this,e)}getValue(e){let t=this._value.read(e);return t.isFinished()||ww.instance.invalidateOnNextAnimationFrame(e),t.getValue()}},ww=class e{constructor(){this._counter=yt(this),this._isScheduled=!1}static{this.instance=new e}invalidateOnNextAnimationFrame(e){this._counter.read(e),this._isScheduled||(this._isScheduled=!0,Yl().requestAnimationFrame(()=>{this._isScheduled=!1,this._update()}))}_update(){this._counter.trigger(void 0)}},Tw=class{constructor(e,t){this.lineNumber=e,this.parts=t,Ae(()=>Gs(t,(e,t)=>e.column<=t.column))}equals(e){return this.lineNumber===e.lineNumber&&this.parts.length===e.parts.length&&this.parts.every((t,n)=>t.equals(e.parts[n]))}renderForScreenReader(e){if(this.parts.length===0)return``;let t=this.parts[this.parts.length-1],n=e.substr(0,t.column-1);return new ps([...this.parts.map(e=>new es(S.fromPositions(new x(1,e.column)),e.lines.map(e=>e.line).join(`
`)))]).applyToString(n).substring(this.parts[0].column-1)}isEmpty(){return this.parts.every(e=>e.lines.length===0)}get lineCount(){return 1+this.parts.reduce((e,t)=>e+t.lines.length-1,0)}},Ew=class{constructor(e,n,r,i=[]){this.column=e,this.text=n,this.preview=r,this._inlineDecorations=i,this.lines=a(this.text).map((e,n)=>({line:e,lineDecorations:t.filter(this._inlineDecorations,n+1,1,e.length+1)}))}equals(e){return this.column===e.column&&this.lines.length===e.lines.length&&this.lines.every((n,r)=>n.line===e.lines[r].line&&t.equalsArr(n.lineDecorations,e.lines[r].lineDecorations))}},Dw=class{constructor(e,t,n,r=0){this.lineNumber=e,this.columnRange=t,this.text=n,this.additionalReservedLineCount=r,this.parts=[new Ew(this.columnRange.endColumnExclusive,this.text,!1)],this.newLines=a(this.text)}renderForScreenReader(e){return this.newLines.join(`
`)}get lineCount(){return this.newLines.length}isEmpty(){return this.parts.every(e=>e.lines.length===0)}equals(e){return this.lineNumber===e.lineNumber&&this.columnRange.equals(e.columnRange)&&this.newLines.length===e.newLines.length&&this.newLines.every((t,n)=>t===e.newLines[n])&&this.additionalReservedLineCount===e.additionalReservedLineCount}};function Ow(e,t){return ct(e,t,kw)}function kw(e,t){return e===t?!0:!e||!t?!1:e instanceof Tw&&t instanceof Tw||e instanceof Dw&&t instanceof Dw?e.equals(t):!1}function Aw(e,t,n){let r=n?e.range.intersectRanges(n):e.range;if(!r)return e;let i=e.text.replaceAll(`\r
`,`
`),a=t.getValueInRange(r,1),o=$e(a,i),s=Gu.ofText(a.substring(0,o)).addToPosition(e.range.getStartPosition()),c=i.substring(o),l=S.fromPositions(s,e.range.getEndPosition());return new es(l,c)}function jw(e,t){return e.text.startsWith(t.text)&&Mw(e.range,t.range)}function Mw(e,t){return t.getStartPosition().equals(e.getStartPosition())&&t.getEndPosition().isBeforeOrEqual(e.getEndPosition())}function Nw(e,t,n,r,i=0){let a=Aw(e,t);if(a.range.endLineNumber!==a.range.startLineNumber)return;let o=t.getLineContent(a.range.startLineNumber),s=ji(o).length;if(a.range.startColumn-1<=s){let e=ji(a.text).length,t=o.substring(a.range.startColumn-1,s),[n,r]=[a.range.getStartPosition(),a.range.getEndPosition()],i=n.column+t.length<=r.column?n.delta(0,t.length):r,c=S.fromPositions(i,r),l=a.text.startsWith(t)?a.text.substring(t.length):a.text.substring(e);a=new es(c,l)}let c=t.getValueInRange(a.range),l=Fw(c,a.text);if(!l)return;let u=a.range.startLineNumber,d=[];if(n===`prefix`){let e=l.filter(e=>e.originalLength===0);if(e.length>1||e.length===1&&e[0].originalStart!==c.length)return}let f=a.text.length-i;for(let e of l){let t=a.range.startColumn+e.originalStart+e.originalLength;if(n===`subwordSmart`&&r&&r.lineNumber===a.range.startLineNumber&&t<r.column||e.originalLength>0)return;if(e.modifiedLength===0)continue;let i=e.modifiedStart+e.modifiedLength,o=Math.max(e.modifiedStart,Math.min(i,f)),s=a.text.substring(e.modifiedStart,o),c=a.text.substring(o,Math.max(e.modifiedStart,i));s.length>0&&d.push(new Ew(t,s,!1)),c.length>0&&d.push(new Ew(t,c,!0))}return new Tw(u,d)}var Pw=void 0;function Fw(e,t){if(Pw?.originalValue===e&&Pw?.newValue===t)return Pw?.changes;{let n=Lw(e,t,!0);if(n){let r=Iw(n);if(r>0){let i=Lw(e,t,!1);i&&Iw(i)<r&&(n=i)}}return Pw={originalValue:e,newValue:t,changes:n},n}}function Iw(e){let t=0;for(let n of e)t+=n.originalLength;return t}function Lw(e,t,n){if(e.length>5e3||t.length>5e3)return;function r(e){let t=0;for(let n=0,r=e.length;n<r;n++){let r=e.charCodeAt(n);r>t&&(t=r)}return t}let i=Math.max(r(e),r(t));function a(e){if(e<0)throw Error(`unexpected`);return i+e+1}function o(e){let t=0,r=0,i=new Int32Array(e.length);for(let o=0,s=e.length;o<s;o++)if(n&&e[o]===`(`){let e=r*100+t;i[o]=a(2*e),t++}else if(n&&e[o]===`)`){t=Math.max(t-1,0);let e=r*100+t;i[o]=a(2*e+1),t===0&&r++}else i[o]=e.charCodeAt(o);return i}let s=o(e),c=o(t);return new mn({getElements:()=>s},{getElements:()=>c}).ComputeDiff(!1).changes}function Rw(e,t){let n,r=!1,i=new Bi(new vo(e,void 0,t.update),(e,i)=>{r||=(n=t.initial instanceof Function?t.initial():t.initial,!0);let a=t.update(e,n,i);return n=a,a},t.changeTracker,()=>{r&&=(t.disposeFinal?.(n),!1)},t.equalityComparer??ac,(e,t,a)=>{if(!r)throw new h(`Can only set when there is a listener! This is to prevent leaks.`);Cs(t,t=>{n=e,i.setValue(e,t,a)})},Dc.ofCaller());return i}function zw(e){let t=e.map(e=>new Rs(Pe.ofStartAndLength(e.rangeOffset,e.rangeLength),e.text));return t.reverse(),new te(t)}var Bw;(function(e){function t(e,t){return e.isInlineEdit?Kw.create(e,t):Ww.create(e,t)}e.create=t})(Bw||={});var Vw=class{constructor(e,t,n){this._data=e,this.identity=t,this.displayLocation=n}get source(){return this._data.source}get isFromExplicitRequest(){return this._data.context.triggerKind===xc.Explicit}get forwardStable(){return this.source.inlineSuggestions.enableForwardStability??!1}get editRange(){return this.getSingleTextEdit().range}get targetRange(){return this.displayLocation?.range??this.editRange}get insertText(){return this.getSingleTextEdit().text}get semanticId(){return this.hash}get action(){return this._sourceInlineCompletion.action}get command(){return this._sourceInlineCompletion.command}get warning(){return this._sourceInlineCompletion.warning}get showInlineEditMenu(){return!!this._sourceInlineCompletion.showInlineEditMenu}get hash(){return JSON.stringify([this.getSingleTextEdit().text,this.getSingleTextEdit().range.getStartPosition().toString()])}get requestUuid(){return this._data.context.requestUuid}get partialAccepts(){return this._data.partialAccepts}get _sourceInlineCompletion(){return this._data.sourceInlineCompletion}addRef(){this.identity.addRef(),this.source.addRef()}removeRef(){this.identity.removeRef(),this.source.removeRef()}reportInlineEditShown(e,t,n){this._data.reportInlineEditShown(e,this.insertText,t,n)}reportPartialAccept(e,t,n){this._data.reportPartialAccept(e,t,n)}reportEndOfLife(e){this._data.reportEndOfLife(e)}setEndOfLifeReason(e){this._data.setEndOfLifeReason(e)}reportInlineEditError(e){this._data.reportInlineEditError(e)}setIsPreceeded(e){this._data.setIsPreceeded(e.partialAccepts)}getSourceCompletion(){return this._sourceInlineCompletion}},Hw=class e{constructor(){this._onDispose=yt(this),this._refCount=1,this.id=`InlineCompletionIdentity`+ e.idCounter++}static{this.idCounter=0}addRef(){this._refCount++}removeRef(){this._refCount--,this._refCount===0&&this._onDispose.trigger(void 0)}},Uw=class e{static create(t){return new e(t.range,t.label,t.kind)}constructor(e,t,n){this.range=e,this.label=t,this.kind=n}withEdit(t,n){let r=new Pe(n.getOffset(this.range.getStartPosition()),n.getOffset(this.range.getEndPosition())),i=Dn([r],t)[0];if(!i)return;let a=n.getRange(i);return new e(a,this.label,this.kind)}},Ww=class e extends Vw{static create(t,n){let r=new Hw,i=uw(n),a=t.insertText.replace(/\r\n|\r|\n/g,n.getEOL()),o=Yw(new Rs(i.getOffsetRange(t.range),a),n),s=o.removeCommonSuffixAndPrefix(n.getValue()),c=i.getTextReplacement(o),l=t.displayLocation?Uw.create(t.displayLocation):void 0;return new e(o,s,c,c.range,t.snippetInfo,t.additionalTextEdits,t,r,l)}constructor(e,t,n,r,i,a,o,s,c){super(o,s,c),this._edit=e,this._trimmedEdit=t,this._textEdit=n,this._originalRange=r,this.snippetInfo=i,this.additionalTextEdits=a,this.isInlineEdit=!1}get hash(){return JSON.stringify(this._trimmedEdit.toJson())}getSingleTextEdit(){return this._textEdit}withIdentity(t){return new e(this._edit,this._trimmedEdit,this._textEdit,this._originalRange,this.snippetInfo,this.additionalTextEdits,this._data,t,this.displayLocation)}withEdit(t,n){let r=Dn([this._edit.replaceRange],t);if(r.length===0)return;let i=new Rs(r[0],this._textEdit.text),a=uw(n),o=a.getTextReplacement(i),s=this.displayLocation;if(s&&(s=s.withEdit(t,a),!s))return;let c=i.removeCommonSuffixAndPrefix(n.getValue());return new e(i,c,o,this._originalRange,this.snippetInfo,this.additionalTextEdits,this._data,this.identity,s)}canBeReused(e,t){let n=this._textEdit.range;return!!n&&n.containsPosition(t)&&this.isVisible(e,t)&&Gu.ofRange(n).isGreaterThanOrEqualTo(Gu.ofRange(this._originalRange))}isVisible(e,t){let n=this.getSingleTextEdit();return Gw(n,this._originalRange,e,t)}};function Gw(e,t,n,r){let i=Aw(e,n),a=e.range;if(!a||t&&!t.getStartPosition().equals(a.getStartPosition())||r.lineNumber!==i.range.startLineNumber||i.isEmpty)return!1;let o=n.getValueInRange(i.range,1),s=i.text,c=Math.max(0,r.column-i.range.startColumn),l=s.substring(0,c),u=s.substring(c),d=o.substring(0,c),f=o.substring(c),p=n.getLineIndentColumn(i.range.startLineNumber);return i.range.startColumn<=p&&(d=d.trimStart(),d.length===0&&(f=f.trimStart()),l=l.trimStart(),l.length===0&&(u=u.trimStart())),l.startsWith(d)&&!!Mi(f,u)}var Kw=class e extends Vw{static create(t,n){let r=qw(n,t.range,t.insertText),i=new Hn(n),a=ps.fromStringEdit(r,i).toReplacement(i),o=new Hw,s=r.replacements.map(e=>{let t=S.fromPositions(n.getPositionAt(e.replaceRange.start),n.getPositionAt(e.replaceRange.endExclusive)),r=n.getValueInRange(t);return Jw.create(e,r)}),c=t.displayLocation?Uw.create(t.displayLocation):void 0;return new e(r,a,t,o,s,c,!1,n.getVersionId())}constructor(e,t,n,r,i,a,o=!1,s){super(n,r,a),this._edit=e,this._textEdit=t,this._edits=i,this._lastChangePartOfInlineEdit=o,this._inlineEditModelVersion=s,this.snippetInfo=void 0,this.additionalTextEdits=[],this.isInlineEdit=!0}get updatedEditModelVersion(){return this._inlineEditModelVersion}get updatedEdit(){return this._edit}getSingleTextEdit(){return this._textEdit}withIdentity(t){return new e(this._edit,this._textEdit,this._data,t,this._edits,this.displayLocation,this._lastChangePartOfInlineEdit,this._inlineEditModelVersion)}canBeReused(e,t){return this._lastChangePartOfInlineEdit&&this.updatedEditModelVersion===e.getVersionId()}withEdit(e,t){return this._applyTextModelChanges(e,this._edits,t)}_applyTextModelChanges(t,n,r){if(n=n.map(e=>e.applyTextModelChanges(t)),n.some(e=>e.edit===void 0))return;let i=r.getVersionId(),a=this._inlineEditModelVersion,o=n.some(e=>e.lastChangeUpdatedEdit);if(o&&(a=i??-1),i===null||a+20<i||(n=n.filter(e=>!e.edit.isEmpty),n.length===0))return;let s=new te(n.map(e=>e.edit)),c=uw(r),l=c.getTextEdit(s).toReplacement(new Hn(r)),u=this.displayLocation;if(!(u&&(u=u.withEdit(t,c),!u)))return new e(s,l,this._data,this.identity,n,u,o,a)}};function qw(e,t,n){let r=e.getEOL(),i=e.getValueInRange(t),o=n.replace(/\r\n|\r|\n/g,r),s=Ho.getDefault().computeDiff(a(i),a(o),{ignoreTrimWhitespace:!1,computeMoves:!1,extendToSubwords:!0,maxComputationTimeMs:500}).changes.flatMap(e=>e.innerChanges??[]);function c(e,t){let n=Gu.fromPosition(t.getStartPosition());return Gu.ofRange(t).createRange(n.addToPosition(e))}let l=new Ta(o);return new te(s.map(n=>{let r=c(t.getStartPosition(),n.originalRange),i=uw(e).getOffsetRange(r),a=l.getValueOfRange(n.modifiedRange),o=new Rs(i,a),u=e.getValueInRange(r);return Xw(o,u,s.length,e)}))}var Jw=class e{static create(t,n){let r=$e(t.newText,n),i=Pt(t.newText,n),a=t.newText.substring(r,t.newText.length-i);return new e(t,a,r,i)}get edit(){return this._edit}get lastChangeUpdatedEdit(){return this._lastChangeUpdatedEdit}constructor(e,t,n,r,i=!1){this._edit=e,this._trimmedNewText=t,this._prefixLength=n,this._suffixLength=r,this._lastChangeUpdatedEdit=i}applyTextModelChanges(e){let t=this._clone();return t._applyTextModelChanges(e),t}_clone(){return new e(this._edit,this._trimmedNewText,this._prefixLength,this._suffixLength,this._lastChangeUpdatedEdit)}_applyTextModelChanges(e){if(this._lastChangeUpdatedEdit=!1,!this._edit)throw new h(`UpdatedInnerEdits: No edit to apply changes to`);let t=this._applyChanges(this._edit,e);if(!t){this._edit=void 0;return}this._edit=t.edit,this._lastChangeUpdatedEdit=t.editHasChanged}_applyChanges(e,t){let n=e.replaceRange.start,r=e.replaceRange.endExclusive,i=e.newText,a=!1,o=this._prefixLength>0||this._suffixLength>0;for(let s=t.replacements.length-1;s>=0;s--){let c=t.replacements[s],l=c.newText.length>0&&c.replaceRange.isEmpty;if(l&&!o&&c.replaceRange.start===n&&i.startsWith(c.newText)){n+=c.newText.length,i=i.substring(c.newText.length),r=Math.max(n,r),a=!0;continue}if(l&&o&&c.replaceRange.start===n+this._prefixLength&&this._trimmedNewText.startsWith(c.newText)){r+=c.newText.length,a=!0,this._prefixLength+=c.newText.length,this._trimmedNewText=this._trimmedNewText.substring(c.newText.length);continue}if(c.newText.length===0&&c.replaceRange.length>0&&c.replaceRange.start>=n+this._prefixLength&&c.replaceRange.endExclusive<=r-this._suffixLength){r-=c.replaceRange.length,a=!0;continue}if(c.equals(e)){a=!0,n=c.replaceRange.endExclusive,i=``;continue}if(!(c.replaceRange.start>r)){if(c.replaceRange.endExclusive<n){n+=c.newText.length-c.replaceRange.length,r+=c.newText.length-c.replaceRange.length;continue}return}}return this._trimmedNewText.length===0&&n+this._prefixLength===r-this._suffixLength?{edit:new Rs(new Pe(n+this._prefixLength,n+this._prefixLength),``),editHasChanged:!0}:{edit:new Rs(new Pe(n,r),i),editHasChanged:a}}};function Yw(e,t){let n=t.getEOL();return e.replaceRange.isEmpty&&e.newText.includes(n)&&(e=Zw(e,t)),e}function Xw(e,t,n,r){let i=r.getEOL();if(e.newText.endsWith(i)&&t.endsWith(i)&&(e=new Rs(e.replaceRange.deltaEnd(-i.length),e.newText.slice(0,-i.length))),n===1&&e.replaceRange.isEmpty&&e.newText.includes(i)){let t=r.getPositionAt(e.replaceRange.start);r.getLineLength(t.lineNumber)!==0&&(e=Zw(e,r))}if(n===1){let n=$e(t,e.newText),r=Pt(t.slice(n),e.newText.slice(n));if(n+r===t.length)return new Rs(e.replaceRange.deltaStart(n).deltaEnd(-r),e.newText.substring(n,e.newText.length-r));if(n+r===e.newText.length)return new Rs(e.replaceRange.deltaStart(n).deltaEnd(-r),``)}return e}function Zw(e,t){if(!e.replaceRange.isEmpty)throw new h(`Unexpected original range`);if(e.replaceRange.start===0)return e;let n=t.getEOL(),r=t.getPositionAt(e.replaceRange.start),i=r.column,a=r.lineNumber;return i===1&&a>1&&e.newText.endsWith(n)&&!e.newText.startsWith(n)?new Rs(e.replaceRange.delta(-1),n+e.newText.slice(0,-n.length)):e}function Qw(e,t){let n=new Cu,r=new Ur(n,e=>t.getLanguageConfiguration(e)),i=new Ce(new $w([e]),r),a=Pu(i,[],void 0,!0),o=``,s=e.getLineContent();function c(e,t){if(e.kind===2)if(c(e.openingBracket,t),t=ti(t,e.openingBracket.length),e.child&&(c(e.child,t),t=ti(t,e.child.length)),e.closingBracket)c(e.closingBracket,t),t=ti(t,e.closingBracket.length);else{let t=r.getSingleLanguageBracketTokens(e.openingBracket.languageId).findClosingTokenText(e.openingBracket.bracketIds);o+=t}else if(e.kind!==3){if(e.kind===0||e.kind===1)o+=s.substring(Ke(t),Ke(ti(t,e.length)));else if(e.kind===4)for(let n of e.children)c(n,t),t=ti(t,n.length)}}return c(a,0),o}var $w=class{constructor(e){this.lines=e,this.tokenization={getLineTokens:e=>this.lines[e-1]}}getLineCount(){return this.lines.length}getLineLength(e){return this.lines[e-1].getLineContent().length}},eT=class e{constructor(){this._nodes=new Set,this._outgoingEdges=new Map}static from(t,n){let r=new e;for(let e of t)r._nodes.add(e);for(let e of t){let t=n(e);if(t.length>0){let n=new Set;for(let e of t)n.add(e);r._outgoingEdges.set(e,n)}}return r}removeCycles(){let e=[],t=new Set,n=new Set,r=[],i=a=>{t.add(a),n.add(a);let o=this._outgoingEdges.get(a);if(o)for(let s of o)t.has(s)?n.has(s)&&(e.push(s),r.push({from:a,to:s})):i(s);n.delete(a)};for(let e of this._nodes)t.has(e)||i(e);for(let{from:e,to:t}of r){let n=this._outgoingEdges.get(e);n&&n.delete(t)}return{foundCycles:e}}getOutgoing(e){let t=this._outgoingEdges.get(e);return t?Array.from(t):[]}},tT;(function(e){e.Jump=`jump`,e.Accept=`accept`,e.Inactive=`inactive`})(tT||={});var nT;(function(e){e.GhostText=`ghostText`,e.Custom=`custom`,e.SideBySide=`sideBySide`,e.Deletion=`deletion`,e.InsertionInline=`insertionInline`,e.InsertionMultiLine=`insertionMultiLine`,e.WordReplacements=`wordReplacements`,e.LineReplacement=`lineReplacement`,e.Collapsed=`collapsed`})(nT||={});function rT(e,t,n,r,i,a){let o=mc(`icr`),s=new ur,c,l={...r,requestUuid:o},u=lT(t,n),d=Ku(e,e=>e.groupId),f=eT.from(e,e=>e.yieldsToGroupIds?.flatMap(e=>d.get(e)??[])??[]),{foundCycles:p}=f.removeCycles();p.length>0&&Ze(Error(`Inline completions: cyclic yield-to dependency detected. Path: ${p.map(e=>e.toString?e.toString():``+e).join(` -> `)}`));let m=0,h=new wl(async e=>{try{if(m++,s.token.isCancellationRequested)return;let r=f.getOutgoing(e);for(let e of r){let r=await h.get(e);if(r)for(let e of r.inlineSuggestions.items){if(e.isInlineEdit||typeof e.insertText!=`string`)return;let r=new es(S.lift(e.range)??u,e.insertText);if(Gw(r,void 0,n,t))return}}let o,d=Date.now();try{o=await e.provideInlineCompletions(n,t,l,s.token)}catch(e){Ze(e);return}let p=Date.now();if(!o)return;let g=[],_=new cT(o,g,e);if(_.addRef(),iT(s.token,()=>_.removeRef(c)),s.token.isCancellationRequested)return;for(let e of o.items)g.push(aT(e,_,u,n,a,l,i,{startTime:d,endTime:p}));return _}finally{m--}});return{get didAllProvidersReturn(){return m===0},lists:Ca.fromPromisesResolveOrder(e.map(e=>h.get(e))).filter(Vu),cancelAndDispose:e=>{c===void 0&&(c=e,s.dispose(!0))}}}function iT(e,t){if(e.isCancellationRequested)return t(),b.None;{let n=e.onCancellationRequested(()=>{n.dispose(),t()});return{dispose:()=>n.dispose()}}}function aT(e,t,n,r,i,a,o,s){let c,l,u=e.range?S.lift(e.range):n;if(typeof e.insertText==`string`){if(c=e.insertText,i&&e.completeBracketPairs){c=uT(c,u.getStartPosition(),r,i);let t=c.length-e.insertText.length;t!==0&&(u=new S(u.startLineNumber,u.startColumn,u.endLineNumber,u.endColumn+t))}l=void 0}else if(`snippet`in e.insertText){let t=e.insertText.snippet.length;if(i&&e.completeBracketPairs){e.insertText.snippet=uT(e.insertText.snippet,u.getStartPosition(),r,i);let n=e.insertText.snippet.length-t;n!==0&&(u=new S(u.startLineNumber,u.startColumn,u.endLineNumber,u.endColumn+n))}let n=new Lf().parse(e.insertText.snippet);n.children.length===1&&n.children[0]instanceof Of?(c=n.children[0].value,l=void 0):(c=n.toString(),l={snippet:e.insertText.snippet,range:u})}else Gn(e.insertText);let d=e.displayLocation?{range:S.lift(e.displayLocation.range),label:e.displayLocation.label,kind:e.displayLocation.kind}:void 0;return new oT(u,c,l,d,e.additionalTextEdits||pw(),e,t,a,e.isInlineEdit??!1,o,s,e.correlationId)}var oT=class{constructor(e,t,n,r,i,a,o,s,c,l,u,d){this.range=e,this.insertText=t,this.snippetInfo=n,this.displayLocation=r,this.additionalTextEdits=i,this.sourceInlineCompletion=a,this.source=o,this.context=s,this.isInlineEdit=c,this._requestInfo=l,this._providerRequestInfo=u,this._correlationId=d,this._didShow=!1,this._timeUntilShown=void 0,this._showStartTime=void 0,this._shownDuration=0,this._showUncollapsedStartTime=void 0,this._showUncollapsedDuration=0,this._didReportEndOfLife=!1,this._lastSetEndOfLifeReason=void 0,this._isPreceeded=!1,this._partiallyAcceptedCount=0,this._partiallyAcceptedSinceOriginal={characters:0,ratio:0,count:0},this._viewData={editorType:l.editorType}}get showInlineEditMenu(){return this.sourceInlineCompletion.showInlineEditMenu??!1}get partialAccepts(){return this._partiallyAcceptedSinceOriginal}async reportInlineEditShown(e,t,n,r){this.updateShownDuration(n),!this._didShow&&(this._didShow=!0,this._viewData.viewKind=n,this._viewData.renderData=r,this._timeUntilShown=Date.now()-this._requestInfo.startTime,this.source.provider.handleItemDidShow?.(this.source.inlineSuggestions,this.sourceInlineCompletion,t),this.sourceInlineCompletion.shownCommand&&await e.executeCommand(this.sourceInlineCompletion.shownCommand.id,...this.sourceInlineCompletion.shownCommand.arguments||[]))}reportPartialAccept(e,t,n){this._partiallyAcceptedCount++,this._partiallyAcceptedSinceOriginal.characters+=n.characters,this._partiallyAcceptedSinceOriginal.ratio=Math.min(this._partiallyAcceptedSinceOriginal.ratio+(1-this._partiallyAcceptedSinceOriginal.ratio)*n.ratio,1),this._partiallyAcceptedSinceOriginal.count+=n.count,this.source.provider.handlePartialAccept?.(this.source.inlineSuggestions,this.sourceInlineCompletion,e,t)}reportEndOfLife(e){if(!this._didReportEndOfLife&&(this._didReportEndOfLife=!0,this.reportInlineEditHidden(),e||=this._lastSetEndOfLifeReason??{kind:tl.Ignored,userTypingDisagreed:!1,supersededBy:void 0},e.kind===tl.Rejected&&this.source.provider.handleRejection&&this.source.provider.handleRejection(this.source.inlineSuggestions,this.sourceInlineCompletion),this.source.provider.handleEndOfLifetime)){let t={requestUuid:this.context.requestUuid,correlationId:this._correlationId,partiallyAccepted:this._partiallyAcceptedCount,partiallyAcceptedCountSinceOriginal:this._partiallyAcceptedSinceOriginal.count,partiallyAcceptedRatioSinceOriginal:this._partiallyAcceptedSinceOriginal.ratio,partiallyAcceptedCharactersSinceOriginal:this._partiallyAcceptedSinceOriginal.characters,shown:this._didShow,shownDuration:this._shownDuration,shownDurationUncollapsed:this._showUncollapsedDuration,preceeded:this._isPreceeded,timeUntilShown:this._timeUntilShown,timeUntilProviderRequest:this._providerRequestInfo.startTime-this._requestInfo.startTime,timeUntilProviderResponse:this._providerRequestInfo.endTime-this._requestInfo.startTime,editorType:this._viewData.editorType,languageId:this._requestInfo.languageId,requestReason:this._requestInfo.reason,viewKind:this._viewData.viewKind,error:this._viewData.error,typingInterval:this._requestInfo.typingInterval,typingIntervalCharacterCount:this._requestInfo.typingIntervalCharacterCount,...this._viewData.renderData};this.source.provider.handleEndOfLifetime(this.source.inlineSuggestions,this.sourceInlineCompletion,e,t)}}reportInlineEditError(e){this._viewData.error?this._viewData.error+=`; ${e}`:this._viewData.error=e}setIsPreceeded(e){this._isPreceeded=!0,(this._partiallyAcceptedSinceOriginal.characters!==0||this._partiallyAcceptedSinceOriginal.ratio!==0||this._partiallyAcceptedSinceOriginal.count!==0)&&console.warn(`Expected partiallyAcceptedCountSinceOriginal to be { characters: 0, rate: 0, partialAcceptances: 0 } before setIsPreceeded.`),this._partiallyAcceptedSinceOriginal=e}setEndOfLifeReason(e){this.reportInlineEditHidden(),this._lastSetEndOfLifeReason=e}updateShownDuration(e){let t=Date.now();this._showStartTime||=t;let n=e===nT.Collapsed;!n&&this._showUncollapsedStartTime===void 0&&(this._showUncollapsedStartTime=t),n&&this._showUncollapsedStartTime!==void 0&&(this._showUncollapsedDuration+=t-this._showUncollapsedStartTime)}reportInlineEditHidden(){if(this._showStartTime===void 0)return;let e=Date.now();this._shownDuration+=e-this._showStartTime,this._showStartTime=void 0,this._showUncollapsedStartTime!==void 0&&(this._showUncollapsedDuration+=e-this._showUncollapsedStartTime,this._showUncollapsedStartTime=void 0)}},sT;(function(e){e.TextEditor=`textEditor`,e.DiffEditor=`diffEditor`,e.Notebook=`notebook`})(sT||={});var cT=class{constructor(e,t,n){this.inlineSuggestions=e,this.inlineSuggestionsData=t,this.provider=n,this.refCount=0}addRef(){this.refCount++}removeRef(e={kind:`other`}){if(this.refCount--,this.refCount===0){for(let e of this.inlineSuggestionsData)e.reportEndOfLife();this.provider.disposeInlineCompletions(this.inlineSuggestions,e)}}};function lT(e,t){let n=t.getWordAtPosition(e),r=t.getLineMaxColumn(e.lineNumber);return n?new S(e.lineNumber,n.startColumn,e.lineNumber,r):S.fromPositions(e,e.with(void 0,r))}function uT(e,t,n,r){let i=n.getLineContent(t.lineNumber),a=Rs.replace(new Pe(t.column-1,i.length),e),o=n.tokenization.tokenizeLinesAt(t.lineNumber,[a.replace(i)])?.[0].sliceZeroCopy(a.getRangeAfterReplace());return o?Qw(o,r):e}var dT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fT=function(e,t){return function(n,r){t(n,r,e)}},pT,mT=class extends b{static{pT=this}static{this._requestId=0}constructor(e,t,n,r,i,a,o,s){super(),this._textModel=e,this._versionId=t,this._debounceValue=n,this._cursorPosition=r,this._languageConfigurationService=i,this._logService=a,this._configurationService=o,this._instantiationService=s,this._updateOperation=this._register(new Ot),this._state=Rw(this,{initial:()=>({inlineCompletions:vT.createEmpty(),suggestWidgetInlineCompletions:vT.createEmpty()}),disposeFinal:e=>{e.inlineCompletions.dispose(),e.suggestWidgetInlineCompletions.dispose()},changeTracker:ln(()=>({versionId:this._versionId})),update:(e,t,n)=>{let r=te.compose(n.changes.map(e=>e.change?zw(e.change.changes):te.empty).filter(Vu));if(r.isEmpty())return t;try{return{inlineCompletions:t.inlineCompletions.createStateWithAppliedEdit(r,this._textModel),suggestWidgetInlineCompletions:t.suggestWidgetInlineCompletions.createStateWithAppliedEdit(r,this._textModel)}}finally{t.inlineCompletions.dispose(),t.suggestWidgetInlineCompletions.dispose()}}}),this.inlineCompletions=this._state.map(this,e=>e.inlineCompletions),this.suggestWidgetInlineCompletions=this._state.map(this,e=>e.suggestWidgetInlineCompletions),this.clearOperationOnTextModelChange=O(this,e=>{this._versionId.read(e),this._updateOperation.clear()}),this._loadingCount=Vl(this,0),this._loggingEnabled=ie(`editor.inlineSuggest.logFetch`,!1,this._configurationService).recomputeInitiallyAndOnChange(this._store),this._structuredFetchLogger=this._register(this._instantiationService.createInstance(IC.cast(),`editor.inlineSuggest.logFetch.commandId`)),this.clearOperationOnTextModelChange.recomputeInitiallyAndOnChange(this._store)}_log(e){this._loggingEnabled.get()&&this._logService.info(FC(e)),this._structuredFetchLogger.log(e)}fetch(e,t,n,r,i,a,o){let s=this._cursorPosition.get(),c=new hT(s,n,this._textModel.getVersionId(),new Set(e)),l=n.selectedSuggestionInfo?this.suggestWidgetInlineCompletions.get():this.inlineCompletions.get();if(this._updateOperation.value?.request.satisfies(c))return this._updateOperation.value.promise;if(l?.request?.satisfies(c))return Promise.resolve(!0);let u=!!this._updateOperation.value;this._updateOperation.clear();let d=new ur,f=(async()=>{this._loadingCount.set(this._loadingCount.get()+1,void 0);let s=new P;try{let l=this._debounceValue.get(this._textModel),f=ei(e.map(e=>e.debounceDelayMs),oi(Qi))??l;if((u||i&&n.triggerKind===xc.Automatic)&&await yw(f,d.token),d.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId)return!1;let p=pT._requestId++;(this._loggingEnabled.get()||this._structuredFetchLogger.isEnabled.get())&&this._log({sourceId:`InlineCompletions.fetch`,kind:`start`,requestId:p,modelUri:this._textModel.uri,modelVersion:this._textModel.getVersionId(),context:{triggerKind:n.triggerKind,suggestInfo:n.selectedSuggestionInfo?!0:void 0},time:Date.now(),provider:t});let m=new Date,h=rT(e,this._cursorPosition.get(),this._textModel,n,o,this._languageConfigurationService);iT(d.token,()=>h.cancelAndDispose({kind:`tokenCancellation`}));let g=!1,_=[];for await(let e of h.lists){if(!e)continue;e.addRef(),s.add(pl(()=>e.removeRef(e.inlineSuggestionsData.length===0?{kind:`empty`}:{kind:`notTaken`})));for(let t of e.inlineSuggestionsData){if(!n.includeInlineEdits&&(t.isInlineEdit||t.showInlineEditMenu)||!n.includeInlineCompletions&&!(t.isInlineEdit||t.showInlineEditMenu))continue;let e=Bw.create(t,this._textModel);_.push(e),!e.isInlineEdit&&!e.showInlineEditMenu&&n.triggerKind===xc.Automatic&&e.isVisible(this._textModel,this._cursorPosition.get())&&(g=!0)}if(g)break}if(h.cancelAndDispose({kind:`lostRace`}),this._loggingEnabled.get()||this._structuredFetchLogger.isEnabled.get()){let e=h.didAllProvidersReturn,t;(d.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId)&&(t=`canceled`);let n=_.map(e=>({range:e.editRange.toString(),text:e.insertText,isInlineEdit:!!e.isInlineEdit,source:e.source.provider.groupId}));this._log({sourceId:`InlineCompletions.fetch`,kind:`end`,requestId:p,durationMs:Date.now()-m.getTime(),error:t,result:n,time:Date.now(),didAllProvidersReturn:e})}let ee=n.earliestShownDateTime-Date.now();if(ee>0&&await yw(ee,d.token),d.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId||a.get())return!1;let v=new Date;this._debounceValue.update(this._textModel,v.getTime()-m.getTime());let te=this._cursorPosition.get();this._updateOperation.clear(),Fa(e=>{let t=this._state.get();n.selectedSuggestionInfo?this._state.set({inlineCompletions:vT.createEmpty(),suggestWidgetInlineCompletions:t.suggestWidgetInlineCompletions.createStateWithAppliedResults(_,c,this._textModel,te,r)},e):this._state.set({inlineCompletions:t.inlineCompletions.createStateWithAppliedResults(_,c,this._textModel,te,r),suggestWidgetInlineCompletions:vT.createEmpty()},e),t.inlineCompletions.dispose(),t.suggestWidgetInlineCompletions.dispose()})}finally{this._loadingCount.set(this._loadingCount.get()-1,void 0),s.dispose()}return!0})(),p=new _T(c,d,f);return this._updateOperation.value=p,f}clear(e){this._updateOperation.clear();let t=this._state.get();this._state.set({inlineCompletions:vT.createEmpty(),suggestWidgetInlineCompletions:vT.createEmpty()},e),t.inlineCompletions.dispose(),t.suggestWidgetInlineCompletions.dispose()}seedInlineCompletionsWithSuggestWidget(){let e=this.inlineCompletions.get(),t=this.suggestWidgetInlineCompletions.get();t&&Fa(n=>{if(!e||(t.request?.versionId??-1)>(e.request?.versionId??-1)){e?.dispose();let r=this._state.get();this._state.set({inlineCompletions:t.clone(),suggestWidgetInlineCompletions:vT.createEmpty()},n),r.inlineCompletions.dispose(),r.suggestWidgetInlineCompletions.dispose()}this.clearSuggestWidgetInlineCompletions(n)})}clearSuggestWidgetInlineCompletions(e){this._updateOperation.value?.request.context.selectedSuggestionInfo&&this._updateOperation.clear()}cancelUpdate(){this._updateOperation.clear()}};mT=pT=dT([fT(4,Ar),fT(5,za),fT(6,Ni),fT(7,k)],mT);var hT=class{constructor(e,t,n,r){this.position=e,this.context=t,this.versionId=n,this.providers=r}satisfies(e){return this.position.equals(e.position)&&Rc(this.context.selectedSuggestionInfo,e.context.selectedSuggestionInfo,Al())&&(e.context.triggerKind===xc.Automatic||this.context.triggerKind===xc.Explicit)&&this.versionId===e.versionId&&gT(e.providers,this.providers)}};function gT(e,t){return[...e].every(e=>t.has(e))}var _T=class{constructor(e,t,n){this.request=e,this.cancellationTokenSource=t,this.promise=n}dispose(){this.cancellationTokenSource.cancel()}},vT=class e extends b{static createEmpty(){return new e([],void 0)}constructor(e,t){for(let t of e)t.addRef();super(),this.inlineCompletions=e,this.request=t,this._register({dispose:()=>{for(let e of this.inlineCompletions)e.removeRef()}})}_findById(e){return this.inlineCompletions.find(t=>t.identity===e)}_findByHash(e){return this.inlineCompletions.find(t=>t.hash===e)}createStateWithAppliedEdit(t,n){let r=this.inlineCompletions.map(e=>e.withEdit(t,n)).filter(Vu);return new e(r,this.request)}createStateWithAppliedResults(t,n,r,i,a){let o;if(a){let e=this._findById(a);if(e&&e.canBeReused(r,n.position)){o=e;let n=t.find(t=>t.hash===e.hash);t=n?bT(n,t):[e,...t]}}let s=o?!o.isInlineEdit:t.some(e=>!e.isInlineEdit&&e.isVisible(r,i)),c=[];for(let e of t){let t=this._findByHash(e.hash),n;t&&t!==e?(n=e.withIdentity(t.identity),e.setIsPreceeded(t),t.setEndOfLifeReason({kind:tl.Ignored,userTypingDisagreed:!1,supersededBy:e.getSourceCompletion()})):n=e,s!==n.isInlineEdit&&c.push(n)}return c.sort(bt(e=>e.showInlineEditMenu,se)),c=yT(c,e=>e.semanticId),new e(c,n)}clone(){return new e(this.inlineCompletions,this.request)}};function yT(e,t){let n=new Set;return e.filter(e=>{let r=t(e);return n.has(r)?!1:(n.add(r),!0)})}function bT(e,t){let n=t.indexOf(e);return n>-1?[e,...t.slice(0,n),...t.slice(n+1)]:t}var xT=class{constructor(e,t,n){this.edit=e,this.commands=t,this.inlineCompletion=n}equals(e){return this.edit.equals(e.edit)&&this.inlineCompletion===e.inlineCompletion}},ST=class e extends b{static{this.MAX_SESSION_GAP_MS=3e3}static{this.MIN_SESSION_DURATION_MS=1e3}static{this.SESSION_HISTORY_LIMIT=50}static{this.TYPING_SPEED_WINDOW_MS=3e5}static{this.MIN_CHARS_FOR_RELIABLE_SPEED=20}getTypingInterval(){return(this._cacheInvalidated||this._cachedTypingIntervalResult===null)&&(this._cachedTypingIntervalResult=this._calculateTypingInterval(),this._cacheInvalidated=!1),this._cachedTypingIntervalResult}constructor(e){super(),this._textModel=e,this._typingSessions=[],this._currentSession=null,this._lastChangeTime=0,this._cachedTypingIntervalResult=null,this._cacheInvalidated=!0,this._register(this._textModel.onDidChangeContent(e=>this._updateTypingSpeed(e)))}_updateTypingSpeed(t){let n=Date.now();if(!this._isUserTyping(t)){this._finalizeCurrentSession();return}this._currentSession&&n-this._lastChangeTime>e.MAX_SESSION_GAP_MS&&this._finalizeCurrentSession(),this._currentSession||={startTime:n,endTime:n,characterCount:0},this._currentSession.endTime=n,this._currentSession.characterCount+=this._getActualCharacterCount(t),this._lastChangeTime=n,this._cacheInvalidated=!0}_getActualCharacterCount(e){let t=0;for(let n of e.changes)t+=Math.max(n.text.length,n.rangeLength);return t}_isUserTyping(e){if(!e.detailedReasons||e.detailedReasons.length===0)return!1;for(let t of e.detailedReasons)if(this._isUserTypingReason(t))return!0;return!1}_isUserTypingReason(e){if(e.metadata.isUndoing||e.metadata.isRedoing)return!1;switch(e.metadata.source){case`cursor`:{let t=e.metadata.kind;return t===`type`||t===`compositionType`||t===`compositionEnd`}default:return!1}}_finalizeCurrentSession(){this._currentSession&&=(this._currentSession.endTime-this._currentSession.startTime>=e.MIN_SESSION_DURATION_MS&&this._currentSession.characterCount>0&&(this._typingSessions.push(this._currentSession),this._typingSessions.length>e.SESSION_HISTORY_LIMIT&&this._typingSessions.shift()),null)}_calculateTypingInterval(){if(this._currentSession){let t={...this._currentSession};if(t.endTime-t.startTime>=e.MIN_SESSION_DURATION_MS&&t.characterCount>0){let e=[...this._typingSessions,t];return this._calculateSpeedFromSessions(e)}}return this._calculateSpeedFromSessions(this._typingSessions)}_calculateSpeedFromSessions(t){if(t.length===0)return{averageInterval:0,characterCount:0};let n=[...t].sort((e,t)=>t.endTime-e.endTime),r=Date.now()-e.TYPING_SPEED_WINDOW_MS,i=n.filter(e=>e.endTime>r),a=n.splice(i.length),o=mr(i.map(e=>e.characterCount));for(let t=0;t<a.length&&o<e.MIN_CHARS_FOR_RELIABLE_SPEED;t++)i.push(a[t]),o+=a[t].characterCount;let s=mr(i.map(e=>e.endTime-e.startTime));if(s===0||o<=1)return{averageInterval:0,characterCount:o};let c=Math.max(1,o-1),l=s/c;return{averageInterval:Math.round(l),characterCount:o}}dispose(){this._finalizeCurrentSession(),super.dispose()}},CT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},wT=function(e,t){return function(n,r){t(n,r,e)}},TT=class extends b{get isAcceptingPartially(){return this._isAcceptingPartially}constructor(e,t,n,r,i,a,o,s,c,l,u,d,p,m){super(),this.textModel=e,this._selectedSuggestItem=t,this._textModelVersionId=n,this._positions=r,this._debounceValue=i,this._enabled=a,this._editor=o,this._instantiationService=s,this._commandService=c,this._languageConfigurationService=l,this._accessibilityService=u,this._languageFeaturesService=d,this._codeEditorService=p,this._inlineCompletionsService=m,this._isActive=Vl(this,!1),this._onlyRequestInlineEditsSignal=yt(this),this._forceUpdateExplicitlySignal=yt(this),this._noDelaySignal=yt(this),this._fetchSpecificProviderSignal=yt(this),this._selectedInlineCompletionId=Vl(this,void 0),this.primaryPosition=O(this,e=>this._positions.read(e)[0]??new x(1,1)),this._isAcceptingPartially=!1,this._appearedInsideViewport=O(this,e=>{let t=this.state.read(e);if(!t||!t.inlineCompletion)return!1;let n=t.inlineCompletion.targetRange,r=this._editorObs.editor.getVisibleRanges();return r.length<1?!1:new S(r[0].startLineNumber,r[0].startColumn,r[r.length-1].endLineNumber,r[r.length-1].endColumn).containsRange(n)}),this._onDidAccept=new E,this.onDidAccept=this._onDidAccept.event,this._lastShownInlineCompletionInfo=void 0,this._lastAcceptedInlineCompletionInfo=void 0,this._didUndoInlineEdits=Vt({owner:this,changeTracker:{createChangeSummary:()=>({didUndo:!1}),handleChange:(e,t)=>(t.didUndo=e.didChange(this._textModelVersionId)&&!!e.change?.isUndoing,!0)}},(e,t)=>{let n=this._textModelVersionId.read(e);return n!==null&&this._lastAcceptedInlineCompletionInfo&&this._lastAcceptedInlineCompletionInfo.textModelVersionIdAfter===n-1&&this._lastAcceptedInlineCompletionInfo.inlineCompletion.isInlineEdit&&t.didUndo?(this._lastAcceptedInlineCompletionInfo=void 0,!0):!1}),this._preserveCurrentCompletionReasons=new Set([ET.Redo,ET.Undo,ET.AcceptWord]),this.dontRefetchSignal=yt(this),this._fetchInlineCompletionsPromise=Vt({owner:this,changeTracker:{createChangeSummary:()=>({dontRefetch:!1,preserveCurrentCompletion:!1,inlineCompletionTriggerKind:xc.Automatic,onlyRequestInlineEdits:!1,shouldDebounce:!0,provider:void 0,textChange:!1,changeReason:``}),handleChange:(e,t)=>{if(e.didChange(this._textModelVersionId)){this._preserveCurrentCompletionReasons.has(this._getReason(e.change))&&(t.preserveCurrentCompletion=!0);let n=e.change?.detailedReasons??[];t.changeReason=n.length>0?n[0].getType():``,t.textChange=!0}else e.didChange(this._forceUpdateExplicitlySignal)?(t.preserveCurrentCompletion=!0,t.inlineCompletionTriggerKind=xc.Explicit):e.didChange(this.dontRefetchSignal)?t.dontRefetch=!0:e.didChange(this._onlyRequestInlineEditsSignal)?t.onlyRequestInlineEdits=!0:e.didChange(this._fetchSpecificProviderSignal)&&(t.provider=e.change);return!0}}},(e,t)=>{if(this._source.clearOperationOnTextModelChange.read(e),this._noDelaySignal.read(e),this.dontRefetchSignal.read(e),this._onlyRequestInlineEditsSignal.read(e),this._forceUpdateExplicitlySignal.read(e),this._fetchSpecificProviderSignal.read(e),!((this._enabled.read(e)&&this._selectedSuggestItem.read(e)||this._isActive.read(e))&&(!this._inlineCompletionsService.isSnoozing()||t.inlineCompletionTriggerKind===xc.Explicit))){this._source.cancelUpdate();return}this._textModelVersionId.read(e);let n=this._source.suggestWidgetInlineCompletions.get(),r=this._selectedSuggestItem.read(e);if(this._shouldShowOnSuggestConflict.get()&&(r=void 0),n&&!r&&this._source.seedInlineCompletionsWithSuggestWidget(),t.dontRefetch)return Promise.resolve(!0);if(this._didUndoInlineEdits.read(e)&&t.inlineCompletionTriggerKind!==xc.Explicit){Fa(e=>{this._source.clear(e)});return}let i=``;t.provider?i+=`providerOnDidChange`:t.inlineCompletionTriggerKind===xc.Explicit&&(i+=`explicit`),t.changeReason&&(i+=i.length>0?`:${t.changeReason}`:t.changeReason);let a=this._typing.getTypingInterval(),o={editorType:this.editorType,startTime:Date.now(),languageId:this.textModel.getLanguageId(),reason:i,typingInterval:a.averageInterval,typingIntervalCharacterCount:a.characterCount},s={triggerKind:t.inlineCompletionTriggerKind,selectedSuggestionInfo:r?.toSelectedSuggestionInfo(),includeInlineCompletions:!t.onlyRequestInlineEdits,includeInlineEdits:this._inlineEditsEnabled.read(e),requestIssuedDateTime:o.startTime,earliestShownDateTime:o.startTime+(t.inlineCompletionTriggerKind===xc.Explicit||this.inAcceptFlow.get()?0:this._minShowDelay.get())};s.triggerKind===xc.Automatic&&t.textChange&&this.textModel.getAlternativeVersionId()===this._lastShownInlineCompletionInfo?.alternateTextModelVersionId&&(s={...s,includeInlineCompletions:!this._lastShownInlineCompletionInfo.inlineCompletion.isInlineEdit,includeInlineEdits:this._lastShownInlineCompletionInfo.inlineCompletion.isInlineEdit});let c=this.selectedInlineCompletion.get()??this._inlineCompletionItems.get()?.inlineEdit,l=t.preserveCurrentCompletion||c?.forwardStable?c:void 0,u=this._jumpedToId.map(e=>!!e&&e===this._inlineCompletionItems.get()?.inlineEdit?.semanticId),d=t.provider?{providers:[t.provider],label:`single:`+t.provider.providerId?.toString()}:{providers:this._languageFeaturesService.inlineCompletionsProvider.all(this.textModel),label:void 0},f=this.getAvailableProviders(d.providers);return this._source.fetch(f,d.label,s,l?.identity,t.shouldDebounce,u,o)}),this._inlineCompletionItems=Zi({owner:this},e=>{let t=this._source.inlineCompletions.read(e);if(!t)return;let n=this.primaryPosition.read(e),r,i=[];for(let e of t.inlineCompletions)e.isInlineEdit?r=e:e.isVisible(this.textModel,n)&&i.push(e);return i.length!==0&&(r=void 0),{inlineCompletions:i,inlineEdit:r}}),this._filteredInlineCompletionItems=Zi({owner:this,equalsFn:ao()},e=>this._inlineCompletionItems.read(e)?.inlineCompletions??[]),this.selectedInlineCompletionIndex=O(this,e=>{let t=this._selectedInlineCompletionId.read(e),n=this._filteredInlineCompletionItems.read(e),r=this._selectedInlineCompletionId===void 0?-1:n.findIndex(e=>e.semanticId===t);return r===-1?(this._selectedInlineCompletionId.set(void 0,void 0),0):r}),this.selectedInlineCompletion=O(this,e=>{let t=this._filteredInlineCompletionItems.read(e),n=this.selectedInlineCompletionIndex.read(e);return t[n]}),this.activeCommands=Zi({owner:this,equalsFn:ao()},e=>this.selectedInlineCompletion.read(e)?.source.inlineSuggestions.commands??[]),this.inlineCompletionsCount=O(this,e=>{if(this.lastTriggerKind.read(e)===xc.Explicit)return this._filteredInlineCompletionItems.read(e).length}),this._hasVisiblePeekWidgets=O(this,e=>this._editorObs.openedPeekWidgets.read(e)>0),this._shouldShowOnSuggestConflict=O(this,e=>{let t=this._showOnSuggestConflict.read(e);if(t!==`never`&&this.selectedInlineCompletion.read(e)){let n=this._selectedSuggestItem.read(e);return n?t===`whenSuggestListIsIncomplete`?n.listIncomplete:!0:!1}return!1}),this.state=Zi({owner:this,equalsFn:(e,t)=>!e||!t?e===t:e.kind===`ghostText`&&t.kind===`ghostText`?Ow(e.ghostTexts,t.ghostTexts)&&e.inlineCompletion===t.inlineCompletion&&e.suggestItem===t.suggestItem:e.kind===`inlineEdit`&&t.kind===`inlineEdit`?e.inlineEdit.equals(t.inlineEdit):!1},e=>{let t=this.textModel,n=this._inlineCompletionItems.read(e),r=n?.inlineEdit;if(r){if(this._hasVisiblePeekWidgets.read(e))return;let i=r.getSingleTextEdit();i=Aw(i,t);let a=this.primaryPosition.map(e=>Ya.fromRangeInclusive(r.targetRange).addMargin(1,1).contains(e.lineNumber)),o=r.source.inlineSuggestions.commands,s=new xT(i,o??[],r),c=r.updatedEdit,l=c?ps.fromStringEdit(c,new Hn(this.textModel)).replacements:[i],u=(n.inlineEdit?.command?.id===`vscode.open`||n.inlineEdit?.command?.id===`_workbench.open`)&&n.inlineEdit?.command.arguments?.length?$n.from(n.inlineEdit?.command.arguments[0]):void 0;return{kind:`inlineEdit`,inlineEdit:s,inlineCompletion:r,edits:l,cursorAtInlineEdit:a,nextEditUri:u}}let i=this._selectedSuggestItem.read(e);if(!this._shouldShowOnSuggestConflict.read(e)&&i){let n=Aw(i.getSingleTextEdit(),t),r=this._computeAugmentation(n,e);if(!this._suggestPreviewEnabled.read(e)&&!r)return;let a=r?.edit??n,o=r?r.edit.text.length-n.text.length:0,s=this._suggestPreviewMode.read(e),c=this._positions.read(e),l=[a,...DT(this.textModel,c,a)].map((e,n)=>({edit:e,ghostText:e?Nw(e,t,s,c[n],o):void 0})).filter(({edit:e,ghostText:t})=>e!==void 0&&t!==void 0),u=l.map(({edit:e})=>e),d=l.map(({ghostText:e})=>e),f=d[0]??new Tw(a.range.endLineNumber,[]);return{kind:`ghostText`,edits:u,primaryGhostText:f,ghostTexts:d,inlineCompletion:r?.completion,suggestItem:i}}else{if(!this._isActive.read(e))return;let n=this.selectedInlineCompletion.read(e);if(!n)return;let r=n.getSingleTextEdit(),i=this._inlineSuggestMode.read(e),a=this._positions.read(e),o=[r,...DT(this.textModel,a,r)].map((e,n)=>({edit:e,ghostText:e?Nw(e,t,i,a[n],0):void 0})).filter(({edit:e,ghostText:t})=>e!==void 0&&t!==void 0),s=o.map(({edit:e})=>e),c=o.map(({ghostText:e})=>e);return c[0]?{kind:`ghostText`,edits:s,primaryGhostText:c[0],ghostTexts:c,inlineCompletion:n,suggestItem:void 0}:void 0}}),this.inlineCompletionState=O(this,e=>{let t=this.state.read(e);if(!(!t||t.kind!==`ghostText`)&&!this._editorObs.inComposition.read(e))return t}),this.inlineEditState=O(this,e=>{let t=this.state.read(e);if(!(!t||t.kind!==`inlineEdit`))return t}),this.inlineEditAvailable=O(this,e=>!!this.inlineEditState.read(e)),this.warning=O(this,e=>this.inlineCompletionState.read(e)?.inlineCompletion?.warning),this.ghostTexts=Zi({owner:this,equalsFn:Ow},e=>{let t=this.inlineCompletionState.read(e);if(t)return t.ghostTexts}),this.primaryGhostText=Zi({owner:this,equalsFn:kw},e=>{let t=this.inlineCompletionState.read(e);if(t)return t?.primaryGhostText}),this.showCollapsed=O(this,e=>{let t=this.state.read(e);if(!t||t.kind!==`inlineEdit`||t.inlineCompletion.displayLocation)return!1;let n=t.inlineCompletion.updatedEditModelVersion===this._textModelVersionId.read(e);return(this._inlineEditsShowCollapsedEnabled.read(e)||!n)&&this._jumpedToId.read(e)!==t.inlineCompletion.semanticId&&!this._inAcceptFlow.read(e)}),this._tabShouldIndent=O(this,e=>{if(this._inAcceptFlow.read(e))return!1;function t(e){return e.startLineNumber!==e.endLineNumber}function n(e,t){let n=e.getLineIndentColumn(t),r=e.getLineLastNonWhitespaceColumn(t);return new S(t,n,t,Math.max(r,n))}return this._editorObs.selections.read(e)?.some(e=>e.isEmpty()?this.textModel.getLineLength(e.startLineNumber)===0:t(e)||e.containsRange(n(this.textModel,e.startLineNumber)))}),this.tabShouldJumpToInlineEdit=O(this,e=>{if(this._tabShouldIndent.read(e))return!1;let t=this.inlineEditState.read(e);return t?this.showCollapsed.read(e)?!0:this._inAcceptFlow.read(e)&&this._appearedInsideViewport.read(e)?!1:!t.cursorAtInlineEdit.read(e):!1}),this.tabShouldAcceptInlineEdit=O(this,e=>{let t=this.inlineEditState.read(e);return!t||this.showCollapsed.read(e)?!1:this._inAcceptFlow.read(e)&&this._appearedInsideViewport.read(e)||t.inlineCompletion.targetRange.startLineNumber===this._editorObs.cursorLineNumber.read(e)||this._jumpedToId.read(e)===t.inlineCompletion.semanticId?!0:this._tabShouldIndent.read(e)?!1:t.cursorAtInlineEdit.read(e)}),this._jumpedToId=Vl(this,void 0),this._inAcceptFlow=Vl(this,!1),this.inAcceptFlow=this._inAcceptFlow,this._source=this._register(this._instantiationService.createInstance(mT,this.textModel,this._textModelVersionId,this._debounceValue,this.primaryPosition)),this.lastTriggerKind=this._source.inlineCompletions.map(this,e=>e?.request?.context.triggerKind),this._editorObs=f(this._editor);let h=this._editorObs.getOption(133);this._suggestPreviewEnabled=h.map(e=>e.preview),this._suggestPreviewMode=h.map(e=>e.previewMode);let g=this._editorObs.getOption(71);this._inlineSuggestMode=g.map(e=>e.mode),this._suppressedInlineCompletionGroupIds=g.map(e=>new Set(e.experimental.suppressInlineSuggestions.split(`,`))),this._inlineEditsEnabled=g.map(e=>!!e.edits.enabled),this._inlineEditsShowCollapsedEnabled=g.map(e=>e.edits.showCollapsed),this._triggerCommandOnProviderChange=g.map(e=>e.triggerCommandOnProviderChange),this._minShowDelay=g.map(e=>e.minShowDelay),this._showOnSuggestConflict=g.map(e=>e.experimental.showOnSuggestConflict),this._typing=this._register(new ST(this.textModel)),this._register(this._inlineCompletionsService.onDidChangeIsSnoozing(e=>{e&&this.stop()}));{let e=this.textModel.uri.scheme===`vscode-notebook-cell`,[t]=this._codeEditorService.listDiffEditors().filter(e=>e.getOriginalEditor().getId()===this._editor.getId()||e.getModifiedEditor().getId()===this._editor.getId());this.isInDiffEditor=!!t,this.editorType=e?sT.Notebook:this.isInDiffEditor?sT.DiffEditor:sT.TextEditor}this._register(_i(this.state,e=>{e&&e.inlineCompletion&&this._inlineCompletionsService.reportNewCompletion(e.inlineCompletion.requestUuid)})),this._register(_i(this._fetchInlineCompletionsPromise)),this._register(la(e=>{this._editorObs.versionId.read(e),this._inAcceptFlow.set(!1,void 0)})),this._register(la(e=>{this.state.map((e,t)=>!e||e.kind===`inlineEdit`&&!e.cursorAtInlineEdit.read(t)).read(e)&&this._jumpedToId.set(void 0,void 0)}));let _=this.inlineEditState.map(e=>e?.inlineCompletion.semanticId);this._register(la(e=>{_.read(e)&&(this._editor.pushUndoStop(),this._lastShownInlineCompletionInfo={alternateTextModelVersionId:this.textModel.getAlternativeVersionId(),inlineCompletion:this.state.get().inlineCompletion})}));let ee=ai(this._languageFeaturesService.inlineCompletionsProvider.onDidChange,()=>this._languageFeaturesService.inlineCompletionsProvider.all(e));oe(this,ee,(e,t)=>{e.onDidChangeInlineCompletions&&t.add(e.onDidChangeInlineCompletions(()=>{if(!this._enabled.get()||(this._codeEditorService.getFocusedCodeEditor()||this._codeEditorService.getActiveCodeEditor())!==this._editor)return;if(this._triggerCommandOnProviderChange.get()){this.trigger(void 0,{onlyFetchInlineEdits:!0});return}let t=this.state.get();t&&(t.inlineCompletion||t.edits)&&t.inlineCompletion?.source.provider!==e||Fa(t=>{this._fetchSpecificProviderSignal.trigger(t,e),this.trigger(t)})}))}).recomputeInitiallyAndOnChange(this._store),this._didUndoInlineEdits.recomputeInitiallyAndOnChange(this._store)}getIndentationInfo(e){let t=!1,n=!0,r=this?.primaryGhostText.read(e);if(this?._selectedSuggestItem&&r&&r.parts.length>0){let{column:e,lines:i}=r.parts[0],a=i[0].line,o=this.textModel.getLineIndentColumn(r.lineNumber);if(e<=o){let e=St(a);e===-1&&(e=a.length-1),t=e>0;let r=this.textModel.getOptions().tabSize;n=yu.visibleColumnFromColumn(a,e+1,r)<r}}return{startsWithIndentation:t,startsWithIndentationLessThanTabSize:n}}_getReason(e){return e?.isUndoing?ET.Undo:e?.isRedoing?ET.Redo:this.isAcceptingPartially?ET.AcceptWord:ET.Other}getAvailableProviders(e){let t=this._suppressedInlineCompletionGroupIds.get(),n=e.filter(e=>!(e.groupId&&t.has(e.groupId))),r=new Set;for(let e of n)e.excludesGroupIds?.forEach(e=>r.add(e));let i=[];for(let e of n){if(e.groupId&&r.has(e.groupId))continue;i.push(e)}return i}async trigger(e,t){Cs(e,e=>{t?.onlyFetchInlineEdits&&this._onlyRequestInlineEditsSignal.trigger(e),t?.noDelay&&this._noDelaySignal.trigger(e),this._isActive.set(!0,e)}),await this._fetchInlineCompletionsPromise.get()}async triggerExplicitly(e,t=!1){Cs(e,e=>{t&&this._onlyRequestInlineEditsSignal.trigger(e),this._isActive.set(!0,e),this._inAcceptFlow.set(!0,e),this._forceUpdateExplicitlySignal.trigger(e)}),await this._fetchInlineCompletionsPromise.get()}stop(e=`automatic`,t){Cs(t,t=>{if(e===`explicitCancel`){let e=this.state.get()?.inlineCompletion;e&&e.reportEndOfLife({kind:tl.Rejected})}this._isActive.set(!1,t),this._source.clear(t)})}_computeAugmentation(e,t){let n=this.textModel,r=this._source.suggestWidgetInlineCompletions.read(t),i=r?r.inlineCompletions.filter(e=>!e.isInlineEdit):[this.selectedInlineCompletion.read(t)].filter(Vu);return Ge(i,t=>{let r=t.getSingleTextEdit();return r=Aw(r,n,S.fromPositions(r.range.getStartPosition(),e.range.getEndPosition())),jw(r,e)?{completion:t,edit:r}:void 0})}async _deltaSelectedInlineCompletionIndex(e){await this.triggerExplicitly();let t=this._filteredInlineCompletionItems.get()||[];if(t.length>0){let n=(this.selectedInlineCompletionIndex.get()+e+t.length)%t.length;this._selectedInlineCompletionId.set(t[n].semanticId,void 0)}else this._selectedInlineCompletionId.set(void 0,void 0)}async next(){await this._deltaSelectedInlineCompletionIndex(1)}async previous(){await this._deltaSelectedInlineCompletionIndex(-1)}_getMetadata(e,t,n=void 0){return n?Xa.inlineCompletionPartialAccept({nes:e.isInlineEdit,requestUuid:e.requestUuid,providerId:e.source.provider.providerId,languageId:t,type:n}):Xa.inlineCompletionAccept({nes:e.isInlineEdit,requestUuid:e.requestUuid,providerId:e.source.provider.providerId,languageId:t})}async accept(e=this._editor){if(e.getModel()!==this.textModel)throw new h;let t,n=!1,r=this.state.get();if(r?.kind===`ghostText`){if(!r||r.primaryGhostText.isEmpty()||!r.inlineCompletion)return;t=r.inlineCompletion}else if(r?.kind===`inlineEdit`)t=r.inlineCompletion,n=!!r.nextEditUri;else return;t.addRef();try{if(e.pushUndoStop(),!n)if(t.snippetInfo){let n=es.delete(t.editRange),r=t.additionalTextEdits.map(e=>new es(S.lift(e.range),e.text??``)),i=ps.fromParallelReplacementsUnsorted([n,...r]);e.edit(i,this._getMetadata(t,this.textModel.getLanguageId())),e.setPosition(t.snippetInfo.range.getStartPosition(),`inlineCompletionAccept`),cw.get(e)?.insert(t.snippetInfo.snippet,{undoStopBefore:!1})}else{let n=r.edits,i=n;r.kind===`ghostText`&&(i=gw(n,this.textModel));let a=mw(i).map(e=>N.fromPositions(e)),o=t.additionalTextEdits.map(e=>new es(S.lift(e.range),e.text??``)),s=ps.fromParallelReplacementsUnsorted([...n,...o]);if(e.edit(s,this._getMetadata(t,this.textModel.getLanguageId())),t.displayLocation===void 0&&e.setSelections(r.kind===`inlineEdit`?a.slice(-1):a,`inlineCompletionAccept`),r.kind===`inlineEdit`&&!this._accessibilityService.isMotionReduced()){let t=s.getNewRanges(),n=this._store.add(new OT(e,t,()=>{this._store.delete(n)}))}}this._onDidAccept.fire(),this.stop(),t.command&&await this._commandService.executeCommand(t.command.id,...t.command.arguments||[]).then(void 0,Ze),t.reportEndOfLife({kind:tl.Accepted})}finally{t.removeRef(),this._inAcceptFlow.set(!0,void 0),this._lastAcceptedInlineCompletionInfo={textModelVersionIdAfter:this.textModel.getVersionId(),inlineCompletion:t}}}async acceptNextWord(){await this._acceptNext(this._editor,`word`,(e,t)=>{let n=this.textModel.getLanguageIdAtPosition(e.lineNumber,e.column),r=this._languageConfigurationService.getLanguageConfiguration(n),i=new RegExp(r.wordDefinition.source,r.wordDefinition.flags.replace(`g`,``)),a=t.match(i),o=0;o=a&&a.index!==void 0?a.index===0?a[0].length:a.index:t.length;let s=/\s+/g.exec(t);return s&&s.index!==void 0&&s.index+s[0].length<o&&(o=s.index+s[0].length),o},0)}async acceptNextLine(){await this._acceptNext(this._editor,`line`,(e,t)=>{let n=t.match(/\n/);return n&&n.index!==void 0?n.index+1:t.length},1)}async _acceptNext(e,t,n,r){if(e.getModel()!==this.textModel)throw new h;let i=this.inlineCompletionState.get();if(!i||i.primaryGhostText.isEmpty()||!i.inlineCompletion)return;let a=i.primaryGhostText,o=i.inlineCompletion;if(o.snippetInfo){await this.accept(e);return}let s=a.parts[0],c=new x(a.lineNumber,s.column),l=s.text,u=n(c,l);if(u===l.length&&a.parts.length===1){this.accept(e);return}let d=l.substring(0,u),f=this._positions.get(),p=f[0];o.addRef();try{this._isAcceptingPartially=!0;try{e.pushUndoStop();let n=S.fromPositions(p,c),r=e.getModel().getValueInRange(n)+d,i=new es(n,r),a=[i,...DT(this.textModel,f,i)].filter(Vu),s=mw(a).map(e=>N.fromPositions(e));e.edit(ps.fromParallelReplacementsUnsorted(a),this._getMetadata(o,t)),e.setSelections(s,`inlineCompletionPartialAccept`),e.revealPositionInCenterIfOutsideViewport(e.getPosition(),1)}finally{this._isAcceptingPartially=!1}let n=S.fromPositions(o.editRange.getStartPosition(),Gu.ofText(d).addToPosition(c)),i=e.getModel().getValueInRange(n,1).length;o.reportPartialAccept(i,{kind:r,acceptedLength:i},{characters:u,ratio:u/l.length,count:1})}finally{o.removeRef()}}handleSuggestAccepted(e){let t=Aw(e.getSingleTextEdit(),this.textModel),n=this._computeAugmentation(t,void 0);if(!n)return;let r=this.textModel.getValueInRange(n.completion.editRange,1).length+t.text.length;n.completion.reportPartialAccept(t.text.length,{kind:2,acceptedLength:r},{characters:t.text.length,count:1,ratio:1})}extractReproSample(){let e=this.textModel.getValue(),t=this.state.get()?.inlineCompletion;return{documentValue:e,inlineCompletion:t?.getSourceCompletion()}}jump(){let e=this.inlineEditState.get();e&&Fa(t=>{this._jumpedToId.set(e.inlineCompletion.semanticId,t),this.dontRefetchSignal.trigger(t);let n=e.inlineCompletion.targetRange,r=n.getStartPosition();if(this._editor.setPosition(r,`inlineCompletions.jump`),n.isSingleLine()&&(e.inlineCompletion.displayLocation||!e.inlineCompletion.insertText.includes(`
`)))this._editor.revealPosition(r);else{let e=new S(n.startLineNumber-1,1,n.endLineNumber+1,1);this._editor.revealRange(e,1)}this._editor.focus()})}async handleInlineSuggestionShown(e,t,n){await e.reportInlineEditShown(this._commandService,t,n)}};TT=CT([wT(7,k),wT(8,Mr),wT(9,Ar),wT(10,Zt),wT(11,W),wT(12,mt),wT(13,Wu)],TT);var ET;(function(e){e[e.Undo=0]=`Undo`,e[e.Redo=1]=`Redo`,e[e.AcceptWord=2]=`AcceptWord`,e[e.Other=3]=`Other`})(ET||={});function DT(e,t,n){if(t.length===1)return[];let r=new Hn(e),i=r.getTransformer(),a=i.getOffset(t[0]),o=t.slice(1).map(e=>i.getOffset(e));n=n.removeCommonPrefixAndSuffix(r);let s=i.getStringReplacement(n),c=s.replaceRange.start-a,l=s.replaceRange.join(Pe.emptyAt(a)),u=r.getValueOfOffsetRange(l);return o.map(e=>{let t=e+c,n=t+s.replaceRange.length,a=new Pe(t,n),o=a.join(Pe.emptyAt(e));if(r.getValueOfOffsetRange(o)!==u)return;let l=new Rs(a,s.newText);return i.getTextReplacement(l)}).filter(Vu)}var OT=class extends b{constructor(e,t,n){super(),n&&this._register({dispose:()=>n()}),this._register(f(e).setDecorations(jt(t.map(e=>({range:e,options:{description:`animation`,className:`edits-fadeout-decoration`,zIndex:1}})))));let r=new bw(1,0,1e3,Sw),i=new Cw(r);this._register(la(t=>{let n=i.getValue(t);e.getContainerDomNode().style.setProperty(`--animation-opacity`,n.toString()),r.isFinished()&&this.dispose()}))}},kT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},AT=function(e,t){return function(n,r){t(n,r,e)}},jT,MT=class{constructor(e){this.name=e}select(e,t,n){if(n.length===0)return 0;let r=n[0].score[0];for(let e=0;e<n.length;e++){let{score:t,completion:i}=n[e];if(t[0]!==r)break;if(i.preselect)return e}return 0}},NT=class extends MT{constructor(){super(`first`)}memorize(e,t,n){}toJSON(){}fromJSON(){}},PT=class extends MT{constructor(){super(`recentlyUsed`),this._cache=new Za(300,.66),this._seq=0}memorize(e,t,n){let r=`${e.getLanguageId()}/${n.textLabel}`;this._cache.set(r,{touch:this._seq++,type:n.completion.kind,insertText:n.completion.insertText})}select(e,t,n){if(n.length===0)return 0;let r=e.getLineContent(t.lineNumber).substr(t.column-10,t.column-1);if(/\s$/.test(r))return super.select(e,t,n);let i=n[0].score[0],a=-1,o=-1,s=-1;for(let t=0;t<n.length&&n[t].score[0]===i;t++){let r=`${e.getLanguageId()}/${n[t].textLabel}`,i=this._cache.peek(r);if(i&&i.touch>s&&i.type===n[t].completion.kind&&i.insertText===n[t].completion.insertText&&(s=i.touch,o=t),n[t].completion.preselect&&a===-1)return a=t}return o===-1?a===-1?0:a:o}toJSON(){return this._cache.toJSON()}fromJSON(e){this._cache.clear();for(let[t,n]of e)n.touch=0,n.type=typeof n.type==`number`?n.type:Wc.fromString(n.type),this._cache.set(t,n);this._seq=this._cache.size}},FT=class extends MT{constructor(){super(`recentlyUsedByPrefix`),this._trie=oc.forStrings(),this._seq=0}memorize(e,t,n){let{word:r}=e.getWordUntilPosition(t),i=`${e.getLanguageId()}/${r}`;this._trie.set(i,{type:n.completion.kind,insertText:n.completion.insertText,touch:this._seq++})}select(e,t,n){let{word:r}=e.getWordUntilPosition(t);if(!r)return super.select(e,t,n);let i=`${e.getLanguageId()}/${r}`,a=this._trie.get(i);if(a||=this._trie.findSubstr(i),a)for(let e=0;e<n.length;e++){let{kind:t,insertText:r}=n[e].completion;if(t===a.type&&r===a.insertText)return e}return super.select(e,t,n)}toJSON(){let e=[];return this._trie.forEach((t,n)=>e.push([n,t])),e.sort((e,t)=>-(e[1].touch-t[1].touch)).forEach((e,t)=>e[1].touch=t),e.slice(0,200)}fromJSON(e){if(this._trie.clear(),e.length>0){this._seq=e[0][1].touch+1;for(let[t,n]of e)n.type=typeof n.type==`number`?n.type:Wc.fromString(n.type),this._trie.set(t,n)}}},IT=class{static{jT=this}static{this._strategyCtors=new Map([[`recentlyUsedByPrefix`,FT],[`recentlyUsed`,PT],[`first`,NT]])}static{this._storagePrefix=`suggest/memories`}constructor(e,t){this._storageService=e,this._configService=t,this._disposables=new P,this._persistSoon=new ju(()=>this._saveState(),500),this._disposables.add(e.onWillSaveState(e=>{e.reason===Vr.SHUTDOWN&&this._saveState()}))}dispose(){this._disposables.dispose(),this._persistSoon.dispose()}memorize(e,t,n){this._withStrategy(e,t).memorize(e,t,n),this._persistSoon.schedule()}select(e,t,n){return this._withStrategy(e,t).select(e,t,n)}_withStrategy(e,t){let n=this._configService.getValue(`editor.suggestSelection`,{overrideIdentifier:e.getLanguageIdAtPosition(t.lineNumber,t.column),resource:e.uri});if(this._strategy?.name!==n){this._saveState(),this._strategy=new((jT._strategyCtors.get(n))||NT);try{let e=this._configService.getValue(`editor.suggest.shareSuggestSelections`)?0:1,t=this._storageService.get(`${jT._storagePrefix}/${n}`,e);t&&this._strategy.fromJSON(JSON.parse(t))}catch{}}return this._strategy}_saveState(){if(this._strategy){let e=this._configService.getValue(`editor.suggest.shareSuggestSelections`)?0:1,t=JSON.stringify(this._strategy);this._storageService.store(`${jT._storagePrefix}/${this._strategy.name}`,t,e,1)}}};IT=jT=kT([AT(0,Mu),AT(1,Ni)],IT);const LT=dl(`ISuggestMemories`);wt(LT,IT,1);var RT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},zT=function(e,t){return function(n,r){t(n,r,e)}},BT,VT=class{static{BT=this}static{this.AtEnd=new T(`atEndOfWord`,!1,{type:`boolean`,description:H(1476,`A context key that is true when at the end of a word. Note that this is only defined when tab-completions are enabled`)})}constructor(e,t){this._editor=e,this._enabled=!1,this._ckAtEnd=BT.AtEnd.bindTo(t),this._configListener=this._editor.onDidChangeConfiguration(e=>e.hasChanged(138)&&this._update()),this._update()}dispose(){this._configListener.dispose(),this._selectionListener?.dispose(),this._ckAtEnd.reset()}_update(){let e=this._editor.getOption(138)===`on`;if(this._enabled!==e)if(this._enabled=e,this._enabled){let e=()=>{if(!this._editor.hasModel()){this._ckAtEnd.set(!1);return}let e=this._editor.getModel(),t=this._editor.getSelection(),n=e.getWordAtPosition(t.getStartPosition());if(!n){this._ckAtEnd.set(!1);return}this._ckAtEnd.set(n.endColumn===t.getStartPosition().column&&t.getStartPosition().lineNumber===t.getEndPosition().lineNumber)};this._selectionListener=this._editor.onDidChangeCursorSelection(e),e()}else this._selectionListener&&=(this._ckAtEnd.reset(),this._selectionListener.dispose(),void 0)}};VT=BT=RT([zT(1,w)],VT);var HT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},UT=function(e,t){return function(n,r){t(n,r,e)}},WT,GT=class{static{WT=this}static{this.OtherSuggestions=new T(`hasOtherSuggestions`,!1)}constructor(e,t){this._editor=e,this._index=0,this._ckOtherSuggestions=WT.OtherSuggestions.bindTo(t)}dispose(){this.reset()}reset(){this._ckOtherSuggestions.reset(),this._listener?.dispose(),this._model=void 0,this._acceptNext=void 0,this._ignore=!1}set({model:e,index:t},n){if(e.items.length===0){this.reset();return}if(WT._moveIndex(!0,e,t)===t){this.reset();return}this._acceptNext=n,this._model=e,this._index=t,this._listener=this._editor.onDidChangeCursorPosition(()=>{this._ignore||this.reset()}),this._ckOtherSuggestions.set(!0)}static _moveIndex(e,t,n){let r=n;for(let i=t.items.length;i>0&&(r=(r+t.items.length+(e?1:-1))%t.items.length,!(r===n||!t.items[r].completion.additionalTextEdits));i--);return r}next(){this._move(!0)}prev(){this._move(!1)}_move(e){if(this._model)try{this._ignore=!0,this._index=WT._moveIndex(e,this._model,this._index),this._acceptNext({index:this._index,item:this._model.items[this._index],model:this._model})}finally{this._ignore=!1}}};GT=WT=HT([UT(1,w)],GT);var KT=class{constructor(e,t,n,r){this._disposables=new P,this._disposables.add(n.onDidSuggest(e=>{e.completionModel.items.length===0&&this.reset()})),this._disposables.add(n.onDidCancel(e=>{this.reset()})),this._disposables.add(t.onDidShow(()=>this._onItem(t.getFocusedItem()))),this._disposables.add(t.onDidFocus(this._onItem,this)),this._disposables.add(t.onDidHide(this.reset,this)),this._disposables.add(e.onWillType(i=>{if(this._active&&!t.isFrozen()&&n.state!==0){let t=i.charCodeAt(i.length-1);this._active.acceptCharacters.has(t)&&e.getOption(0)&&r(this._active.item)}}))}_onItem(e){if(!e||!Ht(e.item.completion.commitCharacters)){this.reset();return}if(this._active&&this._active.item.item===e.item)return;let t=new It;for(let n of e.item.completion.commitCharacters)n.length>0&&t.add(n.charCodeAt(0));this._active={acceptCharacters:t,item:e}}reset(){this._active=void 0}dispose(){this._disposables.dispose()}},qT=class e{async provideSelectionRanges(t,n){let r=[];for(let i of n){let n=[];r.push(n);let a=new Map;await new Promise(n=>e._bracketsRightYield(n,0,t,i,a)),await new Promise(r=>e._bracketsLeftYield(r,0,t,i,a,n))}return r}static{this._maxDuration=30}static{this._maxRounds=2}static _bracketsRightYield(t,n,r,i,a){let o=new Map,s=Date.now();for(;;){if(n>=e._maxRounds){t();break}if(!i){t();break}let c=r.bracketPairs.findNextBracket(i);if(!c){t();break}if(Date.now()-s>e._maxDuration){setTimeout(()=>e._bracketsRightYield(t,n+1,r,i,a));break}if(c.bracketInfo.isOpeningBracket){let e=c.bracketInfo.bracketText,t=o.has(e)?o.get(e):0;o.set(e,t+1)}else{let e=c.bracketInfo.getOpeningBrackets()[0].bracketText,t=o.has(e)?o.get(e):0;if(--t,o.set(e,Math.max(0,t)),t<0){let t=a.get(e);t||(t=new Tc,a.set(e,t)),t.push(c.range)}}i=c.range.getEndPosition()}}static _bracketsLeftYield(t,n,r,i,a,o){let s=new Map,c=Date.now();for(;;){if(n>=e._maxRounds&&a.size===0){t();break}if(!i){t();break}let l=r.bracketPairs.findPrevBracket(i);if(!l){t();break}if(Date.now()-c>e._maxDuration){setTimeout(()=>e._bracketsLeftYield(t,n+1,r,i,a,o));break}if(l.bracketInfo.isOpeningBracket){let t=l.bracketInfo.bracketText,n=s.has(t)?s.get(t):0;if(--n,s.set(t,Math.max(0,n)),n<0){let n=a.get(t);if(n){let i=n.shift();n.size===0&&a.delete(t);let s=S.fromPositions(l.range.getEndPosition(),i.getStartPosition()),c=S.fromPositions(l.range.getStartPosition(),i.getEndPosition());o.push({range:s}),o.push({range:c}),e._addBracketLeading(r,c,o)}}}else{let e=l.bracketInfo.getOpeningBrackets()[0].bracketText,t=s.has(e)?s.get(e):0;s.set(e,t+1)}i=l.range.getStartPosition()}}static _addBracketLeading(e,t,n){if(t.startLineNumber===t.endLineNumber)return;let r=t.startLineNumber,i=e.getLineFirstNonWhitespaceColumn(r);i!==0&&i!==t.startColumn&&(n.push({range:S.fromPositions(new x(r,i),t.getEndPosition())}),n.push({range:S.fromPositions(new x(r,1),t.getEndPosition())}));let a=r-1;if(a>0){let r=e.getLineFirstNonWhitespaceColumn(a);r===t.startColumn&&r!==e.getLineLastNonWhitespaceColumn(a)&&(n.push({range:S.fromPositions(new x(a,r),t.getEndPosition())}),n.push({range:S.fromPositions(new x(a,1),t.getEndPosition())}))}}},JT=class e{static{this.None=new class extends e{distance(){return 0}}}static async create(t,n){if(!n.getOption(133).localityBonus||!n.hasModel())return e.None;let r=n.getModel(),i=n.getPosition();if(!t.canComputeWordRanges(r.uri))return e.None;let[a]=await new qT().provideSelectionRanges(r,[i]);if(a.length===0)return e.None;let o=await t.computeWordRanges(r.uri,a[0].range);if(!o)return e.None;let s=r.getWordUntilPosition(i);return delete o[s.word],new class extends e{distance(e,t){if(!i.equals(n.getPosition()))return 0;if(t.kind===17)return 2<<20;let r=typeof t.label==`string`?t.label:t.label.label,s=o[r];if(al(s))return 2<<20;let c=(Er(s,S.fromPositions(e),S.compareRangesUsingStarts)),l=c>=0?s[c]:s[Math.max(0,~c-1)],u=a.length;for(let e of a){if(!S.containsRange(e.range,l))break;--u}return u}}}},YT=class{constructor(e,t){this.leadingLineContent=e,this.characterCountDelta=t}},XT=class e{constructor(t,n,r,i,a,o,s=pn.default,c=void 0){this.clipboardText=c,this._snippetCompareFn=e._compareCompletionItems,this._items=t,this._column=n,this._wordDistance=i,this._options=a,this._refilterKind=1,this._lineContext=r,this._fuzzyScoreOptions=s,o===`top`?this._snippetCompareFn=e._compareCompletionItemsSnippetsUp:o===`bottom`&&(this._snippetCompareFn=e._compareCompletionItemsSnippetsDown)}get lineContext(){return this._lineContext}set lineContext(e){(this._lineContext.leadingLineContent!==e.leadingLineContent||this._lineContext.characterCountDelta!==e.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<e.characterCountDelta&&this._filteredItems?2:1,this._lineContext=e)}get items(){return this._ensureCachedState(),this._filteredItems}getItemsByProvider(){return this._ensureCachedState(),this._itemsByProvider}getIncompleteProvider(){this._ensureCachedState();let e=new Set;for(let[t,n]of this.getItemsByProvider())n.length>0&&n[0].container.incomplete&&e.add(t);return e}get stats(){return this._ensureCachedState(),this._stats}_ensureCachedState(){this._refilterKind!==0&&this._createCachedState()}_createCachedState(){this._itemsByProvider=new Map;let e=[],{leadingLineContent:t,characterCountDelta:n}=this._lineContext,r=``,i=``,a=this._refilterKind===1?this._items:this._filteredItems,o=[],s=!this._options.filterGraceful||a.length>2e3?ue:xi;for(let c=0;c<a.length;c++){let l=a[c];if(l.isInvalid)continue;let u=this._itemsByProvider.get(l.provider);u?u.push(l):this._itemsByProvider.set(l.provider,[l]);let d=l.position.column-l.editStart.column,f=d+n-(l.position.column-this._column);if(r.length!==f&&(r=f===0?``:t.slice(-f),i=r.toLowerCase()),l.word=r,f===0)l.score=Ft.Default;else{let e=0;for(;e<d;){let t=r.charCodeAt(e);if(t===32||t===9)e+=1;else break}if(e>=f)l.score=Ft.Default;else if(typeof l.completion.filterText==`string`){let t=s(r,i,e,l.completion.filterText,l.filterTextLow,0,this._fuzzyScoreOptions);if(!t)continue;Or(l.completion.filterText,l.textLabel)===0?l.score=t:(l.score=kr(r,i,e,l.textLabel,l.labelLow,0),l.score[0]=t[0])}else{let t=s(r,i,e,l.textLabel,l.labelLow,0,this._fuzzyScoreOptions);if(!t)continue;l.score=t}}l.idx=c,l.distance=this._wordDistance.distance(l.position,l.completion),o.push(l),e.push(l.textLabel.length)}this._filteredItems=o.sort(this._snippetCompareFn),this._refilterKind=0,this._stats={pLabelLen:e.length?Vi(e.length-.85,e,(e,t)=>e-t):0}}static _compareCompletionItems(e,t){return e.score[0]>t.score[0]?-1:e.score[0]<t.score[0]?1:e.distance<t.distance?-1:e.distance>t.distance?1:e.idx<t.idx?-1:e.idx>t.idx?1:0}static _compareCompletionItemsSnippetsDown(t,n){if(t.completion.kind!==n.completion.kind){if(t.completion.kind===28)return 1;if(n.completion.kind===28)return-1}return e._compareCompletionItems(t,n)}static _compareCompletionItemsSnippetsUp(t,n){if(t.completion.kind!==n.completion.kind){if(t.completion.kind===28)return-1;if(n.completion.kind===28)return 1}return e._compareCompletionItems(t,n)}},ZT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},QT=function(e,t){return function(n,r){t(n,r,e)}},$T,eE=class{static shouldAutoTrigger(e){if(!e.hasModel())return!1;let t=e.getModel(),n=e.getPosition();t.tokenization.tokenizeIfCheap(n.lineNumber);let r=t.getWordAtPosition(n);return!(!r||r.endColumn!==n.column&&r.startColumn+1!==n.column||!isNaN(Number(r.word)))}constructor(e,t,n){this.leadingLineContent=e.getLineContent(t.lineNumber).substr(0,t.column-1),this.leadingWord=e.getWordUntilPosition(t),this.lineNumber=t.lineNumber,this.column=t.column,this.triggerOptions=n}};function tE(e,t,n){if(!t.getContextKeyValue(MC.inlineSuggestionVisible.key))return!0;let r=t.getContextKeyValue(MC.suppressSuggestions.key);return r===void 0?!e.getOption(71).suppressSuggestions:!r}function nE(e,t,n){if(!t.getContextKeyValue(`inlineSuggestionVisible`))return!0;let r=t.getContextKeyValue(MC.suppressSuggestions.key);return r===void 0?!e.getOption(71).suppressSuggestions:!r}var rE=$T=class{constructor(e,t,n,r,i,a,o,s,c){this._editor=e,this._editorWorkerService=t,this._clipboardService=n,this._telemetryService=r,this._logService=i,this._contextKeyService=a,this._configurationService=o,this._languageFeaturesService=s,this._envService=c,this._toDispose=new P,this._triggerCharacterListener=new P,this._triggerQuickSuggest=new Br,this._triggerState=void 0,this._completionDisposables=new P,this._onDidCancel=new E,this._onDidTrigger=new E,this._onDidSuggest=new E,this.onDidCancel=this._onDidCancel.event,this.onDidTrigger=this._onDidTrigger.event,this.onDidSuggest=this._onDidSuggest.event,this._currentSelection=this._editor.getSelection()||new N(1,1,1,1),this._toDispose.add(this._editor.onDidChangeModel(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeModelLanguage(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeConfiguration(()=>{this._updateTriggerCharacters()})),this._toDispose.add(this._languageFeaturesService.completionProvider.onDidChange(()=>{this._updateTriggerCharacters(),this._updateActiveSuggestSession()}));let l=!1;this._toDispose.add(this._editor.onDidCompositionStart(()=>{l=!0})),this._toDispose.add(this._editor.onDidCompositionEnd(()=>{l=!1,this._onCompositionEnd()})),this._toDispose.add(this._editor.onDidChangeCursorSelection(e=>{l||this._onCursorChange(e)})),this._toDispose.add(this._editor.onDidChangeModelContent(()=>{!l&&this._triggerState!==void 0&&this._refilterCompletionItems()})),this._updateTriggerCharacters()}dispose(){gt(this._triggerCharacterListener),gt([this._onDidCancel,this._onDidSuggest,this._onDidTrigger,this._triggerQuickSuggest]),this._toDispose.dispose(),this._completionDisposables.dispose(),this.cancel()}_updateTriggerCharacters(){if(this._triggerCharacterListener.clear(),this._editor.getOption(103)||!this._editor.hasModel()||!this._editor.getOption(136))return;let e=new Map;for(let t of this._languageFeaturesService.completionProvider.all(this._editor.getModel()))for(let n of t.triggerCharacters||[]){let r=e.get(n);if(!r){r=new Set;let t=SC();t&&r.add(t),e.set(n,r)}r.add(t)}let t=t=>{if(!nE(this._editor,this._contextKeyService,this._configurationService)||eE.shouldAutoTrigger(this._editor))return;if(!t){let e=this._editor.getPosition();t=this._editor.getModel().getLineContent(e.lineNumber).substr(0,e.column-1)}let n=``;Wt(t.charCodeAt(t.length-1))?sl(t.charCodeAt(t.length-2))&&(n=t.substr(t.length-2)):n=t.charAt(t.length-1);let r=e.get(n);if(r){let e=new Map;if(this._completionModel)for(let[t,n]of this._completionModel.getItemsByProvider())r.has(t)||e.set(t,n);this.trigger({auto:!0,triggerKind:1,triggerCharacter:n,retrigger:!!this._completionModel,clipboardText:this._completionModel?.clipboardText,completionOptions:{providerFilter:r,providerItemsToReuse:e}})}};this._triggerCharacterListener.add(this._editor.onDidType(t)),this._triggerCharacterListener.add(this._editor.onDidCompositionEnd(()=>t()))}get state(){return this._triggerState?this._triggerState.auto?2:1:0}cancel(e=!1){this._triggerState!==void 0&&(this._triggerQuickSuggest.cancel(),this._requestToken?.cancel(),this._requestToken=void 0,this._triggerState=void 0,this._completionModel=void 0,this._context=void 0,this._onDidCancel.fire({retrigger:e}))}clear(){this._completionDisposables.clear()}_updateActiveSuggestSession(){this._triggerState!==void 0&&(!this._editor.hasModel()||!this._languageFeaturesService.completionProvider.has(this._editor.getModel())?this.cancel():this.trigger({auto:this._triggerState.auto,retrigger:!0}))}_onCursorChange(e){if(!this._editor.hasModel())return;let t=this._currentSelection;if(this._currentSelection=this._editor.getSelection(),!e.selection.isEmpty()||e.reason!==0&&e.reason!==3||e.source!==`keyboard`&&e.source!==`deleteLeft`){this.cancel();return}this._triggerState===void 0&&e.reason===0?(t.containsRange(this._currentSelection)||t.getEndPosition().isBeforeOrEqual(this._currentSelection.getPosition()))&&this._doTriggerQuickSuggest():this._triggerState!==void 0&&e.reason===3&&this._refilterCompletionItems()}_onCompositionEnd(){this._triggerState===void 0?this._doTriggerQuickSuggest():this._refilterCompletionItems()}_doTriggerQuickSuggest(){jC.isAllOff(this._editor.getOption(101))||this._editor.getOption(133).snippetsPreventQuickSuggestions&&cw.get(this._editor)?.isInSnippet()||(this.cancel(),this._triggerQuickSuggest.cancelAndSet(()=>{if(this._triggerState!==void 0||!eE.shouldAutoTrigger(this._editor)||!this._editor.hasModel()||!this._editor.hasWidgetFocus())return;let e=this._editor.getModel(),t=this._editor.getPosition(),n=this._editor.getOption(101);if(!jC.isAllOff(n)){if(!jC.isAllOn(n)){e.tokenization.tokenizeIfCheap(t.lineNumber);let r=e.tokenization.getLineTokens(t.lineNumber),i=r.getStandardTokenType(r.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(jC.valueFor(n,i)!==`on`)return}tE(this._editor,this._contextKeyService,this._configurationService)&&this._languageFeaturesService.completionProvider.has(e)&&this.trigger({auto:!0})}},this._editor.getOption(102)))}_refilterCompletionItems(){K(this._editor.hasModel()),K(this._triggerState!==void 0);let e=this._editor.getModel(),t=this._editor.getPosition(),n=new eE(e,t,{...this._triggerState,refilter:!0});this._onNewContext(n)}trigger(e){if(!this._editor.hasModel())return;let t=this._editor.getModel(),n=new eE(t,this._editor.getPosition(),e);this.cancel(e.retrigger),this._triggerState=e,this._onDidTrigger.fire({auto:e.auto,shy:e.shy??!1,position:this._editor.getPosition()}),this._context=n;let r={triggerKind:e.triggerKind??0};e.triggerCharacter&&(r={triggerKind:1,triggerCharacter:e.triggerCharacter}),this._requestToken=new ur;let i=this._editor.getOption(127),a=1;switch(i){case`top`:a=0;break;case`bottom`:a=2;break}let{itemKind:o,showDeprecated:s}=$T.createSuggestFilter(this._editor),c=new bC(a,e.completionOptions?.kindFilter??o,e.completionOptions?.providerFilter,e.completionOptions?.providerItemsToReuse,s),l=JT.create(this._editorWorkerService,this._editor),u=wC(this._languageFeaturesService.completionProvider,t,this._editor.getPosition(),c,r,this._requestToken.token);Promise.all([u,l]).then(async([t,n])=>{if(this._requestToken?.dispose(),!this._editor.hasModel()){t.disposable.dispose();return}let r=e?.clipboardText;if(!r&&t.needsClipboard&&(r=await this._clipboardService.readText()),this._triggerState===void 0){t.disposable.dispose();return}let i=this._editor.getModel(),a=new eE(i,this._editor.getPosition(),e),o={...pn.default,firstMatchCanBeWeak:!this._editor.getOption(133).matchOnWordStartOnly};if(this._completionModel=new XT(t.items,this._context.column,{leadingLineContent:a.leadingLineContent,characterCountDelta:a.column-this._context.column},n,this._editor.getOption(133),this._editor.getOption(127),o,r),this._completionDisposables.add(t.disposable),this._onNewContext(a),this._reportDurationsTelemetry(t.durations),!this._envService.isBuilt||this._envService.isExtensionDevelopment)for(let e of t.items)e.isInvalid&&this._logService.warn(`[suggest] did IGNORE invalid completion item from ${e.provider._debugDisplayName}`,e.completion)}).catch(rr)}_reportDurationsTelemetry(e){Math.random()>1e-4||setTimeout(()=>{this._telemetryService.publicLog2(`suggest.durations.json`,{data:JSON.stringify(e)}),this._logService.debug(`suggest.durations.json`,e)})}static createSuggestFilter(e){let t=new Set;e.getOption(127)===`none`&&t.add(28);let n=e.getOption(133);return n.showMethods||t.add(0),n.showFunctions||t.add(1),n.showConstructors||t.add(2),n.showFields||t.add(3),n.showVariables||t.add(4),n.showClasses||t.add(5),n.showStructs||t.add(6),n.showInterfaces||t.add(7),n.showModules||t.add(8),n.showProperties||t.add(9),n.showEvents||t.add(10),n.showOperators||t.add(11),n.showUnits||t.add(12),n.showValues||t.add(13),n.showConstants||t.add(14),n.showEnums||t.add(15),n.showEnumMembers||t.add(16),n.showKeywords||t.add(17),n.showWords||t.add(18),n.showColors||t.add(19),n.showFiles||t.add(20),n.showReferences||t.add(21),n.showColors||t.add(22),n.showFolders||t.add(23),n.showTypeParameters||t.add(24),n.showSnippets||t.add(28),n.showUsers||t.add(25),n.showIssues||t.add(26),{itemKind:t,showDeprecated:n.showDeprecated}}_onNewContext(e){if(this._context){if(e.lineNumber!==this._context.lineNumber){this.cancel();return}if(ji(e.leadingLineContent)!==ji(this._context.leadingLineContent)){this.cancel();return}if(e.column<this._context.column){e.leadingWord.word?this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0}):this.cancel();return}if(this._completionModel){if(e.leadingWord.word.length!==0&&e.leadingWord.startColumn>this._context.leadingWord.startColumn){if(eE.shouldAutoTrigger(this._editor)&&this._context){let e=this._completionModel.getItemsByProvider();this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerItemsToReuse:e}})}return}if(e.column>this._context.column&&this._completionModel.getIncompleteProvider().size>0&&e.leadingWord.word.length!==0){let e=new Map,t=new Set;for(let[n,r]of this._completionModel.getItemsByProvider())r.length>0&&r[0].container.incomplete?t.add(n):e.set(n,r);this.trigger({auto:this._context.triggerOptions.auto,triggerKind:2,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerFilter:t,providerItemsToReuse:e}})}else{let t=this._completionModel.lineContext,n=!1;if(this._completionModel.lineContext={leadingLineContent:e.leadingLineContent,characterCountDelta:e.column-this._context.column},this._completionModel.items.length===0){let r=eE.shouldAutoTrigger(this._editor);if(!this._context){this.cancel();return}if(r&&this._context.leadingWord.endColumn<e.leadingWord.startColumn){this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0});return}if(this._context.triggerOptions.auto){this.cancel();return}else if(this._completionModel.lineContext=t,n=this._completionModel.items.length>0,n&&e.leadingWord.word.length===0){this.cancel();return}}this._onDidSuggest.fire({completionModel:this._completionModel,triggerOptions:e.triggerOptions,isFrozen:n})}}}}};rE=$T=ZT([QT(1,ne),QT(2,zt),QT(3,Wr),QT(4,za),QT(5,w),QT(6,Ni),QT(7,W),QT(8,sc)],rE);var iE=class e{static{this._maxSelectionLength=51200}constructor(t,n){this._disposables=new P,this._lastOvertyped=[],this._locked=!1,this._disposables.add(t.onWillType(()=>{if(this._locked||!t.hasModel())return;let n=t.getSelections(),r=n.length,i=!1;for(let e=0;e<r;e++)if(!n[e].isEmpty()){i=!0;break}if(!i){this._lastOvertyped.length!==0&&(this._lastOvertyped.length=0);return}this._lastOvertyped=[];let a=t.getModel();for(let t=0;t<r;t++){let r=n[t];if(a.getValueLengthInRange(r)>e._maxSelectionLength)return;this._lastOvertyped[t]={value:a.getValueInRange(r),multiline:r.startLineNumber!==r.endLineNumber}}})),this._disposables.add(n.onDidTrigger(e=>{this._locked=!0})),this._disposables.add(n.onDidCancel(e=>{this._locked=!1}))}getLastOvertypedInfo(e){if(e>=0&&e<this._lastOvertyped.length)return this._lastOvertyped[e]}dispose(){this._disposables.dispose()}},aE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},oE=function(e,t){return function(n,r){t(n,r,e)}},sE=class{constructor(e,t,n,r,i){this._menuId=t,this._menuService=r,this._contextKeyService=i,this._menuDisposables=new P,this.element=V(e,I(`.suggest-status-bar`));let a=(e=>e instanceof qe?n.createInstance(Vn,e,{useComma:!1}):void 0);this._leftActions=new Bs(this.element,{actionViewItemProvider:a}),this._rightActions=new Bs(this.element,{actionViewItemProvider:a}),this._leftActions.domNode.classList.add(`left`),this._rightActions.domNode.classList.add(`right`)}dispose(){this._menuDisposables.dispose(),this._leftActions.dispose(),this._rightActions.dispose(),this.element.remove()}show(){let e=this._menuService.createMenu(this._menuId,this._contextKeyService),t=()=>{let t=[],n=[];for(let[r,i]of e.getActions())r===`left`?t.push(...i):n.push(...i);this._leftActions.clear(),this._leftActions.push(t),this._rightActions.clear(),this._rightActions.push(n)};this._menuDisposables.add(e.onDidChange(()=>t())),this._menuDisposables.add(e)}hide(){this._menuDisposables.clear()}};sE=aE([oE(2,k),oE(3,wu),oE(4,w)],sE);var cE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},lE=function(e,t){return function(n,r){t(n,r,e)}};function uE(e){return!!e&&!!(e.completion.documentation||e.completion.detail&&e.completion.detail!==e.completion.label)}var dE=class{constructor(e,t){this._editor=e,this._onDidClose=new E,this.onDidClose=this._onDidClose.event,this._onDidChangeContents=new E,this.onDidChangeContents=this._onDidChangeContents.event,this._disposables=new P,this._renderDisposeable=new P,this._borderWidth=1,this._size=new br(330,0),this.domNode=I(`.suggest-details`),this.domNode.classList.add(`no-docs`),this._markdownRenderer=t.createInstance($r,{editor:e}),this._body=I(`.body`),this._scrollbar=new Hu(this._body,{alwaysConsumeMouseWheel:!0}),V(this.domNode,this._scrollbar.getDomNode()),this._disposables.add(this._scrollbar),this._header=V(this._body,I(`.header`)),this._close=V(this._header,I(`span`+X.asCSSSelector(J.close))),this._close.title=H(1472,`Close`),this._close.role=`button`,this._close.tabIndex=-1,this._type=V(this._header,I(`p.type`)),this._docs=V(this._body,I(`p.docs`)),this._configureFont(),this._disposables.add(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(59)&&this._configureFont()}))}dispose(){this._disposables.dispose(),this._renderDisposeable.dispose()}_configureFont(){let e=this._editor.getOptions(),t=e.get(59),n=t.getMassagedFontFamily(),r=e.get(134)||t.fontSize,i=e.get(135)||t.lineHeight,a=t.fontWeight,o=`${r}px`,s=`${i}px`;this.domNode.style.fontSize=o,this.domNode.style.lineHeight=`${i/r}`,this.domNode.style.fontWeight=a,this.domNode.style.fontFeatureSettings=t.fontFeatureSettings,this._type.style.fontFamily=n,this._close.style.height=s,this._close.style.width=s}getLayoutInfo(){let e=this._editor.getOption(135)||this._editor.getOption(59).lineHeight,t=this._borderWidth,n=t*2;return{lineHeight:e,borderWidth:t,borderHeight:n,verticalPadding:22,horizontalPadding:14}}renderLoading(){this._type.textContent=H(1473,`Loading...`),this._docs.textContent=``,this.domNode.classList.remove(`no-docs`,`no-type`),this.layout(this.size.width,this.getLayoutInfo().lineHeight*2),this._onDidChangeContents.fire(this)}renderItem(e,t){this._renderDisposeable.clear();let{detail:n,documentation:r}=e.completion;if(t){let t=``;t+=`score: ${e.score[0]}\n`,t+=`prefix: ${e.word??`(no prefix)`}\n`,t+=`word: ${e.completion.filterText?e.completion.filterText+` (filterText)`:e.textLabel}\n`,t+=`distance: ${e.distance} (localityBonus-setting)\n`,t+=`index: ${e.idx}, based on ${e.completion.sortText&&`sortText: "${e.completion.sortText}"`||`label`}\n`,t+=`commit_chars: ${e.completion.commitCharacters?.join(``)}\n`,r=new Tn().appendCodeblock(`empty`,t),n=`Provider: ${e.provider._debugDisplayName}`}if(!t&&!uE(e)){this.clearContents();return}if(this.domNode.classList.remove(`no-docs`,`no-type`),n){let e=n.length>1e5?`${n.substr(0,1e5)}…`:n;this._type.textContent=e,this._type.title=e,Ws(this._type),this._type.classList.toggle(`auto-wrap`,!/\r?\n^\s+/gim.test(e))}else Dl(this._type),this._type.title=``,Wa(this._type),this.domNode.classList.add(`no-type`);if(Dl(this._docs),typeof r==`string`)this._docs.classList.remove(`markdown-docs`),this._docs.textContent=r;else if(r){this._docs.classList.add(`markdown-docs`),Dl(this._docs);let e=this._markdownRenderer.render(r,{asyncRenderCallback:()=>{this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}});this._docs.appendChild(e.element),this._renderDisposeable.add(e)}this.domNode.classList.toggle(`detail-and-doc`,!!n&&!!r),this.domNode.style.userSelect=`text`,this.domNode.tabIndex=-1,this._close.onmousedown=e=>{e.preventDefault(),e.stopPropagation()},this._close.onclick=e=>{e.preventDefault(),e.stopPropagation(),this._onDidClose.fire()},this._body.scrollTop=0,this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}clearContents(){this.domNode.classList.add(`no-docs`),this._type.textContent=``,this._docs.textContent=``}get isEmpty(){return this.domNode.classList.contains(`no-docs`)}get size(){return this._size}layout(e,t){let n=new br(e,t);br.equals(n,this._size)||(this._size=n,m(this.domNode,e,t)),this._scrollbar.scanDomNode()}scrollDown(e=8){this._body.scrollTop+=e}scrollUp(e=8){this._body.scrollTop-=e}scrollTop(){this._body.scrollTop=0}scrollBottom(){this._body.scrollTop=this._body.scrollHeight}pageDown(){this.scrollDown(80)}pageUp(){this.scrollUp(80)}set borderWidth(e){this._borderWidth=e}get borderWidth(){return this._borderWidth}focus(){this.domNode.focus()}};dE=cE([lE(1,k)],dE);var fE=class{constructor(e,t){this.widget=e,this._editor=t,this.allowEditorOverflow=!0,this._disposables=new P,this._added=!1,this._preferAlignAtTop=!0,this._resizable=new Hh,this._resizable.domNode.classList.add(`suggest-details-container`),this._resizable.domNode.appendChild(e.domNode),this._resizable.enableSashes(!1,!0,!0,!1);let n,r,i=0,a=0;this._disposables.add(this._resizable.onDidWillResize(()=>{n=this._topLeft,r=this._resizable.size})),this._disposables.add(this._resizable.onDidResize(e=>{if(n&&r){this.widget.layout(e.dimension.width,e.dimension.height);let t=!1;e.west&&(a=r.width-e.dimension.width,t=!0),e.north&&(i=r.height-e.dimension.height,t=!0),t&&this._applyTopLeft({top:n.top+i,left:n.left+a})}e.done&&(n=void 0,r=void 0,i=0,a=0,this._userSize=e.dimension)})),this._disposables.add(this.widget.onDidChangeContents(()=>{this._anchorBox&&this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,this._preferAlignAtTop)}))}dispose(){this._resizable.dispose(),this._disposables.dispose(),this.hide()}getId(){return`suggest.details`}getDomNode(){return this._resizable.domNode}getPosition(){return this._topLeft?{preference:this._topLeft}:null}show(){this._added||=(this._editor.addOverlayWidget(this),!0)}hide(e=!1){this._resizable.clearSashHoverState(),this._added&&(this._editor.removeOverlayWidget(this),this._added=!1,this._anchorBox=void 0,this._topLeft=void 0),e&&(this._userSize=void 0,this.widget.clearContents())}placeAtAnchor(e,t){this._anchorBox=e.getBoundingClientRect(),this._preferAlignAtTop=t,this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,t)}_placeAtAnchor(e,t,n){let r=ho(this.getDomNode().ownerDocument.body),i=this.widget.getLayoutInfo(),a=new br(220,2*i.lineHeight),o=e.top,s=(function(){let n=r.width-(e.left+e.width+i.borderWidth+i.horizontalPadding),s=-i.borderWidth+e.left+e.width,c=new br(n,r.height-e.top-i.borderHeight-i.verticalPadding),l=c.with(void 0,e.top+e.height-i.borderHeight-i.verticalPadding);return{top:o,left:s,fit:n-t.width,maxSizeTop:c,maxSizeBottom:l,minSize:a.with(Math.min(n,a.width))}})(),c=(function(){let n=e.left-i.borderWidth-i.horizontalPadding,s=Math.max(i.horizontalPadding,e.left-t.width-i.borderWidth),c=new br(n,r.height-e.top-i.borderHeight-i.verticalPadding),l=c.with(void 0,e.top+e.height-i.borderHeight-i.verticalPadding);return{top:o,left:s,fit:n-t.width,maxSizeTop:c,maxSizeBottom:l,minSize:a.with(Math.min(n,a.width))}})(),l=(function(){let n=e.left,o=-i.borderWidth+e.top+e.height,s=new br(e.width-i.borderHeight,r.height-e.top-e.height-i.verticalPadding);return{top:o,left:n,fit:s.height-t.height,maxSizeBottom:s,maxSizeTop:s,minSize:a.with(s.width)}})(),u=[s,c,l],d=u.find(e=>e.fit>=0)??u.sort((e,t)=>t.fit-e.fit)[0],f=e.top+e.height-i.borderHeight,p,m=t.height,h=Math.max(d.maxSizeTop.height,d.maxSizeBottom.height);m>h&&(m=h);let g;n?m<=d.maxSizeTop.height?(p=!0,g=d.maxSizeTop):(p=!1,g=d.maxSizeBottom):m<=d.maxSizeBottom.height?(p=!1,g=d.maxSizeBottom):(p=!0,g=d.maxSizeTop);let{top:_,left:ee}=d;!p&&m>e.height&&(_=f-m);let v=this._editor.getDomNode();if(v){let e=v.getBoundingClientRect();_-=e.top,ee-=e.left}this._applyTopLeft({left:ee,top:_}),this._resizable.enableSashes(!p,d===s,p,d!==s),this._resizable.minSize=d.minSize,this._resizable.maxSize=g,this._resizable.layout(m,Math.min(g.width,t.width)),this.widget.layout(this._resizable.size.width,this._resizable.size.height)}_applyTopLeft(e){this._topLeft=e,this._editor.layoutOverlayWidget(this)}};const pE=dl(`fileService`);var mE;(function(e){e[e.FILE=0]=`FILE`,e[e.FOLDER=1]=`FOLDER`,e[e.ROOT_FOLDER=2]=`ROOT_FOLDER`})(mE||={});var hE=/(?:\/|^)(?:([^\/]+)\/)?([^\/]+)$/;function gE(e,t,n,r,i){if(X.isThemeIcon(i))return[`codicon-${i.id}`,`predefined-file-icon`];if($n.isUri(i))return[];let a=r===mE.ROOT_FOLDER?[`rootfolder-icon`]:r===mE.FOLDER?[`folder-icon`]:[`file-icon`];if(n){let i;if(n.scheme===hc.data)i=cc.parseMetaData(n).get(cc.META_DATA_LABEL);else{let e=n.path.match(hE);e?(i=vE(e[2].toLowerCase()),e[1]&&a.push(`${vE(e[1].toLowerCase())}-name-dir-icon`)):i=vE(n.authority.toLowerCase())}if(r===mE.ROOT_FOLDER)a.push(`${i}-root-name-folder-icon`);else if(r===mE.FOLDER)a.push(`${i}-name-folder-icon`);else{if(i){if(a.push(`${i}-name-file-icon`),a.push(`name-file-icon`),i.length<=255){let e=i.split(`.`);for(let t=1;t<e.length;t++)a.push(`${e.slice(t).join(`.`)}-ext-file-icon`)}a.push(`ext-file-icon`)}let r=_E(e,t,n);r&&a.push(`${vE(r)}-lang-file-icon`)}}return a}function _E(e,t,n){if(!n)return null;let r=null;if(n.scheme===hc.data){let e=cc.parseMetaData(n).get(cc.META_DATA_MIME);e&&(r=t.getLanguageIdByMimeType(e))}else{let t=e.getModel(n);t&&(r=t.getLanguageId())}return r&&r!==`plaintext`?r:t.guessLanguageIdByFilepathOrFirstLine(n)}function vE(e){return e.replace(/[\s]/g,`/`)}var yE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},bE=function(e,t){return function(n,r){t(n,r,e)}},xE=No(`suggest-more-info`,J.chevronRight,H(1474,`Icon for more information in the suggest widget.`)),SE=new class e{static{this._regexRelaxed=/(#([\da-fA-F]{3}){1,2}|(rgb|hsl)a\(\s*(\d{1,3}%?\s*,\s*){3}(1|0?\.\d+)\)|(rgb|hsl)\(\s*\d{1,3}%?(\s*,\s*\d{1,3}%?){2}\s*\))/}static{this._regexStrict=RegExp(`^${e._regexRelaxed.source}$`,`i`)}extract(t,n){if(t.textLabel.match(e._regexStrict))return n[0]=t.textLabel,!0;if(t.completion.detail&&t.completion.detail.match(e._regexStrict))return n[0]=t.completion.detail,!0;if(t.completion.documentation){let r=typeof t.completion.documentation==`string`?t.completion.documentation:t.completion.documentation.value,i=(e._regexRelaxed.exec(r));if(i&&(i.index===0||i.index+i[0].length===r.length))return n[0]=i[0],!0}return!1}},CE=class{constructor(e,t,n,r){this._editor=e,this._modelService=t,this._languageService=n,this._themeService=r,this._onDidToggleDetails=new E,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId=`suggestion`}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(e){let t=new P,n=e;n.classList.add(`show-file-icons`);let r=V(e,I(`.icon`)),i=V(r,I(`span.colorspan`)),a=V(e,I(`.contents`)),o=V(a,I(`.main`)),s=V(o,I(`.icon-label.codicon`)),c=V(o,I(`span.left`)),l=V(o,I(`span.right`)),u=new ns(c,{supportHighlights:!0,supportIcons:!0});t.add(u);let d=V(c,I(`span.signature-label`)),f=V(c,I(`span.qualifier-label`)),p=V(l,I(`span.details-label`)),m=V(l,I(`span.readMore`+X.asCSSSelector(xE)));return m.title=H(1475,`Read More`),{root:n,left:c,right:l,icon:r,colorspan:i,iconLabel:u,iconContainer:s,parametersLabel:d,qualifierLabel:f,detailsLabel:p,readMore:m,disposables:t,configureFont:()=>{let e=this._editor.getOptions(),t=e.get(59),i=t.getMassagedFontFamily(),a=t.fontFeatureSettings,s=t.fontVariationSettings,c=e.get(134)||t.fontSize,l=e.get(135)||t.lineHeight,u=t.fontWeight,d=t.letterSpacing,f=`${c}px`,p=`${l}px`,h=`${d}px`;n.style.fontSize=f,n.style.fontWeight=u,n.style.letterSpacing=h,o.style.fontFamily=i,o.style.fontFeatureSettings=a,o.style.fontVariationSettings=s,o.style.lineHeight=p,r.style.height=p,r.style.width=p,m.style.height=p,m.style.width=p}}}renderElement(e,t,n){n.configureFont();let{completion:r}=e;n.colorspan.style.backgroundColor=``;let i={labelEscapeNewLines:!0,matches:td(e.score)},a=[];if(r.kind===19&&SE.extract(e,a))n.icon.className=`icon customcolor`,n.iconContainer.className=`icon hide`,n.colorspan.style.backgroundColor=a[0];else if(r.kind===20&&this._themeService.getFileIconTheme().hasFileIcons){n.icon.className=`icon hide`,n.iconContainer.className=`icon hide`;let t=gE(this._modelService,this._languageService,$n.from({scheme:`fake`,path:e.textLabel}),mE.FILE),a=gE(this._modelService,this._languageService,$n.from({scheme:`fake`,path:r.detail}),mE.FILE);i.extraClasses=t.length>a.length?t:a}else r.kind===23&&this._themeService.getFileIconTheme().hasFolderIcons?(n.icon.className=`icon hide`,n.iconContainer.className=`icon hide`,i.extraClasses=[gE(this._modelService,this._languageService,$n.from({scheme:`fake`,path:e.textLabel}),mE.FOLDER),gE(this._modelService,this._languageService,$n.from({scheme:`fake`,path:r.detail}),mE.FOLDER)].flat()):(n.icon.className=`icon hide`,n.iconContainer.className=``,n.iconContainer.classList.add(`suggest-icon`,...X.asClassNameArray(Wc.toIcon(r.kind))));r.tags&&r.tags.indexOf(1)>=0&&(i.extraClasses=(i.extraClasses||[]).concat([`deprecated`]),i.matches=[]),n.iconLabel.setLabel(e.textLabel,void 0,i),typeof r.label==`string`?(n.parametersLabel.textContent=``,n.detailsLabel.textContent=wE(r.detail||``),n.root.classList.add(`string-label`)):(n.parametersLabel.textContent=wE(r.label.detail||``),n.detailsLabel.textContent=wE(r.label.description||``),n.root.classList.remove(`string-label`)),this._editor.getOption(133).showInlineDetails?Ws(n.detailsLabel):Wa(n.detailsLabel),uE(e)?(n.right.classList.add(`can-expand-details`),Ws(n.readMore),n.readMore.onmousedown=e=>{e.stopPropagation(),e.preventDefault()},n.readMore.onclick=e=>{e.stopPropagation(),e.preventDefault(),this._onDidToggleDetails.fire()}):(n.right.classList.remove(`can-expand-details`),Wa(n.readMore),n.readMore.onmousedown=null,n.readMore.onclick=null)}disposeTemplate(e){e.disposables.dispose()}};CE=yE([bE(1,Fi),bE(2,ui),bE(3,rn)],CE);function wE(e){return e.replace(/\r\n|\r|\n/g,``)}var TE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},EE=function(e,t){return function(n,r){t(n,r,e)}},DE;Y(`editorSuggestWidget.background`,ge,H(1455,`Background color of the suggest widget.`)),Y(`editorSuggestWidget.border`,_u,H(1456,`Border color of the suggest widget.`));const OE=Y(`editorSuggestWidget.foreground`,El,H(1457,`Foreground color of the suggest widget.`));Y(`editorSuggestWidget.selectedForeground`,Ps,H(1458,`Foreground color of the selected entry in the suggest widget.`)),Y(`editorSuggestWidget.selectedIconForeground`,Cn,H(1459,`Icon foreground color of the selected entry in the suggest widget.`));const kE=Y(`editorSuggestWidget.selectedBackground`,g,H(1460,`Background color of the selected entry in the suggest widget.`));Y(`editorSuggestWidget.highlightForeground`,Qe,H(1461,`Color of the match highlights in the suggest widget.`)),Y(`editorSuggestWidget.focusHighlightForeground`,ir,H(1462,`Color of the match highlights in the suggest widget when an item is focused.`)),Y(`editorSuggestWidgetStatus.foreground`,ae(OE,.5),H(1463,`Foreground color of the suggest widget status.`));var AE=class{constructor(e,t){this._service=e,this._key=`suggestWidget.size/${t.getEditorType()}/${t instanceof t_}`}restore(){let e=this._service.get(this._key,0)??``;try{let t=JSON.parse(e);if(br.is(t))return br.lift(t)}catch{}}store(e){this._service.store(this._key,JSON.stringify(e),0,1)}reset(){this._service.remove(this._key,0)}},jE=class{static{DE=this}static{this.LOADING_MESSAGE=H(1464,`Loading...`)}static{this.NO_SUGGESTIONS_MESSAGE=H(1465,`No suggestions.`)}constructor(e,t,n,r,i){this.editor=e,this._storageService=t,this._state=0,this._isAuto=!1,this._pendingLayout=new Ot,this._pendingShowDetails=new Ot,this._ignoreFocusEvents=!1,this._forceRenderingAbove=!1,this._explainMode=!1,this._showTimeout=new Br,this._disposables=new P,this._onDidSelect=new Pr,this._onDidFocus=new Pr,this._onDidHide=new E,this._onDidShow=new E,this.onDidSelect=this._onDidSelect.event,this.onDidFocus=this._onDidFocus.event,this.onDidHide=this._onDidHide.event,this.onDidShow=this._onDidShow.event,this._onDetailsKeydown=new E,this.onDetailsKeyDown=this._onDetailsKeydown.event,this.element=new Hh,this.element.domNode.classList.add(`editor-widget`,`suggest-widget`),this._contentWidget=new ME(this,e),this._persistedSize=new AE(t,e);class a{constructor(e,t,n=!1,r=!1){this.persistedSize=e,this.currentSize=t,this.persistHeight=n,this.persistWidth=r}}let o;this._disposables.add(this.element.onDidWillResize(()=>{this._contentWidget.lockPreference(),o=new a(this._persistedSize.restore(),this.element.size)})),this._disposables.add(this.element.onDidResize(e=>{if(this._resize(e.dimension.width,e.dimension.height),o&&(o.persistHeight=o.persistHeight||!!e.north||!!e.south,o.persistWidth=o.persistWidth||!!e.east||!!e.west),e.done){if(o){let{itemHeight:e,defaultSize:t}=this.getLayoutInfo(),n=Math.round(e/2),{width:r,height:i}=this.element.size;(!o.persistHeight||Math.abs(o.currentSize.height-i)<=n)&&(i=o.persistedSize?.height??t.height),(!o.persistWidth||Math.abs(o.currentSize.width-r)<=n)&&(r=o.persistedSize?.width??t.width),this._persistedSize.store(new br(r,i))}this._contentWidget.unlockPreference(),o=void 0}})),this._messageElement=V(this.element.domNode,I(`.message`)),this._listElement=V(this.element.domNode,I(`.tree`));let s=this._disposables.add(i.createInstance(dE,this.editor));s.onDidClose(()=>this.toggleDetails(),this,this._disposables),this._details=new fE(s,this.editor);let c=()=>this.element.domNode.classList.toggle(`no-icons`,!this.editor.getOption(133).showIcons);c();let l=i.createInstance(CE,this.editor);this._disposables.add(l),this._disposables.add(l.onDidToggleDetails(()=>this.toggleDetails())),this._list=new ht(`SuggestWidget`,this._listElement,{getHeight:e=>this.getLayoutInfo().itemHeight,getTemplateId:e=>`suggestion`},[l],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>go?`listitem`:`option`,getWidgetAriaLabel:()=>H(1466,`Suggest`),getWidgetRole:()=>`listbox`,getAriaLabel:e=>{let t=e.textLabel,n=Wc.toLabel(e.completion.kind);if(typeof e.completion.label!=`string`){let{detail:r,description:i}=e.completion.label;r&&i?t=H(1467,`{0} {1}, {2}, {3}`,t,r,i,n):r?t=H(1468,`{0} {1}, {2}`,t,r,n):i&&(t=H(1469,`{0}, {1}, {2}`,t,i,n))}else t=H(1470,`{0}, {1}`,t,n);if(!e.isResolved||!this._isDetailsVisible())return t;let{documentation:r,detail:i}=e.completion,a=ci(`{0}{1}`,i||``,r?typeof r==`string`?r:r.value:``);return H(1471,`{0}, docs: {1}`,t,a)}}}),this._list.style(Dt({listInactiveFocusBackground:kE,listInactiveFocusOutline:p})),this._status=i.createInstance(sE,this.element.domNode,vC);let u=()=>this.element.domNode.classList.toggle(`with-status-bar`,this.editor.getOption(133).showStatusBar);u(),this._disposables.add(r.onDidColorThemeChange(e=>this._onThemeChange(e))),this._onThemeChange(r.getColorTheme()),this._disposables.add(this._list.onMouseDown(e=>this._onListMouseDownOrTap(e))),this._disposables.add(this._list.onTap(e=>this._onListMouseDownOrTap(e))),this._disposables.add(this._list.onDidChangeSelection(e=>this._onListSelection(e))),this._disposables.add(this._list.onDidChangeFocus(e=>this._onListFocus(e))),this._disposables.add(this.editor.onDidChangeCursorSelection(()=>this._onCursorSelectionChanged())),this._disposables.add(this.editor.onDidChangeConfiguration(e=>{e.hasChanged(133)&&(u(),c()),this._completionModel&&(e.hasChanged(59)||e.hasChanged(134)||e.hasChanged(135))&&this._list.splice(0,this._list.length,this._completionModel.items)})),this._ctxSuggestWidgetVisible=Q.Visible.bindTo(n),this._ctxSuggestWidgetDetailsVisible=Q.DetailsVisible.bindTo(n),this._ctxSuggestWidgetMultipleSuggestions=Q.MultipleSuggestions.bindTo(n),this._ctxSuggestWidgetHasFocusedSuggestion=Q.HasFocusedSuggestion.bindTo(n),this._disposables.add(Ma(this._details.widget.domNode,`keydown`,e=>{this._onDetailsKeydown.fire(e)})),this._disposables.add(this.editor.onMouseDown(e=>this._onEditorMouseDown(e)))}dispose(){this._details.widget.dispose(),this._details.dispose(),this._list.dispose(),this._status.dispose(),this._disposables.dispose(),this._loadingTimeout?.dispose(),this._pendingLayout.dispose(),this._pendingShowDetails.dispose(),this._showTimeout.dispose(),this._contentWidget.dispose(),this.element.dispose()}_onEditorMouseDown(e){this._details.widget.domNode.contains(e.target.element)?this._details.widget.domNode.focus():this.element.domNode.contains(e.target.element)&&this.editor.focus()}_onCursorSelectionChanged(){this._state!==0&&this._contentWidget.layout()}_onListMouseDownOrTap(e){e.element===void 0||e.index===void 0||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(e,t){let n=this._completionModel;n&&(this._onDidSelect.fire({item:e,index:t,model:n}),this.editor.focus())}_onThemeChange(e){this._details.widget.borderWidth=je(e.type)?2:1}_onListFocus(e){if(this._ignoreFocusEvents)return;if(this._state===5&&this._setState(3),!e.elements.length){this._currentSuggestionDetails&&(this._currentSuggestionDetails.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=void 0),this.editor.setAriaOptions({activeDescendant:void 0}),this._ctxSuggestWidgetHasFocusedSuggestion.set(!1);return}if(!this._completionModel)return;this._ctxSuggestWidgetHasFocusedSuggestion.set(!0);let t=e.elements[0],n=e.indexes[0];t!==this._focusedItem&&(this._currentSuggestionDetails?.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=t,this._list.reveal(n),this._currentSuggestionDetails=bu(async e=>{let n=Qr(()=>{this._isDetailsVisible()&&this._showDetails(!0,!1)},250),r=e.onCancellationRequested(()=>n.dispose());try{return await t.resolve(e)}finally{n.dispose(),r.dispose()}}),this._currentSuggestionDetails.then(()=>{n>=this._list.length||t!==this._list.element(n)||(this._ignoreFocusEvents=!0,this._list.splice(n,1,[t]),this._list.setFocus([n]),this._ignoreFocusEvents=!1,this._isDetailsVisible()?this._showDetails(!1,!1):this.element.domNode.classList.remove(`docs-side`),this.editor.setAriaOptions({activeDescendant:this._list.getElementID(n)}))}).catch(rr)),this._onDidFocus.fire({item:t,index:n,model:this._completionModel})}_setState(e){if(this._state!==e)switch(this._state=e,this.element.domNode.classList.toggle(`frozen`,e===4),this.element.domNode.classList.remove(`message`),e){case 0:Wa(this._messageElement,this._listElement,this._status.element),this._details.hide(!0),this._status.hide(),this._contentWidget.hide(),this._ctxSuggestWidgetVisible.reset(),this._ctxSuggestWidgetMultipleSuggestions.reset(),this._ctxSuggestWidgetHasFocusedSuggestion.reset(),this._showTimeout.cancel(),this.element.domNode.classList.remove(`visible`),this._list.splice(0,this._list.length),this._focusedItem=void 0,this._cappedHeight=void 0,this._explainMode=!1;break;case 1:this.element.domNode.classList.add(`message`),this._messageElement.textContent=DE.LOADING_MESSAGE,Wa(this._listElement,this._status.element),Ws(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,zi(DE.LOADING_MESSAGE);break;case 2:this.element.domNode.classList.add(`message`),this._messageElement.textContent=DE.NO_SUGGESTIONS_MESSAGE,Wa(this._listElement,this._status.element),Ws(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,zi(DE.NO_SUGGESTIONS_MESSAGE);break;case 3:Wa(this._messageElement),Ws(this._listElement,this._status.element),this._show();break;case 4:Wa(this._messageElement),Ws(this._listElement,this._status.element),this._show();break;case 5:Wa(this._messageElement),Ws(this._listElement,this._status.element),this._details.show(),this._show(),this._details.widget.focus();break}}_show(){this._status.show(),this._contentWidget.show(),this._layout(this._persistedSize.restore()),this._ctxSuggestWidgetVisible.set(!0),this._showTimeout.cancelAndSet(()=>{this.element.domNode.classList.add(`visible`),this._onDidShow.fire(this)},100)}showTriggered(e,t){this._state===0&&(this._contentWidget.setPosition(this.editor.getPosition()),this._isAuto=!!e,this._isAuto||(this._loadingTimeout=Qr(()=>this._setState(1),t)))}showSuggestions(e,t,n,r,i){if(this._contentWidget.setPosition(this.editor.getPosition()),this._loadingTimeout?.dispose(),this._currentSuggestionDetails?.cancel(),this._currentSuggestionDetails=void 0,this._completionModel!==e&&(this._completionModel=e),n&&this._state!==2&&this._state!==0){this._setState(4);return}let a=this._completionModel.items.length,o=a===0;if(this._ctxSuggestWidgetMultipleSuggestions.set(a>1),o){this._setState(r?0:2),this._completionModel=void 0;return}this._focusedItem=void 0,this._onDidFocus.pause(),this._onDidSelect.pause();try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(n?4:3),this._list.reveal(t,0,t===0?0:this.getLayoutInfo().itemHeight*.33),this._list.setFocus(i?[]:[t])}finally{this._onDidFocus.resume(),this._onDidSelect.resume()}this._pendingLayout.value=Be(su(this.element.domNode),()=>{this._pendingLayout.clear(),this._layout(this.element.size),this._details.widget.domNode.classList.remove(`focused`)})}focusSelected(){this._list.length>0&&this._list.setFocus([0])}selectNextPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageDown(),!0;case 1:return!this._isAuto;default:return this._list.focusNextPage(),!0}}selectNext(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusNext(1,!0),!0}}selectLast(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollBottom(),!0;case 1:return!this._isAuto;default:return this._list.focusLast(),!0}}selectPreviousPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageUp(),!0;case 1:return!this._isAuto;default:return this._list.focusPreviousPage(),!0}}selectPrevious(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusPrevious(1,!0),!1}}selectFirst(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollTop(),!0;case 1:return!this._isAuto;default:return this._list.focusFirst(),!0}}getFocusedItem(){if(this._state!==0&&this._state!==2&&this._state!==1&&this._completionModel&&this._list.getFocus().length>0)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}toggleDetailsFocus(){this._state===5?(this._list.setFocus(this._list.getFocus()),this._setState(3)):this._state===3&&(this._setState(5),this._isDetailsVisible()?this._details.widget.focus():this.toggleDetails(!0))}toggleDetails(e=!1){this._isDetailsVisible()?(this._pendingShowDetails.clear(),this._ctxSuggestWidgetDetailsVisible.set(!1),this._setDetailsVisible(!1),this._details.hide(),this.element.domNode.classList.remove(`shows-details`)):(uE(this._list.getFocusedElements()[0])||this._explainMode)&&(this._state===3||this._state===5||this._state===4)&&(this._ctxSuggestWidgetDetailsVisible.set(!0),this._setDetailsVisible(!0),this._showDetails(!1,e))}_showDetails(e,t){this._pendingShowDetails.value=Be(su(this.element.domNode),()=>{this._pendingShowDetails.clear(),this._details.show();let n=!1;e?this._details.widget.renderLoading():this._details.widget.renderItem(this._list.getFocusedElements()[0],this._explainMode),this._details.widget.isEmpty?this._details.hide():(this._positionDetails(),this.element.domNode.classList.add(`shows-details`),t&&(this._details.widget.focus(),n=!0)),n||this.editor.focus()})}toggleExplainMode(){this._list.getFocusedElements()[0]&&(this._explainMode=!this._explainMode,this._isDetailsVisible()?this._showDetails(!1,!1):this.toggleDetails())}resetPersistedSize(){this._persistedSize.reset()}hideWidget(){this._pendingLayout.clear(),this._pendingShowDetails.clear(),this._loadingTimeout?.dispose(),this._setState(0),this._onDidHide.fire(this),this.element.clearSashHoverState();let e=this._persistedSize.restore(),t=Math.ceil(this.getLayoutInfo().itemHeight*4.3);e&&e.height<t&&this._persistedSize.store(e.with(void 0,t))}isFrozen(){return this._state===4}_afterRender(e){if(e===null){this._isDetailsVisible()&&this._details.hide();return}this._state===2||this._state===1||(this._isDetailsVisible()&&!this._details.widget.isEmpty&&this._details.show(),this._positionDetails())}_layout(e){if(!this.editor.hasModel()||!this.editor.getDomNode())return;let t=ho(this.element.domNode.ownerDocument.body),n=this.getLayoutInfo();e||=n.defaultSize;let r=e.height,i=e.width;if(this._status.element.style.height=`${n.itemHeight}px`,this._state===2||this._state===1)r=n.itemHeight+n.borderHeight,i=n.defaultSize.width/2,this.element.enableSashes(!1,!1,!1,!1),this.element.minSize=this.element.maxSize=new br(i,r),this._contentWidget.setPreference(2);else{let a=t.width-n.borderHeight-2*n.horizontalPadding;i>a&&(i=a);let o=this._completionModel?this._completionModel.stats.pLabelLen*n.typicalHalfwidthCharacterWidth:i,s=n.statusBarHeight+this._list.contentHeight+n.borderHeight,c=n.itemHeight+n.statusBarHeight,l=qc(this.editor.getDomNode()),u=this.editor.getScrolledVisiblePosition(this.editor.getPosition()),d=l.top+u.top+u.height,f=Math.min(t.height-d-n.verticalPadding,s),p=l.top+u.top-n.verticalPadding,m=Math.min(p,s),h=Math.min(Math.max(m,f)+n.borderHeight,s);r===this._cappedHeight?.capped&&(r=this._cappedHeight.wanted),r<c&&(r=c),r>h&&(r=h),r>f||this._forceRenderingAbove&&p>150?(this._contentWidget.setPreference(1),this.element.enableSashes(!0,!0,!1,!1),h=m):(this._contentWidget.setPreference(2),this.element.enableSashes(!1,!0,!0,!1),h=f),this.element.preferredSize=new br(o,n.defaultSize.height),this.element.maxSize=new br(a,h),this.element.minSize=new br(220,c),this._cappedHeight=r===s?{wanted:this._cappedHeight?.wanted??e.height,capped:r}:void 0}this._resize(i,r)}_resize(e,t){let{width:n,height:r}=this.element.maxSize;e=Math.min(n,e),t=Math.min(r,t);let{statusBarHeight:i}=this.getLayoutInfo();this._list.layout(t-i,e),this._listElement.style.height=`${t-i}px`,this.element.layout(t,e),this._contentWidget.layout(),this._positionDetails()}_positionDetails(){this._isDetailsVisible()&&this._details.placeAtAnchor(this.element.domNode,this._contentWidget.getPosition()?.preference[0]===2)}getLayoutInfo(){let e=this.editor.getOption(59),t=tu(this.editor.getOption(135)||e.lineHeight,8,1e3),n=!this.editor.getOption(133).showStatusBar||this._state===2||this._state===1?0:t,r=this._details.widget.borderWidth,i=2*r;return{itemHeight:t,statusBarHeight:n,borderWidth:r,borderHeight:i,typicalHalfwidthCharacterWidth:e.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new br(430,n+12*t)}}_isDetailsVisible(){return this._storageService.getBoolean(`expandSuggestionDocs`,0,!1)}_setDetailsVisible(e){this._storageService.store(`expandSuggestionDocs`,e,0,0)}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}};jE=DE=TE([EE(1,Mu),EE(2,w),EE(3,rn),EE(4,k)],jE);var ME=class{constructor(e,t){this._widget=e,this._editor=t,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._preferenceLocked=!1,this._added=!1,this._hidden=!1}dispose(){this._added&&(this._added=!1,this._editor.removeContentWidget(this))}getId(){return`editor.widget.suggestWidget`}getDomNode(){return this._widget.element.domNode}show(){this._hidden=!1,this._added||(this._added=!0,this._editor.addContentWidget(this))}hide(){this._hidden||(this._hidden=!0,this.layout())}layout(){this._editor.layoutContentWidget(this)}getPosition(){return this._hidden||!this._position||!this._preference?null:{position:this._position,preference:[this._preference]}}beforeRender(){let{height:e,width:t}=this._widget.element.size,{borderWidth:n,horizontalPadding:r}=this._widget.getLayoutInfo();return new br(t+2*n+r,e+2*n)}afterRender(e){this._widget._afterRender(e)}setPreference(e){this._preferenceLocked||(this._preference=e)}lockPreference(){this._preferenceLocked=!0}unlockPreference(){this._preferenceLocked=!1}setPosition(e){this._position=e}},NE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},PE=function(e,t){return function(n,r){t(n,r,e)}},FE,IE=class{constructor(e,t){if(this._model=e,this._position=t,this._decorationOptions=R.register({description:`suggest-line-suffix`,stickiness:1}),e.getLineMaxColumn(t.lineNumber)!==t.column){let n=e.getOffsetAt(t),r=e.getPositionAt(n+1);e.changeDecorations(e=>{this._marker&&e.removeDecoration(this._marker),this._marker=e.addDecoration(S.fromPositions(t,r),this._decorationOptions)})}}dispose(){this._marker&&!this._model.isDisposed()&&this._model.changeDecorations(e=>{e.removeDecoration(this._marker),this._marker=void 0})}delta(e){if(this._model.isDisposed()||this._position.lineNumber!==e.lineNumber)return 0;if(this._marker){let t=this._model.getDecorationRange(this._marker);return this._model.getOffsetAt(t.getStartPosition())-this._model.getOffsetAt(e)}else return this._model.getLineMaxColumn(e.lineNumber)-e.column}},LE=class{static{FE=this}static{this.ID=`editor.contrib.suggestController`}static get(e){return e.getContribution(FE.ID)}get onWillInsertSuggestItem(){return this._onWillInsertSuggestItem.event}constructor(e,t,n,r,i,a,o){this._memoryService=t,this._commandService=n,this._contextKeyService=r,this._instantiationService=i,this._logService=a,this._telemetryService=o,this._lineSuffix=new Ot,this._toDispose=new P,this._selectors=new RE(e=>e.priority),this._onWillInsertSuggestItem=new E,this._wantsForceRenderingAbove=!1,this.editor=e,this.model=i.createInstance(rE,this.editor),this._selectors.register({priority:0,select:(e,t,n)=>this._memoryService.select(e,t,n)});let s=Q.InsertMode.bindTo(r);s.set(e.getOption(133).insertMode),this._toDispose.add(this.model.onDidTrigger(()=>s.set(e.getOption(133).insertMode))),this.widget=this._toDispose.add(new wc(su(e.getDomNode()),()=>{let e=this._instantiationService.createInstance(jE,this.editor);this._toDispose.add(e),this._toDispose.add(e.onDidSelect(e=>this._insertSuggestion(e,0),this));let t=new KT(this.editor,e,this.model,e=>this._insertSuggestion(e,2));this._toDispose.add(t);let n=Q.MakesTextEdit.bindTo(this._contextKeyService),r=Q.HasInsertAndReplaceRange.bindTo(this._contextKeyService),i=Q.CanResolve.bindTo(this._contextKeyService);return this._toDispose.add(pl(()=>{n.reset(),r.reset(),i.reset()})),this._toDispose.add(e.onDidFocus(({item:e})=>{let t=this.editor.getPosition(),a=e.editStart.column,o=t.column,s=!0;this.editor.getOption(1)===`smart`&&this.model.state===2&&!e.completion.additionalTextEdits&&!(e.completion.insertTextRules&4)&&o-a===e.completion.insertText.length&&(s=this.editor.getModel().getValueInRange({startLineNumber:t.lineNumber,startColumn:a,endLineNumber:t.lineNumber,endColumn:o})!==e.completion.insertText),n.set(s),r.set(!x.equals(e.editInsertEnd,e.editReplaceEnd)),i.set(!!e.provider.resolveCompletionItem||!!e.completion.documentation||e.completion.detail!==e.completion.label)})),this._toDispose.add(e.onDetailsKeyDown(e=>{if(e.toKeyCodeChord().equals(new wn(!0,!1,!1,!1,33))||ro&&e.toKeyCodeChord().equals(new wn(!1,!1,!1,!0,33))){e.stopPropagation();return}e.toKeyCodeChord().isModifierKey()||this.editor.focus()})),this._wantsForceRenderingAbove&&e.forceRenderingAbove(),e})),this._overtypingCapturer=this._toDispose.add(new wc(su(e.getDomNode()),()=>this._toDispose.add(new iE(this.editor,this.model)))),this._alternatives=this._toDispose.add(new wc(su(e.getDomNode()),()=>this._toDispose.add(new GT(this.editor,this._contextKeyService)))),this._toDispose.add(i.createInstance(VT,e)),this._toDispose.add(this.model.onDidTrigger(e=>{this.widget.value.showTriggered(e.auto,e.shy?250:50),this._lineSuffix.value=new IE(this.editor.getModel(),e.position)})),this._toDispose.add(this.model.onDidSuggest(e=>{if(e.triggerOptions.shy)return;let t=-1;for(let n of this._selectors.itemsOrderedByPriorityDesc)if(t=n.select(this.editor.getModel(),this.editor.getPosition(),e.completionModel.items),t!==-1)break;if(t===-1&&(t=0),this.model.state===0)return;let n=!1;if(e.triggerOptions.auto){let t=this.editor.getOption(133);t.selectionMode===`never`||t.selectionMode===`always`?n=t.selectionMode===`never`:t.selectionMode===`whenTriggerCharacter`?n=e.triggerOptions.triggerKind!==1:t.selectionMode===`whenQuickSuggestion`&&(n=e.triggerOptions.triggerKind===1&&!e.triggerOptions.refilter)}this.widget.value.showSuggestions(e.completionModel,t,e.isFrozen,e.triggerOptions.auto,n)})),this._toDispose.add(this.model.onDidCancel(e=>{e.retrigger||this.widget.value.hideWidget()})),this._toDispose.add(this.editor.onDidBlurEditorWidget(()=>{this.model.cancel(),this.model.clear()}));let c=Q.AcceptSuggestionsOnEnter.bindTo(r),l=()=>{let e=this.editor.getOption(1);c.set(e===`on`||e===`smart`)};this._toDispose.add(this.editor.onDidChangeConfiguration(()=>l())),l()}dispose(){this._alternatives.dispose(),this._toDispose.dispose(),this.widget.dispose(),this.model.dispose(),this._lineSuffix.dispose(),this._onWillInsertSuggestItem.dispose()}_insertSuggestion(e,t){if(!e||!e.item){this._alternatives.value.reset(),this.model.cancel(),this.model.clear();return}if(!this.editor.hasModel())return;let n=cw.get(this.editor);if(!n)return;this._onWillInsertSuggestItem.fire({item:e.item});let r=this.editor.getModel(),i=r.getAlternativeVersionId(),{item:a}=e,o=[],s=new ur;t&1||this.editor.pushUndoStop();let c=this.getOverwriteInfo(a,!!(t&8));this._memoryService.memorize(r,this.editor.getPosition(),a);let l=a.isResolved,u=-1,d=-1;if(Array.isArray(a.completion.additionalTextEdits)){this.model.cancel();let e=Cr.capture(this.editor);this.editor.executeEdits(`suggestController.additionalTextEdits.sync`,a.completion.additionalTextEdits.map(e=>{let t=S.lift(e.range);if(t.startLineNumber===a.position.lineNumber&&t.startColumn>a.position.column){let e=this.editor.getPosition().column-a.position.column,n=e,r=S.spansMultipleLines(t)?0:e;t=new S(t.startLineNumber,t.startColumn+n,t.endLineNumber,t.endColumn+r)}return gc.replaceMove(t,e.text)})),e.restoreRelativeVerticalPositionOfCursor(this.editor)}else if(!l){let e=new ad,n,i=r.onDidChangeContent(e=>{if(e.isFlush){s.cancel(),i.dispose();return}for(let t of e.changes){let e=S.getEndPosition(t.range);(!n||x.isBefore(e,n))&&(n=e)}}),c=t;t|=2;let l=!1,u=this.editor.onWillType(()=>{u.dispose(),l=!0,c&2||this.editor.pushUndoStop()});o.push(a.resolve(s.token).then(()=>{if(!a.completion.additionalTextEdits||s.token.isCancellationRequested)return;if(n&&a.completion.additionalTextEdits.some(e=>x.isBefore(n,S.getStartPosition(e.range))))return!1;l&&this.editor.pushUndoStop();let e=Cr.capture(this.editor);return this.editor.executeEdits(`suggestController.additionalTextEdits.async`,a.completion.additionalTextEdits.map(e=>gc.replaceMove(S.lift(e.range),e.text))),e.restoreRelativeVerticalPositionOfCursor(this.editor),(l||!(c&2))&&this.editor.pushUndoStop(),!0}).then(t=>{this._logService.trace(`[suggest] async resolving of edits DONE (ms, applied?)`,e.elapsed(),t),d=t===!0?1:t===!1?0:-2}).finally(()=>{i.dispose(),u.dispose()}))}let{insertText:f}=a.completion;if(a.completion.insertTextRules&4||(f=Lf.escape(f)),this.model.cancel(),n.insert(f,{overwriteBefore:c.overwriteBefore,overwriteAfter:c.overwriteAfter,undoStopBefore:!1,undoStopAfter:!1,adjustWhitespace:!(a.completion.insertTextRules&1),clipboardText:e.model.clipboardText,overtypingCapturer:this._overtypingCapturer.value,reason:Xa.suggest({providerId:ka.fromExtensionId(a.extensionId?.value)})}),t&2||this.editor.pushUndoStop(),a.completion.command)if(a.completion.command.id===zE.id)this.model.trigger({auto:!0,retrigger:!0});else{let e=new ad;o.push(this._commandService.executeCommand(a.completion.command.id,...a.completion.command.arguments?[...a.completion.command.arguments]:[]).catch(e=>{a.completion.extensionId?Ze(e):rr(e)}).finally(()=>{u=e.elapsed()}))}t&4&&this._alternatives.value.set(e,e=>{for(s.cancel();r.canUndo();){i!==r.getAlternativeVersionId()&&r.undo(),this._insertSuggestion(e,3|(t&8?8:0));break}}),this._alertCompletionItem(a),Promise.all(o).finally(()=>{this._reportSuggestionAcceptedTelemetry(a,r,l,u,d,e.index,e.model.items),this.model.clear(),s.dispose()})}_reportSuggestionAcceptedTelemetry(e,t,n,r,i,a,o){if(Math.random()>1e-4)return;let s=new Map;for(let e=0;e<Math.min(30,o.length);e++){let t=o[e].textLabel;s.has(t)?s.get(t).push(e):s.set(t,[e])}let c=s.get(e.textLabel),l=c&&c.length>1?c[0]:-1;this._telemetryService.publicLog2(`suggest.acceptedSuggestion`,{extensionId:e.extensionId?.value??`unknown`,providerId:e.provider._debugDisplayName??`unknown`,kind:e.completion.kind,basenameHash:Bo(nu(t.uri)).toString(16),languageId:t.getLanguageId(),fileExtension:yc(t.uri),resolveInfo:e.provider.resolveCompletionItem?n?1:0:-1,resolveDuration:e.resolveDuration,commandDuration:r,additionalEditsAsync:i,index:a,firstIndex:l})}getOverwriteInfo(e,t){K(this.editor.hasModel());let n=this.editor.getOption(133).insertMode===`replace`;t&&(n=!n);let r=e.position.column-e.editStart.column,i=(n?e.editReplaceEnd.column:e.editInsertEnd.column)-e.position.column,a=this.editor.getPosition().column-e.position.column,o=this._lineSuffix.value?this._lineSuffix.value.delta(this.editor.getPosition()):0;return{overwriteBefore:r+a,overwriteAfter:i+o}}_alertCompletionItem(e){if(Ht(e.completion.additionalTextEdits)){let t=H(1445,`Accepting '{0}' made {1} additional edits`,e.textLabel,e.completion.additionalTextEdits.length);Xi(t)}}triggerSuggest(e,t,n){this.editor.hasModel()&&(this.model.trigger({auto:t??!1,completionOptions:{providerFilter:e,kindFilter:n?new Set:void 0}}),this.editor.revealPosition(this.editor.getPosition(),0),this.editor.focus())}triggerSuggestAndAcceptBest(e){if(!this.editor.hasModel())return;let t=this.editor.getPosition(),n=()=>{t.equals(this.editor.getPosition())&&this._commandService.executeCommand(e.fallback)},r=e=>{if(e.completion.insertTextRules&4||e.completion.additionalTextEdits)return!0;let t=this.editor.getPosition(),n=e.editStart.column,r=t.column;return r-n===e.completion.insertText.length?this.editor.getModel().getValueInRange({startLineNumber:t.lineNumber,startColumn:n,endLineNumber:t.lineNumber,endColumn:r})!==e.completion.insertText:!0};vn.once(this.model.onDidTrigger)(e=>{let t=[];vn.any(this.model.onDidTrigger,this.model.onDidCancel)(()=>{gt(t),n()},void 0,t),this.model.onDidSuggest(({completionModel:e})=>{if(gt(t),e.items.length===0){n();return}let i=this._memoryService.select(this.editor.getModel(),this.editor.getPosition(),e.items),a=e.items[i];if(!r(a)){n();return}this.editor.pushUndoStop(),this._insertSuggestion({index:i,item:a,model:e},7)},void 0,t)}),this.model.trigger({auto:!1,shy:!0}),this.editor.revealPosition(t,0),this.editor.focus()}acceptSelectedSuggestion(e,t){let n=this.widget.value.getFocusedItem(),r=0;e&&(r|=4),t&&(r|=8),this._insertSuggestion(n,r)}acceptNextSuggestion(){this._alternatives.value.next()}acceptPrevSuggestion(){this._alternatives.value.prev()}cancelSuggestWidget(){this.model.cancel(),this.model.clear(),this.widget.value.hideWidget()}focusSuggestion(){this.widget.value.focusSelected()}selectNextSuggestion(){this.widget.value.selectNext()}selectNextPageSuggestion(){this.widget.value.selectNextPage()}selectLastSuggestion(){this.widget.value.selectLast()}selectPrevSuggestion(){this.widget.value.selectPrevious()}selectPrevPageSuggestion(){this.widget.value.selectPreviousPage()}selectFirstSuggestion(){this.widget.value.selectFirst()}toggleSuggestionDetails(){this.widget.value.toggleDetails()}toggleExplainMode(){this.widget.value.toggleExplainMode()}toggleSuggestionFocus(){this.widget.value.toggleDetailsFocus()}resetWidgetSize(){this.widget.value.resetPersistedSize()}forceRenderingAbove(){this.widget.isInitialized?this.widget.value.forceRenderingAbove():this._wantsForceRenderingAbove=!0}stopForceRenderingAbove(){this.widget.isInitialized?this.widget.value.stopForceRenderingAbove():this._wantsForceRenderingAbove=!1}registerSelector(e){return this._selectors.register(e)}};LE=FE=NE([PE(1,LT),PE(2,Mr),PE(3,w),PE(4,k),PE(5,za),PE(6,Wr)],LE);var RE=class{constructor(e){this.prioritySelector=e,this._items=[]}register(e){if(this._items.indexOf(e)!==-1)throw Error(`Value is already registered`);return this._items.push(e),this._items.sort((e,t)=>this.prioritySelector(t)-this.prioritySelector(e)),{dispose:()=>{let t=this._items.indexOf(e);t>=0&&this._items.splice(t,1)}}}get itemsOrderedByPriorityDesc(){return this._items}},zE=class e extends D{static{this.id=`editor.action.triggerSuggest`}constructor(){super({id:e.id,label:B(1453,`Trigger Suggest`),precondition:j.and(F.writable,F.hasCompletionItemProvider,Q.Visible.toNegated()),kbOpts:{kbExpr:F.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[521,2087]},weight:100}})}run(e,t,n){let r=LE.get(t);if(!r)return;let i;n&&typeof n==`object`&&n.auto===!0&&(i=!0),r.triggerSuggest(void 0,i,void 0)}};G(LE.ID,LE,2),s(zE);var BE=Gi.bindToContribution(LE.get);L(new BE({id:`acceptSelectedSuggestion`,precondition:j.and(Q.Visible,Q.HasFocusedSuggestion),handler(e){e.acceptSelectedSuggestion(!0,!1)},kbOpts:[{primary:2,kbExpr:j.and(Q.Visible,F.textInputFocus),weight:190},{primary:3,kbExpr:j.and(Q.Visible,F.textInputFocus,Q.AcceptSuggestionsOnEnter,Q.MakesTextEdit),weight:190}],menuOpts:[{menuId:vC,title:H(1446,`Insert`),group:`left`,order:1,when:Q.HasInsertAndReplaceRange.toNegated()},{menuId:vC,title:H(1447,`Insert`),group:`left`,order:1,when:j.and(Q.HasInsertAndReplaceRange,Q.InsertMode.isEqualTo(`insert`))},{menuId:vC,title:H(1448,`Replace`),group:`left`,order:1,when:j.and(Q.HasInsertAndReplaceRange,Q.InsertMode.isEqualTo(`replace`))}]})),L(new BE({id:`acceptAlternativeSelectedSuggestion`,precondition:j.and(Q.Visible,F.textInputFocus,Q.HasFocusedSuggestion),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:1027,secondary:[1026]},handler(e){e.acceptSelectedSuggestion(!1,!0)},menuOpts:[{menuId:vC,group:`left`,order:2,when:j.and(Q.HasInsertAndReplaceRange,Q.InsertMode.isEqualTo(`insert`)),title:H(1449,`Replace`)},{menuId:vC,group:`left`,order:2,when:j.and(Q.HasInsertAndReplaceRange,Q.InsertMode.isEqualTo(`replace`)),title:H(1450,`Insert`)}]})),gn.registerCommandAlias(`acceptSelectedSuggestionOnEnter`,`acceptSelectedSuggestion`),L(new BE({id:`hideSuggestWidget`,precondition:Q.Visible,handler:e=>e.cancelSuggestWidget(),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:9,secondary:[1033]}})),L(new BE({id:`selectNextSuggestion`,precondition:j.and(Q.Visible,j.or(Q.MultipleSuggestions,Q.HasFocusedSuggestion.negate())),handler:e=>e.selectNextSuggestion(),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}})),L(new BE({id:`selectNextPageSuggestion`,precondition:j.and(Q.Visible,j.or(Q.MultipleSuggestions,Q.HasFocusedSuggestion.negate())),handler:e=>e.selectNextPageSuggestion(),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:12,secondary:[2060]}})),L(new BE({id:`selectLastSuggestion`,precondition:j.and(Q.Visible,j.or(Q.MultipleSuggestions,Q.HasFocusedSuggestion.negate())),handler:e=>e.selectLastSuggestion()})),L(new BE({id:`selectPrevSuggestion`,precondition:j.and(Q.Visible,j.or(Q.MultipleSuggestions,Q.HasFocusedSuggestion.negate())),handler:e=>e.selectPrevSuggestion(),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}})),L(new BE({id:`selectPrevPageSuggestion`,precondition:j.and(Q.Visible,j.or(Q.MultipleSuggestions,Q.HasFocusedSuggestion.negate())),handler:e=>e.selectPrevPageSuggestion(),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:11,secondary:[2059]}})),L(new BE({id:`selectFirstSuggestion`,precondition:j.and(Q.Visible,j.or(Q.MultipleSuggestions,Q.HasFocusedSuggestion.negate())),handler:e=>e.selectFirstSuggestion()})),L(new BE({id:`focusSuggestion`,precondition:j.and(Q.Visible,Q.HasFocusedSuggestion.negate()),handler:e=>e.focusSuggestion(),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}}})),L(new BE({id:`focusAndAcceptSuggestion`,precondition:j.and(Q.Visible,Q.HasFocusedSuggestion.negate()),handler:e=>{e.focusSuggestion(),e.acceptSelectedSuggestion(!0,!1)}})),L(new BE({id:`toggleSuggestionDetails`,precondition:j.and(Q.Visible,Q.HasFocusedSuggestion),handler:e=>e.toggleSuggestionDetails(),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}},menuOpts:[{menuId:vC,group:`right`,order:1,when:j.and(Q.DetailsVisible,Q.CanResolve),title:H(1451,`Show Less`)},{menuId:vC,group:`right`,order:1,when:j.and(Q.DetailsVisible.toNegated(),Q.CanResolve),title:H(1452,`Show More`)}]})),L(new BE({id:`toggleExplainMode`,precondition:Q.Visible,handler:e=>e.toggleExplainMode(),kbOpts:{weight:100,primary:2138}})),L(new BE({id:`toggleSuggestionFocus`,precondition:Q.Visible,handler:e=>e.toggleSuggestionFocus(),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:2570,mac:{primary:778}}})),L(new BE({id:`insertBestCompletion`,precondition:j.and(F.textInputFocus,j.equals(`config.editor.tabCompletion`,`on`),VT.AtEnd,Q.Visible.toNegated(),GT.OtherSuggestions.toNegated(),cw.InSnippetMode.toNegated()),handler:(e,t)=>{e.triggerSuggestAndAcceptBest(Rr(t)?{fallback:`tab`,...t}:{fallback:`tab`})},kbOpts:{weight:190,primary:2}})),L(new BE({id:`insertNextSuggestion`,precondition:j.and(F.textInputFocus,j.equals(`config.editor.tabCompletion`,`on`),GT.OtherSuggestions,Q.Visible.toNegated(),cw.InSnippetMode.toNegated()),handler:e=>e.acceptNextSuggestion(),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:2}})),L(new BE({id:`insertPrevSuggestion`,precondition:j.and(F.textInputFocus,j.equals(`config.editor.tabCompletion`,`on`),GT.OtherSuggestions,Q.Visible.toNegated(),cw.InSnippetMode.toNegated()),handler:e=>e.acceptPrevSuggestion(),kbOpts:{weight:190,kbExpr:F.textInputFocus,primary:1026}})),s(class extends D{constructor(){super({id:`editor.action.resetSuggestSize`,label:B(1454,`Reset Suggest Widget Size`),precondition:void 0})}run(e,t){LE.get(t)?.resetWidgetSize()}});var VE=class extends b{get selectedItem(){return this._currentSuggestItemInfo}constructor(e,t,n){super(),this.editor=e,this.suggestControllerPreselector=t,this.onWillAccept=n,this.isSuggestWidgetVisible=!1,this.isShiftKeyPressed=!1,this._isActive=!1,this._currentSuggestItemInfo=void 0,this._onDidSelectedItemChange=this._register(new E),this.onDidSelectedItemChange=this._onDidSelectedItemChange.event,this._register(e.onKeyDown(e=>{e.shiftKey&&!this.isShiftKeyPressed&&(this.isShiftKeyPressed=!0,this.update(this._isActive))})),this._register(e.onKeyUp(e=>{e.shiftKey&&this.isShiftKeyPressed&&(this.isShiftKeyPressed=!1,this.update(this._isActive))}));let r=LE.get(this.editor);if(r){this._register(r.registerSelector({priority:100,select:(e,t,n)=>{let i=this.editor.getModel();if(!i)return-1;let a=this.suggestControllerPreselector(),o=a?Aw(a,i):void 0;if(!o)return-1;let s=x.lift(t),c=n.map((e,t)=>{let n=HE.fromSuggestion(r,i,s,e,this.isShiftKeyPressed),a=Aw(n.getSingleTextEdit(),i),c=jw(o,a);return{index:t,valid:c,prefixLength:a.text.length,suggestItem:e}}).filter(e=>e&&e.valid&&e.prefixLength>0),l=Hr(c,bt(e=>e.prefixLength,Qi));return l?l.index:-1}}));let e=!1,t=()=>{e||(e=!0,this._register(r.widget.value.onDidShow(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})),this._register(r.widget.value.onDidHide(()=>{this.isSuggestWidgetVisible=!1,this.update(!1)})),this._register(r.widget.value.onDidFocus(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})))};this._register(vn.once(r.model.onDidTrigger)(e=>{t()})),this._register(r.onWillInsertSuggestItem(e=>{let t=this.editor.getPosition(),n=this.editor.getModel();if(!t||!n)return;let i=HE.fromSuggestion(r,n,t,e.item,this.isShiftKeyPressed);this.onWillAccept(i)}))}this.update(this._isActive)}update(e){let t=this.getSuggestItemInfo();(this._isActive!==e||!UE(this._currentSuggestItemInfo,t))&&(this._isActive=e,this._currentSuggestItemInfo=t,this._onDidSelectedItemChange.fire())}getSuggestItemInfo(){let e=LE.get(this.editor);if(!e||!this.isSuggestWidgetVisible)return;let t=e.widget.value.getFocusedItem(),n=this.editor.getPosition(),r=this.editor.getModel();if(!(!t||!n||!r))return HE.fromSuggestion(e,r,n,t.item,this.isShiftKeyPressed)}stopForceRenderingAbove(){LE.get(this.editor)?.stopForceRenderingAbove()}forceRenderingAbove(){LE.get(this.editor)?.forceRenderingAbove()}},HE=class e{static fromSuggestion(t,n,r,i,a){let{insertText:o}=i.completion,s=!1;if(i.completion.insertTextRules&4){let e=new Lf().parse(o);e.children.length<100&&rw.adjustWhitespace(n,r,!0,e),o=e.toString(),s=!0}let c=t.getOverwriteInfo(i,a);return new e(S.fromPositions(r.delta(0,-c.overwriteBefore),r.delta(0,Math.max(c.overwriteAfter,0))),o,i.completion.kind,s,i.container.incomplete??!1)}constructor(e,t,n,r,i){this.range=e,this.insertText=t,this.completionItemKind=n,this.isSnippetText=r,this.listIncomplete=i}equals(e){return this.range.equalsRange(e.range)&&this.insertText===e.insertText&&this.completionItemKind===e.completionItemKind&&this.isSnippetText===e.isSnippetText}toSelectedSuggestionInfo(){return new hu(this.range,this.insertText,this.completionItemKind,this.isSnippetText)}getSingleTextEdit(){return new es(this.range,this.insertText)}};function UE(e,t){return e===t?!0:!e||!t?!1:e.equals(t)}var WE=class extends b{constructor(e,t,n){super(),this._editorObs=e,this._handleSuggestAccepted=t,this._suggestControllerPreselector=n,this._suggestWidgetAdaptor=this._register(new VE(this._editorObs.editor,()=>(this._editorObs.forceUpdate(),this._suggestControllerPreselector()),e=>this._editorObs.forceUpdate(t=>{this._handleSuggestAccepted(e)}))),this.selectedItem=ai(this,e=>this._suggestWidgetAdaptor.onDidSelectedItemChange(()=>{this._editorObs.forceUpdate(t=>e(void 0))}),()=>this._suggestWidgetAdaptor.selectedItem)}stopForceRenderingAbove(){this._suggestWidgetAdaptor.stopForceRenderingAbove()}forceRenderingAbove(){this._suggestWidgetAdaptor.forceRenderingAbove()}},GE=class{constructor(e,t){this.lineNumber=e,this.columnRange=t}},KE=class{constructor(e,t){if(this.startColumn=e,this.endColumnExclusive=t,e>t)throw new h(`startColumn ${e} cannot be after endColumnExclusive ${t}`)}toRange(e){return new S(e,this.startColumn,e,this.endColumnExclusive)}equals(e){return this.startColumn===e.startColumn&&this.endColumnExclusive===e.endColumnExclusive}toZeroBasedOffsetRange(){return new Pe(this.startColumn-1,this.endColumnExclusive-1)}},qE=class e{static fromLineTokens(t){let n=[];for(let e=0;e<t.getCount();e++)n.push(new JE(t.getTokenText(e),t.getMetadata(e)));return e.create(n)}static create(t){return new e(t)}constructor(e){this._tokenInfo=e}toLineTokens(e){return jo.createFromTextAndMetadata(this.map((e,t)=>({text:t.text,metadata:t.metadata})),e)}map(e){let t=[],n=0;for(let r of this._tokenInfo){let i=new Pe(n,n+r.text.length);t.push(e(i,r)),n+=r.text.length}return t}slice(t){let n=[],r=0;for(let e of this._tokenInfo){let i=r,a=i+e.text.length;if(a>t.start){if(i>=t.endExclusive)break;let r=Math.max(0,t.start-i),o=Math.max(0,a-t.endExclusive);n.push(new JE(e.text.slice(r,e.text.length-o),e.metadata))}r+=e.text.length}return e.create(n)}append(t){let n=this._tokenInfo.concat(t._tokenInfo);return e.create(n)}},JE=class{constructor(e,t){this.text=e,this.metadata=t}},YE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},XE=function(e,t){return function(n,r){t(n,r,e)}},ZE,QE=`ghost-text`,$E=class extends b{static{ZE=this}static{this.hot=hi(ZE)}constructor(e,t,r,i,a,o){super(),this._editor=e,this._model=t,this._options=r,this._shouldKeepCursorStable=i,this._isClickable=a,this._languageService=o,this._isDisposed=Vl(this,!1),this._editorObs=f(this._editor),this._warningState=O(e=>{let t=this._model.ghostText.read(e);if(!t)return;let n=this._model.warning.read(e);if(n)return{lineNumber:t.lineNumber,position:new x(t.lineNumber,t.parts[0].column),icon:n.icon}}),this._onDidClick=this._register(new E),this.onDidClick=this._onDidClick.event,this._useSyntaxHighlighting=this._options.map(e=>e.syntaxHighlightingEnabled),this._extraClassNames=O(this,e=>{let t=[...this._options.read(e).extraClasses??[]];return this._useSyntaxHighlighting.read(e)&&t.push(`syntax-highlighted`),this._warningState.read(e)&&t.push(`warning`),t.map(e=>` ${e}`).join(``)}),this.uiState=O(this,e=>{if(this._isDisposed.read(e))return;let t=this._editorObs.model.read(e);if(t!==this._model.targetTextModel.read(e))return;let n=this._model.ghostText.read(e);if(!n)return;let r=n instanceof Dw?n.columnRange:void 0,i=this._useSyntaxHighlighting.read(e),a=this._extraClassNames.read(e),{inlineTexts:o,additionalLines:s,hiddenRange:c,additionalLinesOriginalSuffix:l}=tD(n,t,QE+a),u=t.getLineContent(n.lineNumber),d=new te(o.map(e=>Rs.insert(e.column-1,e.text))),f=i?t.tokenization.tokenizeLinesAt(n.lineNumber,[d.apply(u),...s.map(e=>e.content)]):void 0,p=d.getNewRanges(),m=o.map((e,t)=>({...e,tokens:f?.[0]?.getTokensInRange(p[t])})),h=s.map((e,n)=>{let r=f?.[n+1]??jo.createEmpty(e.content,this._languageService.languageIdCodec);if(n===s.length-1&&l){let e=qE.fromLineTokens(t.tokenization.getLineTokens(l.lineNumber)).slice(l.columnRange.toZeroBasedOffsetRange());r=qE.fromLineTokens(r).append(e).toLineTokens(r.languageIdCodec)}return{content:r,decorations:e.decorations}}),g=this._editor.getSelection()?.getStartPosition().column,_=m.filter(e=>e.text!==``),ee=_.length!==0,v={cursorColumnDistance:(ee?_[0].column:1)-g,cursorLineDistance:ee?0:s.findIndex(e=>e.content!==``)+1,lineCountOriginal:ee?1:0,lineCountModified:s.length+(ee?1:0),characterCountOriginal:0,characterCountModified:mr(_.map(e=>e.text.length))+mr(h.map(e=>e.content.getTextLength())),disjointReplacements:_.length+(s.length>0?1:0),sameShapeReplacements:_.length>1&&h.length===0?_.every(e=>e.text===_[0].text):void 0};return this._model.handleInlineCompletionShown.read(e)?.(v),{replacedRange:r,inlineTexts:m,additionalLines:h,hiddenRange:c,lineNumber:n.lineNumber,additionalReservedLineCount:this._model.minReservedLineCount.read(e),targetTextModel:t,syntaxHighlightingEnabled:i}}),this.decorations=O(this,e=>{let t=this.uiState.read(e);if(!t)return[];let n=[],r=this._extraClassNames.read(e);t.replacedRange&&n.push({range:t.replacedRange.toRange(t.lineNumber),options:{inlineClassName:`inline-completion-text-to-replace`+r,description:`GhostTextReplacement`}}),t.hiddenRange&&n.push({range:t.hiddenRange.toRange(t.lineNumber),options:{inlineClassName:`ghost-text-hidden`,description:`ghost-text-hidden`}});for(let e of t.inlineTexts)n.push({range:S.fromPositions(new x(t.lineNumber,e.column)),options:{description:`ghost-text-decoration`,after:{content:e.text,tokens:e.tokens,inlineClassName:(e.preview?`ghost-text-decoration-preview`:`ghost-text-decoration`)+(this._isClickable?` clickable`:``)+r+e.lineDecorations.map(e=>` `+e.className).join(` `),cursorStops:Ls.Left,attachedData:new eD(this)},showIfCollapsed:!0}});return n}),this._additionalLinesWidget=this._register(new nD(this._editor,O(e=>{let t=this.uiState.read(e);return t?{lineNumber:t.lineNumber,additionalLines:t.additionalLines,minReservedLineCount:t.additionalReservedLineCount,targetTextModel:t.targetTextModel}:void 0}),this._shouldKeepCursorStable,this._isClickable)),this._isInlineTextHovered=this._editorObs.isTargetHovered(e=>e.target.type===6&&e.target.detail.injectedText?.options.attachedData instanceof eD&&e.target.detail.injectedText.options.attachedData.owner===this,this._store),this.isHovered=O(this,e=>this._isDisposed.read(e)?!1:this._isInlineTextHovered.read(e)||this._additionalLinesWidget.isHovered.read(e)),this.height=O(this,e=>this._editorObs.getOption(75).read(e)+(this._additionalLinesWidget.viewZoneHeight.read(e)??0)),this._register(pl(()=>{this._isDisposed.set(!0,void 0)})),this._register(this._editorObs.setDecorations(this.decorations)),this._isClickable&&(this._register(this._additionalLinesWidget.onDidClick(e=>this._onDidClick.fire(e))),this._register(this._editor.onMouseUp(e=>{if(e.target.type!==6)return;let t=e.target.detail.injectedText?.options.attachedData;t instanceof eD&&t.owner===this&&this._onDidClick.fire(e.event)}))),this._register(n((e,t)=>{}))}static getWarningWidgetContext(e){let t=e.ghostTextViewWarningWidgetData;if(t)return t;if(e.parentElement)return this.getWarningWidgetContext(e.parentElement)}ownsViewZone(e){return this._additionalLinesWidget.viewZoneId===e}};$E=ZE=YE([XE(5,ui)],$E);var eD=class{constructor(e){this.owner=e}};function tD(e,n,r){let i=[],a=[];function o(e,n){if(a.length>0){let r=a[a.length-1];n&&r.decorations.push(new t(r.content.length+1,r.content.length+1+e[0].line.length,n,0)),r.content+=e[0].line,e=e.slice(1)}for(let r of e)a.push({content:r.line,decorations:n?[new t(1,r.line.length+1,n,0),...r.lineDecorations]:[...r.lineDecorations]})}let s=n.getLineContent(e.lineNumber),c,l=0;for(let t of e.parts){let e=t.lines;c===void 0?(i.push({column:t.column,text:e[0].line,preview:t.preview,lineDecorations:e[0].lineDecorations}),e=e.slice(1)):o([{line:s.substring(l,t.column-1),lineDecorations:[]}],void 0),e.length>0&&(o(e,r),c===void 0&&t.column<=s.length&&(c=t.column)),l=t.column-1}let u;c!==void 0&&(u=new GE(e.lineNumber,new KE(l+1,s.length+1)));let d=c===void 0?void 0:new KE(c,s.length+1);return{inlineTexts:i,additionalLines:a,hiddenRange:d,additionalLinesOriginalSuffix:u}}var nD=class extends b{get viewZoneId(){return this._viewZoneInfo?.viewZoneId}get viewZoneHeight(){return this._viewZoneHeight}constructor(e,t,n,r){super(),this._editor=e,this._lines=t,this._shouldKeepCursorStable=n,this._isClickable=r,this._viewZoneHeight=Vl(`viewZoneHeight`,void 0),this.editorOptionsChanged=Xe(`editorOptionChanged`,vn.filter(this._editor.onDidChangeConfiguration,e=>e.hasChanged(40)||e.hasChanged(132)||e.hasChanged(112)||e.hasChanged(107)||e.hasChanged(60)||e.hasChanged(59)||e.hasChanged(75))),this._onDidClick=this._register(new E),this.onDidClick=this._onDidClick.event,this._viewZoneListener=this._register(new Ot),this.isHovered=f(this._editor).isTargetHovered(e=>rD(e.target.element),this._store),this.hasBeenAccepted=!1,this._editor instanceof Qc&&this._shouldKeepCursorStable&&this._register(this._editor.onBeforeExecuteEdit(e=>this.hasBeenAccepted=e.source===`inlineSuggestion.accept`)),this._register(la(e=>{let t=this._lines.read(e);this.editorOptionsChanged.read(e),t?(this.hasBeenAccepted=!1,this.updateLines(t.lineNumber,t.additionalLines,t.minReservedLineCount)):this.clear()}))}dispose(){super.dispose(),this.clear()}clear(){this._viewZoneListener.clear(),this._editor.changeViewZones(e=>{this.removeActiveViewZone(e)})}updateLines(e,t,n){let r=this._editor.getModel();if(!r)return;let{tabSize:i}=r.getOptions();this._editor.changeViewZones(r=>{let a=new P;this.removeActiveViewZone(r);let o=Math.max(t.length,n);if(o>0){let n=document.createElement(`div`);iD(n,i,t,this._editor.getOptions(),this._isClickable),this._isClickable&&(a.add(U(n,`mousedown`,e=>{e.preventDefault()})),a.add(U(n,`click`,e=>{rD(e.target)&&this._onDidClick.fire(new _(su(e),e))}))),this.addViewZone(r,e,o,n)}this._viewZoneListener.value=a})}addViewZone(e,t,n,r){let i=e.addZone({afterLineNumber:t,heightInLines:n,domNode:r,afterColumnAffinity:1,onComputedHeight:e=>{this._viewZoneHeight.set(e,void 0)}});this.keepCursorStable(t,n),this._viewZoneInfo={viewZoneId:i,heightInLines:n,lineNumber:t}}removeActiveViewZone(e){this._viewZoneInfo&&(e.removeZone(this._viewZoneInfo.viewZoneId),this.hasBeenAccepted||this.keepCursorStable(this._viewZoneInfo.lineNumber,-this._viewZoneInfo.heightInLines),this._viewZoneInfo=void 0,this._viewZoneHeight.set(void 0,void 0))}keepCursorStable(e,t){if(!this._shouldKeepCursorStable)return;let n=this._editor.getSelection()?.getStartPosition()?.lineNumber;n!==void 0&&e<n&&this._editor.setScrollTop(this._editor.getScrollTop()+t*this._editor.getOption(75))}};function rD(e){return _e(e)&&e.classList.contains(`ghost-text`)}function iD(e,t,n,r,i){let a=r.get(40),o=r.get(132),s=r.get(107),c=r.get(60),l=r.get(59),u=r.get(75),d=`suggest-preview-text`;i&&(d+=` clickable`);let f=new ft(1e4);f.appendString(`<div class="${d}">`);for(let e=0,r=n.length;e<r;e++){let r=n[e],i=r.content;f.appendString(`<div class="view-line`),f.appendString(`" style="top:`),f.appendString(String(e*u)),f.appendString(`px;width:1000000px;">`);let d=i.getLineContent(),p=ut(d),m=ed(d);fr(new ca(l.isMonospace&&!a,l.canUseHalfwidthRightwardsArrow,d,!1,p,m,0,i,r.decorations,t,0,l.spaceWidth,l.middotWidth,l.wsmiddotWidth,o,`none`,s,c!==Ji.OFF,null,null,0),f),f.appendString(`</div>`)}f.appendString(`</div>`),ia(e,l);let p=f.build();e.innerHTML=aD?aD.createHTML(p):p}const aD=ll(`editorGhostText`,{createHTML:e=>e});var oD=class e{static{this.empty=new e([])}constructor(e){this.replacements=e,Ve(Gs(e,(e,t)=>e.lineRange.endLineNumberExclusive<=t.lineRange.startLineNumber))}toString(){return this.replacements.map(e=>e.toString()).join(`,`)}getNewLineRanges(){let e=[],t=0;for(let n of this.replacements)e.push(Ya.ofLength(n.lineRange.startLineNumber+t,n.newLines.length)),t+=n.newLines.length-n.lineRange.length;return e}},sD=class e{static fromSingleTextEdit(t,n){let r=a(t.text),i=t.range.startLineNumber,o=n.getValueOfRange(S.fromPositions(new x(t.range.startLineNumber,1),t.range.getStartPosition()));r[0]=o+r[0];let s=t.range.endLineNumber+1,c=n.getTransformer().getLineLength(t.range.endLineNumber)+1,l=n.getValueOfRange(S.fromPositions(t.range.getEndPosition(),new x(t.range.endLineNumber,c)));r[r.length-1]=r[r.length-1]+l;let u=t.range.startColumn===n.getTransformer().getLineLength(t.range.startLineNumber)+1,d=t.range.endColumn===1;return u&&r[0].length===o.length&&(i++,r.shift()),r.length>0&&i<s&&d&&r[r.length-1].length===l.length&&(s--,r.pop()),new e(new Ya(i,s),r)}constructor(e,t){this.lineRange=e,this.newLines=t}toString(){return`${this.lineRange}->${JSON.stringify(this.newLines)}`}toLineEdit(){return new oD([this])}},cD=class{get lineEdit(){return sD.fromSingleTextEdit(this.edit.toReplacement(this.originalText),this.originalText)}get originalLineRange(){return this.lineEdit.lineRange}get modifiedLineRange(){return this.lineEdit.toLineEdit().getNewLineRanges()[0]}get displayRange(){return this.originalText.lineRange.intersect(this.originalLineRange.join(Ya.ofLength(this.originalLineRange.startLineNumber,this.lineEdit.newLines.length)))}constructor(e,t,n,r,i){this.originalText=e,this.edit=t,this.cursorPosition=n,this.commands=r,this.inlineCompletion=i}},lD=class{constructor(e,t,n){this._model=e,this.inlineEdit=t,this.tabAction=n,this.action=this.inlineEdit.inlineCompletion.action,this.displayName=this.inlineEdit.inlineCompletion.source.provider.displayName??H(1206,`Inline Edit`),this.extensionCommands=this.inlineEdit.inlineCompletion.source.inlineSuggestions.commands??[],this.isInDiffEditor=this._model.isInDiffEditor,this.displayLocation=this.inlineEdit.inlineCompletion.displayLocation,this.showCollapsed=this._model.showCollapsed}accept(){this._model.accept()}jump(){this._model.jump()}abort(e){console.error(e),this.inlineEdit.inlineCompletion.reportInlineEditError(e),this._model.stop()}handleInlineEditShown(e,t){this._model.handleInlineSuggestionShown(this.inlineEdit.inlineCompletion,e,t)}},uD=class{constructor(e){this._model=e,this.onDidAccept=this._model.onDidAccept,this.inAcceptFlow=this._model.inAcceptFlow}},dD=class{constructor(e,t,n,r){this.lineRange=n;let i=f(e),a=O(this,e=>i.isFocused.read(e)&&r.showInlineEditMenu?tT.Accept:tT.Inactive);this.model=new lD(t,new cD(new Ta(``),new ps([r.getSingleTextEdit()]),t.primaryPosition.get(),r.source.inlineSuggestions.commands??[],r),a)}},fD=class e{static fromPoints(t,n){return new e(t.x,t.y,n.x,n.y)}static fromPointSize(t,n){return new e(t.x,t.y,t.x+n.x,t.y+n.y)}static fromLeftTopRightBottom(t,n,r,i){return new e(t,n,r,i)}static fromLeftTopWidthHeight(t,n,r,i){return new e(t,n,t+r,n+i)}static fromRanges(t,n){return new e(t.start,n.start,t.endExclusive,n.endExclusive)}static hull(t){let n=2**53-1,r=2**53-1,i=-(2**53-1),a=-(2**53-1);for(let e of t)n=Math.min(n,e.left),r=Math.min(r,e.top),i=Math.max(i,e.right),a=Math.max(a,e.bottom);return new e(n,r,i,a)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}constructor(e,t,n,r){if(this.left=e,this.top=t,this.right=n,this.bottom=r,e>n)throw new h(`Invalid arguments: Horizontally offset by `+(e-n));if(t>r)throw new h(`Invalid arguments: Vertically offset by `+(t-r))}withMargin(t,n,r,i){let a,o,s,c;return n===void 0&&r===void 0&&i===void 0?a=o=s=c=t:r===void 0&&i===void 0?(a=o=n,s=c=t):(a=i,o=n,s=t,c=r),new e(this.left-a,this.top-s,this.right+o,this.bottom+c)}intersectVertical(t){let n=Math.max(this.top,t.start),r=Math.min(this.bottom,t.endExclusive);return new e(this.left,n,this.right,Math.max(n,r))}intersectHorizontal(t){let n=Math.max(this.left,t.start),r=Math.min(this.right,t.endExclusive);return new e(n,this.top,Math.max(n,r),this.bottom)}toString(){return`Rect{(${this.left},${this.top}), (${this.right},${this.bottom})}`}intersect(t){let n=Math.max(this.left,t.left),r=Math.min(this.right,t.right),i=Math.max(this.top,t.top),a=Math.min(this.bottom,t.bottom);if(!(n>r||i>a))return new e(n,i,r,a)}containsRect(e){return this.left<=e.left&&this.top<=e.top&&this.right>=e.right&&this.bottom>=e.bottom}containsPoint(e){return this.left<=e.x&&this.top<=e.y&&this.right>=e.x&&this.bottom>=e.y}moveToBeContainedIn(t){let n=this.width,r=this.height,i=this.left,a=this.top;return i<t.left?i=t.left:i+n>t.right&&(i=t.right-n),a<t.top?a=t.top:a+r>t.bottom&&(a=t.bottom-r),new e(i,a,i+n,a+r)}withWidth(t){return new e(this.left,this.top,this.left+t,this.bottom)}withHeight(t){return new e(this.left,this.top,this.right,this.top+t)}withTop(t){return new e(this.left,t,this.right,this.bottom)}withLeft(t){return new e(t,this.top,this.right,this.bottom)}translateX(t){return new e(this.left+t,this.top,this.right+t,this.bottom)}translateY(t){return new e(this.left,this.top+t,this.right,this.bottom+t)}getLeftBottom(){return new As(this.left,this.bottom)}getRightBottom(){return new As(this.right,this.bottom)}getRightTop(){return new As(this.right,this.top)}toStyles(){return{position:`absolute`,left:`${this.left}px`,top:`${this.top}px`,width:`${this.width}px`,height:`${this.height}px`}}},pD=class e{constructor(e,t,n,r=null){this.startLineNumbers=e,this.endLineNumbers=t,this.lastLineRelativePosition=n,this.showEndForLine=r}equals(e){return!!e&&this.lastLineRelativePosition===e.lastLineRelativePosition&&this.showEndForLine===e.showEndForLine&&ct(this.startLineNumbers,e.startLineNumbers)&&ct(this.endLineNumbers,e.endLineNumbers)}static get Empty(){return new e([],[],0)}},mD=ll(`stickyScrollViewLayer`,{createHTML:e=>e}),hD=`data-sticky-line-index`,gD=`data-sticky-is-line`,_D=`data-sticky-is-line-number`,vD=`data-sticky-is-folding-icon`,yD=class extends b{get height(){return this._height}constructor(e){super(),this._foldingIconStore=new P,this._rootDomNode=document.createElement(`div`),this._lineNumbersDomNode=document.createElement(`div`),this._linesDomNodeScrollable=document.createElement(`div`),this._linesDomNode=document.createElement(`div`),this._renderedStickyLines=[],this._lineNumbers=[],this._lastLineRelativePosition=0,this._minContentWidthInPx=0,this._isOnGlyphMargin=!1,this._height=-1,this._onDidChangeStickyScrollHeight=this._register(new E),this.onDidChangeStickyScrollHeight=this._onDidChangeStickyScrollHeight.event,this._editor=e,this._lineHeight=e.getOption(75),this._lineNumbersDomNode.className=`sticky-widget-line-numbers`,this._lineNumbersDomNode.setAttribute(`role`,`none`),this._linesDomNode.className=`sticky-widget-lines`,this._linesDomNode.setAttribute(`role`,`list`),this._linesDomNodeScrollable.className=`sticky-widget-lines-scrollable`,this._linesDomNodeScrollable.appendChild(this._linesDomNode),this._rootDomNode.className=`sticky-widget`,this._rootDomNode.classList.toggle(`peek`,e instanceof t_),this._rootDomNode.appendChild(this._lineNumbersDomNode),this._rootDomNode.appendChild(this._linesDomNodeScrollable),this._setHeight(0);let t=()=>{this._linesDomNode.style.left=this._editor.getOption(130).scrollWithEditor?`-${this._editor.getScrollLeft()}px`:`0px`};this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(130)&&t(),e.hasChanged(75)&&(this._lineHeight=this._editor.getOption(75))})),this._register(this._editor.onDidScrollChange(e=>{e.scrollLeftChanged&&t(),e.scrollWidthChanged&&this._updateWidgetWidth()})),this._register(this._editor.onDidChangeModel(()=>{t(),this._updateWidgetWidth()})),this._register(this._foldingIconStore),t(),this._register(this._editor.onDidLayoutChange(e=>{this._updateWidgetWidth()})),this._updateWidgetWidth()}get lineNumbers(){return this._lineNumbers}get lineNumberCount(){return this._lineNumbers.length}getRenderedStickyLine(e){return this._renderedStickyLines.find(t=>t.lineNumber===e)}getCurrentLines(){return this._lineNumbers}setState(e,t,n){let r=!this._state&&!e,i=this._state&&this._state.equals(e);if(n===void 0&&(r||i))return;let a=this._findRenderingData(e),o=this._lineNumbers;this._lineNumbers=a.lineNumbers,this._lastLineRelativePosition=a.lastLineRelativePosition;let s=this._findIndexToRebuildFrom(o,this._lineNumbers,n);this._renderRootNode(this._lineNumbers,this._lastLineRelativePosition,t,s),this._state=e}_findRenderingData(e){if(!e)return{lineNumbers:[],lastLineRelativePosition:0};let t=[...e.startLineNumbers];e.showEndForLine!==null&&(t[e.showEndForLine]=e.endLineNumbers[e.showEndForLine]);let n=0;for(let e=0;e<t.length;e++)n+=this._editor.getLineHeightForPosition(new x(t[e],1));return n===0?{lineNumbers:[],lastLineRelativePosition:0}:{lineNumbers:t,lastLineRelativePosition:e.lastLineRelativePosition}}_findIndexToRebuildFrom(e,t,n){if(t.length===0)return 0;if(n!==void 0)return n;let r=t.findIndex(t=>!e.includes(t));return r===-1?0:r}_updateWidgetWidth(){let e=this._editor.getLayoutInfo(),t=e.contentLeft;this._lineNumbersDomNode.style.width=`${t}px`,this._linesDomNodeScrollable.style.setProperty(`--vscode-editorStickyScroll-scrollableWidth`,`${this._editor.getScrollWidth()-e.verticalScrollbarWidth}px`),this._rootDomNode.style.width=`${e.width-e.verticalScrollbarWidth}px`}_useFoldingOpacityTransition(e){this._lineNumbersDomNode.style.setProperty(`--vscode-editorStickyScroll-foldingOpacityTransition`,`opacity ${e?.5:0}s`)}_setFoldingIconsVisibility(e){for(let t of this._renderedStickyLines){let n=t.foldingIcon;if(!n)continue;n.setVisible(e?!0:n.isCollapsed)}}async _renderRootNode(e,t,n,r){let i=this._editor._getViewModel();if(!i){this._clearWidget();return}if(e.length===0){this._clearWidget();return}let a=[],o=e[e.length-1],s=0;for(let e=0;e<this._renderedStickyLines.length;e++)if(e<r){let t=this._renderedStickyLines[e];a.push(this._updatePosition(t,s,t.lineNumber===o)),s+=t.height}else{let t=this._renderedStickyLines[e];t.lineNumberDomNode.remove(),t.lineDomNode.remove()}let c=this._editor.getLayoutInfo();for(let t=r;t<e.length;t++){let r=this._renderChildNode(i,t,e[t],s,o===e[t],n,c);s+=r.height,this._linesDomNode.appendChild(r.lineDomNode),this._lineNumbersDomNode.appendChild(r.lineNumberDomNode),a.push(r)}n&&(this._setFoldingHoverListeners(),this._useFoldingOpacityTransition(!this._isOnGlyphMargin)),this._minContentWidthInPx=Math.max(...this._renderedStickyLines.map(e=>e.scrollWidth))+c.verticalScrollbarWidth,this._renderedStickyLines=a,this._setHeight(s+t),this._editor.layoutOverlayWidget(this)}_clearWidget(){for(let e=0;e<this._renderedStickyLines.length;e++){let t=this._renderedStickyLines[e];t.lineNumberDomNode.remove(),t.lineDomNode.remove()}this._setHeight(0)}_setHeight(e){this._height!==e&&(this._height=e,this._height===0?this._rootDomNode.style.display=`none`:(this._rootDomNode.style.display=`block`,this._lineNumbersDomNode.style.height=`${this._height}px`,this._linesDomNodeScrollable.style.height=`${this._height}px`,this._rootDomNode.style.height=`${this._height}px`),this._onDidChangeStickyScrollHeight.fire({height:this._height}))}_setFoldingHoverListeners(){this._editor.getOption(125)===`mouseover`&&(this._foldingIconStore.add(U(this._lineNumbersDomNode,Eo.MOUSE_ENTER,()=>{this._isOnGlyphMargin=!0,this._setFoldingIconsVisibility(!0)})),this._foldingIconStore.add(U(this._lineNumbersDomNode,Eo.MOUSE_LEAVE,()=>{this._isOnGlyphMargin=!1,this._useFoldingOpacityTransition(!0),this._setFoldingIconsVisibility(!1)})))}_renderChildNode(e,n,r,i,a,o,s){let c=e.coordinatesConverter.convertModelPositionToViewPosition(new x(r,1)).lineNumber,l=e.getViewLineRenderingData(c),u=this._editor.getOption(76),d=this._editor.getOption(116).verticalScrollbarSize,f;try{f=t.filter(l.inlineDecorations,c,l.minColumn,l.maxColumn)}catch{f=[]}let p=this._editor.getLineHeightForPosition(new x(r,1)),m=e.getTextDirection(r),h=new ca(!0,!0,l.content,l.continuesWithWrappedLine,l.isBasicASCII,l.containsRTL,0,l.tokens,f,l.tabSize,l.startVisibleColumn,1,1,1,500,`none`,!0,!0,null,m,d),g=new ft(2e3),_=fr(h,g),ee;ee=mD?mD.createHTML(g.build()):g.build();let v=document.createElement(`span`);v.setAttribute(hD,String(n)),v.setAttribute(gD,``),v.setAttribute(`role`,`listitem`),v.tabIndex=0,v.className=`sticky-line-content`,v.classList.add(`stickyLine${r}`),v.style.lineHeight=`${p}px`,v.innerHTML=ee;let te=document.createElement(`span`);te.setAttribute(hD,String(n)),te.setAttribute(_D,``),te.className=`sticky-line-number`,te.style.lineHeight=`${p}px`;let y=s.contentLeft;te.style.width=`${y}px`;let ne=document.createElement(`span`);u.renderType===1||u.renderType===3&&r%10==0?ne.innerText=r.toString():u.renderType===2&&(ne.innerText=Math.abs(r-this._editor.getPosition().lineNumber).toString()),ne.className=`sticky-line-number-inner`,ne.style.width=`${s.lineNumbersWidth}px`,ne.style.paddingLeft=`${s.lineNumbersLeft}px`,te.appendChild(ne);let re=this._renderFoldingIconForLine(o,r);re&&(te.appendChild(re.domNode),re.domNode.style.left=`${s.lineNumbersWidth+s.lineNumbersLeft}px`,re.domNode.style.lineHeight=`${p}px`),this._editor.applyFontInfo(v),this._editor.applyFontInfo(te),te.style.lineHeight=`${p}px`,v.style.lineHeight=`${p}px`,te.style.height=`${p}px`,v.style.height=`${p}px`;let ie=new bD(n,r,v,te,re,_.characterMapping,v.scrollWidth,p);return this._updatePosition(ie,i,a)}_updatePosition(e,t,n){let r=e.lineDomNode,i=e.lineNumberDomNode;if(n){r.style.zIndex=`0`,i.style.zIndex=`0`;let n=`${t+this._lastLineRelativePosition+(e.foldingIcon?.isCollapsed?1:0)}px`;r.style.top=n,i.style.top=n}else r.style.zIndex=`1`,i.style.zIndex=`1`,r.style.top=`${t}px`,i.style.top=`${t}px`;return e}_renderFoldingIconForLine(e,t){let n=this._editor.getOption(125);if(!e||n===`never`)return;let r=e.regions,i=r.findRange(t),a=r.getStartLineNumber(i);if(t!==a)return;let o=r.isCollapsed(i),s=new xD(o,a,r.getEndLineNumber(i),this._lineHeight);return s.setVisible(this._isOnGlyphMargin?!0:o||n===`always`),s.domNode.setAttribute(vD,``),s}getId(){return`editor.contrib.stickyScrollWidget`}getDomNode(){return this._rootDomNode}getPosition(){return{preference:2,stackOridinal:10}}getMinContentWidthInPx(){return this._minContentWidthInPx}focusLineWithIndex(e){0<=e&&e<this._renderedStickyLines.length&&this._renderedStickyLines[e].lineDomNode.focus()}getEditorPositionFromNode(e){if(!e||e.children.length>0)return null;let t=this._getRenderedStickyLineFromChildDomNode(e);if(!t)return null;let n=Zr(t.characterMapping,e,0);return new x(t.lineNumber,n)}getLineNumberFromChildDomNode(e){return this._getRenderedStickyLineFromChildDomNode(e)?.lineNumber??null}_getRenderedStickyLineFromChildDomNode(e){let t=this.getLineIndexFromChildDomNode(e);return t===null||t<0||t>=this._renderedStickyLines.length?null:this._renderedStickyLines[t]}getLineIndexFromChildDomNode(e){let t=this._getAttributeValue(e,hD);return t?parseInt(t,10):null}isInStickyLine(e){return this._getAttributeValue(e,gD)!==void 0}isInFoldingIconDomNode(e){return this._getAttributeValue(e,vD)!==void 0}_getAttributeValue(e,t){for(;e&&e!==this._rootDomNode;){let n=e.getAttribute(t);if(n!==null)return n;e=e.parentElement}}},bD=class{constructor(e,t,n,r,i,a,o,s){this.index=e,this.lineNumber=t,this.lineDomNode=n,this.lineNumberDomNode=r,this.foldingIcon=i,this.characterMapping=a,this.scrollWidth=o,this.height=s}},xD=class{constructor(e,t,n,r){this.isCollapsed=e,this.foldingStartLine=t,this.foldingEndLine=n,this.dimension=r,this.domNode=document.createElement(`div`),this.domNode.style.width=`26px`,this.domNode.style.height=`${r}px`,this.domNode.style.lineHeight=`${r}px`,this.domNode.className=X.asClassName(e?aS:iS)}setVisible(e){this.domNode.style.cursor=e?`pointer`:`default`,this.domNode.style.opacity=e?`1`:`0`}},SD=class{constructor(e,t){this.startLineNumber=e,this.endLineNumber=t}},CD=class{constructor(e,t,n){this.range=e,this.children=t,this.parent=n}},wD=class{constructor(e,t,n,r){this.uri=e,this.version=t,this.element=n,this.outlineProviderId=r}},TD=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ED=function(e,t){return function(n,r){t(n,r,e)}},DD;(function(e){e.OUTLINE_MODEL=`outlineModel`,e.FOLDING_PROVIDER_MODEL=`foldingProviderModel`,e.INDENTATION_MODEL=`indentationModel`})(DD||={});var OD;(function(e){e[e.VALID=0]=`VALID`,e[e.INVALID=1]=`INVALID`,e[e.CANCELED=2]=`CANCELED`})(OD||={});var kD=class extends b{constructor(e,t,n,r){switch(super(),this._editor=e,this._modelProviders=[],this._modelPromise=null,this._updateScheduler=this._register(new qa(300)),this._updateOperation=this._register(new P),this._editor.getOption(130).defaultModel){case DD.OUTLINE_MODEL:this._modelProviders.push(new jD(this._editor,r));case DD.FOLDING_PROVIDER_MODEL:this._modelProviders.push(new PD(this._editor,t,r));case DD.INDENTATION_MODEL:this._modelProviders.push(new ND(this._editor,n));break}}dispose(){this._modelProviders.forEach(e=>e.dispose()),this._updateOperation.clear(),this._cancelModelPromise(),super.dispose()}_cancelModelPromise(){this._modelPromise&&=(this._modelPromise.cancel(),null)}async update(e){return this._updateOperation.clear(),this._updateOperation.add({dispose:()=>{this._cancelModelPromise(),this._updateScheduler.cancel()}}),this._cancelModelPromise(),await this._updateScheduler.trigger(async()=>{for(let t of this._modelProviders){let{statusPromise:n,modelPromise:r}=t.computeStickyModel(e);this._modelPromise=r;let i=await n;if(this._modelPromise!==r)return null;switch(i){case OD.CANCELED:return this._updateOperation.clear(),null;case OD.VALID:return t.stickyModel}}return null}).catch(e=>(rr(e),null))}};kD=TD([ED(2,k),ED(3,W)],kD);var AD=class extends b{constructor(e){super(),this._editor=e,this._stickyModel=null}get stickyModel(){return this._stickyModel}_invalid(){return this._stickyModel=null,OD.INVALID}computeStickyModel(e){if(e.isCancellationRequested||!this.isProviderValid())return{statusPromise:this._invalid(),modelPromise:null};let t=bu(e=>this.createModelFromProvider(e));return{statusPromise:t.then(t=>this.isModelValid(t)?e.isCancellationRequested?OD.CANCELED:(this._stickyModel=this.createStickyModel(e,t),OD.VALID):this._invalid()).then(void 0,e=>(rr(e),OD.CANCELED)),modelPromise:t}}isModelValid(e){return!0}isProviderValid(){return!0}},jD=class extends AD{constructor(e,t){super(e),this._languageFeaturesService=t}createModelFromProvider(e){return sC.create(this._languageFeaturesService.documentSymbolProvider,this._editor.getModel(),e)}createStickyModel(e,t){let{stickyOutlineElement:n,providerID:r}=this._stickyModelFromOutlineModel(t,this._stickyModel?.outlineProviderId),i=this._editor.getModel();return new wD(i.uri,i.getVersionId(),n,r)}isModelValid(e){return e&&e.children.size>0}_stickyModelFromOutlineModel(e,t){let n;if(gl.first(e.children.values())instanceof oC){let r=gl.find(e.children.values(),e=>e.id===t);if(r)n=r.children;else{let r=``,i=-1,a;for(let[t,n]of e.children.entries()){let e=this._findSumOfRangesOfGroup(n);e>i&&(a=n,i=e,r=n.id)}t=r,n=a.children}}else n=e.children;let r=[],i=Array.from(n.values()).sort((e,t)=>{let n=new SD(e.symbol.range.startLineNumber,e.symbol.range.endLineNumber),r=new SD(t.symbol.range.startLineNumber,t.symbol.range.endLineNumber);return this._comparator(n,r)});for(let e of i)r.push(this._stickyModelFromOutlineElement(e,e.symbol.selectionRange.startLineNumber));return{stickyOutlineElement:new CD(void 0,r,void 0),providerID:t}}_stickyModelFromOutlineElement(e,t){let n=[];for(let r of e.children.values())if(r.symbol.selectionRange.startLineNumber!==r.symbol.range.endLineNumber)if(r.symbol.selectionRange.startLineNumber!==t)n.push(this._stickyModelFromOutlineElement(r,r.symbol.selectionRange.startLineNumber));else for(let e of r.children.values())n.push(this._stickyModelFromOutlineElement(e,r.symbol.selectionRange.startLineNumber));n.sort((e,t)=>this._comparator(e.range,t.range));let r=new SD(e.symbol.selectionRange.startLineNumber,e.symbol.range.endLineNumber);return new CD(r,n,void 0)}_comparator(e,t){return e.startLineNumber===t.startLineNumber?t.endLineNumber-e.endLineNumber:e.startLineNumber-t.startLineNumber}_findSumOfRangesOfGroup(e){let t=0;for(let n of e.children.values())t+=this._findSumOfRangesOfGroup(n);return e instanceof aC?t+e.symbol.range.endLineNumber-e.symbol.selectionRange.startLineNumber:t}};jD=TD([ED(1,W)],jD);var MD=class extends AD{constructor(e){super(e),this._foldingLimitReporter=this._register(new CS(e))}createStickyModel(e,t){let n=this._fromFoldingRegions(t),r=this._editor.getModel();return new wD(r.uri,r.getVersionId(),n,void 0)}isModelValid(e){return e!==null}_fromFoldingRegions(e){let t=e.length,n=[],r=new CD(void 0,[],void 0);for(let i=0;i<t;i++){let t=e.getParentIndex(i),a;a=t===-1?r:n[t];let o=new CD(new SD(e.getStartLineNumber(i),e.getEndLineNumber(i)+1),[],a);a.children.push(o),n.push(o)}return r}},ND=class extends MD{constructor(e,t){super(e),this._languageConfigurationService=t,this.provider=this._register(new $x(e.getModel(),this._languageConfigurationService,this._foldingLimitReporter))}async createModelFromProvider(e){return this.provider.compute(e)}};ND=TD([ED(1,Ar)],ND);var PD=class extends MD{constructor(e,t,n){super(e),this._languageFeaturesService=n,this.provider=this._register(new Ot),this._register(this._languageFeaturesService.foldingRangeProvider.onDidChange(()=>{this._updateProvider(e,t)})),this._updateProvider(e,t)}_updateProvider(e,t){let n=SS.getFoldingRangeProviders(this._languageFeaturesService,e.getModel());n.length!==0&&(this.provider.value=new mS(e.getModel(),n,t,this._foldingLimitReporter,void 0))}isProviderValid(){return this.provider!==void 0}async createModelFromProvider(e){return this.provider.value?.compute(e)??null}};PD=TD([ED(2,W)],PD);var FD=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ID=function(e,t){return function(n,r){t(n,r,e)}},LD=class{constructor(e,t,n,r){this.startLineNumber=e,this.endLineNumber=t,this.top=n,this.height=r}},RD=class extends b{constructor(e,t,n){super(),this._languageFeaturesService=t,this._languageConfigurationService=n,this._onDidChangeStickyScroll=this._register(new E),this.onDidChangeStickyScroll=this._onDidChangeStickyScroll.event,this._model=null,this._cts=null,this._stickyModelProvider=null,this._editor=e,this._sessionStore=this._register(new P),this._updateSoon=this._register(new ju(()=>this.update(),50)),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(130)&&this.readConfiguration()})),this.readConfiguration()}readConfiguration(){this._sessionStore.clear(),this._editor.getOption(130).enabled&&(this._sessionStore.add(this._editor.onDidChangeModel(()=>{this._model=null,this.updateStickyModelProvider(),this._onDidChangeStickyScroll.fire(),this.update()})),this._sessionStore.add(this._editor.onDidChangeHiddenAreas(()=>this.update())),this._sessionStore.add(this._editor.onDidChangeModelContent(()=>this._updateSoon.schedule())),this._sessionStore.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>this.update())),this._sessionStore.add(pl(()=>{this._stickyModelProvider?.dispose(),this._stickyModelProvider=null})),this.updateStickyModelProvider(),this.update())}getVersionId(){return this._model?.version}updateStickyModelProvider(){this._stickyModelProvider?.dispose(),this._stickyModelProvider=null,this._editor.hasModel()&&(this._stickyModelProvider=new kD(this._editor,()=>this._updateSoon.schedule(),this._languageConfigurationService,this._languageFeaturesService))}async update(){this._cts?.dispose(!0),this._cts=new ur,await this.updateStickyModel(this._cts.token),this._onDidChangeStickyScroll.fire()}async updateStickyModel(e){if(!this._editor.hasModel()||!this._stickyModelProvider||this._editor.getModel().isTooLargeForTokenization()){this._model=null;return}let t=await this._stickyModelProvider.update(e);e.isCancellationRequested||(this._model=t)}getCandidateStickyLinesIntersecting(e){if(!this._model?.element)return[];let t=[];return this.getCandidateStickyLinesIntersectingFromStickyModel(e,this._model.element,t,0,0,-1),this.filterHiddenRanges(t)}getCandidateStickyLinesIntersectingFromStickyModel(e,t,n,r,i,a){if(t.children.length===0)return;let o=a,s=[];for(let e=0;e<t.children.length;e++){let n=t.children[e];n.range&&s.push(n.range.startLineNumber)}let c=this.updateIndex(Er(s,e.startLineNumber,(e,t)=>e-t)),l=this.updateIndex(Er(s,e.endLineNumber,(e,t)=>e-t));for(let a=c;a<=l;a++){let s=t.children[a];if(!s||!s.range)continue;let{startLineNumber:c,endLineNumber:l}=s.range;if(e.startLineNumber<=l+1&&c-1<=e.endLineNumber&&c!==o){o=c;let t=this._editor.getLineHeightForPosition(new x(c,1));n.push(new LD(c,l-1,i,t)),this.getCandidateStickyLinesIntersectingFromStickyModel(e,s,n,r+1,i+t,c)}}}filterHiddenRanges(e){let t=this._editor._getViewModel()?.getHiddenAreas();return t?e.filter(e=>!t.some(t=>e.startLineNumber>=t.startLineNumber&&e.endLineNumber<=t.endLineNumber+1)):e}updateIndex(e){return e===-1?0:e<0?-e-2:e}};RD=FD([ID(1,W),ID(2,Ar)],RD);var zD=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},BD=function(e,t){return function(n,r){t(n,r,e)}},VD,HD=class extends b{static{VD=this}static{this.ID=`store.contrib.stickyScrollController`}constructor(e,t,n,r,i,a,o){super(),this._editor=e,this._contextMenuService=t,this._languageFeaturesService=n,this._instaService=r,this._contextKeyService=o,this._sessionStore=new P,this._maxStickyLines=2**53-1,this._candidateDefinitionsLength=-1,this._focusedStickyElementIndex=-1,this._enabled=!1,this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1,this._endLineNumbers=[],this._mouseTarget=null,this._onDidChangeStickyScrollHeight=this._register(new E),this.onDidChangeStickyScrollHeight=this._onDidChangeStickyScrollHeight.event,this._stickyScrollWidget=new yD(this._editor),this._stickyLineCandidateProvider=new RD(this._editor,n,i),this._register(this._stickyScrollWidget),this._register(this._stickyLineCandidateProvider),this._widgetState=pD.Empty;let s=this._stickyScrollWidget.getDomNode();this._register(this._editor.onDidChangeLineHeight(e=>{e.changes.forEach(e=>{let t=e.lineNumber;this._widgetState.startLineNumbers.includes(t)&&this._renderStickyScroll(t)})})),this._register(this._editor.onDidChangeFont(e=>{e.changes.forEach(e=>{let t=e.lineNumber;this._widgetState.startLineNumbers.includes(t)&&this._renderStickyScroll(t)})})),this._register(this._editor.onDidChangeConfiguration(e=>{this._readConfigurationChange(e)})),this._register(U(s,Eo.CONTEXT_MENU,async e=>{this._onContextMenu(su(s),e)})),this._stickyScrollFocusedContextKey=F.stickyScrollFocused.bindTo(this._contextKeyService),this._stickyScrollVisibleContextKey=F.stickyScrollVisible.bindTo(this._contextKeyService);let c=this._register(Ms(s));this._register(c.onDidBlur(e=>{this._positionRevealed===!1&&s.clientHeight===0?(this._focusedStickyElementIndex=-1,this.focus()):this._disposeFocusStickyScrollStore()})),this._register(c.onDidFocus(e=>{this.focus()})),this._registerMouseListeners(),this._register(U(s,Eo.MOUSE_DOWN,e=>{this._onMouseDown=!0})),this._register(this._stickyScrollWidget.onDidChangeStickyScrollHeight(e=>{this._onDidChangeStickyScrollHeight.fire(e)})),this._onDidResize(),this._readConfiguration()}get stickyScrollWidgetHeight(){return this._stickyScrollWidget.height}static get(e){return e.getContribution(VD.ID)}_disposeFocusStickyScrollStore(){this._stickyScrollFocusedContextKey.set(!1),this._focusDisposableStore?.dispose(),this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1}isFocused(){return this._focused}focus(){if(this._onMouseDown){this._onMouseDown=!1,this._editor.focus();return}this._stickyScrollFocusedContextKey.get()!==!0&&(this._focused=!0,this._focusDisposableStore=new P,this._stickyScrollFocusedContextKey.set(!0),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumbers.length-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}focusNext(){this._focusedStickyElementIndex<this._stickyScrollWidget.lineNumberCount-1&&this._focusNav(!0)}focusPrevious(){this._focusedStickyElementIndex>0&&this._focusNav(!1)}selectEditor(){this._editor.focus()}_focusNav(e){this._focusedStickyElementIndex=e?this._focusedStickyElementIndex+1:this._focusedStickyElementIndex-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex)}goToFocused(){let e=this._stickyScrollWidget.lineNumbers;this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:e[this._focusedStickyElementIndex],column:1})}_revealPosition(e){this._reveaInEditor(e,()=>this._editor.revealPosition(e))}_revealLineInCenterIfOutsideViewport(e){this._reveaInEditor(e,()=>this._editor.revealLineInCenterIfOutsideViewport(e.lineNumber,0))}_reveaInEditor(e,t){this._focused&&this._disposeFocusStickyScrollStore(),this._positionRevealed=!0,t(),this._editor.setSelection(S.fromPositions(e)),this._editor.focus()}_registerMouseListeners(){let e=this._register(new P),t=this._register(new Jg(this._editor,{extractLineNumberFromMouseEvent:e=>{let t=this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);return t?t.lineNumber:0}})),n=e=>{if(!this._editor.hasModel()||e.target.type!==12||e.target.detail!==this._stickyScrollWidget.getId())return null;let t=e.target.element;if(!t||t.innerText!==t.innerHTML)return null;let n=this._stickyScrollWidget.getEditorPositionFromNode(t);return n?{range:new S(n.lineNumber,n.column,n.lineNumber,n.column+t.innerText.length),textElement:t}:null},r=this._stickyScrollWidget.getDomNode();this._register(Ma(r,Eo.CLICK,e=>{if(e.ctrlKey||e.altKey||e.metaKey||!e.leftButton)return;if(e.shiftKey){let t=this._stickyScrollWidget.getLineIndexFromChildDomNode(e.target);if(t===null)return;let n=new x(this._endLineNumbers[t],1);this._revealLineInCenterIfOutsideViewport(n);return}if(this._stickyScrollWidget.isInFoldingIconDomNode(e.target)){let t=this._stickyScrollWidget.getLineNumberFromChildDomNode(e.target);this._toggleFoldingRegionForLine(t);return}if(!this._stickyScrollWidget.isInStickyLine(e.target))return;let t=this._stickyScrollWidget.getEditorPositionFromNode(e.target);if(!t){let n=this._stickyScrollWidget.getLineNumberFromChildDomNode(e.target);if(n===null)return;t=new x(n,1)}this._revealPosition(t)})),this._register(U(ks,Eo.MOUSE_MOVE,e=>{this._mouseTarget=e.target,this._onMouseMoveOrKeyDown(e)})),this._register(U(ks,Eo.KEY_DOWN,e=>{this._onMouseMoveOrKeyDown(e)})),this._register(U(ks,Eo.KEY_UP,()=>{this._showEndForLine!==void 0&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._register(t.onMouseMoveOrRelevantKeyDown(([t,r])=>{let i=n(t);if(!i||!t.hasTriggerModifier||!this._editor.hasModel()){e.clear();return}let{range:a,textElement:o}=i;if(!a.equalsRange(this._stickyRangeProjectedOnEditor))this._stickyRangeProjectedOnEditor=a,e.clear();else if(o.style.textDecoration===`underline`)return;let s=new ur;e.add(pl(()=>s.dispose(!0)));let c;ov(this._languageFeaturesService.definitionProvider,this._editor.getModel(),new x(a.startLineNumber,a.startColumn+1),!1,s.token).then((t=>{if(!s.token.isCancellationRequested)if(t.length!==0){this._candidateDefinitionsLength=t.length;let n=o;c===n?c||(c=n,c.style.textDecoration=`underline`,e.add(pl(()=>{c.style.textDecoration=`none`}))):(e.clear(),c=n,c.style.textDecoration=`underline`,e.add(pl(()=>{c.style.textDecoration=`none`})))}else e.clear()}))})),this._register(t.onCancel(()=>{e.clear()})),this._register(t.onExecute(async e=>{if(e.target.type!==12||e.target.detail!==this._stickyScrollWidget.getId())return;let t=this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);t&&(!this._editor.hasModel()||!this._stickyRangeProjectedOnEditor||(this._candidateDefinitionsLength>1&&(this._focused&&this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:t.lineNumber,column:1})),this._instaService.invokeFunction(xv,e,this._editor,{uri:this._editor.getModel().uri,range:this._stickyRangeProjectedOnEditor})))}))}_onContextMenu(e,t){let n=new _(e,t);this._contextMenuService.showContextMenu({menuId:M.StickyScrollContext,getAnchor:()=>n})}_onMouseMoveOrKeyDown(e){if(!e.shiftKey||!this._mouseTarget||!_e(this._mouseTarget))return;let t=this._stickyScrollWidget.getLineIndexFromChildDomNode(this._mouseTarget);t===null||this._showEndForLine===t||(this._showEndForLine=t,this._renderStickyScroll())}_toggleFoldingRegionForLine(e){if(!this._foldingModel||e===null)return;let t=this._stickyScrollWidget.getRenderedStickyLine(e),n=t?.foldingIcon;if(!n)return;Lx(this._foldingModel,1,[e]),n.isCollapsed=!n.isCollapsed;let r=(n.isCollapsed?this._editor.getTopForLineNumber(n.foldingEndLine):this._editor.getTopForLineNumber(n.foldingStartLine))-this._editor.getOption(75)*t.index+1;this._editor.setScrollTop(r),this._renderStickyScroll(e)}_readConfiguration(){let e=this._editor.getOption(130);if(e.enabled===!1){this._editor.removeOverlayWidget(this._stickyScrollWidget),this._resetState(),this._sessionStore.clear(),this._enabled=!1;return}else e.enabled&&!this._enabled&&(this._editor.addOverlayWidget(this._stickyScrollWidget),this._sessionStore.add(this._editor.onDidScrollChange(e=>{e.scrollTopChanged&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._sessionStore.add(this._editor.onDidLayoutChange(()=>this._onDidResize())),this._sessionStore.add(this._editor.onDidChangeModelTokens(e=>this._onTokensChange(e))),this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll(()=>{this._showEndForLine=void 0,this._renderStickyScroll()})),this._enabled=!0);this._editor.getOption(76).renderType===2&&this._sessionStore.add(this._editor.onDidChangeCursorPosition(()=>{this._showEndForLine=void 0,this._renderStickyScroll(0)}))}_readConfigurationChange(e){(e.hasChanged(130)||e.hasChanged(81)||e.hasChanged(75)||e.hasChanged(125)||e.hasChanged(76))&&this._readConfiguration(),(e.hasChanged(76)||e.hasChanged(52)||e.hasChanged(125))&&this._renderStickyScroll(0)}_needsUpdate(e){let t=this._stickyScrollWidget.getCurrentLines();for(let n of t)for(let t of e.ranges)if(n>=t.fromLineNumber&&n<=t.toLineNumber)return!0;return!1}_onTokensChange(e){this._needsUpdate(e)&&this._renderStickyScroll(0)}_onDidResize(){let e=this._editor.getLayoutInfo().height/this._editor.getOption(75);this._maxStickyLines=Math.round(e*.25),this._renderStickyScroll(0)}async _renderStickyScroll(e){let t=this._editor.getModel();if(!t||t.isTooLargeForTokenization()){this._resetState();return}let n=this._updateAndGetMinRebuildFromLine(e),r=this._stickyLineCandidateProvider.getVersionId();if(r===void 0||r===t.getVersionId())if(!this._focused)await this._updateState(n);else if(this._focusedStickyElementIndex===-1)await this._updateState(n),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1,this._focusedStickyElementIndex!==-1&&this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);else{let e=this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];await this._updateState(n),this._stickyScrollWidget.lineNumberCount===0?this._focusedStickyElementIndex=-1:(this._stickyScrollWidget.lineNumbers.includes(e)||(this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1),this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}}_updateAndGetMinRebuildFromLine(e){if(e!==void 0){let t=this._minRebuildFromLine===void 0?1/0:this._minRebuildFromLine;this._minRebuildFromLine=Math.min(e,t)}return this._minRebuildFromLine}async _updateState(e){this._minRebuildFromLine=void 0,this._foldingModel=await SS.get(this._editor)?.getFoldingModel()??void 0,this._widgetState=this.findScrollWidgetState();let t=this._widgetState.startLineNumbers.length>0;this._stickyScrollVisibleContextKey.set(t),this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,e)}async _resetState(){this._minRebuildFromLine=void 0,this._foldingModel=void 0,this._widgetState=pD.Empty,this._stickyScrollVisibleContextKey.set(!1),this._stickyScrollWidget.setState(void 0,void 0)}findScrollWidgetState(){if(!this._editor.hasModel())return pD.Empty;let e=this._editor.getModel(),t=Math.min(this._maxStickyLines,this._editor.getOption(130).maxLineCount),n=this._editor.getScrollTop(),r=0,i=[],a=[],o=this._editor.getVisibleRanges();if(o.length!==0){let s=new SD(o[0].startLineNumber,o[o.length-1].endLineNumber),c=this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(s);for(let o of c){let s=o.startLineNumber,c=o.endLineNumber;if(e.isValidRange({startLineNumber:s,endLineNumber:c,startColumn:1,endColumn:1})&&c-s>0){let e=o.top,l=e+o.height,u=this._editor.getTopForLineNumber(s)-n,d=this._editor.getBottomForLineNumber(c)-n;if(e>u&&e<=d&&(i.push(s),a.push(c+1),l>d&&(r=d-l)),i.length===t)break}}}return this._endLineNumbers=a,new pD(i,a,r,this._showEndForLine)}dispose(){super.dispose(),this._sessionStore.dispose()}};HD=VD=zD([BD(1,Mo),BD(2,W),BD(3,k),BD(4,Ar),BD(5,co),BD(6,w)],HD);const UD=Y(`inlineEdit.originalBackground`,ae(da,.2),H(1207,`Background color for the original text in inline edits.`),!0),WD=Y(`inlineEdit.modifiedBackground`,ae($i,.3),H(1208,`Background color for the modified text in inline edits.`),!0);Y(`inlineEdit.originalChangedLineBackground`,ae(da,.8),H(1209,`Background color for the changed lines in the original text of inline edits.`),!0);const GD=Y(`inlineEdit.originalChangedTextBackground`,ae(da,.8),H(1210,`Overlay color for the changed text in the original text of inline edits.`),!0),KD=Y(`inlineEdit.modifiedChangedLineBackground`,{light:ae(Hi,.7),dark:ae(Hi,.7),hcDark:Hi,hcLight:Hi},H(1211,`Background color for the changed lines in the modified text of inline edits.`),!0),qD=Y(`inlineEdit.modifiedChangedTextBackground`,ae($i,.7),H(1212,`Overlay color for the changed text in the modified text of inline edits.`),!0),JD=Y(`inlineEdit.gutterIndicator.primaryForeground`,dn,H(1213,`Foreground color for the primary inline edit gutter indicator.`)),YD=Y(`inlineEdit.gutterIndicator.primaryBorder`,Nt,H(1214,`Border color for the primary inline edit gutter indicator.`)),XD=Y(`inlineEdit.gutterIndicator.primaryBackground`,{light:ae(YD,.5),dark:ae(YD,.4),hcDark:ae(YD,.4),hcLight:ae(YD,.5)},H(1215,`Background color for the primary inline edit gutter indicator.`)),ZD=Y(`inlineEdit.gutterIndicator.secondaryForeground`,$u,H(1216,`Foreground color for the secondary inline edit gutter indicator.`)),QD=Y(`inlineEdit.gutterIndicator.secondaryBorder`,Dr,H(1217,`Border color for the secondary inline edit gutter indicator.`)),$D=Y(`inlineEdit.gutterIndicator.secondaryBackground`,QD,H(1218,`Background color for the secondary inline edit gutter indicator.`)),eO=Y(`inlineEdit.gutterIndicator.successfulForeground`,dn,H(1219,`Foreground color for the successful inline edit gutter indicator.`)),tO=Y(`inlineEdit.gutterIndicator.successfulBorder`,Nt,H(1220,`Border color for the successful inline edit gutter indicator.`)),nO=Y(`inlineEdit.gutterIndicator.successfulBackground`,tO,H(1221,`Background color for the successful inline edit gutter indicator.`)),rO=Y(`inlineEdit.gutterIndicator.background`,{hcDark:ae(`tab.inactiveBackground`,.5),hcLight:ae(`tab.inactiveBackground`,.5),dark:ae(`tab.inactiveBackground`,.5),light:`#5f5f5f18`},H(1222,`Background color for the inline edit gutter indicator.`));var iO=Y(`inlineEdit.originalBorder`,{light:da,dark:da,hcDark:da,hcLight:da},H(1223,`Border color for the original text in inline edits.`)),aO=Y(`inlineEdit.modifiedBorder`,{light:cn($i,.6),dark:$i,hcDark:$i,hcLight:$i},H(1224,`Border color for the modified text in inline edits.`)),oO=Y(`inlineEdit.tabWillAcceptModifiedBorder`,{light:cn(aO,0),dark:cn(aO,0),hcDark:cn(aO,0),hcLight:cn(aO,0)},H(1225,`Modified border color for the inline edits widget when tab will accept it.`)),sO=Y(`inlineEdit.tabWillAcceptOriginalBorder`,{light:cn(iO,0),dark:cn(iO,0),hcDark:cn(iO,0),hcLight:cn(iO,0)},H(1226,`Original border color for the inline edits widget over the original text when tab will accept it.`));function cO(e){return e.map(e=>e===tT.Accept?oO:aO)}function lO(e){return e.map(e=>e===tT.Accept?sO:iO)}function uO(e,t){let n;n=typeof e==`string`?dO(e,t):e.map((e,n)=>dO(e,t).read(n));let r=dO(i,t);return n.map((e,t)=>e.makeOpaque(r.read(t)))}function dO(e,t){return Oi({owner:{observeColor:e},equalsFn:(e,t)=>e.equals(t)},t.onDidColorThemeChange,()=>{let n=t.getColorTheme().getColor(e);if(!n)throw new h(`Missing color: ${e}`);return n})}function fO(e,t,n){e.layoutInfo.read(n),e.value.read(n);let r=e.model.read(n);if(!r)return 0;let i=0;e.scrollTop.read(n);for(let n=t.startLineNumber;n<t.endLineNumberExclusive;n++){let t=r.getLineMaxColumn(n),a=e.editor.getOffsetForColumn(n,t);if(a===-1){let n=e.editor.getOption(59).typicalHalfwidthCharacterWidth;a=t*n}i=Math.max(i,a)}let a=t.mapToLineArray(e=>r.getLineContent(e));return i<5&&a.some(e=>e.length>0)&&r.uri.scheme!==`file`&&console.error(`unexpected width`),i}function pO(e,t,n){return e.layoutInfo.read(n),e.value.read(n),e.model.read(n)?(e.scrollTop.read(n),e.editor.getOffsetForColumn(t.lineNumber,t.column)):0}function mO(e,t,n,r){let i=r.getModel();if(!i)return{prefixTrim:0,prefixLeftOffset:0};let a=e.map(e=>e.isSingleLine()?e.startColumn-1:0),o=t.mapToLineArray(e=>fu(i.getLineContent(e))),s=n.filter(e=>e!==``).map(e=>fu(e)),c=Math.min(...a,...o,...s),l;if(i.getLineIndentColumn(t.startLineNumber)>=c+1)l=r.getOffsetForColumn(t.startLineNumber,c+1);else if(n.length>0)l=hO(n[0].slice(0,c),r,i);else return{prefixTrim:0,prefixLeftOffset:0};return{prefixTrim:c,prefixLeftOffset:l}}function hO(e,t,n){let r=t.getOption(59).typicalHalfwidthCharacterWidth,i=n.getOptions().tabSize*r,a=e.split(`	`).length-1;return(e.length-a)*r+a*i}function gO(e){let t=e.layoutInfoContentLeft,n=O({name:`editor.validOverlay.width`},n=>{let r=e.layoutInfoMinimap.read(n).minimapLeft!==0,i=e.layoutInfoWidth.read(n)-t.read(n);if(r){let t=e.layoutInfoMinimap.read(n).minimapWidth+e.layoutInfoVerticalScrollbarWidth.read(n);return i-t}return i}),r=O({name:`editor.validOverlay.height`},t=>e.layoutInfoHeight.read(t)+e.contentHeight.read(t));return O({name:`editor.validOverlay`},e=>fD.fromLeftTopWidthHeight(t.read(e),0,n.read(e),r.read(e)))}function _O(e,t){let n=[];for(let r of e){let e=t.mapRange(r.modifiedRange);n.push(new Zc(r.originalRange,e))}return n}function vO(...e){return e.filter(e=>typeof e==`string`).join(` `)}function yO(e,t){return new S(t.lineNumber,t.column+e.start,t.lineNumber,t.column+e.endExclusive)}function bO(e,t){let n=0;loop:for(let r=0,i=e.length;r<i;r++)switch(e.charCodeAt(r)){case 9:n+=t;break;case 32:n++;break;default:break loop}return n-n%t}function xO(e,t,n){let r=t-t%n,i=0;for(;i<e.length&&r!==0;i++)switch(e.charCodeAt(i)){case 9:r-=n;break;case 32:r--;break;default:throw new h(`Unexpected character found while calculating indent length`)}return i}function SO(e,t,n){let r=a(e),i=[],o=Se(t.mapToLineArray(e=>bO(r[e-1],n)),Qi);return t.forEach(e=>{let t=xO(r[e-1],o,n);i.push(new es(yO(new Pe(0,t),new x(e,1)),``))}),new ps(i)}var CO=class{constructor(){this._data=``}moveTo(e){return this._data+=`M ${e.x} ${e.y} `,this}lineTo(e){return this._data+=`L ${e.x} ${e.y} `,this}build(){return this._data}};function wO(e){let t=Zu(void 0,(t,n)=>e.read(t)||n);return Zi({debugName:()=>`${e.debugName}.mapOutFalsy`},n=>{if(t.read(n),e.read(n))return t})}function TO(e){return{left:O({name:`editor.validOverlay.left`},t=>e(t).left),top:O({name:`editor.validOverlay.top`},t=>e(t).top),width:O({name:`editor.validOverlay.width`},t=>e(t).right-e(t).left),height:O({name:`editor.validOverlay.height`},t=>e(t).bottom-e(t).top)}}var EO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},DO=function(e,t){return function(n,r){t(n,r,e)}},OO=class{constructor(e,t,n,r,i,a){this._model=e,this._close=t,this._editorObs=n,this._contextKeyService=r,this._keybindingService=i,this._commandService=a,this._inlineEditsShowCollapsed=this._editorObs.getOption(71).map(e=>e.edits.showCollapsed)}toDisposableLiveElement(){return this._createHoverContent().toDisposableLiveElement()}_createHoverContent(){let e=Vl(`active`,void 0),t=t=>({title:t.title,icon:t.icon,keybinding:typeof t.commandId==`string`?this._getKeybinding(t.commandArgs?void 0:t.commandId):O(this,e=>typeof t.commandId==`string`?void 0:this._getKeybinding(t.commandArgs?void 0:t.commandId.read(e)).read(e)),isActive:e.map(e=>e===t.id),onHoverChange:n=>e.set(n?t.id:void 0,void 0),onAction:()=>(this._close(!0),this._commandService.executeCommand(typeof t.commandId==`string`?t.commandId:t.commandId.get(),...t.commandArgs??[]))}),n=AO(this._model.displayName),r=jO(t({id:`gotoAndAccept`,title:`${H(1200,`Go To`)} / ${H(1201,`Accept`)}`,icon:J.check,commandId:Ch})),i=jO(t({id:`reject`,title:H(1202,`Reject`),icon:J.close,commandId:Eh})),a=this._model.extensionCommands.map((e,n)=>jO(t({id:e.command.id+`_`+n,title:e.command.title,icon:e.icon??J.symbolEvent,commandId:e.command.id,commandArgs:e.command.arguments}))),o=this._inlineEditsShowCollapsed.map(e=>jO(t(e?{id:`showExpanded`,title:H(1203,`Show Expanded`),icon:J.expandAll,commandId:Dh}:{id:`showCollapsed`,title:H(1204,`Show Collapsed`),icon:J.collapseAll,commandId:Dh}))),s=jO(t({id:`settings`,title:H(1205,`Settings`),icon:J.gear,commandId:`workbench.action.openSettings`,commandArgs:[`@tag:nextEditSuggestions`]})),c=this._model.action?[this._model.action]:[],l=c.length>0?MO(c.map(e=>({id:e.id,label:e.title,enabled:!0,run:()=>this._commandService.executeCommand(e.id,...e.arguments??[]),class:void 0,tooltip:e.tooltip??e.title})),{hoverDelegate:Es}):void 0;return kO([n,r,i,o,s,a.length?NO():void 0,...a,l?NO():void 0,l])}_getKeybinding(e){return e?ai(this._contextKeyService.onDidChangeContext,()=>this._keybindingService.lookupKeybinding(e)):jt(void 0)}};OO=EO([DO(3,w),DO(4,zn),DO(5,Mr)],OO);function kO(e){return q.div({class:`content`,style:{margin:4,minWidth:150}},e)}function AO(e){return q.div({class:`header`,style:{color:C(bn),fontSize:`12px`,fontWeight:`600`,padding:`0 10px`,lineHeight:26}},[e])}function jO(e){return O({name:`inlineEdits.option`},t=>q.div({class:[`monaco-menu-option`,e.isActive?.map(e=>e&&`active`)],onmouseenter:()=>e.onHoverChange?.(!0),onmouseleave:()=>e.onHoverChange?.(!1),onclick:e.onAction,onkeydown:t=>{t.key===`Enter`&&e.onAction?.()},tabIndex:0,style:{borderRadius:3}},[q.elem(`span`,{style:{fontSize:16,display:`flex`}},[X.isThemeIcon(e.icon)?Jn(e.icon):e.icon.map(e=>Jn(e))]),q.elem(`span`,{},[e.title]),q.div({style:{marginLeft:`auto`},ref:n=>{let r=t.store.add(new bc(n,xs,{disableTitle:!0,...id,keybindingLabelShadow:void 0,keybindingLabelBackground:C($t),keybindingLabelBorder:`transparent`,keybindingLabelBottomBorder:void 0}));t.store.add(la(t=>{r.set(e.keybinding.read(t))}))}})]))}function MO(e,t){return O({name:`inlineEdits.actionBar`},n=>q.div({class:[`action-widget-action-bar`],style:{padding:`0 10px`}},[q.div({ref:r=>{n.store.add(new Bs(r,t)).push(e,{icon:!1,label:!0})}})]))}function NO(){return q.div({id:`inline-edit-gutter-indicator-menu-separator`,class:`menu-separator`,style:{color:C(Fn),padding:`4px 0`}},q.div({style:{borderBottom:`1px solid ${C(tc)}`}}))}var PO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},FO=function(e,t){return function(n,r){t(n,r,e)}},IO=class extends b{get model(){let e=this._model.get();if(!e)throw new h(`Inline Edit Model not available`);return e}constructor(e,t,n,r,i,a,o,s,c,l){super(),this._editorObs=e,this._originalRange=t,this._verticalOffset=n,this._model=r,this._isHoveringOverInlineEdit=i,this._focusIsInMenu=a,this._hoverService=o,this._instantiationService=s,this._accessibilityService=c,this._tabAction=O(this,e=>{let t=this._model.read(e);return t?t.tabAction.read(e):tT.Inactive}),this._hoverVisible=Vl(this,!1),this.isHoverVisible=this._hoverVisible,this._isHoveredOverIcon=Vl(this,!1),this._isHoveredOverIconDebounced=Tr(this._isHoveredOverIcon,100),this.isHoveredOverIcon=this._isHoveredOverIconDebounced,this._isHoveredOverInlineEditDebounced=Tr(this._isHoveringOverInlineEdit,100),this._gutterIndicatorStyles=this._tabAction.map((e,t)=>{switch(e){case tT.Inactive:return{background:uO($D,l).read(t).toString(),foreground:uO(ZD,l).read(t).toString(),border:uO(QD,l).read(t).toString()};case tT.Jump:return{background:uO(XD,l).read(t).toString(),foreground:uO(JD,l).read(t).toString(),border:uO(YD,l).read(t).toString()};case tT.Accept:return{background:uO(nO,l).read(t).toString(),foreground:uO(eO,l).read(t).toString(),border:uO(tO,l).read(t).toString()}}}),this._originalRangeObs=wO(this._originalRange),this._state=O(this,e=>{let t=this._originalRangeObs.read(e);if(t)return{range:t,lineOffsetRange:this._editorObs.observeLineOffsetRange(t,this._store)}}),this._stickyScrollController=HD.get(this._editorObs.editor),this._stickyScrollHeight=this._stickyScrollController?ai(this._stickyScrollController.onDidChangeStickyScrollHeight,()=>this._stickyScrollController.stickyScrollWidgetHeight):jt(0),this._lineNumberToRender=O(this,e=>{if(this._verticalOffset.read(e)!==0)return``;let t=this._originalRange.read(e)?.startLineNumber,n=this._editorObs.getOption(76).read(e);if(t===void 0||n.renderType===0)return``;if(n.renderType===3){let n=this._editorObs.cursorPosition.read(e);return t%10==0||n&&n.lineNumber===t?t.toString():``}if(n.renderType===2){let n=this._editorObs.cursorPosition.read(e);if(!n)return``;let r=Math.abs(t-n.lineNumber);return r===0?t.toString():r.toString()}return n.renderType===4?n.renderFn?n.renderFn(t):``:t.toString()}),this._availableWidthForIcon=O(this,e=>{let t=this._editorObs.editor.getModel(),n=this._editorObs.editor,r=this._editorObs.layoutInfo.read(e),i=r.decorationsLeft+r.decorationsWidth-r.glyphMarginLeft;if(!t||i<=0)return()=>0;if(r.lineNumbersLeft===0)return()=>i;let a=this._editorObs.getOption(76).read(e);if(a.renderType===2||a.renderType===0)return()=>i;let o=n.getOption(59).typicalHalfwidthCharacterWidth,s=r.lineNumbersLeft+r.lineNumbersWidth,c=(t.getLineCount()+1).toString().length,l=[];for(let e=1;e<=c;e++){let t=10**(e-1),a=n.getTopForLineNumber(t),c=e*o,u=Math.min(i,Math.max(0,s-c-r.glyphMarginLeft));l.push({firstLineNumberWithDigitCount:t,topOfLineNumber:a,usableWidthLeftOfLineNumber:u})}return e=>{for(let t=l.length-1;t>=0;t--)if(e>=l[t].topOfLineNumber)return l[t].usableWidthLeftOfLineNumber;throw new h(`Could not find avilable width for icon`)}}),this._layout=O(this,e=>{let t=this._state.read(e);if(!t)return;let n=this._editorObs.layoutInfo.read(e),r=this._editorObs.observeLineHeightForLine(t.range.map(e=>e.startLineNumber)).read(e),i=n.decorationsLeft+n.decorationsWidth-n.glyphMarginLeft-4,a=n.height-4,o=fD.fromLeftTopWidthHeight(2,2,i,a),s=o.withTop(this._stickyScrollHeight.read(e)),c=o.withTop(s.top+2),l=t.lineOffsetRange.read(e),u=fD.fromRanges(Pe.fromTo(c.left,c.right),l),d=r,f=this._verticalOffset.read(e),p=u.withHeight(d).translateY(f),m=s.containsRect(p),h=this._tabAction.map(e=>e===tT.Accept?J.keyboardTab:J.arrowRight),g=O(this,e=>{if(this._isHoveredOverIconDebounced.read(e)||this._isHoveredOverInlineEditDebounced.read(e))return J.check;if(this._tabAction.read(e)===tT.Accept)return J.keyboardTab;let n=this._editorObs.cursorLineNumber.read(e)??0,r=t.range.read(e).startLineNumber;return n<=r?J.keyboardTabAbove:J.keyboardTabBelow}),_=e=>{let t=this._availableWidthForIcon.get()(e.bottom+this._editorObs.editor.getScrollTop())-2;return Math.max(Math.min(t,22),16)};if(m){let e=p,t;t=n.lineNumbersWidth===0?Math.min(Math.max(n.lineNumbersLeft-o.left,0),e.width-22):Math.max(n.lineNumbersLeft+n.lineNumbersWidth-o.left,0);let r=e.withWidth(t),i=Math.max(Math.min(n.decorationsWidth,22),16),a=e.withWidth(i).translateX(t);return{gutterEditArea:u,icon:g,iconDirection:`right`,iconRect:a,pillRect:e,lineNumberRect:r}}let ee=o.intersect(u);if(ee&&ee.height>=d){let e=p.moveToBeContainedIn(c).moveToBeContainedIn(ee),t=e.withWidth(_(e));return{gutterEditArea:u,icon:g,iconDirection:`right`,iconRect:t,pillRect:t}}let v=p.moveToBeContainedIn(o),te=v.withWidth(_(v)),y=te,ne=te.top<p.top?`top`:`bottom`;return{gutterEditArea:u,icon:h,iconDirection:ne,iconRect:y,pillRect:te}}),this._iconRef=q.ref(),this.isVisible=this._layout.map(e=>!!e),this._indicator=q.div({class:`inline-edits-view-gutter-indicator`,onclick:()=>{let e=this._layout.get()?.icon.get()===J.check;this._editorObs.editor.focus(),e?this.model.accept():this.model.jump()},tabIndex:0,style:{position:`absolute`,overflow:`visible`}},wO(this._layout).map(e=>e?[q.div({style:{position:`absolute`,background:C(rO),borderRadius:`4px`,...TO(t=>e.read(t).gutterEditArea)}}),q.div({class:`icon`,ref:this._iconRef,onmouseenter:()=>{this._showHover()},style:{cursor:`pointer`,zIndex:`20`,position:`absolute`,backgroundColor:this._gutterIndicatorStyles.map(e=>e.background),"--vscodeIconForeground":this._gutterIndicatorStyles.map(e=>e.foreground),border:this._gutterIndicatorStyles.map(e=>`1px solid ${e.border}`),boxSizing:`border-box`,borderRadius:`4px`,display:`flex`,justifyContent:`flex-end`,transition:`background-color 0.2s ease-in-out, width 0.2s ease-in-out`,...TO(t=>e.read(t).pillRect)}},[q.div({className:`line-number`,style:{lineHeight:e.map(e=>e.lineNumberRect?e.lineNumberRect.height:0),display:e.map(e=>e.lineNumberRect?`flex`:`none`),alignItems:`center`,justifyContent:`flex-end`,width:e.map(e=>e.lineNumberRect?e.lineNumberRect.width:0),height:`100%`,color:this._gutterIndicatorStyles.map(e=>e.foreground)}},this._lineNumberToRender),q.div({style:{rotate:e.map(e=>`${LO(e.iconDirection)}deg`),transition:`rotate 0.2s ease-in-out`,display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`,marginRight:e.map(e=>e.pillRect.width-e.iconRect.width-(e.lineNumberRect?.width??0)),width:e.map(e=>e.iconRect.width)}},[e.map((e,t)=>Jn(e.icon.read(t)))])])]:[])).keepUpdated(this._store),this._register(this._editorObs.createOverlayWidget({domNode:this._indicator.element,position:jt(null),allowEditorOverflow:!1,minContentWidthInPx:jt(0)})),this._register(this._editorObs.editor.onMouseMove(e=>{if(this._state.get()===void 0)return;let t=this._iconRef.element.getBoundingClientRect(),n=fD.fromLeftTopWidthHeight(t.left,t.top,t.width,t.height),r=new As(e.event.posx,e.event.posy);this._isHoveredOverIcon.set(n.containsPoint(r),void 0)})),this._register(this._editorObs.editor.onDidScrollChange(()=>{this._isHoveredOverIcon.set(!1,void 0)})),this._register(xn(this._isHoveredOverInlineEditDebounced,e=>{e&&this.triggerAnimation()})),this._register(la(e=>{this._indicator.readEffect(e),this._indicator.element&&this._editorObs.editor.applyFontInfo(this._indicator.element)}))}triggerAnimation(){return this._accessibilityService.isMotionReduced()?new Animation(null,null).finished:this._iconRef.element.animate([{outline:`2px solid ${this._gutterIndicatorStyles.map(e=>e.border).get()}`,outlineOffset:`-1px`,offset:0},{outline:`2px solid transparent`,outlineOffset:`10px`,offset:1}],{duration:500}).finished}_showHover(){if(this._hoverVisible.get())return;let e=new P,t=e.add(this._instantiationService.createInstance(OO,this.model,e=>{e&&this._editorObs.editor.focus(),r?.dispose()},this._editorObs).toDisposableLiveElement()),n=e.add(Ms(t.element));e.add(n.onDidBlur(()=>this._focusIsInMenu.set(!1,void 0))),e.add(n.onDidFocus(()=>this._focusIsInMenu.set(!0,void 0))),e.add(pl(()=>this._focusIsInMenu.set(!1,void 0)));let r=this._hoverService.showInstantHover({target:this._iconRef.element,content:t.element});r?(this._hoverVisible.set(!0,void 0),e.add(this._editorObs.editor.onDidScrollChange(()=>r.dispose())),e.add(r.onDispose(()=>{this._hoverVisible.set(!1,void 0),e.dispose()}))):e.dispose()}};IO=PO([FO(6,Ac),FO(7,k),FO(8,Zt),FO(9,rn)],IO);function LO(e){switch(e){case`top`:return 90;case`bottom`:return-90;case`right`:return 0}}var RO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},zO=function(e,t){return function(n,r){t(n,r,e)}},BO;(function(e){e.FirstTime=`firstTime`,e.SecondTime=`secondTime`,e.Active=`active`})(BO||={});var VO=class extends b{constructor(e,t,n,r,i,a){super(),this._host=e,this._model=t,this._indicator=n,this._collapsedView=r,this._storageService=i,this._configurationService=a,this._disposables=this._register(new Ot),this._setupDone=Vl({name:`setupDone`},!1),this._activeCompletionId=O(e=>{let t=this._model.read(e);if(!t||!this._setupDone.read(e))return;let n=this._indicator.read(e);if(!(!n||!n.isVisible.read(e)))return t.inlineEdit.inlineCompletion.identity.id}),this._register(this._initializeDebugSetting()),this._disposables.value=this.setupNewUserExperience(),this._setupDone.set(!0,void 0)}setupNewUserExperience(){if(this.getNewUserType()===BO.Active)return;let e=new P,t=!1,r=!1,i=0,a=0;return e.add(Nn(this._activeCompletionId,async(e,n,o,s)=>{if(e===void 0)return;let c=this.getNewUserType();switch(c){case BO.FirstTime:(i++>=5||t)&&(c=BO.SecondTime,this.setNewUserType(c));break;case BO.SecondTime:a++>=3&&r&&(c=BO.Active,this.setNewUserType(c));break}switch(c){case BO.FirstTime:for(let e=0;e<3&&!s.isCancellationRequested;e++)await this._indicator.get()?.triggerAnimation(),await qs(500);break;case BO.SecondTime:this._indicator.get()?.triggerAnimation();break}})),e.add(la(e=>{this._collapsedView.isVisible.read(e)&&this.getNewUserType()!==BO.Active&&this._collapsedView.triggerAnimation()})),e.add(n((e,n)=>{let r=this._indicator.read(e);r&&n.add(xn(r.isHoveredOverIcon,async e=>{e&&(t=!0)}))})),e.add(n((e,t)=>{let n=this._host.read(e);n&&t.add(n.onDidAccept(()=>{r=!0}))})),e}getNewUserType(){return this._storageService.get(`inlineEditsGutterIndicatorUserKind`,-1,BO.FirstTime)}setNewUserType(e){switch(e){case BO.FirstTime:throw new h(`UserKind should not be set to first time`);case BO.SecondTime:break;case BO.Active:this._disposables.clear();break}this._storageService.store(`inlineEditsGutterIndicatorUserKind`,e,-1,0)}_initializeDebugSetting(){let e=`editor.inlineSuggest.edits.resetNewUserExperience`;return this._configurationService.getValue(e)&&this._storageService.remove(`inlineEditsGutterIndicatorUserKind`,-1),this._configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration(e)&&this._configurationService.getValue(e)&&(this._storageService.remove(`inlineEditsGutterIndicatorUserKind`,-1),this._disposables.value=this.setupNewUserExperience())})}};VO=RO([zO(4,Mu),zO(5,Ni)],VO);var HO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},UO=function(e,t){return function(n,r){t(n,r,e)}},WO=class extends b{constructor(e,t,n){super(),this._editor=e,this._edit=t,this._accessibilityService=n,this._onDidClick=this._register(new E),this.onDidClick=this._onDidClick.event,this._iconRef=q.ref(),this.isHovered=jt(!1),this._editorObs=f(this._editor);let r=this._edit.map(e=>e?.edit.replacements[0]??null).map(e=>e?Aw(e,this._editor.getModel()).range.getStartPosition():null),i=this._editorObs.observePosition(r,this._store),a=O(e=>{let t=i.read(e);if(!t)return null;let n=this._editorObs.layoutInfoContentLeft.read(e),r=this._editorObs.scrollLeft.read(e);return new As(n+t.x-r,t.y)}),o=q.div({class:`inline-edits-collapsed-view`,style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`,display:`block`}},[[this.getCollapsedIndicator(a)]]).keepUpdated(this._store).element;this._register(this._editorObs.createOverlayWidget({domNode:o,position:jt(null),allowEditorOverflow:!1,minContentWidthInPx:jt(0)})),this.isVisible=this._edit.map((e,t)=>!!e&&a.read(t)!==null)}triggerAnimation(){return this._accessibilityService.isMotionReduced()?new Animation(null,null).finished:this._iconRef.element.animate([{offset:0,transform:`translateY(-3px)`},{offset:.2,transform:`translateY(1px)`},{offset:.36,transform:`translateY(-1px)`},{offset:.52,transform:`translateY(1px)`},{offset:.68,transform:`translateY(-1px)`},{offset:.84,transform:`translateY(1px)`},{offset:1,transform:`translateY(0px)`}],{duration:2e3}).finished}getCollapsedIndicator(e){let t=this._editorObs.layoutInfoContentLeft,n=e.map((e,n)=>e?e.deltaX(-t.read(n)):null),r=this.createIconPath(n);return q.svg({class:`collapsedView`,ref:this._iconRef,style:{position:`absolute`,...TO(e=>gO(this._editorObs).read(e)),overflow:`hidden`,pointerEvents:`none`}},[q.svgElem(`path`,{class:`collapsedViewPath`,d:r,fill:C(YD)})])}createIconPath(e){return e.map(e=>{if(!e)return new CO().build();let t=e.deltaX(-6/2).deltaY(-1),n=t.deltaX(6),r=t.deltaY(1),i=n.deltaY(1),a=r.deltaX(6/2).deltaY(3);return new CO().moveTo(t).lineTo(n).lineTo(i).lineTo(a).lineTo(r).lineTo(t).build()})}};WO=HO([UO(2,Zt)],WO);var GO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},KO=function(e,t){return function(n,r){t(n,r,e)}},qO=class extends b{constructor(e,t,n,r,a){super(),this._editor=e,this._languageService=a,this._onDidClick=this._register(new E),this.onDidClick=this._onDidClick.event,this._isHovered=Vl(this,!1),this.isHovered=this._isHovered,this._viewRef=q.ref(),this._editorObs=f(this._editor);let o=n.map((e,t)=>{let n;switch(e){case tT.Inactive:n=$D;break;case tT.Jump:n=XD;break;case tT.Accept:n=nO;break}return{border:uO(n,r).read(t).toString(),background:C(i)}}),s=t.map(e=>e?this.getState(e):void 0),c=s.map(e=>e?this.getRendering(e,o):void 0);this.minEditorScrollHeight=O(this,e=>{let t=s.read(e);return t?t.rect.read(e).bottom+this._editor.getScrollTop():0});let l=q.div({class:`inline-edits-custom-view`,style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`,display:`block`}},[c]).keepUpdated(this._store);this._register(this._editorObs.createOverlayWidget({domNode:l.element,position:jt(null),allowEditorOverflow:!1,minContentWidthInPx:Zu(this,(e,t)=>{let n=s.read(e);if(!n)return t??0;let r=n.rect.map(e=>e.right).read(e)+this._editorObs.layoutInfoVerticalScrollbarWidth.read(e)+4-this._editorObs.layoutInfoContentLeft.read(e);return Math.max(t??0,r)}).recomputeInitiallyAndOnChange(this._store)})),this._register(la(e=>{if(!c.read(e)){this._isHovered.set(!1,void 0);return}this._isHovered.set(l.isHovered.read(e),void 0)}))}fitsInsideViewport(e,t,n){let r=this._editorObs.layoutInfoWidth.read(n),i=this._editorObs.layoutInfoContentLeft.read(n),a=this._editor.getLayoutInfo().verticalScrollbarWidth,o=this._editorObs.layoutInfoMinimap.read(n).minimapLeft===0?0:this._editorObs.layoutInfoMinimap.read(n).minimapWidth,s=fO(this._editorObs,e,void 0),c=hO(t,this._editor,this._editor.getModel());return s+c+18<r-i-a-o}getState(e){let t=O(this,t=>{let n=e.range.startLineNumber,r=e.range.endLineNumber,i=e.range.startColumn,a=e.range.endColumn,o=this._editor.getModel()?.getLineCount()??0,s=fO(this._editorObs,new Ya(n,n+1),t),c=n+1<=o?fO(this._editorObs,new Ya(n+1,n+2),t):void 0,l=n-1>=1?fO(this._editorObs,new Ya(n-1,n),t):void 0,u=this._editor.getOffsetForColumn(n,i),d=this._editor.getOffsetForColumn(r,a);return{lineWidth:s,lineWidthBelow:c,lineWidthAbove:l,startContentLeftOffset:u,endContentLeftOffset:d}}),n=e.range.startLineNumber,r=e.range.endLineNumber,i=this.fitsInsideViewport(new Ya(n,r+1),e.label,void 0);return{rect:O(this,a=>{let o=this._editorObs.getOption(59).read(a).typicalHalfwidthCharacterWidth,{lineWidth:s,lineWidthBelow:c,lineWidthAbove:l,startContentLeftOffset:u,endContentLeftOffset:d}=t.read(a),f=this._editorObs.layoutInfoContentLeft.read(a),p=this._editorObs.observeLineHeightForLine(n).recomputeInitiallyAndOnChange(a.store).read(a),m=this._editorObs.scrollTop.read(a),h=this._editorObs.scrollLeft.read(a),g;g=n===r&&d+5*o>=s&&i?`end`:c!==void 0&&c+14-4-4<u?`below`:l!==void 0&&l+14-4-4<u?`above`:`end`;let _,ee,v=0,te=0;switch(g){case`end`:_=this._editorObs.editor.getTopForLineNumber(n),ee=s,v=18;break;case`below`:_=this._editorObs.editor.getTopForLineNumber(n+1),ee=u,v=8,te=2;break;case`above`:_=this._editorObs.editor.getTopForLineNumber(n-1),ee=u,v=8,te=2;break}return fD.fromLeftTopWidthHeight(f+ee-h,_-m,o*e.label.length,p).withMargin(0,4).translateX(v).translateY(te)}),label:e.label,kind:e.kind}}getRendering(e,t){let n=document.createElement(`div`),r=this._editor.getModel().tokenization.tokenizeLinesAt(1,[e.label])?.[0],i;i=r&&e.kind===Ko.Code?Ul.fromLineTokens(r).toLineTokens(e.label,this._languageService.languageIdCodec):jo.createEmpty(e.label,this._languageService.languageIdCodec);let a=Ye(new jn([i]),er.fromEditor(this._editor).withSetWidth(!1).withScrollBeyondLastColumn(0),[],n,!0);n.style.width=`${a.minWidthInPx}px`;let o=e.rect.map(e=>e.withMargin(0,4));return q.div({class:`collapsedView`,ref:this._viewRef,style:{position:`absolute`,...TO(e=>o.read(e)),overflow:`hidden`,boxSizing:`border-box`,cursor:`pointer`,border:t.map(e=>`1px solid ${e.border}`),borderRadius:`4px`,backgroundColor:t.map(e=>e.background),display:`flex`,alignItems:`center`,justifyContent:`center`,whiteSpace:`nowrap`},onmousedown:e=>{e.preventDefault()},onclick:e=>{this._onDidClick.fire(new _(su(e),e))}},[n])}};qO=GO([KO(3,rn),KO(4,ui)],qO);var JO=class extends b{constructor(e,t,n,r){super(),this._editor=e,this._edit=t,this._uiState=n,this._tabAction=r,this._onDidClick=this._register(new E),this.onDidClick=this._onDidClick.event,this._display=O(this,e=>this._uiState.read(e)?`block`:`none`),this._editorMaxContentWidthInRange=O(this,e=>{let t=this._originalDisplayRange.read(e);return t?(this._editorObs.versionId.read(e),Zu(this,(e,n)=>{let r=fO(this._editorObs,t,e);return Math.max(r,n??0)})):jt(0)}).map((e,t)=>e.read(t)),this._maxPrefixTrim=O(this,e=>{let t=this._uiState.read(e);return t?mO(t.deletions,t.originalRange,[],this._editor):{prefixTrim:0,prefixLeftOffset:0}}),this._editorLayoutInfo=O(this,e=>{let t=this._edit.read(e);if(!t||!this._uiState.read(e))return null;let n=this._editorObs.layoutInfo.read(e),r=this._editorObs.scrollLeft.read(e),i=this._editorObs.getOption(59).map(e=>e.typicalHalfwidthCharacterWidth).read(e),a=n.contentLeft+Math.max(this._editorMaxContentWidthInRange.read(e),i)-r,o=t.originalLineRange,s=this._originalVerticalStartPosition.read(e)??this._editor.getTopForLineNumber(o.startLineNumber)-this._editorObs.scrollTop.read(e),c=this._originalVerticalEndPosition.read(e)??this._editor.getTopForLineNumber(o.endLineNumberExclusive)-this._editorObs.scrollTop.read(e),l=n.contentLeft+this._maxPrefixTrim.read(e).prefixLeftOffset-r;return a<=l?null:{codeRect:fD.fromLeftTopRightBottom(l,s,a,c).withMargin(0,0),contentLeft:n.contentLeft}}).recomputeInitiallyAndOnChange(this._store),this._originalOverlay=q.div({style:{pointerEvents:`none`}},O(this,e=>{let t=wO(this._editorLayoutInfo).read(e);if(!t)return;let n=t.map(e=>fD.fromLeftTopRightBottom(e.contentLeft-4-1,e.codeRect.top,e.contentLeft,e.codeRect.bottom)),r=O(this,e=>{let r=t.read(e).codeRect,i=n.read(e);return r.intersectHorizontal(new Pe(i.left,2**53-1))}),a=this._uiState.map(e=>e?.inDiffEditor?3:1).read(e),o=r.map(e=>e.withMargin(a,a));return[q.div({class:`originalSeparatorDeletion`,style:{...o.read(e).toStyles(),borderRadius:`4px`,border:`${1+a}px solid ${C(i)}`,boxSizing:`border-box`}}),q.div({class:`originalOverlayDeletion`,style:{...r.read(e).toStyles(),borderRadius:`4px`,border:lO(this._tabAction).map(e=>`1px solid ${C(e)}`),boxSizing:`border-box`,backgroundColor:C(UD)}}),q.div({class:`originalOverlayHiderDeletion`,style:{...n.read(e).toStyles(),backgroundColor:C(i)}})]})).keepUpdated(this._store),this._nonOverflowView=q.div({class:`inline-edits-view`,style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`,display:this._display}},[[this._originalOverlay]]).keepUpdated(this._store),this.isHovered=jt(!1),this._editorObs=f(this._editor);let a=O(this,e=>{let t=this._edit.read(e);return t?new x(t.originalLineRange.startLineNumber,1):null}),o=O(this,e=>{let t=this._edit.read(e);return t?new x(t.originalLineRange.endLineNumberExclusive,1):null});this._originalDisplayRange=this._uiState.map(e=>e?.originalRange),this._originalVerticalStartPosition=this._editorObs.observePosition(a,this._store).map(e=>e?.y),this._originalVerticalEndPosition=this._editorObs.observePosition(o,this._store).map(e=>e?.y),this._register(this._editorObs.createOverlayWidget({domNode:this._nonOverflowView.element,position:jt(null),allowEditorOverflow:!1,minContentWidthInPx:O(this,e=>{let t=this._editorLayoutInfo.read(e);return t===null?0:t.codeRect.width})}))}},YO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},XO=function(e,t){return function(n,r){t(n,r,e)}},ZO=class extends b{constructor(e,t,n,r,a){super(),this._editor=e,this._input=t,this._tabAction=n,this._languageService=a,this._onDidClick=this._register(new E),this.onDidClick=this._onDidClick.event,this._state=O(this,e=>{let t=this._input.read(e);if(!t)return;let n=this._editor.getModel(),r=n.getEOL();if(t.startColumn===1&&t.lineNumber>1&&n.getLineLength(t.lineNumber)!==0&&t.text.endsWith(r)&&!t.text.startsWith(r)){let e=n.getLineLength(t.lineNumber-1)+1;return{lineNumber:t.lineNumber-1,column:e,text:r+t.text.slice(0,-r.length)}}return{lineNumber:t.lineNumber,column:t.startColumn,text:t.text}}),this._trimVertically=O(this,e=>{let t=this._state.read(e),n=t?.text;if(!n||n.trim()===``)return{topOffset:0,bottomOffset:0,linesTop:0,linesBottom:0};let r=this._editor.getLineHeightForPosition(new x(t.lineNumber,1)),i=this._editor.getModel().getEOL(),a=0,o=0,s=0;for(;s<n.length&&n.startsWith(i,s);s+=i.length)a+=1;for(let e=n.length;e>s&&n.endsWith(i,e);e-=i.length)o+=1;return{topOffset:a*r,bottomOffset:o*r,linesTop:a,linesBottom:o}}),this._maxPrefixTrim=O(this,e=>{let t=this._state.read(e);if(!t)return{prefixLeftOffset:0,prefixTrim:0};let n=this._editor.getModel(),r=n.getEOL(),i=this._trimVertically.read(e),a=t.text.split(r),o=a.slice(i.linesTop,a.length-i.linesBottom);i.linesTop===0&&(o[0]=n.getLineContent(t.lineNumber)+o[0]);let s=new Ya(t.lineNumber,t.lineNumber+(i.linesTop>0?0:1));return mO([],s,o,this._editor)}),this._ghostText=O(e=>{let t=this._state.read(e),n=this._maxPrefixTrim.read(e);if(!t)return;let r=this._editor.getModel().getEOL(),i=t.text.split(r).map((e,t)=>new vc(new S(t+1,t===0?1:n.prefixTrim+1,t+1,e.length+1),`modified-background`,0));return new Tw(t.lineNumber,[new Ew(t.column,t.text,!1,i)])}),this._display=O(this,e=>this._state.read(e)?`block`:`none`),this._editorMaxContentWidthInRange=O(this,e=>{let t=this._state.read(e);if(!t)return 0;this._editorObs.versionId.read(e);let n=this._editor.getModel(),r=n.getEOL(),i=t.text.startsWith(r)?``:n.getValueInRange(new S(t.lineNumber,1,t.lineNumber,t.column)),a=n.getValueInRange(new S(t.lineNumber,t.column,t.lineNumber,n.getLineLength(t.lineNumber)+1)),o=(i+t.text+a).split(r),s=er.fromEditor(this._editor).withSetWidth(!1).withScrollBeyondLastColumn(0),c=o.map(e=>{let r=n.tokenization.tokenizeLinesAt(t.lineNumber,[e])?.[0],i;return i=r?Ul.fromLineTokens(r).toLineTokens(e,this._languageService.languageIdCodec):jo.createEmpty(e,this._languageService.languageIdCodec),Ye(new jn([i]),s,[],I(`div`),!0).minWidthInPx});return Math.max(...c)}),this.startLineOffset=this._trimVertically.map(e=>e.topOffset),this.originalLines=this._state.map(e=>e?new Ya(e.lineNumber,Math.min(e.lineNumber+2,this._editor.getModel().getLineCount()+1)):void 0),this._overlayLayout=O(this,e=>{this._ghostText.read(e);let t=this._state.read(e);if(!t)return null;this._editorObs.observePosition(Vl(this,new x(t.lineNumber,t.column)),e.store).read(e);let n=this._editorObs.layoutInfo.read(e),r=this._editorObs.scrollLeft.read(e),i=this._editorObs.layoutInfoVerticalScrollbarWidth.read(e),a=n.contentLeft+this._editorMaxContentWidthInRange.read(e)-r,o=this._maxPrefixTrim.read(e).prefixLeftOffset??0,s=n.contentLeft+o-r;if(a<=s)return null;let{topOffset:c,bottomOffset:l}=this._trimVertically.read(e),u=this._editorObs.scrollTop.read(e),d=this._ghostTextView.height.read(e)-c-l,f=this._editor.getTopForLineNumber(t.lineNumber)-u+c,p=f+d,m=new fD(s,f,a,p);return{overlay:m,startsAtContentLeft:o===0,contentLeft:n.contentLeft,minContentWidthRequired:o+m.width+i}}).recomputeInitiallyAndOnChange(this._store),this._modifiedOverlay=q.div({style:{pointerEvents:`none`}},O(this,e=>{let t=wO(this._overlayLayout).read(e);if(!t)return;let n=t.map(e=>fD.fromLeftTopRightBottom(e.contentLeft-4-1,e.overlay.top,e.contentLeft,e.overlay.bottom)).read(e),r=this._input.map(e=>e?.inDiffEditor?3:1).read(e),a=t.map(e=>e.overlay.withMargin(0,1,0,e.startsAtContentLeft?0:1).intersectHorizontal(new Pe(n.left,2**53-1))),o=a.map(e=>e.withMargin(r,r));return[q.div({class:`originalUnderlayInsertion`,style:{...o.read(e).toStyles(),borderRadius:4,border:`${1+r}px solid ${C(i)}`,boxSizing:`border-box`}}),q.div({class:`originalOverlayInsertion`,style:{...a.read(e).toStyles(),borderRadius:4,border:cO(this._tabAction).map(e=>`1px solid ${C(e)}`),boxSizing:`border-box`,backgroundColor:C(WD)}}),q.div({class:`originalOverlayHiderInsertion`,style:{...n.toStyles(),backgroundColor:C(i)}})]})).keepUpdated(this._store),this._view=q.div({class:`inline-edits-view`,style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`,display:this._display}},[[this._modifiedOverlay]]).keepUpdated(this._store),this._editorObs=f(this._editor),this._ghostTextView=this._register(r.createInstance($E,this._editor,{ghostText:this._ghostText,minReservedLineCount:jt(0),targetTextModel:this._editorObs.model.map(e=>e??void 0),warning:jt(void 0),handleInlineCompletionShown:jt(()=>{})},Vl(this,{syntaxHighlightingEnabled:!0,extraClasses:[`inline-edit`]}),!0,!0)),this.isHovered=this._ghostTextView.isHovered,this._register(this._ghostTextView.onDidClick(e=>{this._onDidClick.fire(e)})),this._register(this._editorObs.createOverlayWidget({domNode:this._view.element,position:jt(null),allowEditorOverflow:!1,minContentWidthInPx:O(this,e=>{let t=this._overlayLayout.read(e);return t===null?0:t.minContentWidthRequired})}))}};ZO=YO([XO(3,k),XO(4,ui)],ZO);var QO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$O=function(e,t){return function(n,r){t(n,r,e)}},ek=class extends b{constructor(e,t,n,r,a,o){super(),this._editor=e,this._edit=t,this._isInDiffEditor=n,this._tabAction=r,this._languageService=a,this._themeService=o,this._onDidClick=this._register(new E),this.onDidClick=this._onDidClick.event,this._maxPrefixTrim=this._edit.map(e=>e?mO(e.replacements.flatMap(e=>[e.originalRange,e.modifiedRange]),e.originalRange,e.modifiedLines,this._editor.editor):void 0),this._modifiedLineElements=O(this,e=>{let t=[],n=0,r=this._maxPrefixTrim.read(e),i=this._edit.read(e);if(!i||!r)return;let a=r.prefixTrim,o=tk(i.replacements.map(e=>e.modifiedRange)).map(e=>new S(e.startLineNumber,e.startColumn-a,e.endLineNumber,e.endColumn-a)),s=this._editor.model.get(),c=i.modifiedRange.startLineNumber;for(let r=0;r<i.modifiedRange.length;r++){let l=document.createElement(`div`),u=c+r,d=i.modifiedLines[r].slice(a),f=s.tokenization.tokenizeLinesAt(u,[d])?.[0],p;p=f?Ul.fromLineTokens(f).toLineTokens(d,this._languageService.languageIdCodec):jo.createEmpty(d,this._languageService.languageIdCodec);let m=[];for(let e of o.filter(e=>e.startLineNumber===u)){let t=Math.min(e.endColumn,d.length+1);m.push(new vc(new S(1,e.startColumn,1,t),`inlineCompletions-modified-bubble`,0))}let h=Ye(new jn([p]),er.fromEditor(this._editor.editor).withSetWidth(!1).withScrollBeyondLastColumn(0),m,l,!0);this._editor.getOption(59).read(e),n=Math.max(n,h.minWidthInPx),t.push(l)}return{lines:t,requiredWidth:n}}),this._layout=O(this,e=>{let t=this._modifiedLineElements.read(e),n=this._maxPrefixTrim.read(e),r=this._edit.read(e);if(!t||!n||!r)return;let{prefixLeftOffset:i}=n,{requiredWidth:a}=t,o=this._editor.observeLineHeightsForLineRange(r.originalRange).read(e),s=(()=>{let e=o.slice(0,r.modifiedRange.length);for(;e.length<r.modifiedRange.length;)e.push(o[o.length-1]);return e})(),c=this._editor.layoutInfoContentLeft.read(e),l=this._editor.layoutInfoVerticalScrollbarWidth.read(e),u=this._editor.scrollLeft.read(e),d=this._editor.scrollTop.read(e),f=c-u,p=this._editor.editor.getModel(),m=r.originalRange.mapToLineArray(e=>this._editor.editor.getOffsetForColumn(e,p.getLineMaxColumn(e))-i),h=Math.max(...m,a),g=r.originalRange.startLineNumber,_=r.originalRange.endLineNumberExclusive-1,ee=this._editor.editor.getTopForLineNumber(g)-d,v=this._editor.editor.getBottomForLineNumber(_)-d,te=fD.fromLeftTopWidthHeight(f+i,ee,h,v-ee),y=fD.fromLeftTopWidthHeight(te.left,te.bottom,te.width,s.reduce((e,t)=>e+t,0)),ne=fD.hull([te,y]),re=ne.intersectVertical(new Pe(te.bottom,2**53-1)),ie=new fD(re.left,re.top,re.right,re.bottom);return{originalLinesOverlay:te,modifiedLinesOverlay:y,background:ne,lowerBackground:re,lowerText:ie,modifiedLineHeights:s,minContentWidthRequired:i+h+l}}),this._viewZoneInfo=O(e=>{if(!this._editor.getOption(71).map(e=>e.edits.allowCodeShifting===`always`).read(e))return;let t=this._layout.read(e),n=this._edit.read(e);if(!t||!n)return;let r=t.lowerBackground.height,i=n.originalRange.endLineNumberExclusive;return{height:r,lineNumber:i}}),this.minEditorScrollHeight=O(this,e=>{let t=wO(this._layout).read(e);return!t||this._viewZoneInfo.read(e)!==void 0?0:t.read(e).lowerText.bottom+this._editor.editor.getScrollTop()}),this._div=q.div({class:`line-replacement`},[O(this,e=>{let t=wO(this._layout).read(e),n=this._modifiedLineElements.read(e);if(!t||!n)return[];let r=t.read(e),a=this._editor.layoutInfoContentLeft.read(e),o=this._isInDiffEditor.read(e)?3:1;n.lines.forEach((e,t)=>{e.style.width=`${r.lowerText.width}px`,e.style.height=`${r.modifiedLineHeights[t]}px`,e.style.position=`relative`});let s=cO(this._tabAction).read(e),c=lO(this._tabAction).read(e);return[q.div({style:{position:`absolute`,...TO(e=>gO(this._editor).read(e)),overflow:`hidden`,pointerEvents:`none`}},[q.div({class:`borderAroundLineReplacement`,style:{position:`absolute`,...TO(e=>t.read(e).background.translateX(-a).withMargin(o)),borderRadius:`4px`,border:`${o+1}px solid ${C(i)}`,boxSizing:`border-box`,pointerEvents:`none`}}),q.div({class:`originalOverlayLineReplacement`,style:{position:`absolute`,...TO(e=>t.read(e).background.translateX(-a)),borderRadius:`4px`,border:uO(c,this._themeService).map(e=>`1px solid ${e.toString()}`),pointerEvents:`none`,boxSizing:`border-box`,background:C(UD)}}),q.div({class:`modifiedOverlayLineReplacement`,style:{position:`absolute`,...TO(e=>t.read(e).lowerBackground.translateX(-a)),borderRadius:`0 0 4px 4px`,background:C(i),boxShadow:`${C(Us)} 0 6px 6px -6px`,border:`1px solid ${C(s)}`,boxSizing:`border-box`,overflow:`hidden`,cursor:`pointer`,pointerEvents:`auto`},onmousedown:e=>{e.preventDefault()},onclick:e=>this._onDidClick.fire(new _(su(e),e))},[q.div({style:{position:`absolute`,top:0,left:0,width:`100%`,height:`100%`,background:C(KD)}})]),q.div({class:`modifiedLinesLineReplacement`,style:{position:`absolute`,boxSizing:`border-box`,...TO(e=>t.read(e).lowerText.translateX(-a)),fontFamily:this._editor.getOption(58),fontSize:this._editor.getOption(61),fontWeight:this._editor.getOption(62),pointerEvents:`none`,whiteSpace:`nowrap`,borderRadius:`0 0 4px 4px`,overflow:`hidden`}},[...n.lines])])]})]).keepUpdated(this._store),this.isHovered=this._editor.isTargetHovered(e=>this._isMouseOverWidget(e),this._store),this._previousViewZoneInfo=void 0,this._register(pl(()=>this._editor.editor.changeViewZones(e=>this.removePreviousViewZone(e)))),this._register(pr(this._viewZoneInfo,({lastValue:e,newValue:t})=>{e===t||e?.height===t?.height&&e?.lineNumber===t?.lineNumber||this._editor.editor.changeViewZones(e=>{this.removePreviousViewZone(e),t&&this.addViewZone(t,e)})})),this._register(this._editor.createOverlayWidget({domNode:this._div.element,minContentWidthInPx:O(this,e=>this._layout.read(e)?.minContentWidthRequired??0),position:jt({preference:{top:0,left:0}}),allowEditorOverflow:!1}))}_isMouseOverWidget(e){let t=this._layout.get();return!t||!(e.event instanceof Ks)?!1:t.lowerBackground.containsPoint(new As(e.event.relativePos.x,e.event.relativePos.y))}removePreviousViewZone(e){if(!this._previousViewZoneInfo)return;e.removeZone(this._previousViewZoneInfo.id);let t=this._editor.cursorLineNumber.get();t!==null&&t>=this._previousViewZoneInfo.lineNumber&&this._editor.editor.setScrollTop(this._editor.scrollTop.get()-this._previousViewZoneInfo.height),this._previousViewZoneInfo=void 0}addViewZone(e,t){let n=t.addZone({afterLineNumber:e.lineNumber-1,heightInPx:e.height,domNode:I(`div`)});this._previousViewZoneInfo={height:e.height,lineNumber:e.lineNumber,id:n};let r=this._editor.cursorLineNumber.get();r!==null&&r>=e.lineNumber&&this._editor.editor.setScrollTop(this._editor.scrollTop.get()+e.height)}};ek=QO([$O(4,ui),$O(5,rn)],ek);function tk(e){let t=[];for(;e.length;){let n=e.shift();n.startLineNumber!==n.endLineNumber&&(e.push(new S(n.startLineNumber+1,1,n.endLineNumber,n.endColumn)),n=new S(n.startLineNumber,n.startColumn,n.startLineNumber,2**53-1)),t.push(n)}return t}var nk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rk=function(e,t){return function(n,r){t(n,r,e)}},ik=class extends b{static fitsInsideViewport(e,t,n,r){let i=f(e),a=i.layoutInfoWidth.read(r),o=i.layoutInfoContentLeft.read(r),s=e.getLayoutInfo().verticalScrollbarWidth,c=i.layoutInfoMinimap.read(r).minimapLeft===0?0:i.layoutInfoMinimap.read(r).minimapWidth,l=fO(i,n.displayRange,void 0),u=n.lineEdit.newLines.reduce((n,r)=>Math.max(n,hO(r,e,t)),0);return l+u+20+14<a-o-s-c}constructor(e,t,n,r,a,o,s){super(),this._editor=e,this._edit=t,this._previewTextModel=n,this._uiState=r,this._tabAction=a,this._instantiationService=o,this._themeService=s,this._editorObs=f(this._editor),this._onDidClick=this._register(new E),this.onDidClick=this._onDidClick.event,this._display=O(this,e=>this._uiState.read(e)?`block`:`none`),this.previewRef=q.ref();let c=this._uiState.map(e=>e?.isInDiffEditor?3:1);this._editorContainer=q.div({class:[`editorContainer`],style:{position:`absolute`,overflow:`hidden`,cursor:`pointer`},onmousedown:e=>{e.preventDefault()},onclick:e=>{this._onDidClick.fire(new _(su(e),e))}},[q.div({class:`preview`,style:{pointerEvents:`none`},ref:this.previewRef})]).keepUpdated(this._store),this.isHovered=this._editorContainer.didMouseMoveDuringHover,this.previewEditor=this._register(this._instantiationService.createInstance(t_,this.previewRef.element,{glyphMargin:!1,lineNumbers:`off`,minimap:{enabled:!1},guides:{indentation:!1,bracketPairs:!1,bracketPairsHorizontal:!1,highlightActiveIndentation:!1},rulers:[],padding:{top:0,bottom:0},folding:!1,selectOnLineNumbers:!1,selectionHighlight:!1,columnSelection:!1,overviewRulerBorder:!1,overviewRulerLanes:0,lineDecorationsWidth:0,lineNumbersMinChars:0,revealHorizontalRightPadding:0,bracketPairColorization:{enabled:!0,independentColorPoolPerBracketType:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:`hidden`,horizontal:`hidden`,handleMouseWheel:!1},readOnly:!0,wordWrap:`off`,wordWrapOverride1:`off`,wordWrapOverride2:`off`},{contextKeyValues:{[MC.inInlineEditsPreviewEditor.key]:!0},contributions:[]},this._editor)),this._previewEditorObs=f(this.previewEditor),this._activeViewZones=[],this._updatePreviewEditor=O(this,e=>{this._editorContainer.readEffect(e),this._previewEditorObs.model.read(e),this._display.read(e),this._nonOverflowView&&(this._nonOverflowView.element.style.display=this._display.read(e));let t=this._uiState.read(e),n=this._edit.read(e);if(!t||!n)return;let r=n.originalLineRange,i=[];r.startLineNumber>1&&i.push(new S(1,1,r.startLineNumber-1,1)),r.startLineNumber+t.newTextLineCount<this._previewTextModel.getLineCount()+1&&i.push(new S(r.startLineNumber+t.newTextLineCount,1,this._previewTextModel.getLineCount()+1,1)),this.previewEditor.setHiddenAreas(i,void 0,!0);let a=[...this._activeViewZones];this._activeViewZones=[];let o=r.endLineNumberExclusive-r.startLineNumber-t.newTextLineCount;this.previewEditor.changeViewZones(e=>{a.forEach(t=>e.removeZone(t)),o>0&&this._activeViewZones.push(e.addZone({afterLineNumber:r.startLineNumber+t.newTextLineCount-1,heightInLines:o,showInHiddenAreas:!0,domNode:I(`div.diagonal-fill.inline-edits-view-zone`)}))})}),this._previewEditorWidth=O(this,e=>{let t=this._edit.read(e);return t?(this._updatePreviewEditor.read(e),fO(this._previewEditorObs,t.modifiedLineRange,e)):0}),this._cursorPosIfTouchesEdit=O(this,e=>{let t=this._editorObs.cursorPosition.read(e),n=this._edit.read(e);if(!(!n||!t))return n.modifiedLineRange.contains(t.lineNumber)?t:void 0}),this._originalStartPosition=O(this,e=>{let t=this._edit.read(e);return t?new x(t.originalLineRange.startLineNumber,1):null}),this._originalEndPosition=O(this,e=>{let t=this._edit.read(e);return t?new x(t.originalLineRange.endLineNumberExclusive,1):null}),this._originalVerticalStartPosition=this._editorObs.observePosition(this._originalStartPosition,this._store).map(e=>e?.y),this._originalVerticalEndPosition=this._editorObs.observePosition(this._originalEndPosition,this._store).map(e=>e?.y),this._originalDisplayRange=this._edit.map(e=>e?.displayRange),this._editorMaxContentWidthInRange=O(this,e=>{let t=this._originalDisplayRange.read(e);return t?(this._editorObs.versionId.read(e),Zu(this,(e,n)=>{let r=fO(this._editorObs,t,e);return Math.max(r,n??0)})):jt(0)}).map((e,t)=>e.read(t)),this._previewEditorLayoutInfo=O(this,e=>{let t=this._edit.read(e);if(!t||!this._uiState.read(e))return null;let n=t.originalLineRange,r=this._editorObs.scrollLeft.read(e),i=this._editorMaxContentWidthInRange.read(e),a=this._editorObs.layoutInfo.read(e),o=this._previewEditorWidth.read(e),s=a.contentWidth-a.verticalScrollbarWidth,c=this._editor.getContainerDomNode().getBoundingClientRect(),l=a.contentLeft+a.contentWidth+c.left,u=su(this._editor.getContainerDomNode()).innerWidth-l,d=su(this._editor.getContainerDomNode()).innerWidth-c.right,f=Math.min(a.contentWidth*.3,o,100),p=0+u,m=this._cursorPosIfTouchesEdit.read(e),h=Math.max(s+r-0-Math.max(0,f-p),Math.min(m?pO(this._editorObs,m,e)+50:0,s+r)),g=Math.min(i+20,h),_=i+20+o+70,ee=h-g,v,te;g>r?(v=0,te=a.contentLeft+g-r):(v=r-g,te=a.contentLeft);let y=this._originalVerticalStartPosition.read(e)??this._editor.getTopForLineNumber(n.startLineNumber)-this._editorObs.scrollTop.read(e),ne=this._originalVerticalEndPosition.read(e)??this._editor.getBottomForLineNumber(n.endLineNumberExclusive-1)-this._editorObs.scrollTop.read(e),re=a.contentLeft-r,ie=fD.fromLeftTopRightBottom(re,y,te,ne),ae=ie.height===0;ae||(ie=ie.withMargin(0,0));let oe=this._previewEditorObs.observeLineHeightsForLineRange(t.modifiedLineRange).read(e).reduce((e,t)=>e+t,0),se=ne-y,ce=Math.max(se,oe),le=ee===0,ue=Math.min(o+12,d+a.width-a.contentLeft-0),de=fD.fromLeftTopWidthHeight(ie.right+0,y,ue,ce);return de=ae?de.withMargin(0,0).translateY(0):de.withMargin(0,0).translateX(1),{codeRect:ie,editRect:de,codeScrollLeft:r,contentLeft:a.contentLeft,isInsertion:ae,maxContentWidth:_,shouldShowShadow:le,desiredPreviewEditorScrollLeft:v,previewEditorWidth:ue}}),this._stickyScrollController=HD.get(this._editorObs.editor),this._stickyScrollHeight=this._stickyScrollController?ai(this._stickyScrollController.onDidChangeStickyScrollHeight,()=>this._stickyScrollController.stickyScrollWidgetHeight):jt(0),this._shouldOverflow=O(this,e=>!1),this._originalBackgroundColor=ai(this,this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme().getColor(UD)??z.transparent),this._backgroundSvg=q.svg({transform:`translate(-0.5 -0.5)`,style:{overflow:`visible`,pointerEvents:`none`,position:`absolute`}},[q.svgElem(`path`,{class:`rightOfModifiedBackgroundCoverUp`,d:O(this,e=>{let t=this._previewEditorLayoutInfo.read(e);if(t&&!this._originalBackgroundColor.read(e).isTransparent())return new CO().moveTo(t.codeRect.getRightTop()).lineTo(t.codeRect.getRightTop().deltaX(1e3)).lineTo(t.codeRect.getRightBottom().deltaX(1e3)).lineTo(t.codeRect.getRightBottom()).build()}),style:{fill:At(i,`transparent`)}})]).keepUpdated(this._store),this._originalOverlay=q.div({style:{pointerEvents:`none`,display:this._previewEditorLayoutInfo.map(e=>e?.isInsertion?`none`:`block`)}},O(this,e=>{let t=wO(this._previewEditorLayoutInfo).read(e);if(!t)return;let n=c.read(e),r=lO(this._tabAction).map(e=>`1px solid ${C(e)}`),a=`${1+n}px solid ${C(i)}`,o=t.read(e).codeScrollLeft!==0,s=t.map(e=>e.codeRect.bottom<e.editRect.bottom),l=t.map(e=>fD.fromLeftTopRightBottom(e.contentLeft-4-1,e.codeRect.top,e.contentLeft,e.codeRect.bottom+10)).read(e),u=new Pe(l.left,2**53-1),d=t.map(e=>e.codeRect.intersectHorizontal(u)),f=d.map(e=>e.withMargin(n,0,n,n).intersectHorizontal(u)),p=d.map(e=>fD.fromLeftTopWidthHeight(e.right-10+1,e.bottom-1,10,10).intersectHorizontal(u));return[q.div({class:`originalSeparatorSideBySide`,style:{...f.read(e).toStyles(),boxSizing:`border-box`,borderRadius:`4px 0 0 4px`,borderTop:a,borderBottom:a,borderLeft:o?`none`:a}}),q.div({class:`originalOverlaySideBySide`,style:{...d.read(e).toStyles(),boxSizing:`border-box`,borderRadius:`4px 0 0 4px`,borderTop:r,borderBottom:r,borderLeft:o?`none`:r,backgroundColor:C(UD)}}),q.div({class:`originalCornerCutoutSideBySide`,style:{pointerEvents:`none`,display:s.map(e=>e?`block`:`none`),...p.read(e).toStyles()}},[q.div({class:`originalCornerCutoutBackground`,style:{position:`absolute`,top:`0px`,left:`0px`,width:`100%`,height:`100%`,backgroundColor:uO(UD,this._themeService).map(e=>e.toString())}}),q.div({class:`originalCornerCutoutBorder`,style:{position:`absolute`,top:`0px`,left:`0px`,width:`100%`,height:`100%`,boxSizing:`border-box`,borderTop:r,borderRight:r,borderRadius:`0 100% 0 0`,backgroundColor:C(i)}})]),q.div({class:`originalOverlaySideBySideHider`,style:{...l.toStyles(),backgroundColor:C(i)}})]})).keepUpdated(this._store),this._modifiedOverlay=q.div({style:{pointerEvents:`none`}},O(this,e=>{let t=wO(this._previewEditorLayoutInfo).read(e);if(!t)return;let n=t.map(e=>e.codeRect.bottom<e.editRect.bottom),r=c.read(e),a=n.map(e=>`0 4px 4px ${e?4:0}px`),o=uO(cO(this._tabAction),this._themeService).map(e=>`1px solid ${e.toString()}`),s=`${1+r}px solid ${C(i)}`,l=t.map(e=>e.editRect.withMargin(0,1)),u=l.map(e=>e.withMargin(r,r,r,0)),d=O(this,e=>{let n=l.read(e),r=t.read(e);return!r.isInsertion||r.contentLeft>=n.left?fD.fromLeftTopWidthHeight(n.left,n.top,0,0):new fD(r.contentLeft,n.top,n.left,n.top+2)});return[q.div({class:`modifiedInsertionSideBySide`,style:{...d.read(e).toStyles(),backgroundColor:cO(this._tabAction).map(e=>C(e))}}),q.div({class:`modifiedSeparatorSideBySide`,style:{...u.read(e).toStyles(),borderRadius:a,borderTop:s,borderBottom:s,borderRight:s,boxSizing:`border-box`}}),q.div({class:`modifiedOverlaySideBySide`,style:{...l.read(e).toStyles(),borderRadius:a,border:o,boxSizing:`border-box`,backgroundColor:C(WD)}})]})).keepUpdated(this._store),this._nonOverflowView=q.div({class:`inline-edits-view`,style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`,display:this._display}},[this._backgroundSvg,O(this,e=>this._shouldOverflow.read(e)?[]:[this._editorContainer,this._originalOverlay,this._modifiedOverlay])]).keepUpdated(this._store),this._register(this._editorObs.createOverlayWidget({domNode:this._nonOverflowView.element,position:jt(null),allowEditorOverflow:!1,minContentWidthInPx:O(this,e=>{let t=this._previewEditorLayoutInfo.read(e)?.maxContentWidth;return t===void 0?0:t})})),this.previewEditor.setModel(this._previewTextModel),this._register(la(e=>{let t=this._previewEditorLayoutInfo.read(e);if(!t)return;let n=t.editRect.withMargin(-0,-0);this.previewEditor.layout({height:n.height,width:t.previewEditorWidth+15}),this._editorContainer.element.style.top=`${n.top}px`,this._editorContainer.element.style.left=`${n.left}px`,this._editorContainer.element.style.width=`${t.previewEditorWidth+0}px`})),this._register(la(e=>{let t=this._previewEditorLayoutInfo.read(e);t&&this._previewEditorObs.editor.setScrollLeft(t.desiredPreviewEditorScrollLeft)})),this._updatePreviewEditor.recomputeInitiallyAndOnChange(this._store)}};ik=nk([rk(5,k),rk(6,rn)],ik);var ak=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ok=function(e,t){return function(n,r){t(n,r,e)}},sk=class extends b{static{this.MAX_LENGTH=100}constructor(e,t,n,r){super(),this._editor=e,this._edit=t,this._tabAction=n,this._languageService=r,this._onDidClick=this._register(new E),this.onDidClick=this._onDidClick.event,this._start=this._editor.observePosition(jt(this._edit.range.getStartPosition()),this._store),this._end=this._editor.observePosition(jt(this._edit.range.getEndPosition()),this._store),this._line=document.createElement(`div`),this._hoverableElement=Vl(this,null),this.isHovered=this._hoverableElement.map((e,t)=>e?.didMouseMoveDuringHover.read(t)??!1),this._renderTextEffect=O(this,e=>{let t=this._editor.model.get(),n=t.getLineContent(this._edit.range.startLineNumber),r=Rs.replace(new Pe(this._edit.range.startColumn-1,this._edit.range.endColumn-1),this._edit.text),i=r.replace(n),a=t.tokenization.tokenizeLinesAt(this._edit.range.startLineNumber,[i])?.[0],o;o=a?Ul.fromLineTokens(a).slice(r.getRangeAfterReplace()).toLineTokens(this._edit.text,this._languageService.languageIdCodec):jo.createEmpty(this._edit.text,this._languageService.languageIdCodec);let s=Ye(new jn([o]),er.fromEditor(this._editor.editor).withSetWidth(!1).withScrollBeyondLastColumn(0),[],this._line,!0);this._line.style.width=`${s.minWidthInPx}px`});let a=this._editor.observeLineHeightForPosition(this._edit.range.getStartPosition());this._layout=O(this,e=>{this._renderTextEffect.read(e);let t=this._start.read(e),n=this._end.read(e);if(!t||!n||t.x>n.x||t.y>n.y)return;let r=a.read(e),i=this._editor.scrollLeft.read(e),o=this._editor.getOption(59).read(e).typicalHalfwidthCharacterWidth,s=3*o,c=new As(s,4),l=fD.fromPoints(t,n).withHeight(r).translateX(-i),u=fD.fromPointSize(l.getLeftBottom().add(c),new As(this._edit.text.length*o,l.height)),d=u.withLeft(l.left);return{originalLine:l,modifiedLine:u,lowerBackground:d,lineHeight:r}}),this.minEditorScrollHeight=O(this,e=>{let t=wO(this._layout).read(e);return t?t.read(e).modifiedLine.bottom+1+this._editor.editor.getScrollTop():0}),this._root=q.div({class:`word-replacement`},[O(this,e=>{let t=wO(this._layout).read(e);if(!t)return[];let n=lO(this._tabAction).map(e=>C(e)).read(e),r=cO(this._tabAction).map(e=>C(e)).read(e);return[q.div({style:{position:`absolute`,...TO(e=>gO(this._editor).read(e)),overflow:`hidden`,pointerEvents:`none`}},[q.div({style:{position:`absolute`,...TO(e=>t.read(e).lowerBackground.withMargin(1,2,1,0)),background:C(i),cursor:`pointer`,pointerEvents:`auto`},onmousedown:e=>{e.preventDefault()},onmouseup:e=>this._onDidClick.fire(new _(su(e),e)),obsRef:e=>{this._hoverableElement.set(e,void 0)}}),q.div({style:{position:`absolute`,...TO(e=>t.read(e).modifiedLine.withMargin(1,2)),fontFamily:this._editor.getOption(58),fontSize:this._editor.getOption(61),fontWeight:this._editor.getOption(62),pointerEvents:`none`,boxSizing:`border-box`,borderRadius:`4px`,border:`1px solid ${r}`,background:C(qD),display:`flex`,justifyContent:`center`,alignItems:`center`,outline:`2px solid ${C(i)}`}},[this._line]),q.div({style:{position:`absolute`,...TO(e=>t.read(e).originalLine.withMargin(1)),boxSizing:`border-box`,borderRadius:`4px`,border:`1px solid ${n}`,background:C(GD),pointerEvents:`none`}},[]),q.svg({width:11,height:14,viewBox:`0 0 11 14`,fill:`none`,style:{position:`absolute`,left:t.map(e=>e.modifiedLine.left-16),top:t.map(e=>e.modifiedLine.top+Math.round((e.lineHeight-14-5)/2))}},[q.svgElem(`path`,{d:`M1 0C1 2.98966 1 5.92087 1 8.49952C1 9.60409 1.89543 10.5 3 10.5H10.5`,stroke:C(Jl)}),q.svgElem(`path`,{d:`M6 7.5L9.99999 10.49998L6 13.5`,stroke:C(Jl)})])])]})]).keepUpdated(this._store),this._register(this._editor.createOverlayWidget({domNode:this._root.element,minContentWidthInPx:jt(0),position:jt({preference:{top:0,left:0}}),allowEditorOverflow:!1}))}};sk=ak([ok(3,ui)],sk);var ck=class extends b{constructor(e,t,r){super(),this._originalEditor=e,this._state=t,this._modifiedTextModel=r,this._onDidClick=this._register(new E),this.onDidClick=this._onDidClick.event,this.isHovered=f(this._originalEditor).isTargetHovered(e=>e.target.type===6&&e.target.detail.injectedText?.options.attachedData instanceof lk&&e.target.detail.injectedText.options.attachedData.owner===this,this._store),this._tokenizationFinished=fk(this._modifiedTextModel),this._decorations=O(this,e=>{let t=this._state.read(e);if(!t)return;let n=t.modifiedText,r=t.mode===`insertionInline`,i=t.diff.length===1&&t.diff[0].innerChanges?.length===1,a=[],o=[],s=R.register({className:`inlineCompletions-line-insert`,description:`line-insert`,isWholeLine:!0,marginClassName:`gutter-insert`}),c=R.register({className:`inlineCompletions-line-delete`,description:`line-delete`,isWholeLine:!0,marginClassName:`gutter-delete`}),l=R.register({className:`inlineCompletions-char-delete`,description:`char-delete`,isWholeLine:!1,zIndex:1}),u=R.register({className:`inlineCompletions-char-insert`,description:`char-insert`,isWholeLine:!0}),d=R.register({className:`inlineCompletions-char-insert`,description:`char-insert`,shouldFillLineOnLineBreak:!0}),f=R.register({className:`inlineCompletions-char-insert diff-range-empty`,description:`char-insert diff-range-empty`}),p=R.register({className:`inlineCompletions-original-lines`,description:`inlineCompletions-original-lines`,isWholeLine:!1,shouldFillLineOnLineBreak:!0}),m=t.mode!==`sideBySide`&&t.mode!==`deletion`&&t.mode!==`insertionInline`&&t.mode!==`lineReplacement`,h=t.mode===`lineReplacement`;for(let p of t.diff)if(m&&(p.original.isEmpty||a.push({range:p.original.toInclusiveRange(),options:c}),p.modified.isEmpty||o.push({range:p.modified.toInclusiveRange(),options:s})),p.modified.isEmpty||p.original.isEmpty)p.original.isEmpty||a.push({range:p.original.toInclusiveRange(),options:l}),p.modified.isEmpty||o.push({range:p.modified.toInclusiveRange(),options:u});else{let s=r&&uk(p);for(let r of p.innerChanges||[]){if(p.original.contains(r.originalRange.startLineNumber)&&!(h&&r.originalRange.isEmpty())){let e=this._originalEditor.getModel()?.getValueInRange(r.originalRange,1);a.push({range:r.originalRange,options:{description:`char-delete`,shouldFillLineOnLineBreak:!1,className:vO(`inlineCompletions-char-delete`,r.originalRange.isSingleLine()&&t.mode===`insertionInline`&&`single-line-inline`,r.originalRange.isEmpty()&&`empty`,(r.originalRange.isEmpty()&&i||t.mode===`deletion`&&e===`
`)&&!s&&`diff-range-empty`),inlineClassName:s?vO(`strike-through`,`inlineCompletions`):null,zIndex:1}})}if(p.modified.contains(r.modifiedRange.startLineNumber)&&o.push({range:r.modifiedRange,options:r.modifiedRange.isEmpty()&&!s&&i?f:d}),s){let i=n.getValueOfRange(r.modifiedRange),o=i.length>3?[{text:i.slice(0,1),extraClasses:[`start`],offsetRange:new Pe(r.modifiedRange.startColumn-1,r.modifiedRange.startColumn)},{text:i.slice(1,-1),extraClasses:[],offsetRange:new Pe(r.modifiedRange.startColumn,r.modifiedRange.endColumn-2)},{text:i.slice(-1),extraClasses:[`end`],offsetRange:new Pe(r.modifiedRange.endColumn-2,r.modifiedRange.endColumn-1)}]:[{text:i,extraClasses:[`start`,`end`],offsetRange:new Pe(r.modifiedRange.startColumn-1,r.modifiedRange.endColumn)}];this._tokenizationFinished.read(e);let s=this._modifiedTextModel.tokenization.getLineTokens(r.modifiedRange.startLineNumber);for(let{text:e,extraClasses:n,offsetRange:i}of o)a.push({range:S.fromPositions(r.originalRange.getEndPosition()),options:{description:`inserted-text`,before:{tokens:s.getTokensInRange(i),content:e,inlineClassName:vO(`inlineCompletions-char-insert`,r.modifiedRange.isSingleLine()&&t.mode===`insertionInline`&&`single-line-inline`,...n),cursorStops:Ls.None,attachedData:new lk(this)},zIndex:2,showIfCollapsed:!0}})}}}if(t.isInDiffEditor)for(let e of t.diff)e.original.isEmpty||a.push({range:e.original.toExclusiveRange(),options:p});return{originalDecorations:a,modifiedDecorations:o}}),this._register(f(this._originalEditor).setDecorations(this._decorations.map(e=>e?.originalDecorations??[])));let i=this._state.map(e=>e?.modifiedCodeEditor);this._register(n((e,t)=>{let n=i.read(e);n&&t.add(f(n).setDecorations(this._decorations.map(e=>e?.modifiedDecorations??[])))})),this._register(this._originalEditor.onMouseUp(e=>{if(e.target.type!==6)return;let t=e.target.detail.injectedText?.options.attachedData;t instanceof lk&&t.owner===this&&this._onDidClick.fire(e.event)}))}},lk=class{constructor(e){this.owner=e}};function uk(e){return e.innerChanges?e.innerChanges.every(e=>yn(e.modifiedRange)&&yn(e.originalRange)):!1}var dk=0;function fk(e){return ai(e.onDidChangeTokens,()=>dk++)}var pk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},mk=function(e,t){return function(n,r){t(n,r,e)}},hk=class extends b{constructor(e,t,r,i,a,o){super(),this._editor=e,this._host=t,this._model=r,this._ghostTextIndicator=i,this._focusIsInMenu=a,this._instantiationService=o,this._editorObs=f(this._editor),this._tabAction=O(e=>this._model.read(e)?.tabAction.read(e)??tT.Inactive),this._constructorDone=Vl(this,!1),this._uiState=O(this,e=>{let t=this._model.read(e);if(!t||!this._constructorDone.read(e))return;let n=t.inlineEdit,r=Zc.fromEdit(n.edit),i=n.edit.apply(n.originalText),a=_c(r,n.originalText,new Ta(i)),o=this.determineRenderState(t,e,a,new Ta(i));if(!o){t.abort(`unable to determine view: tried to render ${this._previousView?.view}`);return}if(o.kind===nT.SideBySide){let e=SO(i,n.modifiedLineRange,c.getOptions().tabSize);i=e.applyToString(i),r=_O(r,e),a=_c(r,n.originalText,new Ta(i))}return this._previewTextModel.setLanguage(this._editor.getModel().getLanguageId()),this._previewTextModel.getValue()!==i&&this._previewTextModel.setValue(i),t.showCollapsed.read(e)&&!this._indicator.read(e)?.isHoverVisible.read(e)&&(o={kind:nT.Collapsed,viewData:o.viewData}),t.handleInlineEditShown(o.kind,o.viewData),{state:o,diff:a,edit:n,newText:i,newTextLineCount:n.modifiedLineRange.length,isInDiffEditor:t.isInDiffEditor}}),this._previewTextModel=this._register(this._instantiationService.createInstance(Ea,``,this._editor.getModel().getLanguageId(),{...Ea.DEFAULT_CREATION_OPTIONS,bracketPairColorizationOptions:{enabled:!0,independentColorPoolPerBracketType:!1}},null)),this._indicatorCyclicDependencyCircuitBreaker=Vl(this,!1),this._indicator=O(this,e=>{if(!this._indicatorCyclicDependencyCircuitBreaker.read(e))return;let t=Zi({owner:this,equalsFn:Rc(Al())},e=>{let t=this._ghostTextIndicator.read(e);if(t)return t.lineRange;let n=this._uiState.read(e);if(n){if(n.state?.kind===`custom`){let e=n.state.displayLocation?.range;if(!e)throw new h(`custom view should have a range`);return new Ya(e.startLineNumber,e.endLineNumber)}return n.state?.kind===`insertionMultiLine`?this._insertion.originalLines.read(e):n.edit.displayRange}}),n=O(this,e=>{let t=this._model.read(e);if(t)return t;let n=this._ghostTextIndicator.read(e);return n?n.model:t});return e.store.add(this._instantiationService.createInstance(IO,this._editorObs,t,this._gutterIndicatorOffset,n,this._inlineEditsIsHovered,this._focusIsInMenu))}),this._inlineEditsIsHovered=O(this,e=>this._sideBySide.isHovered.read(e)||this._wordReplacementViews.read(e).some(t=>t.isHovered.read(e))||this._deletion.isHovered.read(e)||this._inlineDiffView.isHovered.read(e)||this._lineReplacementView.isHovered.read(e)||this._insertion.isHovered.read(e)||this._customView.isHovered.read(e)),this._gutterIndicatorOffset=O(this,e=>{if(this._uiState.read(e)?.state?.kind===`insertionMultiLine`)return this._insertion.startLineOffset.read(e);let t=this._ghostTextIndicator.read(e);return t?Ck(t,this._editor):0}),this._sideBySide=this._register(this._instantiationService.createInstance(ik,this._editor,this._model.map(e=>e?.inlineEdit),this._previewTextModel,this._uiState.map(e=>e&&e.state?.kind===nT.SideBySide?{newTextLineCount:e.newTextLineCount,isInDiffEditor:e.isInDiffEditor}:void 0),this._tabAction)),this._deletion=this._register(this._instantiationService.createInstance(JO,this._editor,this._model.map(e=>e?.inlineEdit),this._uiState.map(e=>e&&e.state?.kind===nT.Deletion?{originalRange:e.state.originalRange,deletions:e.state.deletions,inDiffEditor:e.isInDiffEditor}:void 0),this._tabAction)),this._insertion=this._register(this._instantiationService.createInstance(ZO,this._editor,this._uiState.map(e=>e&&e.state?.kind===nT.InsertionMultiLine?{lineNumber:e.state.lineNumber,startColumn:e.state.column,text:e.state.text,inDiffEditor:e.isInDiffEditor}:void 0),this._tabAction)),this._inlineDiffViewState=O(this,e=>{let t=this._uiState.read(e);if(!(!t||!t.state)&&!(t.state.kind===`wordReplacements`||t.state.kind===`insertionMultiLine`||t.state.kind===`collapsed`||t.state.kind===`custom`))return{modifiedText:new Ta(t.newText),diff:t.diff,mode:t.state.kind,modifiedCodeEditor:this._sideBySide.previewEditor,isInDiffEditor:t.isInDiffEditor}}),this._inlineCollapsedView=this._register(this._instantiationService.createInstance(WO,this._editor,this._model.map((e,t)=>this._uiState.read(t)?.state?.kind===`collapsed`?e?.inlineEdit:void 0))),this._customView=this._register(this._instantiationService.createInstance(qO,this._editor,this._model.map((e,t)=>this._uiState.read(t)?.state?.kind===`custom`?e?.displayLocation:void 0),this._tabAction)),this._inlineDiffView=this._register(new ck(this._editor,this._inlineDiffViewState,this._previewTextModel)),this._wordReplacementViews=oe(this,this._uiState.map(e=>e?.state?.kind===`wordReplacements`?e.state.replacements:[]),(e,t)=>t.add(this._instantiationService.createInstance(sk,this._editorObs,e,this._tabAction))),this._lineReplacementView=this._register(this._instantiationService.createInstance(ek,this._editorObs,this._uiState.map(e=>e?.state?.kind===nT.LineReplacement?{originalRange:e.state.originalRange,modifiedRange:e.state.modifiedRange,modifiedLines:e.state.modifiedLines,replacements:e.state.replacements}:void 0),this._uiState.map(e=>e?.isInDiffEditor??!1),this._tabAction)),this._useCodeShifting=this._editorObs.getOption(71).map(e=>e.edits.allowCodeShifting),this._renderSideBySide=this._editorObs.getOption(71).map(e=>e.edits.renderSideBySide),this._register(n((e,t)=>{let n=this._model.read(e);n&&t.add(vn.any(this._sideBySide.onDidClick,this._deletion.onDidClick,this._lineReplacementView.onDidClick,this._insertion.onDidClick,...this._wordReplacementViews.read(e).map(e=>e.onDidClick),this._inlineDiffView.onDidClick,this._customView.onDidClick)(e=>{this._viewHasBeenShownLongerThan(350)&&(e.preventDefault(),n.accept())}))})),this._indicator.recomputeInitiallyAndOnChange(this._store),this._wordReplacementViews.recomputeInitiallyAndOnChange(this._store),this._indicatorCyclicDependencyCircuitBreaker.set(!0,void 0),this._register(this._instantiationService.createInstance(VO,this._host,this._model,this._indicator,this._inlineCollapsedView));let s=O(this,e=>Math.max(...this._wordReplacementViews.read(e).map(t=>t.minEditorScrollHeight.read(e)),this._lineReplacementView.minEditorScrollHeight.read(e),this._customView.minEditorScrollHeight.read(e))).recomputeInitiallyAndOnChange(this._store),c=this._editor.getModel(),l;this._register(la(e=>{let t=s.read(e);this._editor.changeViewZones(e=>{let n=this._editor.getScrollHeight(),r=t-n+1;r!==0&&l&&(e.removeZone(l),l=void 0),!(r<=0)&&(l=e.addZone({afterLineNumber:c.getLineCount(),heightInPx:r,domNode:I(`div.minScrollHeightViewZone`)}))})})),this._constructorDone.set(!0,void 0)}getCacheId(e){return e.inlineEdit.inlineCompletion.identity.id}determineView(e,t,n,r){let i=e.inlineEdit,a=this._previousView?.id===this.getCacheId(e),o=this._previousView?.editorWidth!==this._editorObs.layoutInfoWidth.read(t)&&(this._previousView?.view===nT.SideBySide||this._previousView?.view===nT.LineReplacement);if(a&&!o)return this._previousView.view;if(e.displayLocation)return nT.Custom;let s=i.originalLineRange.length,c=i.modifiedLineRange.length,l=n.flatMap(e=>e.innerChanges??[]),u=l.length===1;if(!e.isInDiffEditor){if(u&&this._useCodeShifting.read(t)!==`never`&&gk(n))return _k(n,i.cursorPosition)?nT.InsertionInline:nT.LineReplacement;if(yk(l,i,r))return nT.Deletion;if(vk(n)&&this._useCodeShifting.read(t)===`always`)return nT.InsertionMultiLine;if(l.every(e=>Gu.ofRange(e.originalRange).columnCount<sk.MAX_LENGTH&&Gu.ofRange(e.modifiedRange).columnCount<sk.MAX_LENGTH)&&u&&s===1&&c===1){let t=l.map(e=>r.getValueOfRange(e.modifiedRange)),n=l.map(t=>e.inlineEdit.originalText.getValueOfRange(t.originalRange));if(!t.some(e=>e.includes(`	`))&&!n.some(e=>e.includes(`	`))&&(!l.some(e=>e.originalRange.isEmpty())||!xk(l.map(e=>new es(e.originalRange,``)),i.originalText).some(e=>e.range.isEmpty()&&Gu.ofRange(e.range).columnCount<sk.MAX_LENGTH)))return nT.WordReplacements}}if(s>0&&c>0)return s===1&&c===1&&!e.isInDiffEditor?nT.LineReplacement:this._renderSideBySide.read(t)!==`never`&&ik.fitsInsideViewport(this._editor,this._previewTextModel,i,t)?nT.SideBySide:nT.LineReplacement;if(e.isInDiffEditor){if(yk(l,i,r))return nT.Deletion;if(vk(n)&&this._useCodeShifting.read(t)===`always`)return nT.InsertionMultiLine}return nT.SideBySide}determineRenderState(e,t,n,r){let i=e.inlineEdit,a=this.determineView(e,t,n,r);this._previousView={id:this.getCacheId(e),view:a,editorWidth:this._editor.getLayoutInfo().width,timestamp:Date.now()};let o=n.flatMap(e=>e.innerChanges??[]),s=this._editor.getModel(),c=o.map(e=>({originalRange:e.originalRange,modifiedRange:e.modifiedRange,original:s.getValueInRange(e.originalRange),modified:r.getValueOfRange(e.modifiedRange)})),l=i.cursorPosition,u=c[0].modified.startsWith(s.getEOL()),d={cursorColumnDistance:i.edit.replacements[0].range.getStartPosition().column-l.column,cursorLineDistance:i.lineEdit.lineRange.startLineNumber-l.lineNumber+(u&&i.lineEdit.lineRange.startLineNumber>=l.lineNumber?1:0),lineCountOriginal:i.lineEdit.lineRange.length,lineCountModified:i.lineEdit.newLines.length,characterCountOriginal:c.reduce((e,t)=>e+t.original.length,0),characterCountModified:c.reduce((e,t)=>e+t.modified.length,0),disjointReplacements:c.length,sameShapeReplacements:c.every(e=>e.original===c[0].original&&e.modified===c[0].modified)};switch(a){case nT.InsertionInline:return{kind:nT.InsertionInline,viewData:d};case nT.SideBySide:return{kind:nT.SideBySide,viewData:d};case nT.Collapsed:return{kind:nT.Collapsed,viewData:d};case nT.Custom:return{kind:nT.Custom,displayLocation:e.displayLocation,viewData:d}}if(a===nT.Deletion)return{kind:nT.Deletion,originalRange:i.originalLineRange,deletions:o.map(e=>e.originalRange),viewData:d};if(a===nT.InsertionMultiLine){let e=o[0];return{kind:nT.InsertionMultiLine,lineNumber:e.originalRange.startLineNumber,column:e.originalRange.startColumn,text:r.getValueOfRange(e.modifiedRange),viewData:d}}let f=c.map(e=>new es(e.originalRange,e.modified));if(f.length!==0){if(a===nT.WordReplacements){let e=bk(f,i.originalText);return e.some(e=>e.range.isEmpty())&&(e=xk(f,i.originalText)),{kind:nT.WordReplacements,replacements:e,viewData:d}}if(a===nT.LineReplacement)return{kind:nT.LineReplacement,originalRange:i.originalLineRange,modifiedRange:i.modifiedLineRange,modifiedLines:i.modifiedLineRange.mapToLineArray(e=>r.getLineAt(e)),replacements:o.map(e=>({originalRange:e.originalRange,modifiedRange:e.modifiedRange})),viewData:d}}}_viewHasBeenShownLongerThan(e){let t=this._previousView?.timestamp;if(!t)throw new h(`viewHasBeenShownLongThan called before a view has been shown`);return Date.now()-t>=e}};hk=pk([mk(5,k)],hk);function gk(e){return e.every(e=>e.innerChanges.every(e=>t(e)));function t(e){return!(!e.originalRange.isEmpty()||e.modifiedRange.startLineNumber!==e.modifiedRange.endLineNumber)}}function _k(e,t){if(!t||!gk(e))return!1;let n=t;return e.every(e=>e.innerChanges.every(e=>r(e)));function r(e){let t=e.originalRange.getStartPosition();return!!(n.isBeforeOrEqual(t)||t.lineNumber<n.lineNumber)}}function vk(e){let t=e.flatMap(e=>e.innerChanges??[]);if(t.length!==1)return!1;let n=t[0];return!(!n.originalRange.isEmpty()||n.modifiedRange.startLineNumber===n.modifiedRange.endLineNumber)}function yk(e,t,n){return e.map(e=>({original:t.originalText.getValueOfRange(e.originalRange),modified:n.getValueOfRange(e.modifiedRange)})).every(({original:e,modified:t})=>t.trim()===``&&e.length>0&&(e.length>t.length||e.trim()!==``))}function bk(e,t){return Sk(e,t,e=>/^[a-zA-Z]$/.test(e))}function xk(e,t){return Sk(e,t,e=>!/^\s$/.test(e))}function Sk(e,t,n){let r=[];e.sort((e,t)=>S.compareRangesUsingStarts(e.range,t.range));for(let n of e){let e=n.range.startColumn-1,a=n.range.endColumn-2,o=``,s=``,c=t.getLineAt(n.range.startLineNumber),l=t.getLineAt(n.range.endLineNumber);if(i(c[e]))for(;i(c[e-1]);)o=c[e-1]+o,e--;if(i(l[a])||a<e)for(;i(l[a+1]);)s+=l[a+1],a++;let u=new es(new S(n.range.startLineNumber,e+1,n.range.endLineNumber,a+2),o+n.text+s);r.length>0&&S.areIntersectingOrTouching(r[r.length-1].range,u.range)&&(u=es.joinReplacements([r.pop(),u],t)),r.push(u)}function i(e){return e===void 0?!1:n(e)}return r}function Ck(e,t){let n=e.model.inlineEdit.edit.replacements;if(n.length!==1)return 0;let r=t.getModel();if(!r)return 0;let i=r.getEOL(),a=n[0];if(a.range.isEmpty()&&a.text.startsWith(i)){let e=t.getLineHeightForPosition(a.range.getStartPosition());return wk(a.text,i)*e}return 0}function wk(e,t){if(!t.length)return 0;let n=0,r=0;for(;e.startsWith(t,r);)n++,r+=t.length;return n}var Tk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ek=function(e,t){return function(n,r){t(n,r,e)}},Dk,Ok=class extends b{static{Dk=this}static{this.hot=hi(Dk)}constructor(e,t,n,r,i){super(),this._editor=e,this._edit=t,this._model=n,this._focusIsInMenu=r,this._inlineEdit=O(this,e=>{let t=this._model.read(e);if(!t)return;let n=this._edit.read(e);if(!n)return;let r=this._editor.getModel();if(!r)return;let i=t.inlineEditState.get()?.inlineCompletion.updatedEdit;if(!i)return;let a=i.replacements.map(e=>{let t=S.fromPositions(r.getPositionAt(e.replaceRange.start),r.getPositionAt(e.replaceRange.endExclusive));return new es(t,e.newText)}),o=new ps(a),s=new Hn(r);return new cD(s,o,t.primaryPosition.get(),n.commands,n.inlineCompletion)}),this._inlineEditModel=O(this,e=>{let t=this._model.read(e);if(!t)return;let n=this._inlineEdit.read(e);if(!n)return;let r=O(this,e=>{if(this._editorObs.isFocused.read(e)){if(t.tabShouldJumpToInlineEdit.read(e))return tT.Jump;if(t.tabShouldAcceptInlineEdit.read(e))return tT.Accept}return tT.Inactive});return new lD(t,n,r)}),this._inlineEditHost=O(this,e=>{let t=this._model.read(e);if(t)return new uD(t)}),this._ghostTextIndicator=O(this,e=>{let t=this._model.read(e);if(!t)return;let n=t.inlineCompletionState.read(e);if(!n)return;let r=n.inlineCompletion;if(!r||!r.showInlineEditMenu)return;let i=Ya.ofLength(n.primaryGhostText.lineNumber,1);return new dD(this._editor,t,i,r)}),this._editorObs=f(this._editor),this._register(i.createInstance(hk,this._editor,this._inlineEditHost,this._inlineEditModel,this._ghostTextIndicator,this._focusIsInMenu))}};Ok=Dk=Tk([Ek(4,k)],Ok);var kk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ak=function(e,t){return function(n,r){t(n,r,e)}},jk=class extends b{constructor(e,t,n,r){super(),this._editor=e,this._model=t,this._focusIsInMenu=n,this._instantiationService=r,this._ghostTexts=O(this,e=>this._model.read(e)?.ghostTexts.read(e)??[]),this._stablizedGhostTexts=_w(this._ghostTexts,this._store),this._editorObs=f(this._editor),this._ghostTextWidgets=oe(this,this._stablizedGhostTexts,(e,t)=>il(t=>this._instantiationService.createInstance($E.hot.read(t),this._editor,{ghostText:e,warning:this._model.map((e,t)=>{let n=e?.warning?.read(t);return n?{icon:n.icon}:void 0}),minReservedLineCount:jt(0),targetTextModel:this._model.map(e=>e?.textModel),handleInlineCompletionShown:this._model.map((e,t)=>{let n=e?.inlineCompletionState.read(t)?.inlineCompletion;return n?t=>e.handleInlineSuggestionShown(n,nT.GhostText,t):()=>{}})},this._editorObs.getOption(71).map(e=>({syntaxHighlightingEnabled:e.syntaxHighlightingEnabled})),!1,!1)).recomputeInitiallyAndOnChange(t)).recomputeInitiallyAndOnChange(this._store),this._inlineEdit=O(this,e=>this._model.read(e)?.inlineEditState.read(e)?.inlineEdit),this._everHadInlineEdit=Zu(this,(e,t)=>t||!!this._inlineEdit.read(e)||!!this._model.read(e)?.inlineCompletionState.read(e)?.inlineCompletion?.showInlineEditMenu),this._inlineEditWidget=il(e=>{if(this._everHadInlineEdit.read(e))return this._instantiationService.createInstance(Ok.hot.read(e),this._editor,this._inlineEdit,this._model,this._focusIsInMenu)}).recomputeInitiallyAndOnChange(this._store),this._fontFamily=this._editorObs.getOption(71).map(e=>e.fontFamily),this._register(ii(O(e=>`
.monaco-editor .ghost-text-decoration,
.monaco-editor .ghost-text-decoration-preview,
.monaco-editor .ghost-text {
	font-family: ${this._fontFamily.read(e)};
}`))),this._register(new jh(this._editor,this._model,this._instantiationService))}shouldShowHoverAtViewZone(e){return this._ghostTextWidgets.get()[0]?.get().ownsViewZone(e)??!1}};jk=kk([Ak(3,k)],jk);var Mk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Nk=function(e,t){return function(n,r){t(n,r,e)}},Pk,Fk=class extends b{static{Pk=this}static{this._instances=new Set}static{this.hot=hi(Pk)}static{this.ID=`editor.contrib.inlineCompletionsController`}static getInFocusedEditorOrParent(e){let t=n_(e);return t?Pk.get(t):null}static get(e){return pC(e.getContribution(Pk.ID))}constructor(e,t,n,r,i,a,o,s,c,l){super(),this.editor=e,this._instantiationService=t,this._contextKeyService=n,this._configurationService=r,this._commandService=i,this._debounceService=a,this._languageFeaturesService=o,this._accessibilitySignalService=s,this._keybindingService=c,this._accessibilityService=l,this._editorObs=f(this.editor),this._positions=O(this,e=>this._editorObs.selections.read(e)?.map(e=>e.getEndPosition())??[new x(1,1)]),this._suggestWidgetAdapter=this._register(new WE(this._editorObs,e=>this.model.get()?.handleSuggestAccepted(e),()=>this.model.get()?.selectedInlineCompletion.get()?.getSingleTextEdit())),this._enabledInConfig=ai(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(71).enabled),this._isScreenReaderEnabled=ai(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this._editorDictationInProgress=ai(this,this._contextKeyService.onDidChangeContext,()=>this._contextKeyService.getContext(this.editor.getDomNode()).getValue(`editorDictation.inProgress`)===!0),this._enabled=O(this,e=>this._enabledInConfig.read(e)&&(!this._isScreenReaderEnabled.read(e)||!this._editorDictationInProgress.read(e))),this._debounceValue=this._debounceService.for(this._languageFeaturesService.inlineCompletionsProvider,`InlineCompletionsDebounce`,{min:50,max:50}),this._focusIsInMenu=Vl(this,!1),this._focusIsInEditorOrMenu=O(this,e=>{let t=this._editorObs.isFocused.read(e),n=this._focusIsInMenu.read(e);return t||n}),this._cursorIsInIndentation=O(this,e=>{let t=this._editorObs.cursorPosition.read(e);if(t===null)return!1;let n=this._editorObs.model.read(e);if(!n)return!1;this._editorObs.versionId.read(e);let r=n.getLineIndentColumn(t.lineNumber);return t.column<=r}),this.model=il(this,e=>{if(this._editorObs.isReadonly.read(e))return;let t=this._editorObs.model.read(e);if(t)return this._instantiationService.createInstance(TT,t,this._suggestWidgetAdapter.selectedItem,this._editorObs.versionId,this._positions,this._debounceValue,this._enabled,this.editor)}).recomputeInitiallyAndOnChange(this._store),this._playAccessibilitySignal=yt(this),this._hideInlineEditOnSelectionChange=this._editorObs.getOption(71).map(e=>!0),this._view=this._register(this._instantiationService.createInstance(jk,this.editor,this.model,this._focusIsInMenu)),Pk._instances.add(this),this._register(pl(()=>Pk._instances.delete(this))),this._register(la(e=>{let t=this.model.read(e);if(!t)return;let n=t.state.read(e);if(!n||!this._focusIsInEditorOrMenu.get())return;let r=n.kind===`inlineEdit`?n.nextEditUri:void 0;for(let e of Pk._instances)if(e===this)continue;else r&&hs(r,e.editor.getModel()?.uri)?e.model.get()?.trigger():e.reject()})),this._register(la(e=>{let t=this.model.read(e),n=this.editor.getModel()?.uri;!t||!n||e.store.add(t.onDidAccept(()=>{for(let e of Pk._instances){if(e===this)continue;let t=e.model.get()?.state.get();t?.kind===`inlineEdit`&&hs(t.nextEditUri,n)&&e.model.get()?.stop(`automatic`)}}))})),this._register(xn(this._editorObs.onDidType,(e,t)=>{this._enabled.get()&&this.model.get()?.trigger()})),this._register(xn(this._editorObs.onDidPaste,(e,t)=>{this._enabled.get()&&this.model.get()?.trigger()})),this._register(this._commandService.onDidExecuteCommand(t=>{if(new Set([ra.Tab.id,ra.DeleteLeft.id,ra.DeleteRight.id,`editor.action.inlineSuggest.commit`,`acceptSelectedSuggestion`]).has(t.commandId)&&e.hasTextFocus()&&this._enabled.get()){let e=!1;t.commandId===`editor.action.inlineSuggest.commit`&&(e=!0),this._editorObs.forceUpdate(t=>{this.model.get()?.trigger(t,{noDelay:e})})}})),this._register(xn(this._editorObs.selections,(e,t,n)=>{if(n.some(e=>e.reason===3||e.source===`api`)){if(!this._hideInlineEditOnSelectionChange.get()&&this.model.get()?.state.get()?.kind===`inlineEdit`)return;let e=this.model.get();if(!e)return;e.state.get()?.kind===`ghostText`&&this.model.get()?.stop()}})),this._register(la(t=>{let n=this._focusIsInEditorOrMenu.read(t),r=this.model.get();if(n){let e=r?.state?.get();(!e||e.kind!==`inlineEdit`||!e.nextEditUri)&&Fa(e=>{for(let t of Pk._instances)t!==this&&t.model.get()?.stop(`automatic`,e)});return}this._contextKeyService.getContextKeyValue(`accessibleViewIsShown`)||this._configurationService.getValue(`editor.inlineSuggest.keepOnBlur`)||e.getOption(71).keepOnBlur||Ph.dropDownVisible||r&&(r.state.get()?.inlineCompletion?.isFromExplicitRequest&&r.inlineEditAvailable.get()||Fa(e=>{r.stop(`automatic`,e)}))})),this._register(la(e=>{let t=this.model.read(e)?.inlineCompletionState.read(e);t?.suggestItem?t.primaryGhostText.lineCount>=2&&this._suggestWidgetAdapter.forceRenderingAbove():this._suggestWidgetAdapter.stopForceRenderingAbove()})),this._register(pl(()=>{this._suggestWidgetAdapter.stopForceRenderingAbove()}));let u=Zu(this,(e,t)=>{let n=this.model.read(e)?.state.read(e);return this._suggestWidgetAdapter.selectedItem.get()?t:n?.inlineCompletion?.semanticId});this._register(nr(O(e=>(this._playAccessibilitySignal.read(e),u.read(e),{})),async(e,t,n,r)=>{let i=this.model.get(),a=i?.state.get();if(!a||!i)return;let o=a.kind===`ghostText`?i.textModel.getLineContent(a.primaryGhostText.lineNumber):``;await qs(50,it(r)),await st(this._suggestWidgetAdapter.selectedItem,vu,()=>!1,it(r)),await this._accessibilitySignalService.playSignal(a.kind===`ghostText`?Xt.inlineSuggestion:Xt.nextEditSuggestion),this.editor.getOption(12)&&(a.kind===`ghostText`?this._provideScreenReaderUpdate(a.primaryGhostText.renderForScreenReader(o)):this._provideScreenReaderUpdate(``))})),this._register(this._configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(`accessibility.verbosity.inlineCompletions`)&&this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue(`accessibility.verbosity.inlineCompletions`)})})),this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue(`accessibility.verbosity.inlineCompletions`)});let d=new vw(this._contextKeyService);this._register(d.bind(MC.cursorInIndentation,this._cursorIsInIndentation)),this._register(d.bind(MC.hasSelection,e=>!this._editorObs.cursorSelection.read(e)?.isEmpty())),this._register(d.bind(MC.cursorAtInlineEdit,this.model.map((e,t)=>e?.inlineEditState?.read(t)?.cursorAtInlineEdit.read(t)))),this._register(d.bind(MC.tabShouldAcceptInlineEdit,this.model.map((e,t)=>!!e?.tabShouldAcceptInlineEdit.read(t)))),this._register(d.bind(MC.tabShouldJumpToInlineEdit,this.model.map((e,t)=>!!e?.tabShouldJumpToInlineEdit.read(t)))),this._register(d.bind(MC.inlineEditVisible,e=>this.model.read(e)?.inlineEditState.read(e)!==void 0)),this._register(d.bind(MC.inlineSuggestionHasIndentation,e=>this.model.read(e)?.getIndentationInfo(e)?.startsWithIndentation)),this._register(d.bind(MC.inlineSuggestionHasIndentationLessThanTabSize,e=>this.model.read(e)?.getIndentationInfo(e)?.startsWithIndentationLessThanTabSize)),this._register(d.bind(MC.suppressSuggestions,e=>{let t=this.model.read(e)?.inlineCompletionState.read(e);return t?.primaryGhostText&&t?.inlineCompletion?t.inlineCompletion.source.inlineSuggestions.suppressSuggestions:void 0})),this._register(d.bind(MC.inlineSuggestionVisible,e=>{let t=this.model.read(e)?.inlineCompletionState.read(e);return!!t?.inlineCompletion&&t?.primaryGhostText!==void 0&&!t?.primaryGhostText.isEmpty()}));let p=O(this,e=>{let t=this.model.read(e)?.inlineCompletionState.read(e)?.primaryGhostText;if(!(!t||t.isEmpty()))return new x(t.lineNumber,t.parts[0].column)});this._register(d.bind(MC.cursorBeforeGhostText,e=>{let t=p.read(e);if(!t)return!1;let n=this._editorObs.cursorPosition.read(e);return n?t.equals(n):!1})),this._register(this._instantiationService.createInstance(BC,this.editor))}playAccessibilitySignal(e){this._playAccessibilitySignal.trigger(e)}_provideScreenReaderUpdate(e){let t=this._contextKeyService.getContextKeyValue(`accessibleViewIsShown`),n=this._keybindingService.lookupKeybinding(`editor.action.accessibleView`),r;!t&&n&&this.editor.getOption(168)&&(r=H(1193,`Inspect this in the accessible view ({0})`,n.getAriaLabel())),Xi(r?e+`, `+r:e)}shouldShowHoverAt(e){let t=this.model.get()?.primaryGhostText.get();return t?t.parts.some(n=>e.containsPosition(new x(t.lineNumber,n.column))):!1}shouldShowHoverAtViewZone(e){return this._view.shouldShowHoverAtViewZone(e)}reject(){Fa(e=>{let t=this.model.get();if(t&&(t.stop(`explicitCancel`,e),this._focusIsInEditorOrMenu.get()))for(let t of Pk._instances)t!==this&&t.model.get()?.stop(`automatic`,e)})}jump(){let e=this.model.get();e&&e.jump()}};Fk=Pk=Mk([Nk(1,k),Nk(2,w),Nk(3,Ni),Nk(4,Mr),Nk(5,co),Nk(6,W),Nk(7,nl),Nk(8,zn),Nk(9,Zt)],Fk);var Ik=class e extends D{static{this.ID=Th}constructor(){super({id:e.ID,label:B(1171,`Show Next Inline Suggestion`),precondition:j.and(F.writable,MC.inlineSuggestionVisible),kbOpts:{weight:100,primary:606}})}async run(e,t){Fk.get(t)?.model.get()?.next()}},Lk=class e extends D{static{this.ID=wh}constructor(){super({id:e.ID,label:B(1172,`Show Previous Inline Suggestion`),precondition:j.and(F.writable,MC.inlineSuggestionVisible),kbOpts:{weight:100,primary:604}})}async run(e,t){Fk.get(t)?.model.get()?.previous()}},Rk=class extends D{constructor(){super({id:`editor.action.inlineSuggest.trigger`,label:B(1173,`Trigger Inline Suggestion`),precondition:F.writable})}async run(e,t){let n=Fk.get(t);await vl(async e=>{await n?.model.get()?.triggerExplicitly(e),n?.playAccessibilitySignal(e)})}},zk=class extends D{constructor(){super({id:`editor.action.inlineSuggest.triggerInlineEditExplicit`,label:B(1174,`Trigger Next Edit Suggestion`),precondition:F.writable})}async run(e,t){let n=e.get(nt),r=Fk.get(t);await r?.model.get()?.triggerExplicitly(void 0,!0),r?.model.get()?.inlineEditAvailable.get()||n.notify({severity:Lt.Info,message:H(1162,`No inline edit is available.`)})}},Bk=class extends Gi{constructor(){super({id:`editor.action.inlineSuggest.triggerInlineEdit`,precondition:F.writable})}async runEditorCommand(e,t,n){await Fk.get(t)?.model.get()?.trigger(void 0,{onlyFetchInlineEdits:!0})}},Vk=class extends D{constructor(){super({id:`editor.action.inlineSuggest.acceptNextWord`,label:B(1175,`Accept Next Word Of Inline Suggestion`),precondition:j.and(F.writable,MC.inlineSuggestionVisible),kbOpts:{weight:101,primary:2065,kbExpr:j.and(F.writable,MC.inlineSuggestionVisible,MC.cursorBeforeGhostText,ot.negate())},menuOpts:[{menuId:M.InlineSuggestionToolbar,title:H(1163,`Accept Word`),group:`primary`,order:2}]})}async run(e,t){await Fk.get(t)?.model.get()?.acceptNextWord()}},Hk=class extends D{constructor(){super({id:`editor.action.inlineSuggest.acceptNextLine`,label:B(1176,`Accept Next Line Of Inline Suggestion`),precondition:j.and(F.writable,MC.inlineSuggestionVisible),kbOpts:{weight:101},menuOpts:[{menuId:M.InlineSuggestionToolbar,title:H(1164,`Accept Line`),group:`secondary`,order:2}]})}async run(e,t){await Fk.get(t)?.model.get()?.acceptNextLine()}},Uk=class extends D{constructor(){super({id:Ch,label:B(1177,`Accept Inline Suggestion`),precondition:j.or(MC.inlineSuggestionVisible,MC.inlineEditVisible),menuOpts:[{menuId:M.InlineSuggestionToolbar,title:H(1165,`Accept`),group:`primary`,order:2},{menuId:M.InlineEditsActions,title:H(1166,`Accept`),group:`primary`,order:2}],kbOpts:[{primary:2,weight:200,kbExpr:j.or(j.and(MC.inlineSuggestionVisible,F.tabMovesFocus.toNegated(),Q.Visible.toNegated(),F.hoverFocused.toNegated(),MC.hasSelection.toNegated(),MC.inlineSuggestionHasIndentationLessThanTabSize),j.and(MC.inlineEditVisible,F.tabMovesFocus.toNegated(),Q.Visible.toNegated(),F.hoverFocused.toNegated(),MC.tabShouldAcceptInlineEdit))}]})}async run(e,t){let n=Fk.getInFocusedEditorOrParent(e);n&&(n.model.get()?.accept(n.editor),n.editor.focus())}};zs.registerKeybindingRule({id:Ch,weight:202,primary:2,when:j.and(MC.inInlineEditsPreviewEditor)});var Wk=class extends D{constructor(){super({id:`editor.action.inlineSuggest.jump`,label:B(1178,`Jump to next inline edit`),precondition:MC.inlineEditVisible,menuOpts:[{menuId:M.InlineEditsActions,title:H(1167,`Jump`),group:`primary`,order:1,when:MC.cursorAtInlineEdit.toNegated()}],kbOpts:{primary:2,weight:201,kbExpr:j.and(MC.inlineEditVisible,F.tabMovesFocus.toNegated(),Q.Visible.toNegated(),F.hoverFocused.toNegated(),MC.tabShouldJumpToInlineEdit)}})}async run(e,t){let n=Fk.get(t);n&&n.jump()}},Gk=class e extends D{static{this.ID=Eh}constructor(){super({id:e.ID,label:B(1179,`Hide Inline Suggestion`),precondition:j.or(MC.inlineSuggestionVisible,MC.inlineEditVisible),kbOpts:{weight:190,primary:9},menuOpts:[{menuId:M.InlineEditsActions,title:H(1168,`Reject`),group:`primary`,order:3}]})}async run(e,t){let n=Fk.getInFocusedEditorOrParent(e);Fa(e=>{n?.model.get()?.stop(`explicitCancel`,e)}),n?.editor.focus()}},Kk=class e extends D{static{this.ID=Dh}constructor(){super({id:e.ID,label:B(1180,`Toggle Inline Suggestions Show Collapsed`),precondition:j.true()})}async run(e,t){let n=e.get(Ni),r=n.getValue(`editor.inlineSuggest.edits.showCollapsed`);n.updateValue(`editor.inlineSuggest.edits.showCollapsed`,!r)}};zs.registerKeybindingRule({id:Gk.ID,weight:-1,primary:9,secondary:[1033],when:j.and(MC.inInlineEditsPreviewEditor)});var qk=class e extends we{static{this.ID=`editor.action.inlineSuggest.toggleAlwaysShowToolbar`}constructor(){super({id:e.ID,title:H(1169,`Always Show Toolbar`),f1:!1,precondition:void 0,menu:[{id:M.InlineSuggestionToolbar,group:`secondary`,order:10}],toggled:j.equals(`config.editor.inlineSuggest.showToolbar`,`always`)})}async run(e){let t=e.get(Ni),n=t.getValue(`editor.inlineSuggest.showToolbar`)===`always`?`onHover`:`always`;t.updateValue(`editor.inlineSuggest.showToolbar`,n)}},Jk=class extends D{constructor(){super({id:`editor.action.inlineSuggest.dev.extractRepro`,label:H(1170,`Developer: Extract Inline Suggest State`),alias:`Developer: Inline Suggest Extract Repro`,precondition:j.or(MC.inlineEditVisible,MC.inlineSuggestionVisible)})}async run(e,t){let n=e.get(zt),r=Fk.get(t)?.model.get();if(!r)return;let i=r.extractReproSample(),o=a(JSON.stringify({inlineCompletion:i.inlineCompletion},null,4)).map(e=>`// `+e).join(`
`),s=`${i.documentValue}\n\n// <json>\n${o}\n// </json>\n`;return await n.writeText(s),{reproCase:s}}},Yk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Xk=function(e,t){return function(n,r){t(n,r,e)}},Zk=class{constructor(e,t,n){this.owner=e,this.range=t,this.controller=n}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}},Qk=class{constructor(e,t,n,r,i,a){this._editor=e,this._languageService=t,this._openerService=n,this.accessibilityService=r,this._instantiationService=i,this._telemetryService=a,this.hoverOrdinal=4}suggestHoverAnchor(e){let t=Fk.get(this._editor);if(!t)return null;let n=e.target;if(n.type===8){let r=n.detail;if(t.shouldShowHoverAtViewZone(r.viewZoneId))return new $m(1e3,this,S.fromPositions(this._editor.getModel().validatePosition(r.positionBefore||r.position)),e.event.posx,e.event.posy,!1)}if(n.type===7&&t.shouldShowHoverAt(n.range)||n.type===6&&n.detail.mightBeForeignElement&&t.shouldShowHoverAt(n.range))return new $m(1e3,this,n.range,e.event.posx,e.event.posy,!1);if(n.type===9&&n.element){let r=$E.getWarningWidgetContext(n.element);if(r&&t.shouldShowHoverAt(r.range))return new $m(1e3,this,r.range,e.event.posx,e.event.posy,!1)}return null}computeSync(e,t){if(this._editor.getOption(71).showToolbar!==`onHover`)return[];let n=Fk.get(this._editor);return n&&n.shouldShowHoverAt(e.range)?[new Zk(this,e.range,n)]:[]}renderHoverParts(e,t){let r=new P,i=t[0];this._telemetryService.publicLog2(`inlineCompletionHover.shown`),this.accessibilityService.isScreenReaderOptimized()&&!this._editor.getOption(12)&&r.add(this.renderScreenReaderText(e,i));let a=i.controller.model.get(),o=document.createElement(`div`);return e.fragment.appendChild(o),r.add(n((t,n)=>{let r=n.add(this._instantiationService.createInstance(Ph.hot.read(t),this._editor,!1,jt(null),a.selectedInlineCompletionIndex,a.inlineCompletionsCount,a.activeCommands,a.warning,()=>{e.onContentsChanged()}));o.replaceChildren(r.getDomNode())})),a.triggerExplicitly(),new eh([{hoverPart:i,hoverElement:o,dispose(){r.dispose()}}])}renderScreenReaderText(e,t){let n=new P,r=I,i=r(`div.hover-row.markdown-hover`),a=V(i,r(`div.hover-contents`,{"aria-live":`assertive`})),o=new $r({editor:this._editor},this._languageService,this._openerService),s=t=>{let r=H(1194,`Suggestion:`),i=n.add(o.render(new Tn().appendText(r).appendCodeblock(`text`,t),{asyncRenderCallback:()=>{a.className=`hover-contents code-hover-contents`,e.onContentsChanged()}}));a.replaceChildren(i.element)};return n.add(la(e=>{let n=t.controller.model.read(e)?.primaryGhostText.read(e);if(n){let e=this._editor.getModel().getLineContent(n.lineNumber);s(n.renderForScreenReader(e))}else Yr(a)})),e.fragment.appendChild(i),n}};Qk=Yk([Xk(1,ui),Xk(2,cl),Xk(3,Zt),Xk(4,k),Xk(5,Wr)],Qk);var $k=class{};G(Fk.ID,gC(Fk.hot),3),s(Rk),s(zk),L(new Bk),s(Ik),s(Lk),s(Vk),s(Hk),s(Uk),s(Kk),s(Gk),s(Wk),y(qk),s(Jk),y(Ja),y(uu),th.register(Qk),uC.register(new $k);var eA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},tA=function(e,t){return function(n,r){t(n,r,e)}},nA,rA=class{static{nA=this}static{this.ID=`editor.contrib.gotodefinitionatposition`}static{this.MAX_SOURCE_PREVIEW_LINES=8}constructor(e,t,n,r){this.textModelResolverService=t,this.languageService=n,this.languageFeaturesService=r,this.toUnhook=new P,this.toUnhookForKeyboard=new P,this.currentWordAtPosition=null,this.previousPromise=null,this.editor=e,this.linkDecorations=this.editor.createDecorationsCollection();let i=new Jg(e);this.toUnhook.add(i),this.toUnhook.add(i.onMouseMoveOrRelevantKeyDown(([e,t])=>{this.startFindDefinitionFromMouse(e,t??void 0)})),this.toUnhook.add(i.onExecute(e=>{this.isEnabled(e)&&this.gotoDefinition(e.target.position,e.hasSideBySideModifier).catch(e=>{rr(e)}).finally(()=>{this.removeLinkDecorations()})})),this.toUnhook.add(i.onCancel(()=>{this.removeLinkDecorations(),this.currentWordAtPosition=null}))}static get(e){return e.getContribution(nA.ID)}async startFindDefinitionFromCursor(e){await this.startFindDefinition(e),this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(()=>{this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear()})),this.toUnhookForKeyboard.add(this.editor.onKeyDown(e=>{e&&(this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear())}))}startFindDefinitionFromMouse(e,t){if(e.target.type===9&&this.linkDecorations.length>0)return;if(!this.editor.hasModel()||!this.isEnabled(e,t)){this.currentWordAtPosition=null,this.removeLinkDecorations();return}let n=e.target.position;this.startFindDefinition(n)}async startFindDefinition(e){this.toUnhookForKeyboard.clear();let t=e?this.editor.getModel()?.getWordAtPosition(e):null;if(!t){this.currentWordAtPosition=null,this.removeLinkDecorations();return}if(this.currentWordAtPosition&&this.currentWordAtPosition.startColumn===t.startColumn&&this.currentWordAtPosition.endColumn===t.endColumn&&this.currentWordAtPosition.word===t.word)return;this.currentWordAtPosition=t;let n=new he(this.editor,15);this.previousPromise&&=(this.previousPromise.cancel(),null),this.previousPromise=bu(t=>this.findDefinition(e,t));let r;try{r=await this.previousPromise}catch(e){rr(e);return}if(!r||!r.length||!n.validate(this.editor)){this.removeLinkDecorations();return}let i=r[0].originSelectionRange?S.lift(r[0].originSelectionRange):new S(e.lineNumber,t.startColumn,e.lineNumber,t.endColumn);if(r.length>1){let e=i;for(let{originSelectionRange:t}of r)t&&(e=S.plusRange(e,t));this.addDecoration(e,new Tn().appendText(H(1069,`Click to show {0} definitions.`,r.length)))}else{let e=r[0];return e.uri?this.textModelResolverService.createModelReference(e.uri).then(t=>{if(!t.object||!t.object.textEditorModel){t.dispose();return}let{object:{textEditorModel:n}}=t,{startLineNumber:r}=e.range;if(r<1||r>n.getLineCount()){t.dispose();return}let a=this.getPreviewValue(n,r,e),o=this.languageService.guessLanguageIdByFilepathOrFirstLine(n.uri);this.addDecoration(i,a?new Tn().appendCodeblock(o||``,a):void 0),t.dispose()}):void 0}}getPreviewValue(e,t,n){let r=n.range;return r.endLineNumber-r.startLineNumber>=nA.MAX_SOURCE_PREVIEW_LINES&&(r=this.getPreviewRangeBasedOnIndentation(e,t)),r=e.validateRange(r),this.stripIndentationFromPreviewRange(e,t,r)}stripIndentationFromPreviewRange(e,t,n){let r=e.getLineFirstNonWhitespaceColumn(t);for(let i=t+1;i<n.endLineNumber;i++){let t=e.getLineFirstNonWhitespaceColumn(i);r=Math.min(r,t)}return e.getValueInRange(n).replace(RegExp(`^\\s{${r-1}}`,`gm`),``).trim()}getPreviewRangeBasedOnIndentation(e,t){let n=e.getLineFirstNonWhitespaceColumn(t),r=Math.min(e.getLineCount(),t+nA.MAX_SOURCE_PREVIEW_LINES),i=t+1;for(;i<r;i++){let t=e.getLineFirstNonWhitespaceColumn(i);if(n===t)break}return new S(t,1,i+1,1)}addDecoration(e,t){let n={range:e,options:{description:`goto-definition-link`,inlineClassName:`goto-definition-link`,hoverMessage:t}};this.linkDecorations.set([n])}removeLinkDecorations(){this.linkDecorations.clear()}isEnabled(e,t){return this.editor.hasModel()&&e.isLeftClick&&e.isNoneOrSingleMouseDown&&e.target.type===6&&!(e.target.detail.injectedText?.options instanceof ms)&&(e.hasTriggerModifier||(t?t.keyCodeIsTriggerKey:!1))&&this.languageFeaturesService.definitionProvider.has(this.editor.getModel())}findDefinition(e,t){let n=this.editor.getModel();return n?ov(this.languageFeaturesService.definitionProvider,n,e,!1,t):Promise.resolve(null)}gotoDefinition(e,t){return this.editor.setPosition(e),this.editor.invokeWithinContext(e=>{let n=!t&&this.editor.getOption(100)&&!this.isInPeekEditor(e);return new mv({openToSide:t,openInPeek:n,muteMessage:!0},{title:{value:``,original:``},id:``,precondition:void 0}).run(e)})}isInPeekEditor(e){let t=e.get(w);return p_.inPeekEditor.getValue(t)}dispose(){this.toUnhook.dispose(),this.toUnhookForKeyboard.dispose()}};rA=nA=eA([tA(1,fi),tA(2,ui),tA(3,W)],rA),G(rA.ID,rA,2);var iA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},aA=function(e,t){return function(n,r){t(n,r,e)}},oA=class{constructor(e,t,n){this.marker=e,this.index=t,this.total=n}},sA=class{constructor(e,t,n){this._markerService=t,this._configService=n,this._onDidChange=new E,this.onDidChange=this._onDidChange.event,this._dispoables=new P,this._markers=[],this._nextIdx=-1,$n.isUri(e)?this._resourceFilter=t=>t.toString()===e.toString():e&&(this._resourceFilter=e);let r=this._configService.getValue(`problems.sortOrder`),i=(e,t)=>{let n=fn(e.resource.toString(),t.resource.toString());return n===0&&(n=r===`position`?S.compareRangesUsingStarts(e,t)||Qs.compare(e.severity,t.severity):Qs.compare(e.severity,t.severity)||S.compareRangesUsingStarts(e,t)),n},a=()=>{let t=this._markerService.read({resource:$n.isUri(e)?e:void 0,severities:Qs.Error|Qs.Warning|Qs.Info});return typeof e==`function`&&(t=t.filter(e=>this._resourceFilter(e.resource))),t.sort(i),ct(t,this._markers,(e,t)=>e.resource.toString()===t.resource.toString()&&e.startLineNumber===t.startLineNumber&&e.startColumn===t.startColumn&&e.endLineNumber===t.endLineNumber&&e.endColumn===t.endColumn&&e.severity===t.severity&&e.message===t.message)?!1:(this._markers=t,!0)};a(),this._dispoables.add(t.onMarkerChanged(e=>{(!this._resourceFilter||e.some(e=>this._resourceFilter(e)))&&a()&&(this._nextIdx=-1,this._onDidChange.fire())}))}dispose(){this._dispoables.dispose(),this._onDidChange.dispose()}matches(e){return!this._resourceFilter&&!e?!0:!this._resourceFilter||!e?!1:this._resourceFilter(e)}get selected(){let e=this._markers[this._nextIdx];return e&&new oA(e,this._nextIdx+1,this._markers.length)}_initIdx(e,t,n){let r=this._markers.findIndex(t=>hs(t.resource,e.uri));if(r<0)r=Qu(this._markers.length,t=>fn(this._markers[t].resource.toString(),e.uri.toString())),r<0&&(r=~r),n?this._nextIdx=r:this._nextIdx=(this._markers.length+r-1)%this._markers.length;else{let i=!1,a=!1;for(let n=r;n<this._markers.length;n++){let r=S.lift(this._markers[n]);if(r.isEmpty()){let t=e.getWordAtPosition(r.getStartPosition());t&&(r=new S(r.startLineNumber,t.startColumn,r.startLineNumber,t.endColumn))}if(t&&(r.containsPosition(t)||t.isBeforeOrEqual(r.getStartPosition()))){this._nextIdx=n,i=!0,a=!r.containsPosition(t);break}if(this._markers[n].resource.toString()!==e.uri.toString())break}i?a&&!n&&--this._nextIdx:this._nextIdx=n?0:this._markers.length-1}this._nextIdx<0&&(this._nextIdx=this._markers.length-1)}resetIndex(){this._nextIdx=-1}move(e,t,n){if(this._markers.length===0)return!1;let r=this._nextIdx;return this._nextIdx===-1?this._initIdx(t,n,e):e?this._nextIdx=(this._nextIdx+1)%this._markers.length:e||(this._nextIdx=(this._nextIdx-1+this._markers.length)%this._markers.length),r!==this._nextIdx}find(e,t){let n=this._markers.findIndex(t=>t.resource.toString()===e.toString());if(!(n<0)){for(;n<this._markers.length;n++)if(S.containsPosition(this._markers[n],t))return new oA(this._markers[n],n+1,this._markers.length)}}};sA=iA([aA(1,Qn),aA(2,Ni)],sA);const cA=dl(`IMarkerNavigationService`);var lA=class{constructor(e,t){this._markerService=e,this._configService=t,this._provider=new Tc}getMarkerList(e){for(let t of this._provider){let n=t.getMarkerList(e);if(n)return n}return new sA(e,this._markerService,this._configService)}};lA=iA([aA(0,Qn),aA(1,Ni)],lA),wt(cA,lA,1);var uA;(function(e){function t(e){switch(e){case hn.Ignore:return`severity-ignore `+X.asClassName(J.info);case hn.Info:return X.asClassName(J.info);case hn.Warning:return X.asClassName(J.warning);case hn.Error:return X.asClassName(J.error);default:return``}}e.className=t})(uA||={});var dA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fA=function(e,t){return function(n,r){t(n,r,e)}},pA,mA=class{constructor(e,t,n,r,i){this._openerService=r,this._labelService=i,this._lines=0,this._longestLineLength=0,this._relatedDiagnostics=new WeakMap,this._disposables=new P,this._editor=t;let a=document.createElement(`div`);a.className=`descriptioncontainer`,this._messageBlock=document.createElement(`div`),this._messageBlock.classList.add(`message`),this._messageBlock.setAttribute(`aria-live`,`assertive`),this._messageBlock.setAttribute(`role`,`alert`),a.appendChild(this._messageBlock),this._relatedBlock=document.createElement(`div`),a.appendChild(this._relatedBlock),this._disposables.add(Ma(this._relatedBlock,`click`,e=>{e.preventDefault();let t=this._relatedDiagnostics.get(e.target);t&&n(t)})),this._scrollable=new Ka(a,{horizontal:1,vertical:1,useShadows:!1,horizontalScrollbarSize:6,verticalScrollbarSize:6}),e.appendChild(this._scrollable.getDomNode()),this._disposables.add(this._scrollable.onScroll(e=>{a.style.left=`-${e.scrollLeft}px`,a.style.top=`-${e.scrollTop}px`})),this._disposables.add(this._scrollable)}dispose(){gt(this._disposables)}update(e){let{source:t,message:n,relatedInformation:r,code:i}=e,o=(t?.length||0)+2;i&&(typeof i==`string`?o+=i.length:o+=i.value.length);let s=a(n);this._lines=s.length,this._longestLineLength=0;for(let e of s)this._longestLineLength=Math.max(e.length+o,this._longestLineLength);Dl(this._messageBlock),this._messageBlock.setAttribute(`aria-label`,this.getAriaLabel(e)),this._editor.applyFontInfo(this._messageBlock);let c=this._messageBlock;for(let e of s)c=document.createElement(`div`),c.innerText=e,e===``&&(c.style.height=this._messageBlock.style.lineHeight),this._messageBlock.appendChild(c);if(t||i){let e=document.createElement(`span`);if(e.classList.add(`details`),c.appendChild(e),t){let n=document.createElement(`span`);n.innerText=t,n.classList.add(`source`),e.appendChild(n)}if(i)if(typeof i==`string`){let t=document.createElement(`span`);t.innerText=`(${i})`,t.classList.add(`code`),e.appendChild(t)}else{this._codeLink=I(`a.code-link`),this._codeLink.setAttribute(`href`,`${i.target.toString()}`),this._codeLink.onclick=e=>{this._openerService.open(i.target,{allowCommands:!0}),e.preventDefault(),e.stopPropagation()};let t=V(this._codeLink,I(`span`));t.innerText=i.value,e.appendChild(this._codeLink)}}if(Dl(this._relatedBlock),this._editor.applyFontInfo(this._relatedBlock),Ht(r)){let e=this._relatedBlock.appendChild(document.createElement(`div`));e.style.paddingTop=`${Math.floor(this._editor.getOption(75)*.66)}px`,this._lines+=1;for(let t of r){let n=document.createElement(`div`),r=document.createElement(`a`);r.classList.add(`filename`),r.innerText=`${this._labelService.getUriBasenameLabel(t.resource)}(${t.startLineNumber}, ${t.startColumn}): `,r.title=this._labelService.getUriLabel(t.resource),this._relatedDiagnostics.set(r,t);let i=document.createElement(`span`);i.innerText=t.message,n.appendChild(r),n.appendChild(i),this._lines+=1,e.appendChild(n)}}let l=this._editor.getOption(59),u=Math.ceil(l.typicalFullwidthCharacterWidth*this._longestLineLength*.75),d=l.lineHeight*this._lines;this._scrollable.setScrollDimensions({scrollWidth:u,scrollHeight:d})}layout(e,t){this._scrollable.getDomNode().style.height=`${e}px`,this._scrollable.getDomNode().style.width=`${t}px`,this._scrollable.setScrollDimensions({width:t,height:e})}getHeightInLines(){return Math.min(17,this._lines)}getAriaLabel(e){let t=``;switch(e.severity){case Qs.Error:t=H(1016,`Error`);break;case Qs.Warning:t=H(1017,`Warning`);break;case Qs.Info:t=H(1018,`Info`);break;case Qs.Hint:t=H(1019,`Hint`);break}let n=H(1020,`{0} at {1}. `,t,e.startLineNumber+`:`+e.startColumn),r=this._editor.getModel();return r&&e.startLineNumber<=r.getLineCount()&&e.startLineNumber>=1&&(n=`${r.getLineContent(e.startLineNumber)}, ${n}`),n}},hA=class extends g_{static{pA=this}static{this.TitleMenu=new M(`gotoErrorTitleMenu`)}constructor(e,t,n,r,i,a,o){super(e,{showArrow:!0,showFrame:!0,isAccessible:!0,frameWidth:1},i),this._themeService=t,this._openerService=n,this._menuService=r,this._contextKeyService=a,this._labelService=o,this._callOnDispose=new P,this._onDidSelectRelatedInformation=new E,this.onDidSelectRelatedInformation=this._onDidSelectRelatedInformation.event,this._severity=Qs.Warning,this._backgroundColor=z.white,this._applyTheme(t.getColorTheme()),this._callOnDispose.add(t.onDidColorThemeChange(this._applyTheme.bind(this))),this.create()}_applyTheme(e){this._backgroundColor=e.getColor(TA);let t=yA,n=bA;this._severity===Qs.Warning?(t=xA,n=SA):this._severity===Qs.Info&&(t=CA,n=wA);let r=e.getColor(t),i=e.getColor(n);this.style({arrowColor:r,frameColor:r,headerBackgroundColor:i,primaryHeadingColor:e.getColor(v_),secondaryHeadingColor:e.getColor(y_)})}_applyStyles(){this._parentContainer&&(this._parentContainer.style.backgroundColor=this._backgroundColor?this._backgroundColor.toString():``),super._applyStyles()}dispose(){this._callOnDispose.dispose(),super.dispose()}_fillHead(e){super._fillHead(e),this._disposables.add(this._actionbarWidget.actionRunner.onWillRun(e=>this.editor.focus()));let t=this._menuService.getMenuActions(pA.TitleMenu,this._contextKeyService),n=Rt(t);this._actionbarWidget.push(n,{label:!1,icon:!0,index:0})}_fillTitleIcon(e){this._icon=V(e,I(``))}_fillBody(e){this._parentContainer=e,e.classList.add(`marker-widget`),this._parentContainer.tabIndex=0,this._parentContainer.setAttribute(`role`,`tooltip`),this._container=document.createElement(`div`),e.appendChild(this._container),this._message=new mA(this._container,this.editor,e=>this._onDidSelectRelatedInformation.fire(e),this._openerService,this._labelService),this._disposables.add(this._message)}show(){throw Error(`call showAtMarker`)}showAtMarker(e,t,n){this._container.classList.remove(`stale`),this._message.update(e),this._severity=e.severity,this._applyTheme(this._themeService.getColorTheme());let r=S.lift(e),i=this.editor.getPosition(),a=i&&r.containsPosition(i)?i:r.getStartPosition();super.show(a,this.computeRequiredHeight());let o=this.editor.getModel();if(o){let e=n>1?H(1021,`{0} of {1} problems`,t,n):H(1022,`{0} of {1} problem`,t,n);this.setTitle(nu(o.uri),e)}this._icon.className=`codicon ${uA.className(Qs.toSeverity(this._severity))}`,this.editor.revealPositionNearTop(a,0),this.editor.focus()}updateMarker(e){this._container.classList.remove(`stale`),this._message.update(e)}showStale(){this._container.classList.add(`stale`),this._relayout()}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._heightInPixel=e,this._message.layout(e,t),this._container.style.height=`${e}px`}_onWidth(e){this._message.layout(this._heightInPixel,e)}_relayout(){super._relayout(this.computeRequiredHeight())}computeRequiredHeight(){return 3+this._message.getHeightInLines()}};hA=pA=dA([fA(1,rn),fA(2,cl),fA(3,wu),fA(4,k),fA(5,w),fA(6,Xc)],hA);var gA=wr(Ll,To),_A=wr(Ir,Du),vA=wr(Io,mo),yA=Y(`editorMarkerNavigationError.background`,{dark:gA,light:gA,hcDark:js,hcLight:js},H(1023,`Editor marker navigation widget error color.`)),bA=Y(`editorMarkerNavigationError.headerBackground`,{dark:ae(yA,.1),light:ae(yA,.1),hcDark:null,hcLight:null},H(1024,`Editor marker navigation widget error heading background.`)),xA=Y(`editorMarkerNavigationWarning.background`,{dark:_A,light:_A,hcDark:js,hcLight:js},H(1025,`Editor marker navigation widget warning color.`)),SA=Y(`editorMarkerNavigationWarning.headerBackground`,{dark:ae(xA,.1),light:ae(xA,.1),hcDark:`#0C141F`,hcLight:ae(xA,.2)},H(1026,`Editor marker navigation widget warning heading background.`)),CA=Y(`editorMarkerNavigationInfo.background`,{dark:vA,light:vA,hcDark:js,hcLight:js},H(1027,`Editor marker navigation widget info color.`)),wA=Y(`editorMarkerNavigationInfo.headerBackground`,{dark:ae(CA,.1),light:ae(CA,.1),hcDark:null,hcLight:null},H(1028,`Editor marker navigation widget info heading background.`)),TA=Y(`editorMarkerNavigation.background`,i,H(1029,`Editor marker navigation widget background.`)),EA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},DA=function(e,t){return function(n,r){t(n,r,e)}},OA,kA=class{static{OA=this}static{this.ID=`editor.contrib.markerController`}static get(e){return e.getContribution(OA.ID)}constructor(e,t,n,r,i){this._markerNavigationService=t,this._contextKeyService=n,this._editorService=r,this._instantiationService=i,this._sessionDispoables=new P,this._editor=e,this._widgetVisible=FA.bindTo(this._contextKeyService)}dispose(){this._cleanUp(),this._sessionDispoables.dispose()}_cleanUp(){this._widgetVisible.reset(),this._sessionDispoables.clear(),this._widget=void 0,this._model=void 0}_getOrCreateModel(e){if(this._model&&this._model.matches(e))return this._model;let t=!1;return this._model&&(t=!0,this._cleanUp()),this._model=this._markerNavigationService.getMarkerList(e),t&&this._model.move(!0,this._editor.getModel(),this._editor.getPosition()),this._widget=this._instantiationService.createInstance(hA,this._editor),this._widget.onDidClose(()=>this.close(),this,this._sessionDispoables),this._widgetVisible.set(!0),this._sessionDispoables.add(this._model),this._sessionDispoables.add(this._widget),this._sessionDispoables.add(this._editor.onDidChangeCursorPosition(e=>{(!this._model?.selected||!S.containsPosition(this._model?.selected.marker,e.position))&&this._model?.resetIndex()})),this._sessionDispoables.add(this._model.onDidChange(()=>{if(!this._widget||!this._widget.position||!this._model)return;let e=this._model.find(this._editor.getModel().uri,this._widget.position);e?this._widget.updateMarker(e.marker):this._widget.showStale()})),this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation(e=>{this._editorService.openCodeEditor({resource:e.resource,options:{pinned:!0,revealIfOpened:!0,selection:S.lift(e).collapseToStart()}},this._editor),this.close(!1)})),this._sessionDispoables.add(this._editor.onDidChangeModel(()=>this._cleanUp())),this._model}close(e=!0){this._cleanUp(),e&&this._editor.focus()}showAtMarker(e){if(!this._editor.hasModel())return;let t=this._editor.getModel(),n=this._getOrCreateModel(t.uri);n.resetIndex(),n.move(!0,t,new x(e.startLineNumber,e.startColumn)),n.selected&&this._widget.showAtMarker(n.selected.marker,n.selected.index,n.selected.total)}async navigate(e,t){if(!this._editor.hasModel())return;let n=this._editor.getModel(),r=this._getOrCreateModel(t?void 0:n.uri);if(r.move(e,n,this._editor.getPosition()),r.selected)if(r.selected.marker.resource.toString()!==n.uri.toString()){this._cleanUp();let n=await this._editorService.openCodeEditor({resource:r.selected.marker.resource,options:{pinned:!1,revealIfOpened:!0,selectionRevealType:2,selection:r.selected.marker}},this._editor);n&&(OA.get(n)?.close(),OA.get(n)?.navigate(e,t))}else this._widget.showAtMarker(r.selected.marker,r.selected.index,r.selected.total)}};kA=OA=EA([DA(1,cA),DA(2,w),DA(3,mt),DA(4,k)],kA);var AA=class extends D{constructor(e,t,n){super(n),this._next=e,this._multiFile=t}async run(e,t){t.hasModel()&&await kA.get(t)?.navigate(this._next,this._multiFile)}},jA=class e extends AA{static{this.ID=`editor.action.marker.next`}static{this.LABEL=B(1012,`Go to Next Problem (Error, Warning, Info)`)}constructor(){super(!0,!1,{id:e.ID,label:e.LABEL,precondition:void 0,kbOpts:{kbExpr:F.focus,primary:578,weight:100},menuOpts:{menuId:hA.TitleMenu,title:e.LABEL.value,icon:No(`marker-navigation-next`,J.arrowDown,H(1008,`Icon for goto next marker.`)),group:`navigation`,order:1}})}},MA=class e extends AA{static{this.ID=`editor.action.marker.prev`}static{this.LABEL=B(1013,`Go to Previous Problem (Error, Warning, Info)`)}constructor(){super(!1,!1,{id:e.ID,label:e.LABEL,precondition:void 0,kbOpts:{kbExpr:F.focus,primary:1602,weight:100},menuOpts:{menuId:hA.TitleMenu,title:e.LABEL.value,icon:No(`marker-navigation-previous`,J.arrowUp,H(1009,`Icon for goto previous marker.`)),group:`navigation`,order:2}})}},NA=class extends AA{constructor(){super(!0,!0,{id:`editor.action.marker.nextInFiles`,label:B(1014,`Go to Next Problem in Files (Error, Warning, Info)`),precondition:void 0,kbOpts:{kbExpr:F.focus,primary:66,weight:100},menuOpts:{menuId:M.MenubarGoMenu,title:H(1010,`Next &&Problem`),group:`6_problem_nav`,order:1}})}},PA=class extends AA{constructor(){super(!1,!0,{id:`editor.action.marker.prevInFiles`,label:B(1015,`Go to Previous Problem in Files (Error, Warning, Info)`),precondition:void 0,kbOpts:{kbExpr:F.focus,primary:1090,weight:100},menuOpts:{menuId:M.MenubarGoMenu,title:H(1011,`Previous &&Problem`),group:`6_problem_nav`,order:2}})}};G(kA.ID,kA,4),s(jA),s(MA),s(NA),s(PA);var FA=new T(`markersNavigationVisible`,!1),IA=Gi.bindToContribution(kA.get);L(new IA({id:`closeMarkersNavigation`,precondition:FA,handler:e=>e.close(),kbOpts:{weight:150,kbExpr:F.focus,primary:9,secondary:[1033]}})),s(class extends D{constructor(){super({id:`editor.action.debugEditorGpuRenderer`,label:B(1093,`Developer: Debug Editor GPU Renderer`),precondition:j.true()})}async run(e,t){let n=e.get(k),r=await e.get(xe).pick([{label:H(1090,`Log Texture Atlas Stats`),id:`logTextureAtlasStats`},{label:H(1091,`Save Texture Atlas`),id:`saveTextureAtlas`},{label:H(1092,`Draw Glyph`),id:`drawGlyph`}],{canPickMany:!1});if(r)switch(r.id){case`logTextureAtlasStats`:n.invokeFunction(e=>{let t=e.get(za),n=cr.atlas;if(!cr.atlas){t.error(`No texture atlas found`);return}let r=n.getStats();t.info([`Texture atlas stats`,...r].join(`

`))});break;case`saveTextureAtlas`:n.invokeFunction(async e=>{let t=e.get(yl),n=e.get(pE),r=t.getWorkspace().folders;if(r.length>0){let e=cr.atlas,t=[];for(let[i,a]of e.pages.entries())t.push(n.writeFile($n.joinPath(r[0].uri,`textureAtlasPage${i}_actual.png`),Yc.wrap(new Uint8Array(await(await a.source.convertToBlob()).arrayBuffer()))),n.writeFile($n.joinPath(r[0].uri,`textureAtlasPage${i}_usage.png`),Yc.wrap(new Uint8Array(await(await a.getUsagePreview()).arrayBuffer()))));await Promise.all(t)}});break;case`drawGlyph`:n.invokeFunction(async e=>{let t=e.get(Ni),n=e.get(pE),r=e.get(xe),i=e.get(yl).getWorkspace().folders;if(i.length===0)return;let a=cr.atlas,o=t.getValue(`editor.fontFamily`),s=t.getValue(`editor.fontSize`),c=new jr(s,o,Yl().devicePixelRatio,cr.decorationStyleCache),l=await r.input({prompt:`Enter a character to draw (prefix with 0x for code point))`});if(!l)return;let u=l.match(/0x(?<codePoint>[0-9a-f]+)/i)?.groups?.codePoint;u!==void 0&&(l=String.fromCodePoint(parseInt(u,16)));let d=a.getGlyph(c,l,0,0,0);if(!d)return;let f=a.pages[d.pageIndex].source.getContext(`2d`)?.getImageData(d.x,d.y,d.w,d.h);if(!f)return;let p=new OffscreenCanvas(f.width,f.height);rd(p.getContext(`2d`)).putImageData(f,0,0);let m=await p.convertToBlob({type:`image/png`}),h=$n.joinPath(i[0].uri,`glyph_${l}_0_${s}px_${o.replaceAll(/[,\\\/\.'\s]/g,`_`)}.png`);await n.writeFile(h,Yc.wrap(new Uint8Array(await m.arrayBuffer())))});break}}});var LA;(function(e){e.NoAutoFocus=`noAutoFocus`,e.FocusIfVisible=`focusIfVisible`,e.AutoFocusImmediately=`autoFocusImmediately`})(LA||={});var RA=class extends D{constructor(){super({id:`editor.action.showHover`,label:B(1099,`Show or Focus Hover`),metadata:{description:B(1100,`Show or focus the editor hover which shows documentation, references, and other content for a symbol at the current cursor position.`),args:[{name:`args`,schema:{type:`object`,properties:{focus:{description:`Controls if and when the hover should take focus upon being triggered by this action.`,enum:[LA.NoAutoFocus,LA.FocusIfVisible,LA.AutoFocusImmediately],enumDescriptions:[H(1096,`The hover will not automatically take focus.`),H(1097,`The hover will take focus only if it is already visible.`),H(1098,`The hover will automatically take focus when it appears.`)],default:LA.FocusIfVisible}}}}]},precondition:void 0,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2087),weight:100}})}run(e,t,n){if(!t.hasModel())return;let r=Yv.get(t);if(!r)return;let i=n?.focus,a=LA.FocusIfVisible;Object.values(LA).includes(i)?a=i:typeof i==`boolean`&&i&&(a=LA.AutoFocusImmediately);let o=e=>{let n=t.getPosition(),i=new S(n.lineNumber,n.column,n.lineNumber,n.column);r.showContentHover(i,1,2,e)},s=t.getOption(2)===2;r.isHoverVisible?a===LA.NoAutoFocus?o(s):r.focus():o(s||a===LA.AutoFocusImmediately)}},zA=class extends D{constructor(){super({id:`editor.action.showDefinitionPreviewHover`,label:B(1101,`Show Definition Preview Hover`),precondition:void 0,metadata:{description:B(1102,`Show the definition preview hover in the editor.`)}})}run(e,t){let n=Yv.get(t);if(!n)return;let r=t.getPosition();if(!r)return;let i=new S(r.lineNumber,r.column,r.lineNumber,r.column),a=rA.get(t);a&&a.startFindDefinitionFromCursor(r).then(()=>{n.showContentHover(i,1,2,!0)})}},BA=class extends D{constructor(){super({id:`editor.action.hideHover`,label:B(1103,`Hide Hover`),alias:`Hide Content Hover`,precondition:void 0})}run(e,t){Yv.get(t)?.hideContentHover()}},VA=class extends D{constructor(){super({id:`editor.action.scrollUpHover`,label:B(1104,`Scroll Up Hover`),precondition:F.hoverFocused,kbOpts:{kbExpr:F.hoverFocused,primary:16,weight:100},metadata:{description:B(1105,`Scroll up the editor hover.`)}})}run(e,t){let n=Yv.get(t);n&&n.scrollUp()}},HA=class extends D{constructor(){super({id:`editor.action.scrollDownHover`,label:B(1106,`Scroll Down Hover`),precondition:F.hoverFocused,kbOpts:{kbExpr:F.hoverFocused,primary:18,weight:100},metadata:{description:B(1107,`Scroll down the editor hover.`)}})}run(e,t){let n=Yv.get(t);n&&n.scrollDown()}},UA=class extends D{constructor(){super({id:`editor.action.scrollLeftHover`,label:B(1108,`Scroll Left Hover`),precondition:F.hoverFocused,kbOpts:{kbExpr:F.hoverFocused,primary:15,weight:100},metadata:{description:B(1109,`Scroll left the editor hover.`)}})}run(e,t){let n=Yv.get(t);n&&n.scrollLeft()}},WA=class extends D{constructor(){super({id:`editor.action.scrollRightHover`,label:B(1110,`Scroll Right Hover`),precondition:F.hoverFocused,kbOpts:{kbExpr:F.hoverFocused,primary:17,weight:100},metadata:{description:B(1111,`Scroll right the editor hover.`)}})}run(e,t){let n=Yv.get(t);n&&n.scrollRight()}},GA=class extends D{constructor(){super({id:`editor.action.pageUpHover`,label:B(1112,`Page Up Hover`),precondition:F.hoverFocused,kbOpts:{kbExpr:F.hoverFocused,primary:11,secondary:[528],weight:100},metadata:{description:B(1113,`Page up the editor hover.`)}})}run(e,t){let n=Yv.get(t);n&&n.pageUp()}},KA=class extends D{constructor(){super({id:`editor.action.pageDownHover`,label:B(1114,`Page Down Hover`),precondition:F.hoverFocused,kbOpts:{kbExpr:F.hoverFocused,primary:12,secondary:[530],weight:100},metadata:{description:B(1115,`Page down the editor hover.`)}})}run(e,t){let n=Yv.get(t);n&&n.pageDown()}},qA=class extends D{constructor(){super({id:`editor.action.goToTopHover`,label:B(1116,`Go To Top Hover`),precondition:F.hoverFocused,kbOpts:{kbExpr:F.hoverFocused,primary:14,secondary:[2064],weight:100},metadata:{description:B(1117,`Go to the top of the editor hover.`)}})}run(e,t){let n=Yv.get(t);n&&n.goToTop()}},JA=class extends D{constructor(){super({id:`editor.action.goToBottomHover`,label:B(1118,`Go To Bottom Hover`),precondition:F.hoverFocused,kbOpts:{kbExpr:F.hoverFocused,primary:13,secondary:[2066],weight:100},metadata:{description:B(1119,`Go to the bottom of the editor hover.`)}})}run(e,t){let n=Yv.get(t);n&&n.goToBottom()}},YA=class extends D{constructor(){super({id:yh,label:bh,alias:`Increase Hover Verbosity Level`,precondition:F.hoverVisible})}run(e,t,n){let r=Yv.get(t);if(!r)return;let i=n?.index===void 0?r.focusedHoverPartIndex():n.index;r.updateHoverVerbosityLevel(iu.Increase,i,n?.focus)}},XA=class extends D{constructor(){super({id:xh,label:Sh,alias:`Decrease Hover Verbosity Level`,precondition:F.hoverVisible})}run(e,t,n){let r=Yv.get(t);if(!r)return;let i=n?.index===void 0?r.focusedHoverPartIndex():n.index;Yv.get(t)?.updateHoverVerbosityLevel(iu.Decrease,i,n?.focus)}},ZA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},QA=function(e,t){return function(n,r){t(n,r,e)}},$A=I,ej=class{constructor(e,t,n){this.owner=e,this.range=t,this.marker=n}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}},tj={type:1,filter:{include:jp.QuickFix},triggerAction:Mp.QuickFixHover},nj=class{constructor(e,t,n,r){this._editor=e,this._markerDecorationsService=t,this._openerService=n,this._languageFeaturesService=r,this.hoverOrdinal=1,this.recentMarkerCodeActionsInfo=void 0}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1&&!e.supportsMarkerHover)return[];let n=this._editor.getModel(),r=e.range;if(!n.isValidRange(e.range))return[];let i=r.startLineNumber,a=n.getLineMaxColumn(i),o=[];for(let r of t){let t=r.range.startLineNumber===i?r.range.startColumn:1,s=r.range.endLineNumber===i?r.range.endColumn:a,c=this._markerDecorationsService.getMarker(n.uri,r);if(!c)continue;let l=new S(e.range.startLineNumber,t,e.range.startLineNumber,s);o.push(new ej(this,l,c))}return o}renderHoverParts(e,t){if(!t.length)return new eh([]);let n=[];t.forEach(t=>{let r=this._renderMarkerHover(t);e.fragment.appendChild(r.hoverElement),n.push(r)});let r=t.length===1?t[0]:t.sort((e,t)=>Qs.compare(e.marker.severity,t.marker.severity))[0],i=this._renderMarkerStatusbar(e,r);return new eh(n,i)}_renderMarkerHover(e){let t=new P,n=$A(`div.hover-row`),r=V(n,$A(`div.marker.hover-contents`)),{source:i,message:a,code:o,relatedInformation:s}=e.marker;this._editor.applyFontInfo(r);let c=V(r,$A(`span`));if(c.style.whiteSpace=`pre-wrap`,c.innerText=a,i||o)if(o&&typeof o!=`string`){let e=$A(`span`);if(i){let t=V(e,$A(`span`));t.innerText=i}let n=V(e,$A(`a.code-link`));n.setAttribute(`href`,o.target.toString(!0)),t.add(U(n,`click`,e=>{this._openerService.open(o.target,{allowCommands:!0}),e.preventDefault(),e.stopPropagation()}));let a=V(n,$A(`span`));a.innerText=o.value;let s=V(r,e);s.style.opacity=`0.6`,s.style.paddingLeft=`6px`}else{let e=V(r,$A(`span`));e.style.opacity=`0.6`,e.style.paddingLeft=`6px`,e.innerText=i&&o?`${i}(${o})`:i||`(${o})`}if(Ht(s))for(let{message:e,resource:n,startLineNumber:i,startColumn:a}of s){let o=V(r,$A(`div`));o.style.marginTop=`8px`;let s=V(o,$A(`a`));s.innerText=`${nu(n)}(${i}, ${a}): `,s.style.cursor=`pointer`,t.add(U(s,`click`,e=>{if(e.stopPropagation(),e.preventDefault(),this._openerService){let e={selection:{startLineNumber:i,startColumn:a}};this._openerService.open(n,{fromUserGesture:!0,editorOptions:e}).catch(rr)}}));let c=V(o,$A(`span`));c.innerText=e,this._editor.applyFontInfo(c)}return{hoverPart:e,hoverElement:n,dispose:()=>t.dispose()}}_renderMarkerStatusbar(e,t){let n=new P;if(t.marker.severity===Qs.Error||t.marker.severity===Qs.Warning||t.marker.severity===Qs.Info){let n=kA.get(this._editor);n&&e.statusBar.addAction({label:H(1129,`View Problem`),commandId:jA.ID,run:()=>{e.hide(),n.showAtMarker(t.marker),this._editor.focus()}})}if(!this._editor.getOption(103)){let r=e.statusBar.append($A(`div`));this.recentMarkerCodeActionsInfo&&(Le.makeKey(this.recentMarkerCodeActionsInfo.marker)===Le.makeKey(t.marker)?this.recentMarkerCodeActionsInfo.hasCodeActions||(r.textContent=H(1130,`No quick fixes available`)):this.recentMarkerCodeActionsInfo=void 0);let i=this.recentMarkerCodeActionsInfo&&!this.recentMarkerCodeActionsInfo.hasCodeActions?b.None:Qr(()=>r.textContent=H(1131,`Checking for quick fixes...`),200,n);r.textContent||=`\xA0`;let a=this.getCodeActions(t.marker);n.add(pl(()=>a.cancel())),a.then(a=>{if(i.dispose(),this.recentMarkerCodeActionsInfo={marker:t.marker,hasCodeActions:a.validActions.length>0},!this.recentMarkerCodeActionsInfo.hasCodeActions){a.dispose(),r.textContent=H(1132,`No quick fixes available`);return}r.style.display=`none`;let o=!1;n.add(pl(()=>{o||a.dispose()})),e.statusBar.addAction({label:H(1133,`Quick Fix...`),commandId:zp,run:t=>{o=!0;let n=Em.get(this._editor),r=qc(t);e.hide(),n?.showCodeActions(tj,a,{x:r.left,y:r.top,width:r.width,height:r.height})}});let s=a.validActions.find(e=>e.action.isAI);s&&e.statusBar.addAction({label:s.action.title,commandId:s.action.command?.id??``,iconClass:X.asClassName(J.sparkle),run:()=>{Em.get(this._editor)?.applyCodeAction(s,!1,!1,Zp.FromProblemsHover)}}),e.onContentsChanged()},rr)}return n}getCodeActions(e){return bu(t=>qp(this._languageFeaturesService.codeActionProvider,this._editor.getModel(),new S(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),tj,Vo.None,t))}};nj=ZA([QA(1,Bt),QA(2,cl),QA(3,W)],nj);var rj=class{constructor(e){this._editor=e}computeSync(e){let t=e=>({value:e}),n=this._editor.getLineDecorations(e.lineNumber),r=[],i=e.laneOrLine===`lineNo`;if(!n)return r;for(let a of n){let n=a.options.glyphMargin?.position??v.Center;if(!i&&n!==e.laneOrLine)continue;let o=i?a.options.lineNumberHoverMessage:a.options.glyphMarginHoverMessage;if(!o||Ln(o))continue;r.push(...un(o).map(t))}return r}},ij=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},aj=function(e,t){return function(n,r){t(n,r,e)}},oj,sj=I,cj=class extends b{static{oj=this}static{this.ID=`editor.contrib.modesGlyphHoverWidget`}constructor(e,t,n){super(),this._renderDisposeables=this._register(new P),this._editor=e,this._isVisible=!1,this._messages=[],this._hover=this._register(new pa(!0)),this._hover.containerDomNode.classList.toggle(`hidden`,!this._isVisible),this._markdownRenderer=new $r({editor:this._editor},t,n),this._hoverOperation=this._register(new Bh(this._editor,new rj(this._editor))),this._register(this._hoverOperation.onResult(e=>this._withResult(e))),this._register(this._editor.onDidChangeModelDecorations(()=>this._onModelDecorationsChanged())),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(59)&&this._updateFont()})),this._register(Ma(this._hover.containerDomNode,`mouseleave`,e=>{this._onMouseLeave(e)})),this._editor.addOverlayWidget(this)}dispose(){this._hoverComputerOptions=void 0,this._editor.removeOverlayWidget(this),super.dispose()}getId(){return oj.ID}getDomNode(){return this._hover.containerDomNode}getPosition(){return null}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName(`code`)).forEach(e=>this._editor.applyFontInfo(e))}_onModelDecorationsChanged(){this._isVisible&&this._hoverComputerOptions&&(this._hoverOperation.cancel(),this._hoverOperation.start(0,this._hoverComputerOptions))}showsOrWillShow(e){let t=e.target;return t.type===2&&t.detail.glyphMarginLane?(this._startShowingAt(t.position.lineNumber,t.detail.glyphMarginLane),!0):t.type===3?(this._startShowingAt(t.position.lineNumber,`lineNo`),!0):!1}_startShowingAt(e,t){this._hoverComputerOptions&&this._hoverComputerOptions.lineNumber===e&&this._hoverComputerOptions.laneOrLine===t||(this._hoverOperation.cancel(),this.hide(),this._hoverComputerOptions={lineNumber:e,laneOrLine:t},this._hoverOperation.start(0,this._hoverComputerOptions))}hide(){this._hoverComputerOptions=void 0,this._hoverOperation.cancel(),this._isVisible&&(this._isVisible=!1,this._hover.containerDomNode.classList.toggle(`hidden`,!this._isVisible))}_withResult(e){this._messages=e.value,this._messages.length>0?this._renderMessages(e.options.lineNumber,e.options.laneOrLine,this._messages):this.hide()}_renderMessages(e,t,n){this._renderDisposeables.clear();let r=document.createDocumentFragment();for(let e of n){let t=sj(`div.hover-row.markdown-hover`),n=V(t,sj(`div.hover-contents`)),i=this._renderDisposeables.add(this._markdownRenderer.render(e.value));n.appendChild(i.element),r.appendChild(t)}this._updateContents(r),this._showAt(e,t)}_updateContents(e){this._hover.contentsDomNode.textContent=``,this._hover.contentsDomNode.appendChild(e),this._updateFont()}_showAt(e,t){this._isVisible||(this._isVisible=!0,this._hover.containerDomNode.classList.toggle(`hidden`,!this._isVisible));let n=this._editor.getLayoutInfo(),r=this._editor.getTopForLineNumber(e),i=this._editor.getScrollTop(),a=this._editor.getOption(75),o=this._hover.containerDomNode.clientHeight,s=r-i-(o-a)/2,c=n.glyphMarginLeft+n.glyphMarginWidth+(t===`lineNo`?n.lineNumbersWidth:0);this._hover.containerDomNode.style.left=`${c}px`,this._hover.containerDomNode.style.top=`${Math.max(Math.round(s),0)}px`,this._hover.containerDomNode.style.zIndex=`11`}_onMouseLeave(e){let t=this._editor.getDomNode();(!t||!Rh(t,e.x,e.y))&&this.hide()}};cj=oj=ij([aj(1,ui),aj(2,cl)],cj);var lj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},uj=function(e,t){return function(n,r){t(n,r,e)}},dj=class extends b{static{this.ID=`editor.contrib.marginHover`}constructor(e,t){super(),this._editor=e,this._instantiationService=t,this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new P,this._hoverState={mouseDown:!1},this._reactToEditorMouseMoveRunner=this._register(new ju(()=>this._reactToEditorMouseMove(this._mouseMoveEvent),0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(69)&&(this._unhookListeners(),this._hookListeners())}))}_hookListeners(){let e=this._editor.getOption(69);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled?(this._listenersStore.add(this._editor.onMouseDown(e=>this._onEditorMouseDown(e))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._listenersStore.add(this._editor.onKeyDown(e=>this._onKeyDown(e)))):(this._listenersStore.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._listenersStore.add(this._editor.onKeyDown(e=>this._onKeyDown(e)))),this._listenersStore.add(this._editor.onMouseLeave(e=>this._onEditorMouseLeave(e))),this._listenersStore.add(this._editor.onDidChangeModel(()=>{this._cancelScheduler(),this.hideGlyphHover()})),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(e=>this._onEditorScrollChanged(e)))}_unhookListeners(){this._listenersStore.clear()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this.hideGlyphHover()}_onEditorMouseDown(e){this._hoverState.mouseDown=!0,!this._isMouseOnGlyphHoverWidget(e)&&this.hideGlyphHover()}_isMouseOnGlyphHoverWidget(e){let t=this._glyphWidget?.getDomNode();return t?Rh(t,e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._hoverState.mouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),!this._isMouseOnGlyphHoverWidget(e)&&this.hideGlyphHover())}_shouldNotRecomputeCurrentHoverWidget(e){let t=this._hoverSettings.sticky,n=this._isMouseOnGlyphHoverWidget(e);return t&&n}_onEditorMouseMove(e){if(!this.shouldKeepOpenOnEditorMouseMoveOrLeave){if(this._mouseMoveEvent=e,this._shouldNotRecomputeCurrentHoverWidget(e)){this._reactToEditorMouseMoveRunner.cancel();return}this._reactToEditorMouseMove(e)}}_reactToEditorMouseMove(e){e&&(this._tryShowHoverWidget(e)||this.hideGlyphHover())}_tryShowHoverWidget(e){return this._getOrCreateGlyphWidget().showsOrWillShow(e)}_onKeyDown(e){this._editor.hasModel()&&(e.keyCode===5||e.keyCode===6||e.keyCode===57||e.keyCode===4||this.hideGlyphHover())}hideGlyphHover(){this._glyphWidget?.hide()}_getOrCreateGlyphWidget(){return this._glyphWidget||=this._instantiationService.createInstance(cj,this._editor),this._glyphWidget}dispose(){super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),this._glyphWidget?.dispose()}};dj=lj([uj(1,k)],dj);var fj=class{},pj=class{},mj=class{};G(Yv.ID,Yv,2),G(dj.ID,dj,2),s(RA),s(zA),s(BA),s(VA),s(HA),s(UA),s(WA),s(GA),s(KA),s(qA),s(JA),s(YA),s(XA),th.register(mg),th.register(nj),ul((e,t)=>{let n=e.getColor(tc);n&&(t.addRule(`.monaco-editor .monaco-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${n.transparent(.5)}; }`),t.addRule(`.monaco-editor .monaco-hover hr { border-top: 1px solid ${n.transparent(.5)}; }`),t.addRule(`.monaco-editor .monaco-hover hr { border-bottom: 0px solid ${n.transparent(.5)}; }`))}),uC.register(new fj),uC.register(new pj),uC.register(new mj);function hj(e,t){let n=0;for(let r=0;r<e.length;r++)e.charAt(r)===`	`?n+=t:n++;return n}function gj(e,t,n){e=e<0?0:e;let r=``;if(!n){let n=Math.floor(e/t);e%=t;for(let e=0;e<n;e++)r+=`	`}for(let t=0;t<e;t++)r+=` `;return r}function _j(e,t,n,r){if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return[];let i=t.getLanguageConfiguration(e.getLanguageId()).indentRulesSupport;if(!i)return[];let a=new _l(e,i,t);for(r=Math.min(r,e.getLineCount());n<=r&&a.shouldIgnore(n);)n++;if(n>r-1)return[];let{tabSize:o,indentSize:s,insertSpaces:c}=e.getOptions(),l=(e,t)=>(t||=1,Bl.shiftIndent(e,e.length+t,o,s,c)),u=(e,t)=>(t||=1,Bl.unshiftIndent(e,e.length+t,o,s,c)),d=[],f=e.getLineContent(n),p=ji(f),m=p;a.shouldIncrease(n)?(m=l(m),p=l(p)):a.shouldIndentNextLine(n)&&(m=l(m)),n++;for(let t=n;t<=r;t++){if(vj(e,t))continue;let n=e.getLineContent(t),r=ji(n),i=m;a.shouldDecrease(t,i)&&(m=u(m),p=u(p)),r!==m&&d.push(gc.replaceMove(new N(t,1,t,r.length+1),zo(m,s,c))),!a.shouldIgnore(t)&&(a.shouldIncrease(t,i)?(p=l(p),m=p):m=a.shouldIndentNextLine(t,i)?l(m):p)}return d}function vj(e,t){return e.tokenization.isCheapToTokenize(t)?e.tokenization.getLineTokens(t).getStandardTokenType(0)===2:!1}var yj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},bj=function(e,t){return function(n,r){t(n,r,e)}},xj=class e extends D{static{this.ID=`editor.action.indentationToSpaces`}constructor(){super({id:e.ID,label:B(1138,`Convert Indentation to Spaces`),precondition:F.writable,metadata:{description:B(1139,`Convert the tab indentation to spaces.`)}})}run(e,t){let n=t.getModel();if(!n)return;let r=n.getOptions(),i=t.getSelection();if(!i)return;let a=new Pj(i,r.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[a]),t.pushUndoStop(),n.updateOptions({insertSpaces:!0})}},Sj=class e extends D{static{this.ID=`editor.action.indentationToTabs`}constructor(){super({id:e.ID,label:B(1140,`Convert Indentation to Tabs`),precondition:F.writable,metadata:{description:B(1141,`Convert the spaces indentation to tabs.`)}})}run(e,t){let n=t.getModel();if(!n)return;let r=n.getOptions(),i=t.getSelection();if(!i)return;let a=new Fj(i,r.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[a]),t.pushUndoStop(),n.updateOptions({insertSpaces:!1})}},Cj=class extends D{constructor(e,t,n){super(n),this.insertSpaces=e,this.displaySizeOnly=t}run(e,t){let n=e.get(xe),r=e.get(Fi),i=t.getModel();if(!i)return;let a=r.getCreationOptions(i.getLanguageId(),i.uri,i.isForSimpleWidget),o=i.getOptions(),s=[1,2,3,4,5,6,7,8].map(e=>({id:e.toString(),label:e.toString(),description:e===a.tabSize&&e===o.tabSize?H(1134,`Configured Tab Size`):e===a.tabSize?H(1135,`Default Tab Size`):e===o.tabSize?H(1136,`Current Tab Size`):void 0})),c=Math.min(i.getOptions().tabSize-1,7);setTimeout(()=>{n.pick(s,{placeHolder:H(1137,`Select Tab Size for Current File`),activeItem:s[c]}).then(e=>{if(e&&i&&!i.isDisposed()){let t=parseInt(e.label,10);this.displaySizeOnly?i.updateOptions({tabSize:t}):i.updateOptions({tabSize:t,indentSize:t,insertSpaces:this.insertSpaces})}})},50)}},wj=class e extends Cj{static{this.ID=`editor.action.indentUsingTabs`}constructor(){super(!1,!1,{id:e.ID,label:B(1142,`Indent Using Tabs`),precondition:void 0,metadata:{description:B(1143,`Use indentation with tabs.`)}})}},Tj=class e extends Cj{static{this.ID=`editor.action.indentUsingSpaces`}constructor(){super(!0,!1,{id:e.ID,label:B(1144,`Indent Using Spaces`),precondition:void 0,metadata:{description:B(1145,`Use indentation with spaces.`)}})}},Ej=class e extends Cj{static{this.ID=`editor.action.changeTabDisplaySize`}constructor(){super(!0,!0,{id:e.ID,label:B(1146,`Change Tab Display Size`),precondition:void 0,metadata:{description:B(1147,`Change the space size equivalent of the tab.`)}})}},Dj=class e extends D{static{this.ID=`editor.action.detectIndentation`}constructor(){super({id:e.ID,label:B(1148,`Detect Indentation from Content`),precondition:void 0,metadata:{description:B(1149,`Detect the indentation from content.`)}})}run(e,t){let n=e.get(Fi),r=t.getModel();if(!r)return;let i=n.getCreationOptions(r.getLanguageId(),r.uri,r.isForSimpleWidget);r.detectIndentation(i.insertSpaces,i.tabSize)}},Oj=class extends D{constructor(){super({id:`editor.action.reindentlines`,label:B(1150,`Reindent Lines`),precondition:F.writable,metadata:{description:B(1151,`Reindent the lines of the editor.`)}})}run(e,t){let n=e.get(Ar),r=t.getModel();if(!r)return;let i=_j(r,n,1,r.getLineCount());i.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,i),t.pushUndoStop())}},kj=class extends D{constructor(){super({id:`editor.action.reindentselectedlines`,label:B(1152,`Reindent Selected Lines`),precondition:F.writable,metadata:{description:B(1153,`Reindent the selected lines of the editor.`)}})}run(e,t){let n=e.get(Ar),r=t.getModel();if(!r)return;let i=t.getSelections();if(i===null)return;let a=[];for(let e of i){let t=e.startLineNumber,i=e.endLineNumber;if(t!==i&&e.endColumn===1&&i--,t===1){if(t===i)continue}else t--;let o=_j(r,n,t,i);a.push(...o)}a.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,a),t.pushUndoStop())}},Aj=class{constructor(e,t){this._initialSelection=t,this._edits=[],this._selectionId=null;for(let t of e)t.range&&typeof t.text==`string`&&this._edits.push(t)}getEditOperations(e,t){for(let e of this._edits)t.addEditOperation(S.lift(e.range),e.text);let n=!1;Array.isArray(this._edits)&&this._edits.length===1&&this._initialSelection.isEmpty()&&(this._edits[0].range.startColumn===this._initialSelection.endColumn&&this._edits[0].range.startLineNumber===this._initialSelection.endLineNumber?(n=!0,this._selectionId=t.trackSelection(this._initialSelection,!0)):this._edits[0].range.endColumn===this._initialSelection.startColumn&&this._edits[0].range.endLineNumber===this._initialSelection.startLineNumber&&(n=!0,this._selectionId=t.trackSelection(this._initialSelection,!1))),n||(this._selectionId=t.trackSelection(this._initialSelection))}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}},jj=class{static{this.ID=`editor.contrib.autoIndentOnPaste`}constructor(e,t){this.editor=e,this._languageConfigurationService=t,this.callOnDispose=new P,this.callOnModel=new P,this.callOnDispose.add(e.onDidChangeConfiguration(()=>this.update())),this.callOnDispose.add(e.onDidChangeModel(()=>this.update())),this.callOnDispose.add(e.onDidChangeModelLanguage(()=>this.update()))}update(){this.callOnModel.clear(),!(!this.editor.getOption(17)||this.editor.getOption(16)<4)&&this.editor.hasModel()&&this.callOnModel.add(this.editor.onDidPaste(({range:e})=>{this.trigger(e)}))}trigger(e){let t=this.editor.getSelections();if(t===null||t.length>1)return;let n=this.editor.getModel();if(!n||this.rangeContainsOnlyWhitespaceCharacters(n,e)||!this.editor.getOption(18)&&Mj(n,e)||!n.tokenization.isCheapToTokenize(e.getStartPosition().lineNumber))return;let r=this.editor.getOption(16),{tabSize:i,indentSize:a,insertSpaces:o}=n.getOptions(),s=[],l={shiftIndent:e=>Bl.shiftIndent(e,e.length+1,i,a,o),unshiftIndent:e=>Bl.unshiftIndent(e,e.length+1,i,a,o)},u=e.startLineNumber,d=n.getLineContent(u);if(!/\S/.test(d.substring(0,e.startColumn-1))){let e=c(r,n,n.getLanguageId(),u,l,this._languageConfigurationService);if(e!==null){let t=ji(d),r=hj(e,i),a=hj(t,i);if(r!==a){let e=gj(r,i,o);s.push({range:new S(u,1,u,t.length+1),text:e}),d=e+d.substring(t.length)}else{let e=Oo(n,u,this._languageConfigurationService);if(e===0||e===8)return}}}let f=u;for(;u<e.endLineNumber;){if(!/\S/.test(n.getLineContent(u+1))){u++;continue}break}if(u!==e.endLineNumber){let t=c(r,{tokenization:{getLineTokens:e=>n.tokenization.getLineTokens(e),getLanguageId:()=>n.getLanguageId(),getLanguageIdAtPosition:(e,t)=>n.getLanguageIdAtPosition(e,t)},getLineContent:e=>e===f?d:n.getLineContent(e)},n.getLanguageId(),u+1,l,this._languageConfigurationService);if(t!==null){let r=hj(t,i),a=hj(ji(n.getLineContent(u+1)),i);if(r!==a){let t=r-a;for(let r=u+1;r<=e.endLineNumber;r++){let e=n.getLineContent(r),a=ji(e),c=hj(a,i)+t,l=gj(c,i,o);l!==a&&s.push({range:new S(r,1,r,a.length+1),text:l})}}}}if(s.length>0){this.editor.pushUndoStop();let e=new Aj(s,this.editor.getSelection());this.editor.executeCommand(`autoIndentOnPaste`,e),this.editor.pushUndoStop()}}rangeContainsOnlyWhitespaceCharacters(e,t){let n=e=>e.trim().length===0,r=!0;if(t.startLineNumber===t.endLineNumber){let i=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);r=n(i)}else for(let i=t.startLineNumber;i<=t.endLineNumber;i++){let a=e.getLineContent(i);if(i===t.startLineNumber){let e=a.substring(t.startColumn-1);r=n(e)}else if(i===t.endLineNumber){let e=a.substring(0,t.endColumn-1);r=n(e)}else r=e.getLineFirstNonWhitespaceColumn(i)===0;if(!r)break}return r}dispose(){this.callOnDispose.dispose(),this.callOnModel.dispose()}};jj=yj([bj(1,Ar)],jj);function Mj(e,t){let n=t=>kc(e,t)===2;return n(t.getStartPosition())||n(t.getEndPosition())}function Nj(e,t,n,r){if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return;let i=``;for(let e=0;e<n;e++)i+=` `;let a=new RegExp(i,`gi`);for(let n=1,o=e.getLineCount();n<=o;n++){let o=e.getLineFirstNonWhitespaceColumn(n);if(o===0&&(o=e.getLineMaxColumn(n)),o===1)continue;let s=new S(n,1,n,o),c=e.getValueInRange(s),l=r?c.replace(/\t/gi,i):c.replace(a,`	`);t.addEditOperation(s,l)}}var Pj=class{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),Nj(e,t,this.tabSize,!0)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}},Fj=class{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),Nj(e,t,this.tabSize,!1)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}};G(jj.ID,jj,2),s(xj),s(Sj),s(wj),s(Tj),s(Ej),s(Dj),s(Oj),s(kj),G(kv.ID,kv,1),th.register(Pv);var Ij=class{constructor(e,t,n){this._editRange=e,this._originalSelection=t,this._text=n}getEditOperations(e,t){t.addTrackedEditOperation(this._editRange,this._text)}computeCursorState(e,t){let n=t.getInverseEditOperations()[0].range;return this._originalSelection.isEmpty()?new N(n.endLineNumber,Math.min(this._originalSelection.positionColumn,n.endColumn),n.endLineNumber,Math.min(this._originalSelection.positionColumn,n.endColumn)):new N(n.endLineNumber,n.endColumn-this._text.length,n.endLineNumber,n.endColumn)}},Lj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Rj=function(e,t){return function(n,r){t(n,r,e)}},zj,Bj=class{static{zj=this}static{this.ID=`editor.contrib.inPlaceReplaceController`}static get(e){return e.getContribution(zj.ID)}static{this.DECORATION=R.register({description:`in-place-replace`,className:`valueSetReplacement`})}constructor(e,t){this.editor=e,this.editorWorkerService=t,this.decorations=this.editor.createDecorationsCollection()}dispose(){}run(e,t){this.currentRequest?.cancel();let n=this.editor.getSelection(),r=this.editor.getModel();if(!r||!n)return;let i=n;if(i.startLineNumber!==i.endLineNumber)return;let a=new he(this.editor,5),o=r.uri;return this.editorWorkerService.canNavigateValueSet(o)?(this.currentRequest=bu(e=>this.editorWorkerService.navigateValueSet(o,i,t)),this.currentRequest.then(t=>{if(!t||!t.range||!t.value||!a.validate(this.editor))return;let n=S.lift(t.range),r=t.range,o=t.value.length-(i.endColumn-i.startColumn);r={startLineNumber:r.startLineNumber,startColumn:r.startColumn,endLineNumber:r.endLineNumber,endColumn:r.startColumn+t.value.length},o>1&&(i=new N(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn+o-1));let s=new Ij(n,i,t.value);this.editor.pushUndoStop(),this.editor.executeCommand(e,s),this.editor.pushUndoStop(),this.decorations.set([{range:r,options:zj.DECORATION}]),this.decorationRemover?.cancel(),this.decorationRemover=qs(350),this.decorationRemover.then(()=>this.decorations.clear()).catch(rr)}).catch(rr)):Promise.resolve(void 0)}};Bj=zj=Lj([Rj(1,ne)],Bj);var Vj=class extends D{constructor(){super({id:`editor.action.inPlaceReplace.up`,label:B(1227,`Replace with Previous Value`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:3159,weight:100}})}run(e,t){let n=Bj.get(t);return n?n.run(this.id,!1):Promise.resolve(void 0)}},Hj=class extends D{constructor(){super({id:`editor.action.inPlaceReplace.down`,label:B(1228,`Replace with Next Value`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:3161,weight:100}})}run(e,t){let n=Bj.get(t);return n?n.run(this.id,!0):Promise.resolve(void 0)}};G(Bj.ID,Bj,4),s(Vj),s(Hj);var Uj=class{constructor(e){this._selection=e,this._selectionId=null}getEditOperations(e,t){let n=Wj(e);n&&t.addEditOperation(n.range,n.text),this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}};function Wj(e){let t=e.getLineCount(),n=e.getLineContent(t),r=fa(n)===-1;if(!(!t||r))return gc.insert(new x(t,e.getLineMaxColumn(t)),e.getEOL())}var Gj=class e extends D{static{this.ID=`editor.action.insertFinalNewLine`}constructor(){super({id:e.ID,label:B(1229,`Insert Final New Line`),precondition:F.writable})}run(e,t,n){let r=t.getSelection();if(r===null)return;let i=new Uj(r);t.pushUndoStop(),t.executeCommands(this.id,[i]),t.pushUndoStop()}};s(Gj),s(class extends D{constructor(){super({id:`expandLineSelection`,label:B(1230,`Expand Line Selection`),precondition:void 0,kbOpts:{weight:0,kbExpr:F.textInputFocus,primary:2090}})}run(e,t,n){if(n||={},!t.hasModel())return;let r=t._getViewModel();r.model.pushStackElement(),r.setCursorStates(n.source,3,Ss.expandLineSelection(r,r.getCursorStates())),r.revealAllCursors(n.source,!0)}});var Kj=class{constructor(e,t,n){this._selection=e,this._cursors=t,this._selectionId=null,this._trimInRegexesAndStrings=n}getEditOperations(e,t){let n=qj(e,this._cursors,this._trimInRegexesAndStrings);for(let e=0,r=n.length;e<r;e++){let r=n[e];t.addEditOperation(r.range,r.text)}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}};function qj(e,t,n){t.sort((e,t)=>e.lineNumber===t.lineNumber?e.column-t.column:e.lineNumber-t.lineNumber);for(let e=t.length-2;e>=0;e--)t[e].lineNumber===t[e+1].lineNumber&&t.splice(e,1);let r=[],i=0,a=0,o=t.length;for(let s=1,c=e.getLineCount();s<=c;s++){let c=e.getLineContent(s),l=c.length+1,u=0;if(a<o&&t[a].lineNumber===s&&(u=t[a].column,a++,u===l)||c.length===0)continue;let d=fa(c),f=0;if(d===-1)f=1;else if(d!==c.length-1)f=d+2;else continue;if(!n){if(!e.tokenization.hasAccurateTokensForLine(s))continue;let t=e.tokenization.getLineTokens(s),n=t.getStandardTokenType(t.findTokenIndexAtOffset(f));if(n===2||n===3)continue}f=Math.max(u,f),r[i++]=gc.delete(new S(s,f,s,l))}return r}var Jj=class{constructor(e,t,n){this._selection=e,this._isCopyingDown=t,this._noop=n||!1,this._selectionDirection=0,this._selectionId=null,this._startLineNumberDelta=0,this._endLineNumberDelta=0}getEditOperations(e,t){let n=this._selection;this._startLineNumberDelta=0,this._endLineNumberDelta=0,n.startLineNumber<n.endLineNumber&&n.endColumn===1&&(this._endLineNumberDelta=1,n=n.setEndPosition(n.endLineNumber-1,e.getLineMaxColumn(n.endLineNumber-1)));let r=[];for(let t=n.startLineNumber;t<=n.endLineNumber;t++)r.push(e.getLineContent(t));let i=r.join(`
`);i===``&&this._isCopyingDown&&(this._startLineNumberDelta++,this._endLineNumberDelta++),this._noop?t.addEditOperation(new S(n.endLineNumber,e.getLineMaxColumn(n.endLineNumber),n.endLineNumber+1,1),n.endLineNumber===e.getLineCount()?``:`
`):this._isCopyingDown?t.addEditOperation(new S(n.startLineNumber,1,n.startLineNumber,1),i+`
`):t.addEditOperation(new S(n.endLineNumber,e.getLineMaxColumn(n.endLineNumber),n.endLineNumber,e.getLineMaxColumn(n.endLineNumber)),`
`+i),this._selectionId=t.trackSelection(n),this._selectionDirection=this._selection.getDirection()}computeCursorState(e,t){let n=t.getTrackedSelection(this._selectionId);if(this._startLineNumberDelta!==0||this._endLineNumberDelta!==0){let e=n.startLineNumber,t=n.startColumn,r=n.endLineNumber,i=n.endColumn;this._startLineNumberDelta!==0&&(e+=this._startLineNumberDelta,t=1),this._endLineNumberDelta!==0&&(r+=this._endLineNumberDelta,i=1),n=N.createWithDirection(e,t,r,i,this._selectionDirection)}return n}},Yj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Xj=function(e,t){return function(n,r){t(n,r,e)}},Zj=class{constructor(e,t,n,r){this._languageConfigurationService=r,this._selection=e,this._isMovingDown=t,this._autoIndent=n,this._selectionId=null,this._moveEndLineSelectionShrink=!1}getEditOperations(e,t){let n=()=>e.getLanguageId(),r=(t,n)=>e.getLanguageIdAtPosition(t,n),i=e.getLineCount();if(this._isMovingDown&&this._selection.endLineNumber===i){this._selectionId=t.trackSelection(this._selection);return}if(!this._isMovingDown&&this._selection.startLineNumber===1){this._selectionId=t.trackSelection(this._selection);return}this._moveEndPositionDown=!1;let a=this._selection;a.startLineNumber<a.endLineNumber&&a.endColumn===1&&(this._moveEndPositionDown=!0,a=a.setEndPosition(a.endLineNumber-1,e.getLineMaxColumn(a.endLineNumber-1)));let{tabSize:o,indentSize:s,insertSpaces:l}=e.getOptions(),u=this.buildIndentConverter(o,s,l);if(a.startLineNumber===a.endLineNumber&&e.getLineMaxColumn(a.startLineNumber)===1){let n=a.startLineNumber,r=this._isMovingDown?n+1:n-1;e.getLineMaxColumn(r)===1?t.addEditOperation(new S(1,1,1,1),null):(t.addEditOperation(new S(n,1,n,1),e.getLineContent(r)),t.addEditOperation(new S(r,1,r,e.getLineMaxColumn(r)),null)),a=new N(r,1,r,1)}else{let i,s;if(this._isMovingDown){i=a.endLineNumber+1,s=e.getLineContent(i),t.addEditOperation(new S(i-1,e.getLineMaxColumn(i-1),i,e.getLineMaxColumn(i)),null);let d=s;if(this.shouldAutoIndent(e,a)){let f=this.matchEnterRule(e,u,o,i,a.startLineNumber-1);if(f!==null){let t=ji(e.getLineContent(i)),n=f+hj(t,o);d=gj(n,o,l)+this.trimStart(s)}else{let t={tokenization:{getLineTokens:t=>t===a.startLineNumber?e.tokenization.getLineTokens(i):e.tokenization.getLineTokens(t),getLanguageId:n,getLanguageIdAtPosition:r},getLineContent:t=>t===a.startLineNumber?e.getLineContent(i):e.getLineContent(t)},f=c(this._autoIndent,t,e.getLanguageIdAtPosition(i,1),a.startLineNumber,u,this._languageConfigurationService);if(f!==null){let t=ji(e.getLineContent(i)),n=hj(f,o),r=hj(t,o);n!==r&&(d=gj(n,o,l)+this.trimStart(s))}}t.addEditOperation(new S(a.startLineNumber,1,a.startLineNumber,1),d+`
`);let p=this.matchEnterRuleMovingDown(e,u,o,a.startLineNumber,i,d);if(p!==null)p!==0&&this.getIndentEditsOfMovingBlock(e,t,a,o,l,p);else{let s={tokenization:{getLineTokens:t=>t===a.startLineNumber?e.tokenization.getLineTokens(i):t>=a.startLineNumber+1&&t<=a.endLineNumber+1?e.tokenization.getLineTokens(t-1):e.tokenization.getLineTokens(t),getLanguageId:n,getLanguageIdAtPosition:r},getLineContent:t=>t===a.startLineNumber?d:t>=a.startLineNumber+1&&t<=a.endLineNumber+1?e.getLineContent(t-1):e.getLineContent(t)},f=c(this._autoIndent,s,e.getLanguageIdAtPosition(i,1),a.startLineNumber+1,u,this._languageConfigurationService);if(f!==null){let n=ji(e.getLineContent(a.startLineNumber)),r=hj(f,o),i=hj(n,o);if(r!==i){let n=r-i;this.getIndentEditsOfMovingBlock(e,t,a,o,l,n)}}}}else t.addEditOperation(new S(a.startLineNumber,1,a.startLineNumber,1),d+`
`)}else if(i=a.startLineNumber-1,s=e.getLineContent(i),t.addEditOperation(new S(i,1,i+1,1),null),t.addEditOperation(new S(a.endLineNumber,e.getLineMaxColumn(a.endLineNumber),a.endLineNumber,e.getLineMaxColumn(a.endLineNumber)),`
`+s),this.shouldAutoIndent(e,a)){let s={tokenization:{getLineTokens:t=>t===i?e.tokenization.getLineTokens(a.startLineNumber):e.tokenization.getLineTokens(t),getLanguageId:n,getLanguageIdAtPosition:r},getLineContent:t=>t===i?e.getLineContent(a.startLineNumber):e.getLineContent(t)},d=this.matchEnterRule(e,u,o,a.startLineNumber,a.startLineNumber-2);if(d!==null)d!==0&&this.getIndentEditsOfMovingBlock(e,t,a,o,l,d);else{let n=c(this._autoIndent,s,e.getLanguageIdAtPosition(a.startLineNumber,1),i,u,this._languageConfigurationService);if(n!==null){let r=ji(e.getLineContent(a.startLineNumber)),i=hj(n,o),s=hj(r,o);if(i!==s){let n=i-s;this.getIndentEditsOfMovingBlock(e,t,a,o,l,n)}}}}}this._selectionId=t.trackSelection(a)}buildIndentConverter(e,t,n){return{shiftIndent:r=>Bl.shiftIndent(r,r.length+1,e,t,n),unshiftIndent:r=>Bl.unshiftIndent(r,r.length+1,e,t,n)}}parseEnterResult(e,t,n,r,i){if(i){let a=i.indentation;i.indentAction===nn.None||i.indentAction===nn.Indent?a=i.indentation+i.appendText:i.indentAction===nn.IndentOutdent?a=i.indentation:i.indentAction===nn.Outdent&&(a=t.unshiftIndent(i.indentation)+i.appendText);let o=e.getLineContent(r);if(this.trimStart(o).indexOf(this.trimStart(a))>=0){let i=ji(e.getLineContent(r)),o=ji(a),s=Oo(e,r,this._languageConfigurationService);s!==null&&s&2&&(o=t.unshiftIndent(o));let c=hj(o,n),l=hj(i,n);return c-l}}return null}matchEnterRuleMovingDown(e,t,n,r,i,a){if(fa(a)>=0){let a=e.getLineMaxColumn(i),o=Ec(this._autoIndent,e,new S(i,a,i,a),this._languageConfigurationService);return this.parseEnterResult(e,t,n,r,o)}else{let i=r-1;for(;i>=1;){let t=e.getLineContent(i);if(fa(t)>=0)break;i--}if(i<1||r>e.getLineCount())return null;let a=e.getLineMaxColumn(i),o=Ec(this._autoIndent,e,new S(i,a,i,a),this._languageConfigurationService);return this.parseEnterResult(e,t,n,r,o)}}matchEnterRule(e,t,n,r,i,a){let o=i;for(;o>=1;){let t;if(t=o===i&&a!==void 0?a:e.getLineContent(o),fa(t)>=0)break;o--}if(o<1||r>e.getLineCount())return null;let s=e.getLineMaxColumn(o),c=Ec(this._autoIndent,e,new S(o,s,o,s),this._languageConfigurationService);return this.parseEnterResult(e,t,n,r,c)}trimStart(e){return e.replace(/^\s+/,``)}shouldAutoIndent(e,t){if(this._autoIndent<4||!e.tokenization.isCheapToTokenize(t.startLineNumber))return!1;let n=e.getLanguageIdAtPosition(t.startLineNumber,1),r=e.getLanguageIdAtPosition(t.endLineNumber,1);return!(n!==r||this._languageConfigurationService.getLanguageConfiguration(n).indentRulesSupport===null)}getIndentEditsOfMovingBlock(e,t,n,r,i,a){for(let o=n.startLineNumber;o<=n.endLineNumber;o++){let s=e.getLineContent(o),c=ji(s),l=hj(c,r)+a,u=gj(l,r,i);u!==c&&(t.addEditOperation(new S(o,1,o,c.length+1),u),o===n.endLineNumber&&n.endColumn<=c.length+1&&u===``&&(this._moveEndLineSelectionShrink=!0))}}computeCursorState(e,t){let n=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(n=n.setEndPosition(n.endLineNumber+1,1)),this._moveEndLineSelectionShrink&&n.startLineNumber<n.endLineNumber&&(n=n.setEndPosition(n.endLineNumber,2)),n}};Zj=Yj([Xj(3,Ar)],Zj);var Qj=class{static{this._COLLATOR=tt.Collator()}constructor(e,t){this.selection=e,this.descending=t,this.selectionId=null}getEditOperations(e,t){let n=eM(e,this.selection,this.descending);n&&t.addEditOperation(n.range,n.text),this.selectionId=t.trackSelection(this.selection)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}static canRun(e,t,n){if(e===null)return!1;let r=$j(e,t,n);if(!r)return!1;for(let e=0,t=r.before.length;e<t;e++)if(r.before[e]!==r.after[e])return!0;return!1}};function $j(e,t,n){let r=t.startLineNumber,i=t.endLineNumber;if(t.endColumn===1&&i--,r>=i)return null;let a=[];for(let t=r;t<=i;t++)a.push(e.getLineContent(t));let o=a.slice(0);return o.sort(Qj._COLLATOR.value.compare),n===!0&&(o=o.reverse()),{startLineNumber:r,endLineNumber:i,before:a,after:o}}function eM(e,t,n){let r=$j(e,t,n);return r?gc.replace(new S(r.startLineNumber,1,r.endLineNumber,e.getLineMaxColumn(r.endLineNumber)),r.after.join(`
`)):null}var tM=class extends D{constructor(e,t){super(t),this.down=e}run(e,t){if(!t.hasModel())return;let n=t.getSelections().map((e,t)=>({selection:e,index:t,ignore:!1}));n.sort((e,t)=>S.compareRangesUsingStarts(e.selection,t.selection));let r=n[0];for(let e=1;e<n.length;e++){let t=n[e];r.selection.endLineNumber===t.selection.startLineNumber&&(r.index<t.index?t.ignore=!0:(r.ignore=!0,r=t))}let i=[];for(let e of n)i.push(new Jj(e.selection,this.down,e.ignore));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},nM=class extends tM{constructor(){super(!1,{id:`editor.action.copyLinesUpAction`,label:B(1236,`Copy Line Up`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:1552,linux:{primary:3600},weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`2_line`,title:H(1231,`&&Copy Line Up`),order:1}})}},rM=class extends tM{constructor(){super(!0,{id:`editor.action.copyLinesDownAction`,label:B(1237,`Copy Line Down`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:1554,linux:{primary:3602},weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`2_line`,title:H(1232,`Co&&py Line Down`),order:2}})}},iM=class extends D{constructor(){super({id:`editor.action.duplicateSelection`,label:B(1238,`Duplicate Selection`),precondition:F.writable,menuOpts:{menuId:M.MenubarSelectionMenu,group:`2_line`,title:H(1233,`&&Duplicate Selection`),order:5}})}run(e,t,n){if(!t.hasModel())return;let r=[],i=t.getSelections(),a=t.getModel();for(let e of i)if(e.isEmpty())r.push(new Jj(e,!0));else{let t=new N(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn);r.push(new Zl(t,a.getValueInRange(e)))}t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}},aM=class extends D{constructor(e,t){super(t),this.down=e}run(e,t){let n=e.get(Ar),r=[],i=t.getSelections()||[],a=t.getOption(16);for(let e of i)r.push(new Zj(e,this.down,a,n));t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}},oM=class extends aM{constructor(){super(!1,{id:`editor.action.moveLinesUpAction`,label:B(1239,`Move Line Up`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:528,linux:{primary:528},weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`2_line`,title:H(1234,`Mo&&ve Line Up`),order:3}})}},sM=class extends aM{constructor(){super(!0,{id:`editor.action.moveLinesDownAction`,label:B(1240,`Move Line Down`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:530,linux:{primary:530},weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`2_line`,title:H(1235,`Move &&Line Down`),order:4}})}},cM=class extends D{constructor(e,t){super(t),this.descending=e}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=t.getSelections();r.length===1&&r[0].isEmpty()&&(r=[new N(1,1,n.getLineCount(),n.getLineMaxColumn(n.getLineCount()))]);for(let e of r)if(!Qj.canRun(t.getModel(),e,this.descending))return;let i=[];for(let e=0,t=r.length;e<t;e++)i[e]=new Qj(r[e],this.descending);t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},lM=class extends cM{constructor(){super(!1,{id:`editor.action.sortLinesAscending`,label:B(1241,`Sort Lines Ascending`),precondition:F.writable})}},uM=class extends cM{constructor(){super(!0,{id:`editor.action.sortLinesDescending`,label:B(1242,`Sort Lines Descending`),precondition:F.writable})}},dM=class extends D{constructor(){super({id:`editor.action.removeDuplicateLines`,label:B(1243,`Delete Duplicate Lines`),precondition:F.writable})}run(e,t){if(!t.hasModel())return;let n=t.getModel();if(n.getLineCount()===1&&n.getLineMaxColumn(1)===1)return;let r=[],i=[],a=0,o=!0,s=t.getSelections();s.length===1&&s[0].isEmpty()&&(s=[new N(1,1,n.getLineCount(),n.getLineMaxColumn(n.getLineCount()))],o=!1);for(let e of s){let t=new Set,o=[];for(let r=e.startLineNumber;r<=e.endLineNumber;r++){let e=n.getLineContent(r);t.has(e)||(o.push(e),t.add(e))}let s=new N(e.startLineNumber,1,e.endLineNumber,n.getLineMaxColumn(e.endLineNumber)),c=e.startLineNumber-a,l=new N(c,1,c+o.length-1,o[o.length-1].length);r.push(gc.replace(s,o.join(`
`))),i.push(l),a+=e.endLineNumber-e.startLineNumber+1-o.length}t.pushUndoStop(),t.executeEdits(this.id,r,o?i:void 0),t.pushUndoStop()}},fM=class extends D{constructor(){super({id:`editor.action.reverseLines`,label:B(1244,`Reverse lines`),precondition:F.writable})}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=t.getSelections(),i=r;i.length===1&&i[0].isEmpty()&&(i=[new N(1,1,n.getLineCount(),n.getLineMaxColumn(n.getLineCount()))]);let a=[],o=[];for(let e=0;e<i.length;e++){let t=i[e],s=r[e],c=t.endLineNumber;t.startLineNumber<t.endLineNumber&&t.endColumn===1&&c--;let l=new S(t.startLineNumber,1,c,n.getLineMaxColumn(c));c===n.getLineCount()&&n.getLineContent(l.endLineNumber)===``&&(l=l.setEndPosition(l.endLineNumber-1,n.getLineMaxColumn(l.endLineNumber-1)));let u=[];for(let e=l.endLineNumber;e>=l.startLineNumber;e--)u.push(n.getLineContent(e));let d=gc.replace(l,u.join(`
`));a.push(d);let f=function(e){return e<=l.endLineNumber?l.endLineNumber-e+l.startLineNumber:e};o.push(function(e){if(e.isEmpty())return new N(f(e.positionLineNumber),e.positionColumn,f(e.positionLineNumber),e.positionColumn);{let t=f(e.selectionStartLineNumber),n=f(e.positionLineNumber),r=e.selectionStartColumn,i=e.positionColumn;return new N(t,r,n,i)}}(s))}t.pushUndoStop(),t.executeEdits(this.id,a,o),t.pushUndoStop()}},pM=class e extends D{static{this.ID=`editor.action.trimTrailingWhitespace`}constructor(){super({id:e.ID,label:B(1245,`Trim Trailing Whitespace`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:An(2089,2102),weight:100}})}run(e,t,n){let r=[];n.reason===`auto-save`&&(r=(t.getSelections()||[]).map(e=>new x(e.positionLineNumber,e.positionColumn)));let i=t.getSelection();if(i===null)return;let a=e.get(Ni),o=t.getModel(),s=a.getValue(`files.trimTrailingWhitespaceInRegexAndStrings`,{overrideIdentifier:o?.getLanguageId(),resource:o?.uri}),c=new Kj(i,r,s);t.pushUndoStop(),t.executeCommands(this.id,[c]),t.pushUndoStop()}},mM=class extends D{constructor(){super({id:`editor.action.deleteLines`,label:B(1246,`Delete Line`),precondition:F.writable,kbOpts:{kbExpr:F.textInputFocus,primary:3113,weight:100}})}run(e,t){if(!t.hasModel())return;let n=this._getLinesToRemove(t),r=t.getModel();if(r.getLineCount()===1&&r.getLineMaxColumn(1)===1)return;let i=0,a=[],o=[];for(let e=0,t=n.length;e<t;e++){let t=n[e],s=t.startLineNumber,c=t.endLineNumber,l=1,u=r.getLineMaxColumn(c);c<r.getLineCount()?(c+=1,u=1):s>1&&(--s,l=r.getLineMaxColumn(s)),a.push(gc.replace(new N(s,l,c,u),``)),o.push(new N(s-i,t.positionColumn,s-i,t.positionColumn)),i+=t.endLineNumber-t.startLineNumber+1}t.pushUndoStop(),t.executeEdits(this.id,a,o),t.pushUndoStop()}_getLinesToRemove(e){let t=e.getSelections().map(e=>{let t=e.endLineNumber;return e.startLineNumber<e.endLineNumber&&e.endColumn===1&&--t,{startLineNumber:e.startLineNumber,selectionStartColumn:e.selectionStartColumn,endLineNumber:t,positionColumn:e.positionColumn}});t.sort((e,t)=>e.startLineNumber===t.startLineNumber?e.endLineNumber-t.endLineNumber:e.startLineNumber-t.startLineNumber);let n=[],r=t[0];for(let e=1;e<t.length;e++)r.endLineNumber+1>=t[e].startLineNumber?r.endLineNumber=t[e].endLineNumber:(n.push(r),r=t[e]);return n.push(r),n}},hM=class extends D{constructor(){super({id:`editor.action.indentLines`,label:B(1247,`Indent Line`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:2142,weight:100}})}run(e,t){let n=t._getViewModel();n&&(t.pushUndoStop(),t.executeCommands(this.id,ha.indent(n.cursorConfig,t.getModel(),t.getSelections())),t.pushUndoStop())}},gM=class extends D{constructor(){super({id:`editor.action.outdentLines`,label:B(1248,`Outdent Line`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:2140,weight:100}})}run(e,t){ra.Outdent.runEditorCommand(e,t,null)}},_M=class extends D{constructor(){super({id:`editor.action.insertLineBefore`,label:B(1249,`Insert Line Above`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:3075,weight:100}})}run(e,t){let n=t._getViewModel();n&&(t.pushUndoStop(),t.executeCommands(this.id,yr.lineInsertBefore(n.cursorConfig,t.getModel(),t.getSelections())))}},vM=class extends D{constructor(){super({id:`editor.action.insertLineAfter`,label:B(1250,`Insert Line Below`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:2051,weight:100}})}run(e,t){let n=t._getViewModel();n&&(t.pushUndoStop(),t.executeCommands(this.id,yr.lineInsertAfter(n.cursorConfig,t.getModel(),t.getSelections())))}},yM=class extends D{run(e,t){if(!t.hasModel())return;let n=t.getSelection(),r=this._getRangesToDelete(t),i=[];for(let e=0,t=r.length-1;e<t;e++){let t=r[e],n=r[e+1];S.intersectRanges(t,n)===null?i.push(t):r[e+1]=S.plusRange(t,n)}i.push(r[r.length-1]);let a=this._getEndCursorState(n,i),o=i.map(e=>gc.replace(e,``));t.pushUndoStop(),t.executeEdits(this.id,o,a),t.pushUndoStop()}},bM=class extends yM{constructor(){super({id:`deleteAllLeft`,label:B(1251,`Delete All Left`),precondition:F.writable,kbOpts:{kbExpr:F.textInputFocus,primary:0,mac:{primary:2049},weight:100}})}_getEndCursorState(e,t){let n=null,r=[],i=0;return t.forEach(t=>{let a;if(t.endColumn===1&&i>0){let e=t.startLineNumber-i;a=new N(e,t.startColumn,e,t.startColumn)}else a=new N(t.startLineNumber,t.startColumn,t.startLineNumber,t.startColumn);i+=t.endLineNumber-t.startLineNumber,t.intersectRanges(e)?n=a:r.push(a)}),n&&r.unshift(n),r}_getRangesToDelete(e){let t=e.getSelections();if(t===null)return[];let n=t,r=e.getModel();return r===null?[]:(n.sort(S.compareRangesUsingStarts),n=n.map(e=>{if(e.isEmpty())if(e.startColumn===1){let t=Math.max(1,e.startLineNumber-1),n=e.startLineNumber===1?1:r.getLineLength(t)+1;return new S(t,n,e.startLineNumber,1)}else return new S(e.startLineNumber,1,e.startLineNumber,e.startColumn);else return new S(e.startLineNumber,1,e.endLineNumber,e.endColumn)}),n)}},xM=class extends yM{constructor(){super({id:`deleteAllRight`,label:B(1252,`Delete All Right`),precondition:F.writable,kbOpts:{kbExpr:F.textInputFocus,primary:0,mac:{primary:297,secondary:[2068]},weight:100}})}_getEndCursorState(e,t){let n=null,r=[];for(let i=0,a=t.length;i<a;i++){let a=t[i],o=new N(a.startLineNumber-0,a.startColumn,a.startLineNumber-0,a.startColumn);a.intersectRanges(e)?n=o:r.push(o)}return n&&r.unshift(n),r}_getRangesToDelete(e){let t=e.getModel();if(t===null)return[];let n=e.getSelections();if(n===null)return[];let r=n.map(e=>{if(e.isEmpty()){let n=t.getLineMaxColumn(e.startLineNumber);return e.startColumn===n?new S(e.startLineNumber,e.startColumn,e.startLineNumber+1,1):new S(e.startLineNumber,e.startColumn,e.startLineNumber,n)}return e});return r.sort(S.compareRangesUsingStarts),r}},SM=class extends D{constructor(){super({id:`editor.action.joinLines`,label:B(1253,`Join Lines`),precondition:F.writable,kbOpts:{kbExpr:F.editorTextFocus,primary:0,mac:{primary:296},weight:100}})}run(e,t){let n=t.getSelections();if(n===null)return;let r=t.getSelection();if(r===null)return;n.sort(S.compareRangesUsingStarts);let i=[],a=n.reduce((e,t)=>e.isEmpty()?e.endLineNumber===t.startLineNumber?(r.equalsSelection(e)&&(r=t),t):t.startLineNumber>e.endLineNumber+1?(i.push(e),t):new N(e.startLineNumber,e.startColumn,t.endLineNumber,t.endColumn):t.startLineNumber>e.endLineNumber?(i.push(e),t):new N(e.startLineNumber,e.startColumn,t.endLineNumber,t.endColumn));i.push(a);let o=t.getModel();if(o===null)return;let s=[],c=[],l=r,u=0;for(let e=0,t=i.length;e<t;e++){let t=i[e],n=t.startLineNumber,a=0,d,f,p=o.getLineLength(t.endLineNumber)-t.endColumn;if(t.isEmpty()||t.startLineNumber===t.endLineNumber){let e=t.getStartPosition();e.lineNumber<o.getLineCount()?(d=n+1,f=o.getLineMaxColumn(d)):(d=e.lineNumber,f=o.getLineMaxColumn(e.lineNumber))}else d=t.endLineNumber,f=o.getLineMaxColumn(d);let m=o.getLineContent(n);for(let e=n+1;e<=d;e++){let t=o.getLineContent(e),n=o.getLineFirstNonWhitespaceColumn(e);if(n>=1){let e=!0;m===``&&(e=!1),e&&(m.charAt(m.length-1)===` `||m.charAt(m.length-1)===`	`)&&(e=!1,m=m.replace(/[\s\uFEFF\xA0]+$/g,` `));let r=t.substr(n-1);m+=(e?` `:``)+r,a=e?r.length+1:r.length}else a=0}let h=new S(n,1,d,f);if(!h.isEmpty()){let e;t.isEmpty()?(s.push(gc.replace(h,m)),e=new N(h.startLineNumber-u,m.length-a+1,n-u,m.length-a+1)):t.startLineNumber===t.endLineNumber?(s.push(gc.replace(h,m)),e=new N(t.startLineNumber-u,t.startColumn,t.endLineNumber-u,t.endColumn)):(s.push(gc.replace(h,m)),e=new N(t.startLineNumber-u,t.startColumn,t.startLineNumber-u,m.length-p)),S.intersectRanges(h,r)===null?c.push(e):l=e}u+=h.endLineNumber-h.startLineNumber}c.unshift(l),t.pushUndoStop(),t.executeEdits(this.id,s,c),t.pushUndoStop()}},CM=class extends D{constructor(){super({id:`editor.action.transpose`,label:B(1254,`Transpose Characters around the Cursor`),precondition:F.writable})}run(e,t){let n=t.getSelections();if(n===null)return;let r=t.getModel();if(r===null)return;let i=[];for(let e=0,t=n.length;e<t;e++){let t=n[e];if(!t.isEmpty())continue;let a=t.getStartPosition(),o=r.getLineMaxColumn(a.lineNumber);if(a.column>=o){if(a.lineNumber===r.getLineCount())continue;let e=new S(a.lineNumber,Math.max(1,a.column-1),a.lineNumber+1,1),t=r.getValueInRange(e).split(``).reverse().join(``);i.push(new io(new N(a.lineNumber,Math.max(1,a.column-1),a.lineNumber+1,1),t))}else{let e=new S(a.lineNumber,Math.max(1,a.column-1),a.lineNumber,a.column+1),t=r.getValueInRange(e).split(``).reverse().join(``);i.push(new ic(e,t,new N(a.lineNumber,a.column+1,a.lineNumber,a.column+1)))}}t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},wM=class extends D{run(e,t){let n=t.getSelections();if(n===null)return;let r=t.getModel();if(r===null)return;let i=t.getOption(147),a=[];for(let e of n)if(e.isEmpty()){let n=e.getStartPosition(),o=t.getConfiguredWordAtPosition(n);if(!o)continue;let s=new S(n.lineNumber,o.startColumn,n.lineNumber,o.endColumn),c=r.getValueInRange(s);a.push(gc.replace(s,this._modifyText(c,i)))}else{let t=r.getValueInRange(e);a.push(gc.replace(e,this._modifyText(t,i)))}t.pushUndoStop(),t.executeEdits(this.id,a),t.pushUndoStop()}},TM=class extends wM{constructor(){super({id:`editor.action.transformToUppercase`,label:B(1255,`Transform to Uppercase`),precondition:F.writable})}_modifyText(e,t){return e.toLocaleUpperCase()}},EM=class extends wM{constructor(){super({id:`editor.action.transformToLowercase`,label:B(1256,`Transform to Lowercase`),precondition:F.writable})}_modifyText(e,t){return e.toLocaleLowerCase()}},DM=class{constructor(e,t){this._pattern=e,this._flags=t,this._actual=null,this._evaluated=!1}get(){if(!this._evaluated){this._evaluated=!0;try{this._actual=new RegExp(this._pattern,this._flags)}catch{}}return this._actual}isSupported(){return this.get()!==null}},OM=class e extends wM{static{this.titleBoundary=new DM(`(^|[^\\p{L}\\p{N}']|((^|\\P{L})'))\\p{L}`,`gmu`)}constructor(){super({id:`editor.action.transformToTitlecase`,label:B(1257,`Transform to Title Case`),precondition:F.writable})}_modifyText(t,n){let r=e.titleBoundary.get();return r?t.toLocaleLowerCase().replace(r,e=>e.toLocaleUpperCase()):t}},kM=class e extends wM{static{this.caseBoundary=new DM(`(\\p{Ll})(\\p{Lu})`,`gmu`)}static{this.singleLetters=new DM(`(\\p{Lu}|\\p{N})(\\p{Lu})(\\p{Ll})`,`gmu`)}constructor(){super({id:`editor.action.transformToSnakecase`,label:B(1258,`Transform to Snake Case`),precondition:F.writable})}_modifyText(t,n){let r=e.caseBoundary.get(),i=e.singleLetters.get();return!r||!i?t:t.replace(r,`$1_$2`).replace(i,`$1_$2$3`).toLocaleLowerCase()}},AM=class e extends wM{static{this.wordBoundary=new DM(`[_\\s-]`,`gm`)}static{this.validWordStart=new DM(`^(\\p{Lu}[^\\p{Lu}])`,`gmu`)}constructor(){super({id:`editor.action.transformToCamelcase`,label:B(1259,`Transform to Camel Case`),precondition:F.writable})}_modifyText(t,n){let r=e.wordBoundary.get(),i=e.validWordStart.get();if(!r||!i)return t;let a=t.split(r);return a.shift()?.replace(i,e=>e.toLocaleLowerCase())+a.map(e=>e.substring(0,1).toLocaleUpperCase()+e.substring(1)).join(``)}},jM=class e extends wM{static{this.wordBoundary=new DM(`[_\\s-]`,`gm`)}static{this.wordBoundaryToMaintain=new DM(`(?<=\\.)`,`gm`)}constructor(){super({id:`editor.action.transformToPascalcase`,label:B(1260,`Transform to Pascal Case`),precondition:F.writable})}_modifyText(t,n){let r=e.wordBoundary.get(),i=e.wordBoundaryToMaintain.get();return!r||!i?t:t.split(i).map(e=>e.split(r)).flat().map(e=>e.substring(0,1).toLocaleUpperCase()+e.substring(1)).join(``)}},MM=class e extends wM{static isSupported(){return[this.caseBoundary,this.singleLetters,this.underscoreBoundary].every(e=>e.isSupported())}static{this.caseBoundary=new DM(`(\\p{Ll})(\\p{Lu})`,`gmu`)}static{this.singleLetters=new DM(`(\\p{Lu}|\\p{N})(\\p{Lu}\\p{Ll})`,`gmu`)}static{this.underscoreBoundary=new DM(`(\\S)(_)(\\S)`,`gm`)}constructor(){super({id:`editor.action.transformToKebabcase`,label:B(1261,`Transform to Kebab Case`),precondition:F.writable})}_modifyText(t,n){let r=e.caseBoundary.get(),i=e.singleLetters.get(),a=e.underscoreBoundary.get();return!r||!i||!a?t:t.replace(a,`$1-$3`).replace(r,`$1-$2`).replace(i,`$1-$2`).toLocaleLowerCase()}};s(nM),s(rM),s(iM),s(oM),s(sM),s(lM),s(uM),s(dM),s(pM),s(mM),s(hM),s(gM),s(_M),s(vM),s(bM),s(xM),s(SM),s(CM),s(TM),s(EM),s(fM),kM.caseBoundary.isSupported()&&kM.singleLetters.isSupported()&&s(kM),AM.wordBoundary.isSupported()&&s(AM),jM.wordBoundary.isSupported()&&s(jM),OM.titleBoundary.isSupported()&&s(OM),MM.isSupported()&&s(MM);var NM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},PM=function(e,t){return function(n,r){t(n,r,e)}},FM;const IM=new T(`LinkedEditingInputVisible`,!1);var LM=`linked-editing-decoration`,RM=class extends b{static{FM=this}static{this.ID=`editor.contrib.linkedEditing`}static{this.DECORATION=R.register({description:`linked-editing`,stickiness:0,className:LM})}static get(e){return e.getContribution(FM.ID)}constructor(e,t,n,r,i){super(),this.languageConfigurationService=r,this._syncRangesToken=0,this._localToDispose=this._register(new P),this._editor=e,this._providers=n.linkedEditingRangeProvider,this._enabled=!1,this._visibleContextKey=IM.bindTo(t),this._debounceInformation=i.for(this._providers,`Linked Editing`,{max:200}),this._currentDecorations=this._editor.createDecorationsCollection(),this._languageWordPattern=null,this._currentWordPattern=null,this._ignoreChangeEvent=!1,this._localToDispose=this._register(new P),this._rangeUpdateTriggerPromise=null,this._rangeSyncTriggerPromise=null,this._currentRequestCts=null,this._currentRequestPosition=null,this._currentRequestModelVersion=null,this._register(this._editor.onDidChangeModel(()=>this.reinitialize(!0))),this._register(this._editor.onDidChangeConfiguration(e=>{(e.hasChanged(78)||e.hasChanged(105))&&this.reinitialize(!1)})),this._register(this._providers.onDidChange(()=>this.reinitialize(!1))),this._register(this._editor.onDidChangeModelLanguage(()=>this.reinitialize(!0))),this.reinitialize(!0)}reinitialize(e){let t=this._editor.getModel(),n=t!==null&&(this._editor.getOption(78)||this._editor.getOption(105))&&this._providers.has(t);if(n===this._enabled&&!e||(this._enabled=n,this.clearRanges(),this._localToDispose.clear(),!n||t===null))return;this._localToDispose.add(vn.runAndSubscribe(t.onDidChangeLanguageConfiguration,()=>{this._languageWordPattern=this.languageConfigurationService.getLanguageConfiguration(t.getLanguageId()).getWordDefinition()}));let r=new qa(this._debounceInformation.get(t)),i=()=>{this._rangeUpdateTriggerPromise=r.trigger(()=>this.updateRanges(),this._debounceDuration??this._debounceInformation.get(t))},a=new qa(0),o=e=>{this._rangeSyncTriggerPromise=a.trigger(()=>this._syncRanges(e))};this._localToDispose.add(this._editor.onDidChangeCursorPosition(()=>{i()})),this._localToDispose.add(this._editor.onDidChangeModelContent(e=>{if(!this._ignoreChangeEvent&&this._currentDecorations.length>0){let t=this._currentDecorations.getRange(0);if(t&&e.changes.every(e=>t.intersectRanges(e.range))){o(this._syncRangesToken);return}}i()})),this._localToDispose.add({dispose:()=>{r.dispose(),a.dispose()}}),this.updateRanges()}_syncRanges(e){if(!this._editor.hasModel()||e!==this._syncRangesToken||this._currentDecorations.length===0)return;let t=this._editor.getModel(),n=this._currentDecorations.getRange(0);if(!n||n.startLineNumber!==n.endLineNumber)return this.clearRanges();let r=t.getValueInRange(n);if(this._currentWordPattern){let e=r.match(this._currentWordPattern);if((e?e[0].length:0)!==r.length)return this.clearRanges()}let i=[];for(let e=1,n=this._currentDecorations.length;e<n;e++){let n=this._currentDecorations.getRange(e);if(n)if(n.startLineNumber!==n.endLineNumber)i.push({range:n,text:r});else{let e=t.getValueInRange(n),a=r,o=n.startColumn,s=n.endColumn,c=$e(e,a);o+=c,e=e.substr(c),a=a.substr(c);let l=Pt(e,a);s-=l,e=e.substr(0,e.length-l),a=a.substr(0,a.length-l),(o!==s||a.length!==0)&&i.push({range:new S(n.startLineNumber,o,n.endLineNumber,s),text:a})}}if(i.length!==0)try{this._editor.popUndoStop(),this._ignoreChangeEvent=!0;let e=this._editor._getViewModel().getPrevEditOperationType();this._editor.executeEdits(`linkedEditing`,i),this._editor._getViewModel().setPrevEditOperationType(e)}finally{this._ignoreChangeEvent=!1}}dispose(){this.clearRanges(),super.dispose()}clearRanges(){this._visibleContextKey.set(!1),this._currentDecorations.clear(),this._currentRequestCts&&(this._currentRequestCts.cancel(),this._currentRequestCts=null,this._currentRequestPosition=null)}async updateRanges(e=!1){if(!this._editor.hasModel()){this.clearRanges();return}let t=this._editor.getPosition();if(!this._enabled&&!e||this._editor.getSelections().length>1){this.clearRanges();return}let n=this._editor.getModel(),r=n.getVersionId();if(this._currentRequestPosition&&this._currentRequestModelVersion===r){if(t.equals(this._currentRequestPosition))return;if(this._currentDecorations.length>0){let e=this._currentDecorations.getRange(0);if(e&&e.containsPosition(t))return}}this._currentRequestPosition?.equals(t)||this._currentDecorations.getRange(0)?.containsPosition(t)||this.clearRanges(),this._currentRequestPosition=t,this._currentRequestModelVersion=r;let i=this._currentRequestCts=new ur;try{let e=new ad(!1),a=await VM(this._providers,n,t,i.token);if(this._debounceInformation.update(n,e.elapsed()),i!==this._currentRequestCts||(this._currentRequestCts=null,r!==n.getVersionId()))return;let o=[];a?.ranges&&(o=a.ranges),this._currentWordPattern=a?.wordPattern||this._languageWordPattern;let s=!1;for(let e=0,n=o.length;e<n;e++)if(S.containsPosition(o[e],t)){if(s=!0,e!==0){let t=o[e];o.splice(e,1),o.unshift(t)}break}if(!s){this.clearRanges();return}let c=o.map(e=>({range:e,options:FM.DECORATION}));this._visibleContextKey.set(!0),this._currentDecorations.set(c),this._syncRangesToken++}catch(e){Pn(e)||rr(e),(this._currentRequestCts===i||!this._currentRequestCts)&&this.clearRanges()}}};RM=FM=NM([PM(1,w),PM(2,W),PM(3,Ar),PM(4,co)],RM);var zM=class extends D{constructor(){super({id:`editor.action.linkedEditing`,label:B(1263,`Start Linked Editing`),precondition:j.and(F.writable,F.hasRenameProvider),kbOpts:{kbExpr:F.editorTextFocus,primary:3132,weight:100}})}runCommand(e,t){let n=e.get(mt),[r,i]=Array.isArray(t)&&t||[void 0,void 0];return $n.isUri(r)&&x.isIPosition(i)?n.openCodeEditor({resource:r},n.getActiveCodeEditor()).then(e=>{e&&(e.setPosition(i),e.invokeWithinContext(t=>(this.reportTelemetry(t,e),this.run(t,e))))},rr):super.runCommand(e,t)}run(e,t){let n=RM.get(t);return n?Promise.resolve(n.updateRanges(!0)):Promise.resolve()}},BM=Gi.bindToContribution(RM.get);L(new BM({id:`cancelLinkedEditingInput`,precondition:IM,handler:e=>e.clearRanges(),kbOpts:{kbExpr:F.editorTextFocus,weight:199,primary:9,secondary:[1033]}}));function VM(e,t,n,r){let i=e.ordered(t);return Ue(i.map(e=>async()=>{try{return await e.provideLinkedEditingRanges(t,n,r)}catch(e){Ze(e);return}}),e=>!!e&&Ht(e?.ranges))}Y(`editor.linkedEditingBackground`,{dark:z.fromHex(`#f00`).transparent(.3),light:z.fromHex(`#f00`).transparent(.3),hcDark:z.fromHex(`#f00`).transparent(.3),hcLight:z.white},H(1262,`Background color when the editor auto renames on type.`)),Sl(`_executeLinkedEditingProvider`,(e,t,n)=>{let{linkedEditingRangeProvider:r}=e.get(W);return VM(r,t,n,A.None)}),G(RM.ID,RM,1),s(zM);var HM=class{constructor(e,t){this._link=e,this._provider=t}toJSON(){return{range:this.range,url:this.url,tooltip:this.tooltip}}get range(){return this._link.range}get url(){return this._link.url}get tooltip(){return this._link.tooltip}async resolve(e){return this._link.url?this._link.url:typeof this._provider.resolveLink==`function`?Promise.resolve(this._provider.resolveLink(this._link,e)).then(t=>(this._link=t||this._link,this._link.url?this.resolve(e):Promise.reject(Error(`missing`)))):Promise.reject(Error(`missing`))}},UM=class e{static{this.Empty=new e([])}constructor(t){this._disposables=new P;let n=[];for(let[r,i]of t){let t=r.links.map(e=>new HM(e,i));n=e._union(n,t),on(r)&&(this._disposables??=new P,this._disposables.add(r))}this.links=n}dispose(){this._disposables?.dispose(),this.links.length=0}static _union(e,t){let n=[],r,i,a,o;for(r=0,a=0,i=e.length,o=t.length;r<i&&a<o;){let i=e[r],o=t[a];if(S.areIntersectingOrTouching(i.range,o.range)){r++;continue}S.compareRangesUsingStarts(i.range,o.range)<0?(n.push(i),r++):(n.push(o),a++)}for(;r<i;r++)n.push(e[r]);for(;a<o;a++)n.push(t[a]);return n}};async function WM(e,t,n){let r=[],i=e.ordered(t).reverse().map(async(e,i)=>{try{let a=await e.provideLinks(t,n);a&&(r[i]=[a,e])}catch(e){Ze(e)}});await Promise.all(i);let a=new UM(vi(r));return n.isCancellationRequested&&(a.dispose(),a=UM.Empty),a}gn.registerCommand(`_executeLinkProvider`,async(e,...t)=>{let[n,r]=t;K(n instanceof $n),typeof r!=`number`&&(r=0);let{linkProvider:i}=e.get(W),a=e.get(Fi).getModel(n);if(!a)return[];let o=await WM(i,a,A.None);if(!o)return[];for(let e=0;e<Math.min(r,o.links.length);e++)await o.links[e].resolve(A.None);let s=o.links.slice(0);return o.dispose(),s});var GM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},KM=function(e,t){return function(n,r){t(n,r,e)}},qM,JM=class extends b{static{qM=this}static{this.ID=`editor.linkDetector`}static get(e){return e.getContribution(qM.ID)}constructor(e,t,n,r,i){super(),this.editor=e,this.openerService=t,this.notificationService=n,this.languageFeaturesService=r,this.providers=this.languageFeaturesService.linkProvider,this.debounceInformation=i.for(this.providers,`Links`,{min:1e3,max:4e3}),this.computeLinks=this._register(new ju(()=>this.computeLinksNow(),1e3)),this.computePromise=null,this.activeLinksList=null,this.currentOccurrences={},this.activeLinkDecorationId=null;let a=this._register(new Jg(e));this._register(a.onMouseMoveOrRelevantKeyDown(([e,t])=>{this._onEditorMouseMove(e,t)})),this._register(a.onExecute(e=>{this.onEditorMouseUp(e)})),this._register(a.onCancel(e=>{this.cleanUpActiveLinkDecoration()})),this._register(e.onDidChangeConfiguration(e=>{e.hasChanged(79)&&(this.updateDecorations([]),this.stop(),this.computeLinks.schedule(0))})),this._register(e.onDidChangeModelContent(e=>{this.editor.hasModel()&&this.computeLinks.schedule(this.debounceInformation.get(this.editor.getModel()))})),this._register(e.onDidChangeModel(e=>{this.currentOccurrences={},this.activeLinkDecorationId=null,this.stop(),this.computeLinks.schedule(0)})),this._register(e.onDidChangeModelLanguage(e=>{this.stop(),this.computeLinks.schedule(0)})),this._register(this.providers.onDidChange(e=>{this.stop(),this.computeLinks.schedule(0)})),this.computeLinks.schedule(0)}async computeLinksNow(){if(!this.editor.hasModel()||!this.editor.getOption(79))return;let e=this.editor.getModel();if(!e.isTooLargeForSyncing()&&this.providers.has(e)){this.activeLinksList&&=(this.activeLinksList.dispose(),null),this.computePromise=bu(t=>WM(this.providers,e,t));try{let t=new ad(!1);if(this.activeLinksList=await this.computePromise,this.debounceInformation.update(e,t.elapsed()),e.isDisposed())return;this.updateDecorations(this.activeLinksList.links)}catch(e){rr(e)}finally{this.computePromise=null}}}updateDecorations(e){let t=this.editor.getOption(86)===`altKey`,n=[],r=Object.keys(this.currentOccurrences);for(let e of r){let t=this.currentOccurrences[e];n.push(t.decorationId)}let i=[];if(e)for(let n of e)i.push(XM.decoration(n,t));this.editor.changeDecorations(t=>{let r=t.deltaDecorations(n,i);this.currentOccurrences={},this.activeLinkDecorationId=null;for(let t=0,n=r.length;t<n;t++){let n=new XM(e[t],r[t]);this.currentOccurrences[n.decorationId]=n}})}_onEditorMouseMove(e,t){let n=this.editor.getOption(86)===`altKey`;if(this.isEnabled(e,t)){this.cleanUpActiveLinkDecoration();let t=this.getLinkOccurrence(e.target.position);t&&this.editor.changeDecorations(e=>{t.activate(e,n),this.activeLinkDecorationId=t.decorationId})}else this.cleanUpActiveLinkDecoration()}cleanUpActiveLinkDecoration(){let e=this.editor.getOption(86)===`altKey`;if(this.activeLinkDecorationId){let t=this.currentOccurrences[this.activeLinkDecorationId];t&&this.editor.changeDecorations(n=>{t.deactivate(n,e)}),this.activeLinkDecorationId=null}}onEditorMouseUp(e){if(!this.isEnabled(e))return;let t=this.getLinkOccurrence(e.target.position);t&&this.openLinkOccurrence(t,e.hasSideBySideModifier,!0)}openLinkOccurrence(e,t,n=!1){if(!this.openerService)return;let{link:r}=e;r.resolve(A.None).then(e=>{if(typeof e==`string`&&this.editor.hasModel()){let t=this.editor.getModel().uri;if(t.scheme===hc.file&&e.startsWith(`${hc.file}:`)){let n=$n.parse(e);if(n.scheme===hc.file){let r=Da(n),i=null;r.startsWith(`/./`)||r.startsWith(`\\.\\`)?i=`.${r.substr(1)}`:(r.startsWith(`//./`)||r.startsWith(`\\\\.\\`))&&(i=`.${r.substr(2)}`),i&&(e=ts(t,i))}}}return this.openerService.open(e,{openToSide:t,fromUserGesture:n,allowContributedOpeners:!0,allowCommands:!0,fromWorkspace:!0})},e=>{let t=e instanceof Error?e.message:e;t===`invalid`?this.notificationService.warn(H(1264,`Failed to open this link because it is not well-formed: {0}`,r.url.toString())):t===`missing`?this.notificationService.warn(H(1265,`Failed to open this link because its target is missing.`)):rr(e)})}getLinkOccurrence(e){if(!this.editor.hasModel()||!e)return null;let t=this.editor.getModel().getDecorationsInRange({startLineNumber:e.lineNumber,startColumn:e.column,endLineNumber:e.lineNumber,endColumn:e.column},0,!0);for(let e of t){let t=this.currentOccurrences[e.id];if(t)return t}return null}isEnabled(e,t){return!!(e.target.type===6&&(e.hasTriggerModifier||t&&t.keyCodeIsTriggerKey))}stop(){this.computeLinks.cancel(),this.activeLinksList&&=(this.activeLinksList?.dispose(),null),this.computePromise&&=(this.computePromise.cancel(),null)}dispose(){super.dispose(),this.stop()}};JM=qM=GM([KM(1,cl),KM(2,nt),KM(3,W),KM(4,co)],JM);var YM={general:R.register({description:`detected-link`,stickiness:1,collapseOnReplaceEdit:!0,inlineClassName:`detected-link`}),active:R.register({description:`detected-link-active`,stickiness:1,collapseOnReplaceEdit:!0,inlineClassName:`detected-link-active`})},XM=class e{static decoration(t,n){return{range:t.range,options:e._getOptions(t,n,!1)}}static _getOptions(e,t,n){let r={...n?YM.active:YM.general};return r.hoverMessage=ZM(e,t),r}constructor(e,t){this.link=e,this.decorationId=t}activate(t,n){t.changeDecorationOptions(this.decorationId,e._getOptions(this.link,n,!0))}deactivate(t,n){t.changeDecorationOptions(this.decorationId,e._getOptions(this.link,n,!1))}};function ZM(e,t){let n=e.url&&/^command:/i.test(e.url.toString()),r=e.tooltip?e.tooltip:n?H(1266,`Execute command`):H(1267,`Follow link`),i=t?ro?H(1268,`cmd + click`):H(1269,`ctrl + click`):ro?H(1270,`option + click`):H(1271,`alt + click`);if(e.url){let t=``;if(/^command:/i.test(e.url.toString())){let n=e.url.toString().match(/^command:([^?#]+)/);if(n){let e=n[1];t=H(1272,`Execute command {0}`,e)}}return new Tn(``,!0).appendLink(e.url.toString(!0).replace(/ /g,`%20`),r,t).appendMarkdown(` (${i})`)}else return new Tn().appendText(`${r} (${i})`)}var QM=class extends D{constructor(){super({id:`editor.action.openLink`,label:B(1273,`Open Link`),precondition:void 0})}run(e,t){let n=JM.get(t);if(!n||!t.hasModel())return;let r=t.getSelections();for(let e of r){let t=n.getLinkOccurrence(e.getEndPosition());t&&n.openLinkOccurrence(t,!1)}}};G(JM.ID,JM,1),s(QM);var $M=class extends b{static{this.ID=`editor.contrib.longLinesHelper`}constructor(e){super(),this._editor=e,this._register(this._editor.onMouseDown(e=>{let t=this._editor.getOption(132);t>=0&&e.target.type===6&&e.target.position.column>=t&&this._editor.updateOptions({stopRenderingLineAfter:-1})}))}};G($M.ID,$M,2);var eN=class extends b{static{this.ID=`editor.contrib.middleScroll`}constructor(e){super(),this._editor=e;let t=f(this._editor),n=t.getOption(170);this._register(la(e=>{if(!n.read(e))return;let r=t.domNode.read(e);if(!r)return;let i=e.store.add(ko(`scrollingSession`,void 0));e.store.add(this._editor.onMouseDown(e=>{if(i.get()){i.set(void 0,void 0);return}if(!e.event.middleButton)return;e.event.stopPropagation(),e.event.preventDefault();let t=new P,n=new As(e.event.posx,e.event.posy),a=tN(su(r),n,t).map(e=>e.subtract(n).withThreshold(5)),o=r.getBoundingClientRect(),s=new As(n.x-o.left,n.y-o.top);i.set({mouseDeltaAfterThreshold:a,initialMousePosInEditor:s,didScroll:!1,dispose:()=>t.dispose()},void 0),t.add(this._editor.onMouseUp(e=>{let t=i.get();t&&t.didScroll&&i.set(void 0,void 0)})),t.add(this._editor.onKeyDown(e=>{i.set(void 0,void 0)}))})),e.store.add(la(e=>{let t=i.read(e);if(!t)return;let n=Date.now();e.store.add(la(e=>{ww.instance.invalidateOnNextAnimationFrame(e);let r=Date.now(),i=r-n;n=r;let a=t.mouseDeltaAfterThreshold.get(),o=i/32,s=a.scale(o),c=new As(this._editor.getScrollLeft(),this._editor.getScrollTop());this._editor.setScrollPosition(nN(c.add(s))),s.isZero()||(t.didScroll=!0)}));let a=O(e=>{let n=t.mouseDeltaAfterThreshold.read(e),r=``;return r+=n.y<0?`n`:n.y>0?`s`:``,r+=n.x<0?`w`:n.x>0?`e`:``,r});e.store.add(la(e=>{r.setAttribute(`data-scroll-direction`,a.read(e))}))}));let a=e.store.add(q.div({class:[`scroll-editor-on-middle-click-dot`,i.map(e=>e?``:`hidden`)],style:{left:i.map(e=>e?e.initialMousePosInEditor.x:0),top:i.map(e=>e?e.initialMousePosInEditor.y:0)}}).toDisposableLiveElement());e.store.add(sn(r,a.element)),e.store.add(la(e=>{let t=i.read(e);r.classList.toggle(`scroll-editor-on-middle-click-editor`,!!t)}))}))}};function tN(e,t,n){let r=Vl(`pos`,t);return n.add(U(e,`mousemove`,e=>{r.set(new As(e.pageX,e.pageY),void 0)})),r}function nN(e){return{scrollLeft:e.x,scrollTop:e.y}}G(eN.ID,eN,2);var rN=Y(`editor.wordHighlightBackground`,{dark:`#575757B8`,light:`#57575740`,hcDark:null,hcLight:null},H(1545,`Background color of a symbol during read-access, like reading a variable. The color must not be opaque so as not to hide underlying decorations.`),!0);Y(`editor.wordHighlightStrongBackground`,{dark:`#004972B8`,light:`#0e639c40`,hcDark:null,hcLight:null},H(1546,`Background color of a symbol during write-access, like writing to a variable. The color must not be opaque so as not to hide underlying decorations.`),!0),Y(`editor.wordHighlightTextBackground`,rN,H(1547,`Background color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations.`),!0);var iN=Y(`editor.wordHighlightBorder`,{light:null,dark:null,hcDark:p,hcLight:p},H(1548,`Border color of a symbol during read-access, like reading a variable.`));Y(`editor.wordHighlightStrongBorder`,{light:null,dark:null,hcDark:p,hcLight:p},H(1549,`Border color of a symbol during write-access, like writing to a variable.`)),Y(`editor.wordHighlightTextBorder`,iN,H(1550,`Border color of a textual occurrence for a symbol.`));var aN=Y(`editorOverviewRuler.wordHighlightForeground`,`#A0A0A0CC`,H(1551,`Overview ruler marker color for symbol highlights. The color must not be opaque so as not to hide underlying decorations.`),!0),oN=Y(`editorOverviewRuler.wordHighlightStrongForeground`,`#C0A0C0CC`,H(1552,`Overview ruler marker color for write-access symbol highlights. The color must not be opaque so as not to hide underlying decorations.`),!0),sN=Y(`editorOverviewRuler.wordHighlightTextForeground`,ze,H(1553,`Overview ruler marker color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations.`),!0),cN=R.register({description:`word-highlight-strong`,stickiness:1,className:`wordHighlightStrong`,overviewRuler:{color:Kt(oN),position:En.Center},minimap:{color:Kt(Ut),position:1}}),lN=R.register({description:`word-highlight-text`,stickiness:1,className:`wordHighlightText`,overviewRuler:{color:Kt(sN),position:En.Center},minimap:{color:Kt(Ut),position:1}}),uN=R.register({description:`selection-highlight-overview`,stickiness:1,className:`selectionHighlight`,overviewRuler:{color:Kt(ze),position:En.Center},minimap:{color:Kt(Ut),position:1}}),dN=R.register({description:`selection-highlight`,stickiness:1,className:`selectionHighlight`}),fN=R.register({description:`word-highlight`,stickiness:1,className:`wordHighlight`,overviewRuler:{color:Kt(aN),position:En.Center},minimap:{color:Kt(Ut),position:1}});function pN(e){return e===Fl.Write?cN:e===Fl.Text?lN:fN}function mN(e){return e?dN:uN}ul((e,t)=>{let n=e.getColor(Ua);n&&t.addRule(`.monaco-editor .selectionHighlight { background-color: ${n.transparent(.5)}; }`)});var hN=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gN=function(e,t){return function(n,r){t(n,r,e)}},_N;function vN(e,t){let n=t.filter(t=>!e.find(e=>e.equals(t)));if(n.length>=1){let e=n.map(e=>`line ${e.viewState.position.lineNumber} column ${e.viewState.position.column}`).join(`, `),t=n.length===1?H(1275,`Cursor added: {0}`,e):H(1276,`Cursors added: {0}`,e);zi(t)}}var yN=class extends D{constructor(){super({id:`editor.action.insertCursorAbove`,label:B(1285,`Add Cursor Above`),precondition:void 0,kbOpts:{kbExpr:F.editorTextFocus,primary:2576,linux:{primary:1552,secondary:[3088]},weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`3_multi`,title:H(1277,`&&Add Cursor Above`),order:2}})}run(e,t,n){if(!t.hasModel())return;let r=!0;n&&n.logicalLine===!1&&(r=!1);let i=t._getViewModel();if(i.cursorConfig.readOnly)return;i.model.pushStackElement();let a=i.getCursorStates();i.setCursorStates(n.source,3,Ss.addCursorUp(i,a,r)),i.revealTopMostCursor(n.source),vN(a,i.getCursorStates())}},bN=class extends D{constructor(){super({id:`editor.action.insertCursorBelow`,label:B(1286,`Add Cursor Below`),precondition:void 0,kbOpts:{kbExpr:F.editorTextFocus,primary:2578,linux:{primary:1554,secondary:[3090]},weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`3_multi`,title:H(1278,`A&&dd Cursor Below`),order:3}})}run(e,t,n){if(!t.hasModel())return;let r=!0;n&&n.logicalLine===!1&&(r=!1);let i=t._getViewModel();if(i.cursorConfig.readOnly)return;i.model.pushStackElement();let a=i.getCursorStates();i.setCursorStates(n.source,3,Ss.addCursorDown(i,a,r)),i.revealBottomMostCursor(n.source),vN(a,i.getCursorStates())}},xN=class extends D{constructor(){super({id:`editor.action.insertCursorAtEndOfEachLineSelected`,label:B(1287,`Add Cursors to Line Ends`),precondition:void 0,kbOpts:{kbExpr:F.editorTextFocus,primary:1575,weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`3_multi`,title:H(1279,`Add C&&ursors to Line Ends`),order:4}})}getCursorsForSelection(e,t,n){if(!e.isEmpty()){for(let r=e.startLineNumber;r<e.endLineNumber;r++){let e=t.getLineMaxColumn(r);n.push(new N(r,e,r,e))}e.endColumn>1&&n.push(new N(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn))}}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=t.getSelections(),i=t._getViewModel(),a=i.getCursorStates(),o=[];r.forEach(e=>this.getCursorsForSelection(e,n,o)),o.length>0&&t.setSelections(o),vN(a,i.getCursorStates())}},SN=class extends D{constructor(){super({id:`editor.action.addCursorsToBottom`,label:B(1288,`Add Cursors to Bottom`),precondition:void 0})}run(e,t){if(!t.hasModel())return;let n=t.getSelections(),r=t.getModel().getLineCount(),i=[];for(let e=n[0].startLineNumber;e<=r;e++)i.push(new N(e,n[0].startColumn,e,n[0].endColumn));let a=t._getViewModel(),o=a.getCursorStates();i.length>0&&t.setSelections(i),vN(o,a.getCursorStates())}},CN=class extends D{constructor(){super({id:`editor.action.addCursorsToTop`,label:B(1289,`Add Cursors to Top`),precondition:void 0})}run(e,t){if(!t.hasModel())return;let n=t.getSelections(),r=[];for(let e=n[0].startLineNumber;e>=1;e--)r.push(new N(e,n[0].startColumn,e,n[0].endColumn));let i=t._getViewModel(),a=i.getCursorStates();r.length>0&&t.setSelections(r),vN(a,i.getCursorStates())}},wN=class{constructor(e,t,n){this.selections=e,this.revealRange=t,this.revealScrollType=n}},TN=class e{static create(t,n){if(!t.hasModel())return null;let r=n.getState();if(!t.hasTextFocus()&&r.isRevealed&&r.searchString.length>0)return new e(t,n,!1,r.searchString,r.wholeWord,r.matchCase,null);let i=!1,a,o,s=t.getSelections();s.length===1&&s[0].isEmpty()?(i=!0,a=!0,o=!0):(a=r.wholeWord,o=r.matchCase);let c=t.getSelection(),l,u=null;if(c.isEmpty()){let e=t.getConfiguredWordAtPosition(c.getStartPosition());if(!e)return null;l=e.word,u=new N(c.startLineNumber,e.startColumn,c.startLineNumber,e.endColumn)}else l=t.getModel().getValueInRange(c).replace(/\r\n/g,`
`);return new e(t,n,i,l,a,o,u)}constructor(e,t,n,r,i,a,o){this._editor=e,this.findController=t,this.isDisconnectedFromFindController=n,this.searchText=r,this.wholeWord=i,this.matchCase=a,this.currentMatch=o}addSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;let e=this._getNextMatch();if(!e)return null;let t=this._editor.getSelections();return new wN(t.concat(e),e,0)}moveSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;let e=this._getNextMatch();if(!e)return null;let t=this._editor.getSelections();return new wN(t.slice(0,t.length-1).concat(e),e,0)}_getNextMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){let e=this.currentMatch;return this.currentMatch=null,e}this.findController.highlightFindOptions();let e=this._editor.getSelections(),t=e[e.length-1],n=this._editor.getModel().findNextMatch(this.searchText,t.getEndPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(147):null,!1);return n?new N(n.range.startLineNumber,n.range.startColumn,n.range.endLineNumber,n.range.endColumn):null}addSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;let e=this._getPreviousMatch();if(!e)return null;let t=this._editor.getSelections();return new wN(t.concat(e),e,0)}moveSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;let e=this._getPreviousMatch();if(!e)return null;let t=this._editor.getSelections();return new wN(t.slice(0,t.length-1).concat(e),e,0)}_getPreviousMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){let e=this.currentMatch;return this.currentMatch=null,e}this.findController.highlightFindOptions();let e=this._editor.getSelections(),t=e[e.length-1],n=this._editor.getModel().findPreviousMatch(this.searchText,t.getStartPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(147):null,!1);return n?new N(n.range.startLineNumber,n.range.startColumn,n.range.endLineNumber,n.range.endColumn):null}selectAll(e){if(!this._editor.hasModel())return[];this.findController.highlightFindOptions();let t=this._editor.getModel();return e?t.findMatches(this.searchText,e,!1,this.matchCase,this.wholeWord?this._editor.getOption(147):null,!1,1073741824):t.findMatches(this.searchText,!0,!1,this.matchCase,this.wholeWord?this._editor.getOption(147):null,!1,1073741824)}},EN=class e extends b{static{this.ID=`editor.contrib.multiCursorController`}static get(t){return t.getContribution(e.ID)}constructor(e){super(),this._sessionDispose=this._register(new P),this._editor=e,this._ignoreSelectionChange=!1,this._session=null}dispose(){this._endSession(),super.dispose()}_beginSessionIfNeeded(e){if(!this._session){let t=TN.create(this._editor,e);if(!t)return;this._session=t;let n={searchString:this._session.searchText};this._session.isDisconnectedFromFindController&&(n.wholeWordOverride=1,n.matchCaseOverride=1,n.isRegexOverride=2),e.getState().change(n,!1),this._sessionDispose.add(this._editor.onDidChangeCursorSelection(e=>{this._ignoreSelectionChange||this._endSession()})),this._sessionDispose.add(this._editor.onDidBlurEditorText(()=>{this._endSession()})),this._sessionDispose.add(e.getState().onFindReplaceStateChange(e=>{(e.matchCase||e.wholeWord)&&this._endSession()}))}}_endSession(){this._sessionDispose.clear(),this._session&&this._session.isDisconnectedFromFindController&&this._session.findController.getState().change({wholeWordOverride:0,matchCaseOverride:0,isRegexOverride:0},!1),this._session=null}_setSelections(e){this._ignoreSelectionChange=!0,this._editor.setSelections(e),this._ignoreSelectionChange=!1}_expandEmptyToWord(e,t){if(!t.isEmpty())return t;let n=this._editor.getConfiguredWordAtPosition(t.getStartPosition());return n?new N(t.startLineNumber,n.startColumn,t.startLineNumber,n.endColumn):t}_applySessionResult(e){e&&(this._setSelections(e.selections),e.revealRange&&this._editor.revealRangeInCenterIfOutsideViewport(e.revealRange,e.revealScrollType))}getSession(e){return this._session}addSelectionToNextFindMatch(e){if(this._editor.hasModel()){if(!this._session){let t=this._editor.getSelections();if(t.length>1){let n=e.getState().matchCase;if(!IN(this._editor.getModel(),t,n)){let e=this._editor.getModel(),n=[];for(let r=0,i=t.length;r<i;r++)n[r]=this._expandEmptyToWord(e,t[r]);this._editor.setSelections(n);return}}}this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToNextFindMatch())}}addSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToPreviousFindMatch())}moveSelectionToNextFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToNextFindMatch())}moveSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToPreviousFindMatch())}selectAll(e){if(!this._editor.hasModel())return;let t=null,n=e.getState();if(n.isRevealed&&n.searchString.length>0&&n.isRegex){let e=this._editor.getModel();t=n.searchScope?e.findMatches(n.searchString,n.searchScope,n.isRegex,n.matchCase,n.wholeWord?this._editor.getOption(147):null,!1,1073741824):e.findMatches(n.searchString,!0,n.isRegex,n.matchCase,n.wholeWord?this._editor.getOption(147):null,!1,1073741824)}else{if(this._beginSessionIfNeeded(e),!this._session)return;t=this._session.selectAll(n.searchScope)}if(t.length>0){let e=this._editor.getSelection();for(let n=0,r=t.length;n<r;n++){let r=t[n];if(r.range.intersectRanges(e)){t[n]=t[0],t[0]=r;break}}this._setSelections(t.map(e=>new N(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn)))}}},DN=class extends D{run(e,t){let n=EN.get(t);if(!n)return;let r=t._getViewModel();if(r){let i=r.getCursorStates(),a=_x.get(t);if(a)this._run(n,a);else{let r=e.get(k).createInstance(_x,t);this._run(n,r),r.dispose()}vN(i,r.getCursorStates())}}},ON=class extends DN{constructor(){super({id:`editor.action.addSelectionToNextFindMatch`,label:B(1290,`Add Selection to Next Find Match`),precondition:void 0,kbOpts:{kbExpr:F.focus,primary:2082,weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`3_multi`,title:H(1280,`Add &&Next Occurrence`),order:5}})}_run(e,t){e.addSelectionToNextFindMatch(t)}},kN=class extends DN{constructor(){super({id:`editor.action.addSelectionToPreviousFindMatch`,label:B(1291,`Add Selection to Previous Find Match`),precondition:void 0,menuOpts:{menuId:M.MenubarSelectionMenu,group:`3_multi`,title:H(1281,`Add P&&revious Occurrence`),order:6}})}_run(e,t){e.addSelectionToPreviousFindMatch(t)}},AN=class extends DN{constructor(){super({id:`editor.action.moveSelectionToNextFindMatch`,label:B(1292,`Move Last Selection to Next Find Match`),precondition:void 0,kbOpts:{kbExpr:F.focus,primary:An(2089,2082),weight:100}})}_run(e,t){e.moveSelectionToNextFindMatch(t)}},jN=class extends DN{constructor(){super({id:`editor.action.moveSelectionToPreviousFindMatch`,label:B(1293,`Move Last Selection to Previous Find Match`),precondition:void 0})}_run(e,t){e.moveSelectionToPreviousFindMatch(t)}},MN=class extends DN{constructor(){super({id:`editor.action.selectHighlights`,label:B(1294,`Select All Occurrences of Find Match`),precondition:void 0,kbOpts:{kbExpr:F.focus,primary:3114,weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`3_multi`,title:H(1282,`Select All &&Occurrences`),order:7}})}_run(e,t){e.selectAll(t)}},NN=class extends DN{constructor(){super({id:`editor.action.changeAll`,label:B(1295,`Change All Occurrences`),precondition:j.and(F.writable,F.editorTextFocus),kbOpts:{kbExpr:F.editorTextFocus,primary:2108,weight:100},contextMenuOpts:{group:`1_modification`,order:1.2}})}_run(e,t){e.selectAll(t)}},PN=class{constructor(e,t,n,r,i){this._model=e,this._searchText=t,this._matchCase=n,this._wordSeparators=r,this._cachedFindMatches=null,this._modelVersionId=this._model.getVersionId(),i&&this._model===i._model&&this._searchText===i._searchText&&this._matchCase===i._matchCase&&this._wordSeparators===i._wordSeparators&&this._modelVersionId===i._modelVersionId&&(this._cachedFindMatches=i._cachedFindMatches)}findMatches(){return this._cachedFindMatches===null&&(this._cachedFindMatches=this._model.findMatches(this._searchText,!0,!1,this._matchCase,this._wordSeparators,!1).map(e=>e.range),this._cachedFindMatches.sort(S.compareRangesUsingStarts)),this._cachedFindMatches}},FN=class extends b{static{_N=this}static{this.ID=`editor.contrib.selectionHighlighter`}constructor(e,t){super(),this._languageFeaturesService=t,this.editor=e,this._isEnabled=e.getOption(121),this._isEnabledMultiline=e.getOption(123),this._maxLength=e.getOption(122),this._decorations=e.createDecorationsCollection(),this.updateSoon=this._register(new ju(()=>this._update(),300)),this.state=null,this._register(e.onDidChangeConfiguration(t=>{this._isEnabled=e.getOption(121),this._isEnabledMultiline=e.getOption(123),this._maxLength=e.getOption(122)})),this._register(e.onDidChangeCursorSelection(e=>{this._isEnabled&&(e.selection.isEmpty()?e.reason===3?(this.state&&this._setState(null),this.updateSoon.schedule()):this._setState(null):this._update())})),this._register(e.onDidChangeModel(e=>{this._setState(null)})),this._register(e.onDidChangeModelContent(e=>{this._isEnabled&&this.updateSoon.schedule()}));let n=_x.get(e);n&&this._register(n.getState().onFindReplaceStateChange(e=>{this._update()})),this.updateSoon.schedule()}_update(){this._setState(_N._createState(this.state,this._isEnabled,this._isEnabledMultiline,this._maxLength,this.editor))}static _createState(e,t,n,r,i){if(!t||!i.hasModel())return null;if(!n){let e=i.getSelection();if(e.startLineNumber!==e.endLineNumber)return null}let a=EN.get(i);if(!a)return null;let o=_x.get(i);if(!o)return null;let s=a.getSession(o);if(!s){let e=i.getSelections();if(e.length>1){let t=o.getState().matchCase;if(!IN(i.getModel(),e,t))return null}s=TN.create(i,o)}if(!s||s.currentMatch||/^[ \t]+$/.test(s.searchText)||r>0&&s.searchText.length>r)return null;let c=o.getState(),l=c.matchCase;if(c.isRevealed){let e=c.searchString;l||(e=e.toLowerCase());let t=s.searchText;if(l||(t=t.toLowerCase()),e===t&&s.matchCase===c.matchCase&&s.wholeWord===c.wholeWord&&!c.isRegex)return null}return new PN(i.getModel(),s.searchText,s.matchCase,s.wholeWord?i.getOption(147):null,e)}_setState(e){if(this.state=e,!this.state){this._decorations.clear();return}if(!this.editor.hasModel())return;let t=this.editor.getModel();if(t.isTooLargeForTokenization())return;let n=this.state.findMatches(),r=this.editor.getSelections();r.sort(S.compareRangesUsingStarts);let i=[];for(let e=0,t=0,a=n.length,o=r.length;e<a;){let a=n[e];if(t>=o)i.push(a),e++;else{let n=S.compareRangesUsingStarts(a,r[t]);n<0?((r[t].isEmpty()||!S.areIntersecting(a,r[t]))&&i.push(a),e++):(n>0||e++,t++)}}let a=this.editor.getOption(89)!==`off`,o=this._languageFeaturesService.documentHighlightProvider.has(t)&&a,s=i.map(e=>({range:e,options:mN(o)}));this._decorations.set(s)}dispose(){this._setState(null),super.dispose()}};FN=_N=hN([gN(1,W)],FN);function IN(e,t,n){let r=LN(e,t[0],!n);for(let i=1,a=t.length;i<a;i++){let a=t[i];if(a.isEmpty())return!1;let o=LN(e,a,!n);if(r!==o)return!1}return!0}function LN(e,t,n){let r=e.getValueInRange(t);return n?r.toLowerCase():r}var RN=class extends D{constructor(){super({id:`editor.action.focusNextCursor`,label:B(1296,`Focus Next Cursor`),metadata:{description:H(1283,`Focuses the next cursor`),args:[]},precondition:void 0})}run(e,t,n){if(!t.hasModel())return;let r=t._getViewModel();if(r.cursorConfig.readOnly)return;r.model.pushStackElement();let i=Array.from(r.getCursorStates()),a=i.shift();a&&(i.push(a),r.setCursorStates(n.source,3,i),r.revealPrimaryCursor(n.source,!0),vN(i,r.getCursorStates()))}},zN=class extends D{constructor(){super({id:`editor.action.focusPreviousCursor`,label:B(1297,`Focus Previous Cursor`),metadata:{description:H(1284,`Focuses the previous cursor`),args:[]},precondition:void 0})}run(e,t,n){if(!t.hasModel())return;let r=t._getViewModel();if(r.cursorConfig.readOnly)return;r.model.pushStackElement();let i=Array.from(r.getCursorStates()),a=i.pop();a&&(i.unshift(a),r.setCursorStates(n.source,3,i),r.revealPrimaryCursor(n.source,!0),vN(i,r.getCursorStates()))}};G(EN.ID,EN,4),G(FN.ID,FN,1),s(yN),s(bN),s(xN),s(ON),s(kN),s(AN),s(jN),s(MN),s(NN),s(SN),s(CN),s(RN),s(zN);const BN={Visible:new T(`parameterHintsVisible`,!1),MultipleSignatures:new T(`parameterHintsMultipleSignatures`,!1)};async function VN(e,t,n,r,i){let a=e.ordered(t);for(let e of a)try{let a=await e.provideSignatureHelp(t,n,i,r);if(a)return a}catch(e){Ze(e)}}gn.registerCommand(`_executeSignatureHelpProvider`,async(e,...t)=>{let[n,r,i]=t;K($n.isUri(n)),K(x.isIPosition(r)),K(typeof i==`string`||!i);let a=e.get(W),o=await e.get(fi).createModelReference(n);try{let e=await VN(a.signatureHelpProvider,o.object.textEditorModel,x.lift(r),{triggerKind:Yu.Invoke,isRetrigger:!1,triggerCharacter:i},A.None);return e?(setTimeout(()=>e.dispose(),0),e.value):void 0}finally{o.dispose()}});var HN;(function(e){e.Default={type:0};class t{constructor(e,t){this.request=e,this.previouslyActiveHints=t,this.type=2}}e.Pending=t;class n{constructor(e){this.hints=e,this.type=1}}e.Active=n})(HN||={});var UN=class e extends b{static{this.DEFAULT_DELAY=120}constructor(t,n,r=e.DEFAULT_DELAY){super(),this._onChangedHints=this._register(new E),this.onChangedHints=this._onChangedHints.event,this.triggerOnType=!1,this._state=HN.Default,this._pendingTriggers=[],this._lastSignatureHelpResult=this._register(new Ot),this.triggerChars=new It,this.retriggerChars=new It,this.triggerId=0,this.editor=t,this.providers=n,this.throttledDelayer=new qa(r),this._register(this.editor.onDidBlurEditorWidget(()=>this.cancel())),this._register(this.editor.onDidChangeConfiguration(()=>this.onEditorConfigurationChange())),this._register(this.editor.onDidChangeModel(e=>this.onModelChanged())),this._register(this.editor.onDidChangeModelLanguage(e=>this.onModelChanged())),this._register(this.editor.onDidChangeCursorSelection(e=>this.onCursorChange(e))),this._register(this.editor.onDidChangeModelContent(e=>this.onModelContentChange())),this._register(this.providers.onDidChange(this.onModelChanged,this)),this._register(this.editor.onDidType(e=>this.onDidType(e))),this.onEditorConfigurationChange(),this.onModelChanged()}get state(){return this._state}set state(e){this._state.type===2&&this._state.request.cancel(),this._state=e}cancel(e=!1){this.state=HN.Default,this.throttledDelayer.cancel(),e||this._onChangedHints.fire(void 0)}trigger(e,t){let n=this.editor.getModel();if(!n||!this.providers.has(n))return;let r=++this.triggerId;this._pendingTriggers.push(e),this.throttledDelayer.trigger(()=>this.doTrigger(r),t).catch(rr)}next(){if(this.state.type!==1)return;let e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,n=t%e===e-1,r=this.editor.getOption(97).cycle;if((e<2||n)&&!r){this.cancel();return}this.updateActiveSignature(n&&r?0:t+1)}previous(){if(this.state.type!==1)return;let e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,n=t===0,r=this.editor.getOption(97).cycle;if((e<2||n)&&!r){this.cancel();return}this.updateActiveSignature(n&&r?e-1:t-1)}updateActiveSignature(e){this.state.type===1&&(this.state=new HN.Active({...this.state.hints,activeSignature:e}),this._onChangedHints.fire(this.state.hints))}async doTrigger(e){let t=this.state.type===1||this.state.type===2,n=this.getLastActiveHints();if(this.cancel(!0),this._pendingTriggers.length===0)return!1;let r=this._pendingTriggers.reduce(WN);this._pendingTriggers=[];let i={triggerKind:r.triggerKind,triggerCharacter:r.triggerCharacter,isRetrigger:t,activeSignatureHelp:n};if(!this.editor.hasModel())return!1;let a=this.editor.getModel(),o=this.editor.getPosition();this.state=new HN.Pending(bu(e=>VN(this.providers,a,o,i,e)),n);try{let t=await this.state.request;return e===this.triggerId?!t||!t.value.signatures||t.value.signatures.length===0?(t?.dispose(),this._lastSignatureHelpResult.clear(),this.cancel(),!1):(this.state=new HN.Active(t.value),this._lastSignatureHelpResult.value=t,this._onChangedHints.fire(this.state.hints),!0):(t?.dispose(),!1)}catch(t){return e===this.triggerId&&(this.state=HN.Default),rr(t),!1}}getLastActiveHints(){switch(this.state.type){case 1:return this.state.hints;case 2:return this.state.previouslyActiveHints;default:return}}get isTriggered(){return this.state.type===1||this.state.type===2||this.throttledDelayer.isTriggered()}onModelChanged(){this.cancel(),this.triggerChars.clear(),this.retriggerChars.clear();let e=this.editor.getModel();if(e)for(let t of this.providers.ordered(e)){for(let e of t.signatureHelpTriggerCharacters||[])if(e.length){let t=e.charCodeAt(0);this.triggerChars.add(t),this.retriggerChars.add(t)}for(let e of t.signatureHelpRetriggerCharacters||[])e.length&&this.retriggerChars.add(e.charCodeAt(0))}}onDidType(e){if(!this.triggerOnType)return;let t=e.length-1,n=e.charCodeAt(t);(this.triggerChars.has(n)||this.isTriggered&&this.retriggerChars.has(n))&&this.trigger({triggerKind:Yu.TriggerCharacter,triggerCharacter:e.charAt(t)})}onCursorChange(e){e.source===`mouse`?this.cancel():this.isTriggered&&this.trigger({triggerKind:Yu.ContentChange})}onModelContentChange(){this.isTriggered&&this.trigger({triggerKind:Yu.ContentChange})}onEditorConfigurationChange(){this.triggerOnType=this.editor.getOption(97).enabled,this.triggerOnType||this.cancel()}dispose(){this.cancel(!0),super.dispose()}};function WN(e,t){switch(t.triggerKind){case Yu.Invoke:return t;case Yu.ContentChange:return e;case Yu.TriggerCharacter:default:return t}}var GN=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},KN=function(e,t){return function(n,r){t(n,r,e)}},qN,JN=I,YN=No(`parameter-hints-next`,J.chevronDown,H(1299,`Icon for show next parameter hint.`)),XN=No(`parameter-hints-previous`,J.chevronUp,H(1300,`Icon for show previous parameter hint.`)),ZN=class extends b{static{qN=this}static{this.ID=`editor.widget.parameterHintsWidget`}constructor(e,t,n,r,i){super(),this.editor=e,this.model=t,this.renderDisposeables=this._register(new P),this.visible=!1,this.announcedLabel=null,this.allowEditorOverflow=!0,this.markdownRenderer=new $r({editor:e},i,r),this.keyVisible=BN.Visible.bindTo(n),this.keyMultipleSignatures=BN.MultipleSignatures.bindTo(n)}createParameterHintDOMNodes(){let e=JN(`.editor-widget.parameter-hints-widget`),t=V(e,JN(`.phwrapper`));t.tabIndex=-1;let n=V(t,JN(`.controls`)),r=V(n,JN(`.button`+X.asCSSSelector(XN))),i=V(n,JN(`.overloads`)),a=V(n,JN(`.button`+X.asCSSSelector(YN)));this._register(U(r,`click`,e=>{l.stop(e),this.previous()})),this._register(U(a,`click`,e=>{l.stop(e),this.next()}));let o=JN(`.body`),s=new Hu(o,{alwaysConsumeMouseWheel:!0});this._register(s),t.appendChild(s.getDomNode());let c=V(o,JN(`.signature`)),u=V(o,JN(`.docs`));e.style.userSelect=`text`,this.domNodes={element:e,signature:c,overloads:i,docs:u,scrollbar:s},this.editor.addContentWidget(this),this.hide(),this._register(this.editor.onDidChangeCursorSelection(e=>{this.visible&&this.editor.layoutContentWidget(this)}));let d=()=>{if(!this.domNodes)return;let e=this.editor.getOption(59),t=this.domNodes.element;t.style.fontSize=`${e.fontSize}px`,t.style.lineHeight=`${e.lineHeight/e.fontSize}`,t.style.setProperty(`--vscode-parameterHintsWidget-editorFontFamily`,e.fontFamily),t.style.setProperty(`--vscode-parameterHintsWidget-editorFontFamilyDefault`,oa.fontFamily)};d(),this._register(vn.chain(this.editor.onDidChangeConfiguration.bind(this.editor),e=>e.filter(e=>e.hasChanged(59)))(d)),this._register(this.editor.onDidLayoutChange(e=>this.updateMaxHeight())),this.updateMaxHeight()}show(){this.visible||(this.domNodes||this.createParameterHintDOMNodes(),this.keyVisible.set(!0),this.visible=!0,setTimeout(()=>{this.domNodes?.element.classList.add(`visible`)},100),this.editor.layoutContentWidget(this))}hide(){this.renderDisposeables.clear(),this.visible&&(this.keyVisible.reset(),this.visible=!1,this.announcedLabel=null,this.domNodes?.element.classList.remove(`visible`),this.editor.layoutContentWidget(this))}getPosition(){return this.visible?{position:this.editor.getPosition(),preference:[1,2]}:null}render(e){if(this.renderDisposeables.clear(),!this.domNodes)return;let t=e.signatures.length>1;this.domNodes.element.classList.toggle(`multiple`,t),this.keyMultipleSignatures.set(t),this.domNodes.signature.innerText=``,this.domNodes.docs.innerText=``;let n=e.signatures[e.activeSignature];if(!n)return;let r=V(this.domNodes.signature,JN(`.code`)),i=n.parameters.length>0,a=n.activeParameter??e.activeParameter;if(i)this.renderParameters(r,n,a);else{let e=V(r,JN(`span`));e.textContent=n.label}let o=n.parameters[a];if(o?.documentation){let e=JN(`span.documentation`);if(typeof o.documentation==`string`)e.textContent=o.documentation;else{let t=this.renderMarkdownDocs(o.documentation);e.appendChild(t.element)}V(this.domNodes.docs,JN(`p`,{},e))}if(n.documentation!==void 0)if(typeof n.documentation==`string`)V(this.domNodes.docs,JN(`p`,{},n.documentation));else{let e=this.renderMarkdownDocs(n.documentation);V(this.domNodes.docs,e.element)}let s=this.hasDocs(n,o);if(this.domNodes.signature.classList.toggle(`has-docs`,s),this.domNodes.docs.classList.toggle(`empty`,!s),this.domNodes.overloads.textContent=String(e.activeSignature+1).padStart(e.signatures.length.toString().length,`0`)+`/`+e.signatures.length,o){let e=``,t=n.parameters[a];e=Array.isArray(t.label)?n.label.substring(t.label[0],t.label[1]):t.label,t.documentation&&(e+=typeof t.documentation==`string`?`, ${t.documentation}`:`, ${t.documentation.value}`),n.documentation&&(e+=typeof n.documentation==`string`?`, ${n.documentation}`:`, ${n.documentation.value}`),this.announcedLabel!==e&&(Xi(H(1301,`{0}, hint`,e)),this.announcedLabel=e)}this.editor.layoutContentWidget(this),this.domNodes.scrollbar.scanDomNode()}renderMarkdownDocs(e){let t=this.renderDisposeables.add(this.markdownRenderer.render(e,{asyncRenderCallback:()=>{this.domNodes?.scrollbar.scanDomNode()}}));return t.element.classList.add(`markdown-docs`),t}hasDocs(e,t){return!!(t&&typeof t.documentation==`string`&&xa(t.documentation).length>0||t&&typeof t.documentation==`object`&&xa(t.documentation).value.length>0||e.documentation&&typeof e.documentation==`string`&&xa(e.documentation).length>0||e.documentation&&typeof e.documentation==`object`&&xa(e.documentation.value).length>0)}renderParameters(e,t,n){let[r,i]=this.getParameterLabelOffsets(t,n),a=document.createElement(`span`);a.textContent=t.label.substring(0,r);let o=document.createElement(`span`);o.textContent=t.label.substring(r,i),o.className=`parameter active`;let s=document.createElement(`span`);s.textContent=t.label.substring(i),V(e,a,o,s)}getParameterLabelOffsets(e,t){let n=e.parameters[t];if(n){if(Array.isArray(n.label))return n.label;if(n.label.length){let t=RegExp(`(\\W|^)${bi(n.label)}(?=\\W|$)`,`g`);t.test(e.label);let r=t.lastIndex-n.label.length;return r>=0?[r,t.lastIndex]:[0,0]}else return[0,0]}else return[0,0]}next(){this.editor.focus(),this.model.next()}previous(){this.editor.focus(),this.model.previous()}getDomNode(){return this.domNodes||this.createParameterHintDOMNodes(),this.domNodes.element}getId(){return qN.ID}updateMaxHeight(){if(!this.domNodes)return;let e=`${Math.max(this.editor.getLayoutInfo().height/4,250)}px`;this.domNodes.element.style.maxHeight=e;let t=this.domNodes.element.getElementsByClassName(`phwrapper`);t.length&&(t[0].style.maxHeight=e)}};ZN=qN=GN([KN(2,w),KN(3,cl),KN(4,ui)],ZN),Y(`editorHoverWidget.highlightForeground`,Qe,H(1302,`Foreground color of the active item in the parameter hint.`));var QN=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$N=function(e,t){return function(n,r){t(n,r,e)}},eP,tP=class extends b{static{eP=this}static{this.ID=`editor.controller.parameterHints`}static get(e){return e.getContribution(eP.ID)}constructor(e,t,n){super(),this.editor=e,this.model=this._register(new UN(e,n.signatureHelpProvider)),this._register(this.model.onChangedHints(e=>{e?(this.widget.value.show(),this.widget.value.render(e)):this.widget.rawValue?.hide()})),this.widget=new Nc(()=>this._register(t.createInstance(ZN,this.editor,this.model)))}cancel(){this.model.cancel()}previous(){this.widget.rawValue?.previous()}next(){this.widget.rawValue?.next()}trigger(e){this.model.trigger(e,0)}};tP=eP=QN([$N(1,k),$N(2,W)],tP);var nP=class extends D{constructor(){super({id:`editor.action.triggerParameterHints`,label:B(1298,`Trigger Parameter Hints`),precondition:F.hasSignatureHelpProvider,kbOpts:{kbExpr:F.editorTextFocus,primary:3082,weight:100}})}run(e,t){tP.get(t)?.trigger({triggerKind:Yu.Invoke})}};G(tP.ID,tP,2),s(nP);var rP=Gi.bindToContribution(tP.get);L(new rP({id:`closeParameterHints`,precondition:BN.Visible,handler:e=>e.cancel(),kbOpts:{weight:175,kbExpr:F.focus,primary:9,secondary:[1033]}})),L(new rP({id:`showPrevParameterHint`,precondition:j.and(BN.Visible,BN.MultipleSignatures),handler:e=>e.previous(),kbOpts:{weight:175,kbExpr:F.focus,primary:16,secondary:[528],mac:{primary:16,secondary:[528,302]}}})),L(new rP({id:`showNextParameterHint`,precondition:j.and(BN.Visible,BN.MultipleSignatures),handler:e=>e.next(),kbOpts:{weight:175,kbExpr:F.focus,primary:18,secondary:[530],mac:{primary:18,secondary:[530,300]}}}));var iP=class extends b{static{this.ID=`editor.contrib.placeholderText`}constructor(e){super(),this._editor=e,this._editorObs=f(this._editor),this._placeholderText=this._editorObs.getOption(99),this._state=Zi({owner:this,equalsFn:Ql},e=>{let t=this._placeholderText.read(e);if(t&&this._editorObs.valueIsEmpty.read(e))return{placeholder:t}}),this._shouldViewBeAlive=aP(this,e=>this._state.read(e)?.placeholder!==void 0),this._view=O(e=>{if(!this._shouldViewBeAlive.read(e))return;let t=Bu(`div.editorPlaceholder`);e.store.add(la(e=>{let n=this._state.read(e),r=n?.placeholder!==void 0;t.root.style.display=r?`block`:`none`,t.root.innerText=n?.placeholder??``})),e.store.add(la(e=>{let n=this._editorObs.layoutInfo.read(e);t.root.style.left=`${n.contentLeft}px`,t.root.style.width=n.contentWidth-n.verticalScrollbarWidth+`px`,t.root.style.top=`${this._editor.getTopForLineNumber(0)}px`})),e.store.add(la(e=>{t.root.style.fontFamily=this._editorObs.getOption(58).read(e),t.root.style.fontSize=this._editorObs.getOption(61).read(e)+`px`,t.root.style.lineHeight=this._editorObs.getOption(75).read(e)+`px`})),e.store.add(this._editorObs.createOverlayWidget({allowEditorOverflow:!1,minContentWidthInPx:jt(0),position:jt(null),domNode:t.root}))}),this._view.recomputeInitiallyAndOnChange(this._store)}};function aP(e,t){return Zu(e,(e,n)=>n===!0?!0:t(e))}var oP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},sP=function(e,t){return function(n,r){t(n,r,e)}},cP=class{constructor(e){this.instantiationService=e}init(...e){}};function lP(e,t){return class extends t{constructor(){super(...arguments),this._autorun=void 0}init(...t){this._autorun=n((n,r)=>{let i=_t(e(),n);r.add(this.instantiationService.createInstance(i,...t))})}dispose(){this._autorun?.dispose()}}}function uP(e){return ri()?lP(e,dP):e()}var dP=class extends cP{constructor(e,t){super(t),this.init(e)}};dP=oP([sP(1,k)],dP),G(iP.ID,uP(()=>iP),0),Y(`editor.placeholder.foreground`,Pi,H(1321,`Foreground color of the placeholder text in the editor.`));var fP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},pP=function(e,t){return function(n,r){t(n,r,e)}};const mP=new T(`renameInputVisible`,!1,H(1373,`Whether the rename input widget is visible`));new T(`renameInputFocused`,!1,H(1374,`Whether the rename input widget is focused`));var hP=class{constructor(e,t,n,r,i,a){this._editor=e,this._acceptKeybindings=t,this._themeService=n,this._keybindingService=r,this._logService=a,this.allowEditorOverflow=!0,this._disposables=new P,this._visibleContextKey=mP.bindTo(i),this._isEditingRenameCandidate=!1,this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,this._candidates=new Set,this._beforeFirstInputFieldEditSW=new ad,this._inputWithButton=new _P,this._disposables.add(this._inputWithButton),this._editor.addContentWidget(this),this._disposables.add(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(59)&&this._updateFont()})),this._disposables.add(n.onDidColorThemeChange(this._updateStyles,this))}dispose(){this._disposables.dispose(),this._editor.removeContentWidget(this)}getId(){return`__renameInputWidget`}getDomNode(){return this._domNode||(this._domNode=document.createElement(`div`),this._domNode.className=`monaco-editor rename-box`,this._domNode.appendChild(this._inputWithButton.domNode),this._renameCandidateListView=this._disposables.add(new gP(this._domNode,{fontInfo:this._editor.getOption(59),onFocusChange:e=>{this._inputWithButton.input.value=e,this._isEditingRenameCandidate=!1},onSelectionChange:()=>{this._isEditingRenameCandidate=!1,this.acceptInput(!1)}})),this._disposables.add(this._inputWithButton.onDidInputChange(()=>{this._renameCandidateListView?.focusedCandidate!==void 0&&(this._isEditingRenameCandidate=!0),this._timeBeforeFirstInputFieldEdit??=this._beforeFirstInputFieldEditSW.elapsed(),this._renameCandidateProvidersCts?.token.isCancellationRequested===!1&&this._renameCandidateProvidersCts.cancel(),this._renameCandidateListView?.clearFocus()})),this._label=document.createElement(`div`),this._label.className=`rename-label`,this._domNode.appendChild(this._label),this._updateFont(),this._updateStyles(this._themeService.getColorTheme())),this._domNode}_updateStyles(e){if(!this._domNode)return;let t=e.getColor(Un),n=e.getColor(Oe);this._domNode.style.backgroundColor=String(e.getColor(ge)??``),this._domNode.style.boxShadow=t?` 0 0 8px 2px ${t}`:``,this._domNode.style.border=n?`1px solid ${n}`:``,this._domNode.style.color=String(e.getColor(lt)??``);let r=e.getColor(Ai);this._inputWithButton.domNode.style.backgroundColor=String(e.getColor(si)??``),this._inputWithButton.input.style.backgroundColor=String(e.getColor(si)??``),this._inputWithButton.domNode.style.borderWidth=r?`1px`:`0px`,this._inputWithButton.domNode.style.borderStyle=r?`solid`:`none`,this._inputWithButton.domNode.style.borderColor=r?.toString()??`none`}_updateFont(){if(this._domNode===void 0)return;K(this._label!==void 0,`RenameWidget#_updateFont: _label must not be undefined given _domNode is defined`),this._editor.applyFontInfo(this._inputWithButton.input);let e=this._editor.getOption(59);this._label.style.fontSize=`${this._computeLabelFontSize(e.fontSize)}px`}_computeLabelFontSize(e){return e*.8}getPosition(){if(!this._visible||!this._editor.hasModel()||!this._editor.getDomNode())return null;let e=ho(this.getDomNode().ownerDocument.body),t=qc(this._editor.getDomNode());this._nPxAvailableAbove=this._getTopForPosition()+t.top,this._nPxAvailableBelow=e.height-this._nPxAvailableAbove;let n=this._editor.getOption(75),{totalHeight:r}=vP.getLayoutInfo({lineHeight:n}),i=this._nPxAvailableBelow>r*6?[2,1]:[1,2];return{position:this._position,preference:i}}beforeRender(){let[e,t]=this._acceptKeybindings;return this._label.innerText=H(1375,`{0} to Rename, {1} to Preview`,this._keybindingService.lookupKeybinding(e)?.getLabel(),this._keybindingService.lookupKeybinding(t)?.getLabel()),this._domNode.style.minWidth=`200px`,null}afterRender(e){if(e===null){this.cancelInput(!0,`afterRender (because position is null)`);return}if(!this._editor.hasModel()||!this._editor.getDomNode())return;K(this._renameCandidateListView),K(this._nPxAvailableAbove!==void 0),K(this._nPxAvailableBelow!==void 0);let t=Yo(this._inputWithButton.domNode),n=Yo(this._label),r;r=e===2?this._nPxAvailableBelow:this._nPxAvailableAbove,this._renameCandidateListView.layout({height:r-n-t,width:ba(this._inputWithButton.domNode)})}acceptInput(e){this._trace(`invoking acceptInput`),this._currentAcceptInput?.(e)}cancelInput(e,t){this._currentCancelInput?.(e)}focusNextRenameSuggestion(){this._renameCandidateListView?.focusNext()||(this._inputWithButton.input.value=this._currentName)}focusPreviousRenameSuggestion(){this._renameCandidateListView?.focusPrevious()||(this._inputWithButton.input.value=this._currentName)}getInput(e,t,n,r,i){let{start:a,end:o}=this._getSelection(e,t);this._renameCts=i;let s=new P;this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,r===void 0?this._inputWithButton.button.style.display=`none`:(this._inputWithButton.button.style.display=`flex`,this._requestRenameCandidatesOnce=r,this._requestRenameCandidates(t,!1),s.add(U(this._inputWithButton.button,`click`,()=>this._requestRenameCandidates(t,!0))),s.add(U(this._inputWithButton.button,Eo.KEY_DOWN,e=>{let n=new Fs(e);(n.equals(3)||n.equals(10))&&(n.stopPropagation(),n.preventDefault(),this._requestRenameCandidates(t,!0))}))),this._isEditingRenameCandidate=!1,this._domNode.classList.toggle(`preview`,n),this._position=new x(e.startLineNumber,e.startColumn),this._currentName=t,this._inputWithButton.input.value=t,this._inputWithButton.input.setAttribute(`selectionStart`,a.toString()),this._inputWithButton.input.setAttribute(`selectionEnd`,o.toString()),this._inputWithButton.input.size=Math.max((e.endColumn-e.startColumn)*1.1,20),this._beforeFirstInputFieldEditSW.reset(),s.add(pl(()=>{this._renameCts=void 0,i.dispose(!0)})),s.add(pl(()=>{this._renameCandidateProvidersCts!==void 0&&(this._renameCandidateProvidersCts.dispose(!0),this._renameCandidateProvidersCts=void 0)})),s.add(pl(()=>this._candidates.clear()));let c=new Uu;return c.p.finally(()=>{s.dispose(),this._hide()}),this._currentCancelInput=e=>(this._trace(`invoking _currentCancelInput`),this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView?.clearCandidates(),c.complete(e),!0),this._currentAcceptInput=e=>{this._trace(`invoking _currentAcceptInput`),K(this._renameCandidateListView!==void 0);let r=this._renameCandidateListView.nCandidates,i,a,o=this._renameCandidateListView.focusedCandidate;if(o===void 0?(this._trace(`using new name from inputField`),i=this._inputWithButton.input.value,a=this._isEditingRenameCandidate?{k:`userEditedRenameSuggestion`}:{k:`inputField`}):(this._trace(`using new name from renameSuggestion`),i=o,a={k:`renameSuggestion`}),i===t||i.trim().length===0){this.cancelInput(!0,`_currentAcceptInput (because newName === value || newName.trim().length === 0)`);return}this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView.clearCandidates(),c.complete({newName:i,wantsPreview:n&&e,stats:{source:a,nRenameSuggestions:r,timeBeforeFirstInputFieldEdit:this._timeBeforeFirstInputFieldEdit,nRenameSuggestionsInvocations:this._nRenameSuggestionsInvocations,hadAutomaticRenameSuggestionsInvocation:this._hadAutomaticRenameSuggestionsInvocation}})},s.add(i.token.onCancellationRequested(()=>this.cancelInput(!0,`cts.token.onCancellationRequested`))),s.add(this._editor.onDidBlurEditorWidget(()=>this.cancelInput(!this._domNode?.ownerDocument.hasFocus(),`editor.onDidBlurEditorWidget`))),this._show(),c.p}_requestRenameCandidates(e,t){if(this._requestRenameCandidatesOnce!==void 0&&(this._renameCandidateProvidersCts!==void 0&&this._renameCandidateProvidersCts.dispose(!0),K(this._renameCts),this._inputWithButton.buttonState!==`stop`)){this._renameCandidateProvidersCts=new ur;let n=t?rs.Invoke:rs.Automatic,r=this._requestRenameCandidatesOnce(n,this._renameCandidateProvidersCts.token);if(r.length===0){this._inputWithButton.setSparkleButton();return}t||(this._hadAutomaticRenameSuggestionsInvocation=!0),this._nRenameSuggestionsInvocations+=1,this._inputWithButton.setStopButton(),this._updateRenameCandidates(r,e,this._renameCts.token)}}_getSelection(e,t){K(this._editor.hasModel());let n=this._editor.getSelection(),r=0,i=t.length;return!S.isEmpty(n)&&!S.spansMultipleLines(n)&&S.containsRange(e,n)&&(r=Math.max(0,n.startColumn-e.startColumn),i=Math.min(e.endColumn,n.endColumn)-e.startColumn),{start:r,end:i}}_show(){this._trace(`invoking _show`),this._editor.revealLineInCenterIfOutsideViewport(this._position.lineNumber,0),this._visible=!0,this._visibleContextKey.set(!0),this._editor.layoutContentWidget(this),setTimeout(()=>{this._inputWithButton.input.focus(),this._inputWithButton.input.setSelectionRange(parseInt(this._inputWithButton.input.getAttribute(`selectionStart`)),parseInt(this._inputWithButton.input.getAttribute(`selectionEnd`)))},100)}async _updateRenameCandidates(e,t,n){let r=(...e)=>this._trace(`_updateRenameCandidates`,...e);r(`start`);let i=await Me(Promise.allSettled(e),n);if(this._inputWithButton.setSparkleButton(),i===void 0){r(`returning early - received updateRenameCandidates results - undefined`);return}let a=i.flatMap(e=>e.status===`fulfilled`&&Vu(e.value)?e.value:[]);r(`received updateRenameCandidates results - total (unfiltered) ${a.length} candidates.`);let o=ki(a,e=>e.newSymbolName);r(`distinct candidates - ${o.length} candidates.`);let s=o.filter(({newSymbolName:e})=>e.trim().length>0&&e!==this._inputWithButton.input.value&&e!==t&&!this._candidates.has(e));if(r(`valid distinct candidates - ${a.length} candidates.`),s.forEach(e=>this._candidates.add(e.newSymbolName)),s.length<1){r(`returning early - no valid distinct candidates`);return}r(`setting candidates`),this._renameCandidateListView.setCandidates(s),r(`asking editor to re-layout`),this._editor.layoutContentWidget(this)}_hide(){this._trace(`invoked _hide`),this._visible=!1,this._visibleContextKey.reset(),this._editor.layoutContentWidget(this)}_getTopForPosition(){let e=this._editor.getVisibleRanges(),t;return e.length>0?t=e[0].startLineNumber:(this._logService.warn(`RenameWidget#_getTopForPosition: this should not happen - visibleRanges is empty`),t=Math.max(1,this._position.lineNumber-5)),this._editor.getTopForLineNumber(this._position.lineNumber)-this._editor.getTopForLineNumber(t)}_trace(...e){this._logService.trace(`RenameWidget`,...e)}};hP=fP([pP(2,rn),pP(3,zn),pP(4,w),pP(5,za)],hP);var gP=class e{constructor(t,n){this._disposables=new P,this._availableHeight=0,this._minimumWidth=0,this._lineHeight=n.fontInfo.lineHeight,this._typicalHalfwidthCharacterWidth=n.fontInfo.typicalHalfwidthCharacterWidth,this._listContainer=document.createElement(`div`),this._listContainer.className=`rename-box rename-candidate-list-container`,t.appendChild(this._listContainer),this._listWidget=e._createListWidget(this._listContainer,this._candidateViewHeight,n.fontInfo),this._disposables.add(this._listWidget.onDidChangeFocus(e=>{e.elements.length===1&&n.onFocusChange(e.elements[0].newSymbolName)},this._disposables)),this._disposables.add(this._listWidget.onDidChangeSelection(e=>{e.elements.length===1&&n.onSelectionChange()},this._disposables)),this._disposables.add(this._listWidget.onDidBlur(e=>{this._listWidget.setFocus([])})),this._listWidget.style(Dt({listInactiveFocusForeground:Ps,listInactiveFocusBackground:g}))}dispose(){this._listWidget.dispose(),this._disposables.dispose()}layout({height:e,width:t}){this._availableHeight=e,this._minimumWidth=t}setCandidates(e){this._listWidget.splice(0,0,e);let t=this._pickListHeight(this._listWidget.length),n=this._pickListWidth(e);this._listWidget.layout(t,n),this._listContainer.style.height=`${t}px`,this._listContainer.style.width=`${n}px`,zi(H(1376,`Received {0} rename suggestions`,e.length))}clearCandidates(){this._listContainer.style.height=`0px`,this._listContainer.style.width=`0px`,this._listWidget.splice(0,this._listWidget.length,[])}get nCandidates(){return this._listWidget.length}get focusedCandidate(){if(this._listWidget.length===0)return;let e=this._listWidget.getSelectedElements()[0];if(e!==void 0)return e.newSymbolName;let t=this._listWidget.getFocusedElements()[0];if(t!==void 0)return t.newSymbolName}focusNext(){if(this._listWidget.length===0)return!1;let e=this._listWidget.getFocus();if(e.length===0)return this._listWidget.focusFirst(),this._listWidget.reveal(0),!0;if(e[0]===this._listWidget.length-1)return this._listWidget.setFocus([]),this._listWidget.reveal(0),!1;{this._listWidget.focusNext();let e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}}focusPrevious(){if(this._listWidget.length===0)return!1;let e=this._listWidget.getFocus();if(e.length===0){this._listWidget.focusLast();let e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}else if(e[0]===0)return this._listWidget.setFocus([]),!1;else{this._listWidget.focusPrevious();let e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}}clearFocus(){this._listWidget.setFocus([])}get _candidateViewHeight(){let{totalHeight:e}=vP.getLayoutInfo({lineHeight:this._lineHeight});return e}_pickListHeight(e){let t=this._candidateViewHeight*e;return Math.min(t,this._availableHeight,this._candidateViewHeight*7)}_pickListWidth(e){let t=Math.ceil(Math.max(...e.map(e=>e.newSymbolName.length))*this._typicalHalfwidthCharacterWidth);return Math.max(this._minimumWidth,25+t+10)}static _createListWidget(e,t,n){let r=new class{getTemplateId(e){return`candidate`}getHeight(e){return t}},i=new class{constructor(){this.templateId=`candidate`}renderTemplate(e){return new vP(e,n)}renderElement(e,t,n){n.populate(e)}disposeTemplate(e){e.dispose()}};return new ht(`NewSymbolNameCandidates`,e,r,[i],{keyboardSupport:!1,mouseSupport:!0,multipleSelectionSupport:!1})}},_P=class{constructor(){this._buttonHoverContent=``,this._onDidInputChange=new E,this.onDidInputChange=this._onDidInputChange.event,this._disposables=new P}get domNode(){return this._domNode||(this._domNode=document.createElement(`div`),this._domNode.className=`rename-input-with-button`,this._domNode.style.display=`flex`,this._domNode.style.flexDirection=`row`,this._domNode.style.alignItems=`center`,this._inputNode=document.createElement(`input`),this._inputNode.className=`rename-input`,this._inputNode.type=`text`,this._inputNode.style.border=`none`,this._inputNode.setAttribute(`aria-label`,H(1377,`Rename input. Type new name and press Enter to commit.`)),this._domNode.appendChild(this._inputNode),this._buttonNode=document.createElement(`div`),this._buttonNode.className=`rename-suggestions-button`,this._buttonNode.setAttribute(`tabindex`,`0`),this._buttonGenHoverText=H(1378,`Generate new name suggestions`),this._buttonCancelHoverText=H(1379,`Cancel`),this._buttonHoverContent=this._buttonGenHoverText,this._disposables.add(an().setupDelayedHover(this._buttonNode,()=>({content:this._buttonHoverContent,appearance:{showPointer:!0,compact:!0}}))),this._domNode.appendChild(this._buttonNode),this._disposables.add(U(this.input,Eo.INPUT,()=>this._onDidInputChange.fire())),this._disposables.add(U(this.input,Eo.KEY_DOWN,e=>{let t=new Fs(e);(t.keyCode===15||t.keyCode===17)&&this._onDidInputChange.fire()})),this._disposables.add(U(this.input,Eo.CLICK,()=>this._onDidInputChange.fire())),this._disposables.add(U(this.input,Eo.FOCUS,()=>{this.domNode.style.outlineWidth=`1px`,this.domNode.style.outlineStyle=`solid`,this.domNode.style.outlineOffset=`-1px`,this.domNode.style.outlineColor=`var(--vscode-focusBorder)`})),this._disposables.add(U(this.input,Eo.BLUR,()=>{this.domNode.style.outline=`none`}))),this._domNode}get input(){return K(this._inputNode),this._inputNode}get button(){return K(this._buttonNode),this._buttonNode}get buttonState(){return this._buttonState}setSparkleButton(){this._buttonState=`sparkle`,this._sparkleIcon??=Jn(J.sparkle),Dl(this.button),this.button.appendChild(this._sparkleIcon),this.button.setAttribute(`aria-label`,`Generating new name suggestions`),this._buttonHoverContent=this._buttonGenHoverText,this.input.focus()}setStopButton(){this._buttonState=`stop`,this._stopIcon??=Jn(J.stopCircle),Dl(this.button),this.button.appendChild(this._stopIcon),this.button.setAttribute(`aria-label`,`Cancel generating new name suggestions`),this._buttonHoverContent=this._buttonCancelHoverText,this.input.focus()}dispose(){this._disposables.dispose()}},vP=class e{static{this._PADDING=2}constructor(t,n){this._domNode=document.createElement(`div`),this._domNode.className=`rename-box rename-candidate`,this._domNode.style.display=`flex`,this._domNode.style.columnGap=`5px`,this._domNode.style.alignItems=`center`,this._domNode.style.height=`${n.lineHeight}px`,this._domNode.style.padding=`${e._PADDING}px`;let r=document.createElement(`div`);r.style.display=`flex`,r.style.alignItems=`center`,r.style.width=r.style.height=`${n.lineHeight*.8}px`,this._domNode.appendChild(r),this._icon=Jn(J.sparkle),this._icon.style.display=`none`,r.appendChild(this._icon),this._label=document.createElement(`div`),ia(this._label,n),this._domNode.appendChild(this._label),t.appendChild(this._domNode)}populate(e){this._updateIcon(e),this._updateLabel(e)}_updateIcon(e){let t=!!e.tags?.includes(_s.AIGenerated);this._icon.style.display=t?`inherit`:`none`}_updateLabel(e){this._label.innerText=e.newSymbolName}static getLayoutInfo({lineHeight:t}){return{totalHeight:t+e._PADDING*2}}dispose(){}},yP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},bP=function(e,t){return function(n,r){t(n,r,e)}},xP,SP=class{constructor(e,t,n){this.model=e,this.position=t,this._providerRenameIdx=0,this._providers=n.ordered(e)}hasProvider(){return this._providers.length>0}async resolveRenameLocation(e){let t=[];for(this._providerRenameIdx=0;this._providerRenameIdx<this._providers.length;this._providerRenameIdx++){let n=this._providers[this._providerRenameIdx];if(!n.resolveRenameLocation)break;let r=await n.resolveRenameLocation(this.model,this.position,e);if(r){if(r.rejectReason){t.push(r.rejectReason);continue}return r}}this._providerRenameIdx=0;let n=this.model.getWordAtPosition(this.position);return n?{range:new S(this.position.lineNumber,n.startColumn,this.position.lineNumber,n.endColumn),text:n.word,rejectReason:t.length>0?t.join(`
`):void 0}:{range:S.fromPositions(this.position),text:``,rejectReason:t.length>0?t.join(`
`):void 0}}async provideRenameEdits(e,t){return this._provideRenameEdits(e,this._providerRenameIdx,[],t)}async _provideRenameEdits(e,t,n,r){let i=this._providers[t];if(!i)return{edits:[],rejectReason:n.join(`
`)};let a=await i.provideRenameEdits(this.model,this.position,e,r);if(a){if(a.rejectReason)return this._provideRenameEdits(e,t+1,n.concat(a.rejectReason),r)}else return this._provideRenameEdits(e,t+1,n.concat(H(1362,`No result.`)),r);return a}};async function CP(e,t,n,r){let i=new SP(t,n,e),a=await i.resolveRenameLocation(A.None);return a?.rejectReason?{edits:[],rejectReason:a.rejectReason}:i.provideRenameEdits(r,A.None)}var wP=class{static{xP=this}static{this.ID=`editor.contrib.renameController`}static get(e){return e.getContribution(xP.ID)}constructor(e,t,n,r,i,a,o,s){this.editor=e,this._instaService=t,this._notificationService=n,this._bulkEditService=r,this._progressService=i,this._logService=a,this._configService=o,this._languageFeaturesService=s,this._disposableStore=new P,this._cts=new ur,this._renameWidget=this._disposableStore.add(this._instaService.createInstance(hP,this.editor,[`acceptRenameInput`,`acceptRenameInputWithPreview`]))}dispose(){this._disposableStore.dispose(),this._cts.dispose(!0)}async run(){let e=this._logService.trace.bind(this._logService,`[rename]`);if(this._cts.dispose(!0),this._cts=new ur,!this.editor.hasModel()){e(`editor has no model`);return}let t=this.editor.getPosition(),n=new SP(this.editor.getModel(),t,this._languageFeaturesService.renameProvider);if(!n.hasProvider()){e(`skeleton has no provider`);return}let r=new gu(this.editor,5,void 0,this._cts.token),i;try{e(`resolving rename location`);let t=n.resolveRenameLocation(r.token);this._progressService.showWhile(t,250),i=await t,e(`resolved rename location`)}catch(n){n instanceof Ns?e(`resolve rename location cancelled`,JSON.stringify(n,null,`	`)):(e(`resolve rename location failed`,n instanceof Error?n:JSON.stringify(n,null,`	`)),(typeof n==`string`||or(n))&&ff.get(this.editor)?.showMessage(n||H(1363,`An unknown error occurred while resolving rename location`),t));return}finally{r.dispose()}if(!i){e(`returning early - no loc`);return}if(i.rejectReason){e(`returning early - rejected with reason: ${i.rejectReason}`,i.rejectReason),ff.get(this.editor)?.showMessage(i.rejectReason,t);return}if(r.token.isCancellationRequested){e(`returning early - cts1 cancelled`);return}let a=new gu(this.editor,5,i.range,this._cts.token),o=this.editor.getModel(),s=this._languageFeaturesService.newSymbolNamesProvider.all(o),c=await Promise.all(s.map(async e=>[e,await e.supportsAutomaticNewSymbolNamesTriggerKind??!1])),l=(e,t)=>{let n=c.slice();return e===rs.Automatic&&(n=n.filter(([e,t])=>t)),n.map(([n])=>n.provideNewSymbolNames(o,i.range,e,t))};e(`creating rename input field and awaiting its result`);let u=this._bulkEditService.hasPreviewHandler()&&this._configService.getValue(this.editor.getModel().uri,`editor.rename.enablePreview`),d=await this._renameWidget.getInput(i.range,i.text,u,s.length>0?l:void 0,a);if(e(`received response from rename input field`),typeof d==`boolean`){e(`returning early - rename input field response - ${d}`),d&&this.editor.focus(),a.dispose();return}this.editor.focus(),e(`requesting rename edits`);let f=Me(n.provideRenameEdits(d.newName,a.token),a.token).then(async t=>{if(!t){e(`returning early - no rename edits result`);return}if(!this.editor.hasModel()){e(`returning early - no model after rename edits are provided`);return}if(t.rejectReason){e(`returning early - rejected with reason: ${t.rejectReason}`),this._notificationService.info(t.rejectReason);return}this.editor.setSelection(S.fromPositions(this.editor.getSelection().getPosition())),e(`applying edits`),this._bulkEditService.apply(t,{editor:this.editor,showPreview:d.wantsPreview,label:H(1364,`Renaming '{0}' to '{1}'`,i?.text,d.newName),code:`undoredo.rename`,quotableLabel:H(1365,`Renaming {0} to {1}`,i?.text,d.newName),respectAutoSaveConfig:!0,reason:Xa.rename()}).then(t=>{e(`edits applied`),t.ariaSummary&&Xi(H(1366,`Successfully renamed '{0}' to '{1}'. Summary: {2}`,i.text,d.newName,t.ariaSummary))}).catch(t=>{e(`error when applying edits ${JSON.stringify(t,null,`	`)}`),this._notificationService.error(H(1367,`Rename failed to apply edits`)),this._logService.error(t)})},t=>{e(`error when providing rename edits`,JSON.stringify(t,null,`	`)),this._notificationService.error(H(1368,`Rename failed to compute edits`)),this._logService.error(t)}).finally(()=>{a.dispose()});return e(`returning rename operation`),this._progressService.showWhile(f,250),f}acceptRenameInput(e){this._renameWidget.acceptInput(e)}cancelRenameInput(){this._renameWidget.cancelInput(!0,`cancelRenameInput command`)}focusNextRenameSuggestion(){this._renameWidget.focusNextRenameSuggestion()}focusPreviousRenameSuggestion(){this._renameWidget.focusPreviousRenameSuggestion()}};wP=xP=yP([bP(1,k),bP(2,nt),bP(3,$o),bP(4,$l),bP(5,za),bP(6,so),bP(7,W)],wP);var TP=class extends D{constructor(){super({id:`editor.action.rename`,label:B(1370,`Rename Symbol`),precondition:j.and(F.writable,F.hasRenameProvider),kbOpts:{kbExpr:F.editorTextFocus,primary:60,weight:100},contextMenuOpts:{group:`1_modification`,order:1.1}})}runCommand(e,t){let n=e.get(mt),[r,i]=Array.isArray(t)&&t||[void 0,void 0];return $n.isUri(r)&&x.isIPosition(i)?n.openCodeEditor({resource:r},n.getActiveCodeEditor()).then(e=>{e&&(e.setPosition(i),e.invokeWithinContext(t=>(this.reportTelemetry(t,e),this.run(t,e))))},rr):super.runCommand(e,t)}run(e,t){let n=e.get(za),r=wP.get(t);return r?(n.trace(`[RenameAction] got controller, running...`),r.run()):(n.trace(`[RenameAction] returning early - controller missing`),Promise.resolve())}};G(wP.ID,wP,4),s(TP);var EP=Gi.bindToContribution(wP.get);L(new EP({id:`acceptRenameInput`,precondition:mP,handler:e=>e.acceptRenameInput(!1),kbOpts:{weight:199,kbExpr:j.and(F.focus,j.not(`isComposing`)),primary:3}})),L(new EP({id:`acceptRenameInputWithPreview`,precondition:j.and(mP,j.has(`config.editor.rename.enablePreview`)),handler:e=>e.acceptRenameInput(!0),kbOpts:{weight:199,kbExpr:j.and(F.focus,j.not(`isComposing`)),primary:2051}})),L(new EP({id:`cancelRenameInput`,precondition:mP,handler:e=>e.cancelRenameInput(),kbOpts:{weight:199,kbExpr:F.focus,primary:9,secondary:[1033]}})),y(class extends we{constructor(){super({id:`focusNextRenameSuggestion`,title:{...B(1371,`Focus Next Rename Suggestion`)},precondition:mP,keybinding:[{primary:18,weight:199}]})}run(e){let t=e.get(mt).getFocusedCodeEditor();if(!t)return;let n=wP.get(t);n&&n.focusNextRenameSuggestion()}}),y(class extends we{constructor(){super({id:`focusPreviousRenameSuggestion`,title:{...B(1372,`Focus Previous Rename Suggestion`)},precondition:mP,keybinding:[{primary:16,weight:199}]})}run(e){let t=e.get(mt).getFocusedCodeEditor();if(!t)return;let n=wP.get(t);n&&n.focusPreviousRenameSuggestion()}}),Sl(`_executeDocumentRenameProvider`,function(e,t,n,...r){let[i]=r;K(typeof i==`string`);let{renameProvider:a}=e.get(W);return CP(a,t,n,i)}),Sl(`_executePrepareRename`,async function(e,t,n){let{renameProvider:r}=e.get(W),i=await new SP(t,n,r).resolveRenameLocation(A.None);if(i?.rejectReason)throw Error(i.rejectReason);return i}),On.as(de.Configuration).registerConfiguration({id:`editor`,properties:{"editor.rename.enablePreview":{scope:6,description:H(1369,`Enable/disable the ability to preview changes before renaming`),default:!0,type:`boolean`}}});var DP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},OP=function(e,t){return function(n,r){t(n,r,e)}},kP=class extends b{static{this.ID=`editor.sectionHeaderDetector`}constructor(e,t,n){super(),this.editor=e,this.languageConfigurationService=t,this.editorWorkerService=n,this.decorations=this.editor.createDecorationsCollection(),this.options=this.createOptions(e.getOption(81)),this.computePromise=null,this.currentOccurrences={},this._register(e.onDidChangeModel(t=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(81)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(e.onDidChangeModelLanguage(t=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(81)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(t.onDidChange(t=>{let n=this.editor.getModel()?.getLanguageId();n&&t.affects(n)&&(this.currentOccurrences={},this.options=this.createOptions(e.getOption(81)),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(e.onDidChangeConfiguration(t=>{this.options&&!t.hasChanged(81)||(this.options=this.createOptions(e.getOption(81)),this.updateDecorations([]),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(this.editor.onDidChangeModelContent(e=>{this.computeSectionHeaders.schedule()})),this._register(e.onDidChangeModelTokens(e=>{this.computeSectionHeaders.isScheduled()||this.computeSectionHeaders.schedule(1e3)})),this.computeSectionHeaders=this._register(new ju(()=>{this.findSectionHeaders()},250)),this.computeSectionHeaders.schedule(0)}createOptions(e){if(!e||!this.editor.hasModel())return;let t=this.editor.getModel().getLanguageId();if(!t)return;let n=this.languageConfigurationService.getLanguageConfiguration(t).comments,r=this.languageConfigurationService.getLanguageConfiguration(t).foldingRules;if(!(!n&&!r?.markers))return{foldingRules:r,markSectionHeaderRegex:e.markSectionHeaderRegex,findMarkSectionHeaders:e.showMarkSectionHeaders,findRegionSectionHeaders:e.showRegionSectionHeaders}}findSectionHeaders(){if(!this.editor.hasModel()||!this.options?.findMarkSectionHeaders&&!this.options?.findRegionSectionHeaders)return;let e=this.editor.getModel();if(e.isDisposed()||e.isTooLargeForSyncing())return;let t=e.getVersionId();this.editorWorkerService.findSectionHeaders(e.uri,this.options).then(n=>{e.isDisposed()||e.getVersionId()!==t||this.updateDecorations(n)})}updateDecorations(e){let t=this.editor.getModel();t&&(e=e.filter(e=>{if(!e.shouldBeInComments)return!0;let n=t.validateRange(e.range),r=t.tokenization.getLineTokens(n.startLineNumber),i=r.findTokenIndexAtOffset(n.startColumn-1),a=r.getStandardTokenType(i);return r.getLanguageId(i)===t.getLanguageId()&&a===1}));let n=Object.values(this.currentOccurrences).map(e=>e.decorationId),r=e.map(e=>AP(e));this.editor.changeDecorations(t=>{let i=t.deltaDecorations(n,r);this.currentOccurrences={};for(let t=0,n=i.length;t<n;t++){let n={sectionHeader:e[t],decorationId:i[t]};this.currentOccurrences[n.decorationId]=n}})}stop(){this.computeSectionHeaders.cancel(),this.computePromise&&=(this.computePromise.cancel(),null)}dispose(){super.dispose(),this.stop(),this.decorations.clear()}};kP=DP([OP(1,Ar),OP(2,ne)],kP);function AP(e){return{range:e.range,options:R.createDynamic({description:`section-header`,stickiness:3,collapseOnReplaceEdit:!0,minimap:{color:void 0,position:1,sectionHeaderStyle:e.hasSeparatorLine?2:1,sectionHeaderText:e.text}})}}G(kP.ID,kP,1);function jP(e){for(let t=0,n=e.length;t<n;t+=4){let n=e[t+0],r=e[t+1],i=e[t+2],a=e[t+3];e[t+0]=a,e[t+1]=i,e[t+2]=r,e[t+3]=n}}function MP(e){let t=new Uint8Array(e.buffer,e.byteOffset,e.length*4);return Ol()||jP(t),Yc.wrap(t)}function NP(e){let t=new Uint32Array(PP(e)),n=0;if(t[n++]=e.id,e.type===`full`)t[n++]=1,t[n++]=e.data.length,t.set(e.data,n),n+=e.data.length;else{t[n++]=2,t[n++]=e.deltas.length;for(let r of e.deltas)t[n++]=r.start,t[n++]=r.deleteCount,r.data?(t[n++]=r.data.length,t.set(r.data,n),n+=r.data.length):t[n++]=0}return MP(t)}function PP(e){let t=0;if(t+=2,e.type===`full`)t+=1+e.data.length;else{t+=1,t+=3*e.deltas.length;for(let n of e.deltas)n.data&&(t+=n.data.length)}return t}function FP(e){return e&&!!e.data}function IP(e){return e&&Array.isArray(e.edits)}var LP=class{constructor(e,t,n){this.provider=e,this.tokens=t,this.error=n}};function RP(e,t){return e.has(t)}function zP(e,t){let n=e.orderedGroups(t);return n.length>0?n[0]:[]}async function BP(e,t,n,r,i){let a=zP(e,t),o=await Promise.all(a.map(async e=>{let a,o=null;try{a=await e.provideDocumentSemanticTokens(t,e===n?r:null,i)}catch(e){o=e,a=null}return(!a||!FP(a)&&!IP(a))&&(a=null),new LP(e,a,o)}));for(let e of o){if(e.error)throw e.error;if(e.tokens)return e}return o.length>0?o[0]:null}function VP(e,t){let n=e.orderedGroups(t);return n.length>0?n[0]:null}var HP=class{constructor(e,t){this.provider=e,this.tokens=t}};function UP(e,t){return e.has(t)}function WP(e,t){let n=e.orderedGroups(t);return n.length>0?n[0]:[]}async function GP(e,t,n,r){let i=WP(e,t),a=await Promise.all(i.map(async e=>{let i;try{i=await e.provideDocumentRangeSemanticTokens(t,n,r)}catch(e){Ze(e),i=null}return(!i||!FP(i))&&(i=null),new HP(e,i)}));for(let e of a)if(e.tokens)return e;return a.length>0?a[0]:null}gn.registerCommand(`_provideDocumentSemanticTokensLegend`,async(e,...t)=>{let[n]=t;K(n instanceof $n);let r=e.get(Fi).getModel(n);if(!r)return;let{documentSemanticTokensProvider:i}=e.get(W),a=VP(i,r);return a?a[0].getLegend():e.get(Mr).executeCommand(`_provideDocumentRangeSemanticTokensLegend`,n)}),gn.registerCommand(`_provideDocumentSemanticTokens`,async(e,...t)=>{let[n]=t;K(n instanceof $n);let r=e.get(Fi).getModel(n);if(!r)return;let{documentSemanticTokensProvider:i}=e.get(W);if(!RP(i,r))return e.get(Mr).executeCommand(`_provideDocumentRangeSemanticTokens`,n,r.getFullModelRange());let a=await BP(i,r,null,null,A.None);if(!a)return;let{provider:o,tokens:s}=a;if(!s||!FP(s))return;let c=NP({id:0,type:`full`,data:s.data});return s.resultId&&o.releaseDocumentSemanticTokens(s.resultId),c}),gn.registerCommand(`_provideDocumentRangeSemanticTokensLegend`,async(e,...t)=>{let[n,r]=t;K(n instanceof $n);let i=e.get(Fi).getModel(n);if(!i)return;let{documentRangeSemanticTokensProvider:a}=e.get(W),o=WP(a,i);if(o.length===0)return;if(o.length===1)return o[0].getLegend();if(!r||!S.isIRange(r))return console.warn(`provideDocumentRangeSemanticTokensLegend might be out-of-sync with provideDocumentRangeSemanticTokens unless a range argument is passed in`),o[0].getLegend();let s=await GP(a,i,S.lift(r),A.None);if(s)return s.provider.getLegend()}),gn.registerCommand(`_provideDocumentRangeSemanticTokens`,async(e,...t)=>{let[n,r]=t;K(n instanceof $n),K(S.isIRange(r));let i=e.get(Fi).getModel(n);if(!i)return;let{documentRangeSemanticTokensProvider:a}=e.get(W),o=await GP(a,i,S.lift(r),A.None);if(!(!o||!o.tokens))return NP({id:0,type:`full`,data:o.tokens.data})});function KP(e,t,n){let r=n.getValue(`editor.semanticHighlighting`,{overrideIdentifier:e.getLanguageId(),resource:e.uri})?.enabled;return typeof r==`boolean`?r:t.getColorTheme().semanticHighlighting}var qP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},JP=function(e,t){return function(n,r){t(n,r,e)}},YP,XP=class extends b{constructor(e,t,n,r,i,a){super(),this._watchers=new Fu;let o=t=>{this._watchers.get(t.uri)?.dispose(),this._watchers.set(t.uri,new ZP(t,e,n,i,a))},s=(e,t)=>{t.dispose(),this._watchers.delete(e.uri)},c=()=>{for(let e of t.getModels()){let t=this._watchers.get(e.uri);KP(e,n,r)?t||o(e):t&&s(e,t)}};t.getModels().forEach(e=>{KP(e,n,r)&&o(e)}),this._register(t.onModelAdded(e=>{KP(e,n,r)&&o(e)})),this._register(t.onModelRemoved(e=>{let t=this._watchers.get(e.uri);t&&s(e,t)})),this._register(r.onDidChangeConfiguration(e=>{e.affectsConfiguration(`editor.semanticHighlighting`)&&c()})),this._register(n.onDidColorThemeChange(c))}dispose(){gt(this._watchers.values()),this._watchers.clear(),super.dispose()}};XP=qP([JP(0,Vc),JP(1,Fi),JP(2,rn),JP(3,Ni),JP(4,co),JP(5,W)],XP);var ZP=class extends b{static{YP=this}static{this.REQUEST_MIN_DELAY=300}static{this.REQUEST_MAX_DELAY=2e3}constructor(e,t,n,r,i){super(),this._semanticTokensStylingService=t,this._isDisposed=!1,this._model=e,this._provider=i.documentSemanticTokensProvider,this._debounceInformation=r.for(this._provider,`DocumentSemanticTokens`,{min:YP.REQUEST_MIN_DELAY,max:YP.REQUEST_MAX_DELAY}),this._fetchDocumentSemanticTokens=this._register(new ju(()=>this._fetchDocumentSemanticTokensNow(),YP.REQUEST_MIN_DELAY)),this._currentDocumentResponse=null,this._currentDocumentRequestCancellationTokenSource=null,this._documentProvidersChangeListeners=[],this._providersChangedDuringRequest=!1,this._register(this._model.onDidChangeContent(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeAttached(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeLanguage(()=>{this._currentDocumentResponse&&=(this._currentDocumentResponse.dispose(),null),this._currentDocumentRequestCancellationTokenSource&&=(this._currentDocumentRequestCancellationTokenSource.cancel(),null),this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(0)}));let a=()=>{gt(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[];for(let t of this._provider.all(e))typeof t.onDidChange==`function`&&this._documentProvidersChangeListeners.push(t.onDidChange(()=>{if(this._currentDocumentRequestCancellationTokenSource){this._providersChangedDuringRequest=!0;return}this._fetchDocumentSemanticTokens.schedule(0)}))};a(),this._register(this._provider.onDidChange(()=>{a(),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(n.onDidColorThemeChange(e=>{this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._fetchDocumentSemanticTokens.schedule(0)}dispose(){this._currentDocumentResponse&&=(this._currentDocumentResponse.dispose(),null),this._currentDocumentRequestCancellationTokenSource&&=(this._currentDocumentRequestCancellationTokenSource.cancel(),null),gt(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[],this._setDocumentSemanticTokens(null,null,null,[]),this._isDisposed=!0,super.dispose()}_fetchDocumentSemanticTokensNow(){if(this._currentDocumentRequestCancellationTokenSource)return;if(!RP(this._provider,this._model)){this._currentDocumentResponse&&this._model.tokenization.setSemanticTokens(null,!1);return}if(!this._model.isAttachedToEditor())return;let e=new ur,t=this._currentDocumentResponse?this._currentDocumentResponse.provider:null,n=this._currentDocumentResponse&&this._currentDocumentResponse.resultId||null,r=BP(this._provider,this._model,t,n,e.token);this._currentDocumentRequestCancellationTokenSource=e,this._providersChangedDuringRequest=!1;let i=[],a=this._model.onDidChangeContent(e=>{i.push(e)}),o=new ad(!1);r.then(e=>{if(this._debounceInformation.update(this._model,o.elapsed()),this._currentDocumentRequestCancellationTokenSource=null,a.dispose(),!e)this._setDocumentSemanticTokens(null,null,null,i);else{let{provider:t,tokens:n}=e,r=this._semanticTokensStylingService.getStyling(t);this._setDocumentSemanticTokens(t,n||null,r,i)}},e=>{e&&(Pn(e)||typeof e.message==`string`&&e.message.indexOf(`busy`)!==-1)||rr(e),this._currentDocumentRequestCancellationTokenSource=null,a.dispose(),(i.length>0||this._providersChangedDuringRequest)&&(this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model)))})}static _copy(e,t,n,r,i){i=Math.min(i,n.length-r,e.length-t);for(let a=0;a<i;a++)n[r+a]=e[t+a]}_setDocumentSemanticTokens(e,t,n,r){let i=this._currentDocumentResponse,a=()=>{(r.length>0||this._providersChangedDuringRequest)&&!this._fetchDocumentSemanticTokens.isScheduled()&&this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))};if(this._currentDocumentResponse&&=(this._currentDocumentResponse.dispose(),null),this._isDisposed){e&&t&&e.releaseDocumentSemanticTokens(t.resultId);return}if(!e||!n){this._model.tokenization.setSemanticTokens(null,!1);return}if(!t){this._model.tokenization.setSemanticTokens(null,!0),a();return}if(IP(t)){if(!i){this._model.tokenization.setSemanticTokens(null,!0);return}if(t.edits.length===0)t={resultId:t.resultId,data:i.data};else{let e=0;for(let n of t.edits)e+=(n.data?n.data.length:0)-n.deleteCount;let r=i.data,a=new Uint32Array(r.length+e),o=r.length,s=a.length;for(let e=t.edits.length-1;e>=0;e--){let c=t.edits[e];if(c.start>r.length){n.warnInvalidEditStart(i.resultId,t.resultId,e,c.start,r.length),this._model.tokenization.setSemanticTokens(null,!0);return}let l=o-(c.start+c.deleteCount);l>0&&(YP._copy(r,o-l,a,s-l,l),s-=l),c.data&&(YP._copy(c.data,0,a,s-c.data.length,c.data.length),s-=c.data.length),o=c.start}o>0&&YP._copy(r,0,a,0,o),t={resultId:t.resultId,data:a}}}if(FP(t)){this._currentDocumentResponse=new QP(e,t.resultId,t.data);let i=Ml(t,n,this._model.getLanguageId());if(r.length>0)for(let e of r)for(let t of i)for(let n of e.changes)t.applyEdit(n.range,n.text);this._model.tokenization.setSemanticTokens(i,!0)}else this._model.tokenization.setSemanticTokens(null,!0);a()}};ZP=YP=qP([JP(1,Vc),JP(2,rn),JP(3,co),JP(4,W)],ZP);var QP=class{constructor(e,t,n){this.provider=e,this.resultId=t,this.data=n}dispose(){this.provider.releaseDocumentSemanticTokens(this.resultId)}};at(XP);var $P=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},eF=function(e,t){return function(n,r){t(n,r,e)}},tF=class extends b{static{this.ID=`editor.contrib.viewportSemanticTokens`}constructor(e,t,n,r,i,a){super(),this._semanticTokensStylingService=t,this._themeService=n,this._configurationService=r,this._editor=e,this._provider=a.documentRangeSemanticTokensProvider,this._debounceInformation=i.for(this._provider,`DocumentRangeSemanticTokens`,{min:100,max:500}),this._tokenizeViewport=this._register(new ju(()=>this._tokenizeViewportNow(),100)),this._outstandingRequests=[];let o=()=>{this._editor.hasModel()&&this._tokenizeViewport.schedule(this._debounceInformation.get(this._editor.getModel()))};this._register(this._editor.onDidScrollChange(()=>{o()})),this._register(this._editor.onDidChangeModel(()=>{this._cancelAll(),o()})),this._register(this._editor.onDidChangeModelContent(e=>{this._cancelAll(),o()})),this._register(this._provider.onDidChange(()=>{this._cancelAll(),o()})),this._register(this._configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(`editor.semanticHighlighting`)&&(this._cancelAll(),o())})),this._register(this._themeService.onDidColorThemeChange(()=>{this._cancelAll(),o()})),o()}_cancelAll(){for(let e of this._outstandingRequests)e.cancel();this._outstandingRequests=[]}_removeOutstandingRequest(e){for(let t=0,n=this._outstandingRequests.length;t<n;t++)if(this._outstandingRequests[t]===e){this._outstandingRequests.splice(t,1);return}}_tokenizeViewportNow(){if(!this._editor.hasModel())return;let e=this._editor.getModel();if(e.tokenization.hasCompleteSemanticTokens())return;if(!KP(e,this._themeService,this._configurationService)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}if(!UP(this._provider,e)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}let t=this._editor.getVisibleRangesPlusViewportAboveBelow();this._outstandingRequests=this._outstandingRequests.concat(t.map(t=>this._requestRange(e,t)))}_requestRange(e,t){let n=e.getVersionId(),r=bu(n=>Promise.resolve(GP(this._provider,e,t,n))),i=new ad(!1);return r.then(r=>{if(this._debounceInformation.update(e,i.elapsed()),!r||!r.tokens||e.isDisposed()||e.getVersionId()!==n)return;let{provider:a,tokens:o}=r,s=this._semanticTokensStylingService.getStyling(a);e.tokenization.setPartialSemanticTokens(t,Ml(o,s,e.getLanguageId()))}).then(()=>this._removeOutstandingRequest(r),()=>this._removeOutstandingRequest(r)),r}};tF=$P([eF(1,Vc),eF(2,rn),eF(3,Ni),eF(4,co),eF(5,W)],tF),G(tF.ID,tF,1);var nF=class{constructor(e=!0){this.selectSubwords=e}provideSelectionRanges(e,t){let n=[];for(let r of t){let t=[];n.push(t),this.selectSubwords&&this._addInWordRanges(t,e,r),this._addWordRanges(t,e,r),this._addWhitespaceLine(t,e,r),t.push({range:e.getFullModelRange()})}return n}_addInWordRanges(e,t,n){let r=t.getWordAtPosition(n);if(!r)return;let{word:i,startColumn:a}=r,o=n.column-a,s=o,c=o,l=0;for(;s>=0;s--){let e=i.charCodeAt(s);if(s!==o&&(e===95||e===45)||ea(e)&&Ui(l))break;l=e}for(s+=1;c<i.length;c++){let e=i.charCodeAt(c);if(Ui(e)&&ea(l)||e===95||e===45)break;l=e}s<c&&e.push({range:new S(n.lineNumber,a+s,n.lineNumber,a+c)})}_addWordRanges(e,t,n){let r=t.getWordAtPosition(n);r&&e.push({range:new S(n.lineNumber,r.startColumn,n.lineNumber,r.endColumn)})}_addWhitespaceLine(e,t,n){t.getLineLength(n.lineNumber)>0&&t.getLineFirstNonWhitespaceColumn(n.lineNumber)===0&&t.getLineLastNonWhitespaceColumn(n.lineNumber)===0&&e.push({range:new S(n.lineNumber,1,n.lineNumber,t.getLineMaxColumn(n.lineNumber))})}},rF=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},iF=function(e,t){return function(n,r){t(n,r,e)}},aF,oF=class e{constructor(e,t){this.index=e,this.ranges=t}mov(t){let n=this.index+(t?1:-1);if(n<0||n>=this.ranges.length)return this;let r=new e(n,this.ranges);return r.ranges[n].equalsRange(this.ranges[this.index])?r.mov(t):r}},sF=class{static{aF=this}static{this.ID=`editor.contrib.smartSelectController`}static get(e){return e.getContribution(aF.ID)}constructor(e,t){this._editor=e,this._languageFeaturesService=t,this._ignoreSelection=!1}dispose(){this._selectionListener?.dispose()}async run(e){if(!this._editor.hasModel())return;let t=this._editor.getSelections(),n=this._editor.getModel();if(this._state||await dF(this._languageFeaturesService.selectionRangeProvider,n,t.map(e=>e.getPosition()),this._editor.getOption(128),A.None).then(e=>{if(!(!Ht(e)||e.length!==t.length)&&!(!this._editor.hasModel()||!ct(this._editor.getSelections(),t,(e,t)=>e.equalsSelection(t)))){for(let n=0;n<e.length;n++)e[n]=e[n].filter(e=>e.containsPosition(t[n].getStartPosition())&&e.containsPosition(t[n].getEndPosition())),e[n].unshift(t[n]);this._state=e.map(e=>new oF(0,e)),this._selectionListener?.dispose(),this._selectionListener=this._editor.onDidChangeCursorPosition(()=>{this._ignoreSelection||(this._selectionListener?.dispose(),this._state=void 0)})}}),!this._state)return;this._state=this._state.map(t=>t.mov(e));let r=this._state.map(e=>N.fromPositions(e.ranges[e.index].getStartPosition(),e.ranges[e.index].getEndPosition()));this._ignoreSelection=!0;try{this._editor.setSelections(r)}finally{this._ignoreSelection=!1}}};sF=aF=rF([iF(1,W)],sF);var cF=class extends D{constructor(e,t){super(t),this._forward=e}async run(e,t){let n=sF.get(t);n&&await n.run(this._forward)}},lF=class extends cF{constructor(){super(!0,{id:`editor.action.smartSelect.expand`,label:B(1382,`Expand Selection`),precondition:void 0,kbOpts:{kbExpr:F.editorTextFocus,primary:1553,mac:{primary:3345,secondary:[1297]},weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`1_basic`,title:H(1380,`&&Expand Selection`),order:2}})}};gn.registerCommandAlias(`editor.action.smartSelect.grow`,`editor.action.smartSelect.expand`);var uF=class extends cF{constructor(){super(!1,{id:`editor.action.smartSelect.shrink`,label:B(1383,`Shrink Selection`),precondition:void 0,kbOpts:{kbExpr:F.editorTextFocus,primary:1551,mac:{primary:3343,secondary:[1295]},weight:100},menuOpts:{menuId:M.MenubarSelectionMenu,group:`1_basic`,title:H(1381,`&&Shrink Selection`),order:3}})}};G(sF.ID,sF,4),s(lF),s(uF);async function dF(e,t,n,r,i){let a=e.all(t).concat(new nF(r.selectSubwords));a.length===1&&a.unshift(new qT);let o=[],s=[];for(let e of a)o.push(Promise.resolve(e.provideSelectionRanges(t,n,i)).then(e=>{if(Ht(e)&&e.length===n.length)for(let t=0;t<n.length;t++){s[t]||(s[t]=[]);for(let r of e[t])S.isIRange(r.range)&&S.containsPosition(r.range,n[t])&&s[t].push(S.lift(r.range))}},Ze));return await Promise.all(o),s.map(e=>{if(e.length===0)return[];e.sort((e,t)=>x.isBefore(e.getStartPosition(),t.getStartPosition())?1:x.isBefore(t.getStartPosition(),e.getStartPosition())||x.isBefore(e.getEndPosition(),t.getEndPosition())?-1:x.isBefore(t.getEndPosition(),e.getEndPosition())?1:0);let n=[],i;for(let t of e)(!i||S.containsRange(t,i)&&!S.equalsRange(t,i))&&(n.push(t),i=t);if(!r.selectLeadingAndTrailingWhitespace)return n;let a=[n[0]];for(let e=1;e<n.length;e++){let r=n[e-1],i=n[e];if(i.startLineNumber!==r.startLineNumber||i.endLineNumber!==r.endLineNumber){let e=new S(r.startLineNumber,t.getLineFirstNonWhitespaceColumn(r.startLineNumber),r.endLineNumber,t.getLineLastNonWhitespaceColumn(r.endLineNumber));e.containsRange(r)&&!e.equalsRange(r)&&i.containsRange(e)&&!i.equalsRange(e)&&a.push(e);let n=new S(r.startLineNumber,1,r.endLineNumber,t.getLineMaxColumn(r.endLineNumber));n.containsRange(r)&&!n.equalsRange(e)&&i.containsRange(n)&&!i.equalsRange(n)&&a.push(n)}a.push(i)}return a})}gn.registerCommand(`_executeSelectionRangeProvider`,async function(e,...t){let[n,r]=t;K($n.isUri(n));let i=e.get(W).selectionRangeProvider,a=await e.get(fi).createModelReference(n);try{return dF(i,a.object.textEditorModel,r,{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},A.None)}finally{a.dispose()}});const fF=Object.freeze({View:B(1620,`View`),Help:B(1621,`Help`),Test:B(1622,`Test`),File:B(1623,`File`),Preferences:B(1624,`Preferences`),Developer:B(1625,`Developer`)});var pF=class extends na{constructor(){super({id:`editor.action.toggleStickyScroll`,title:{...B(1430,`Toggle Editor Sticky Scroll`),mnemonicTitle:H(1426,`&&Toggle Editor Sticky Scroll`)},metadata:{description:B(1431,`Toggle/enable the editor sticky scroll which shows the nested scopes at the top of the viewport`)},category:fF.View,toggled:{condition:j.equals(`config.editor.stickyScroll.enabled`,!0),title:H(1427,`Sticky Scroll`),mnemonicTitle:H(1428,`&&Sticky Scroll`)},menu:[{id:M.CommandPalette},{id:M.MenubarAppearanceMenu,group:`4_editor`,order:3},{id:M.StickyScrollContext}]})}async runEditorCommand(e,t){let n=e.get(Ni),r=!n.getValue(`editor.stickyScroll.enabled`),i=HD.get(t)?.isFocused();n.updateValue(`editor.stickyScroll.enabled`,r),i&&t.focus()}},mF=class extends na{constructor(){super({id:`editor.action.focusStickyScroll`,title:{...B(1432,`Focus Editor Sticky Scroll`),mnemonicTitle:H(1429,`&&Focus Editor Sticky Scroll`)},precondition:j.and(j.has(`config.editor.stickyScroll.enabled`),F.stickyScrollVisible),menu:[{id:M.CommandPalette}]})}runEditorCommand(e,t){HD.get(t)?.focus()}},hF=class extends na{constructor(){super({id:`editor.action.selectNextStickyScrollLine`,title:B(1433,`Select the next editor sticky scroll line`),precondition:F.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:100,primary:18}})}runEditorCommand(e,t){HD.get(t)?.focusNext()}},gF=class extends na{constructor(){super({id:`editor.action.selectPreviousStickyScrollLine`,title:B(1434,`Select the previous sticky scroll line`),precondition:F.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:100,primary:16}})}runEditorCommand(e,t){HD.get(t)?.focusPrevious()}},_F=class extends na{constructor(){super({id:`editor.action.goToFocusedStickyScrollLine`,title:B(1435,`Go to the focused sticky scroll line`),precondition:F.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:100,primary:3}})}runEditorCommand(e,t){HD.get(t)?.goToFocused()}},vF=class extends na{constructor(){super({id:`editor.action.selectEditor`,title:B(1436,`Select Editor`),precondition:F.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:100,primary:9}})}runEditorCommand(e,t){HD.get(t)?.selectEditor()}};G(HD.ID,HD,1),y(pF),y(mF),y(gF),y(hF),y(_F),y(vF);var yF=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},bF=function(e,t){return function(n,r){t(n,r,e)}},xF=class{constructor(e,t,n,r,i,a,o){this.range=e,this.insertText=t,this.filterText=n,this.additionalTextEdits=r,this.command=i,this.action=a,this.completion=o}},SF=class extends mi{constructor(e,t,n,r,i,a){super(i.disposable),this.model=e,this.line=t,this.word=n,this.completionModel=r,this._suggestMemoryService=a}canBeReused(e,t,n){return this.model===e&&this.line===t&&this.word.word.length>0&&this.word.startColumn===n.startColumn&&this.word.endColumn<n.endColumn&&this.completionModel.getIncompleteProvider().size===0}get items(){let e=[],{items:t}=this.completionModel,n=this._suggestMemoryService.select(this.model,{lineNumber:this.line,column:this.word.endColumn+this.completionModel.lineContext.characterCountDelta},t),r=gl.slice(t,n),i=gl.slice(t,0,n),a=5;for(let t of gl.concat(r,i)){if(t.score===Ft.Default)continue;let n=new S(t.editStart.lineNumber,t.editStart.column,t.editInsertEnd.lineNumber,t.editInsertEnd.column+this.completionModel.lineContext.characterCountDelta),r=t.completion.insertTextRules&&t.completion.insertTextRules&4?{snippet:t.completion.insertText}:t.completion.insertText;e.push(new xF(n,r,t.filterTextLow??t.labelLow,t.completion.additionalTextEdits,t.completion.command,t.completion.action,t)),a-->=0&&t.resolve(A.None)}return e}};SF=yF([bF(5,LT)],SF);var CF=class extends b{constructor(e,t,n,r){super(),this._languageFeatureService=e,this._clipboardService=t,this._suggestMemoryService=n,this._editorService=r,this._store.add(e.inlineCompletionsProvider.register(`*`,this))}async provideInlineCompletions(e,t,n,r){if(n.selectedSuggestionInfo)return;let i;for(let t of this._editorService.listCodeEditors())if(t.getModel()===e){i=t;break}if(!i)return;let a=i.getOption(101);if(jC.isAllOff(a))return;e.tokenization.tokenizeIfCheap(t.lineNumber);let o=e.tokenization.getLineTokens(t.lineNumber),s=o.getStandardTokenType(o.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(jC.valueFor(a,s)!==`inline`)return;let c=e.getWordAtPosition(t),l;if(c?.word||(l=this._getTriggerCharacterInfo(e,t)),!c?.word&&!l||(c||=e.getWordUntilPosition(t),c.endColumn!==t.column))return;let u,d=e.getValueInRange(new S(t.lineNumber,1,t.lineNumber,t.column));if(!l&&this._lastResult?.canBeReused(e,t.lineNumber,c)){let e=new YT(d,t.column-this._lastResult.word.endColumn);this._lastResult.completionModel.lineContext=e,this._lastResult.acquire(),u=this._lastResult}else{let n=await wC(this._languageFeatureService.completionProvider,e,t,new bC(void 0,rE.createSuggestFilter(i).itemKind,l?.providers),l&&{triggerKind:1,triggerCharacter:l.ch},r),a;n.needsClipboard&&(a=await this._clipboardService.readText());let o=new XT(n.items,t.column,new YT(d,0),JT.None,i.getOption(133),i.getOption(127),{boostFullMatch:!1,firstMatchCanBeWeak:!1},a);u=new SF(e,t.lineNumber,c,o,n,this._suggestMemoryService)}return this._lastResult=u,u}handleItemDidShow(e,t){t.completion.resolve(A.None)}disposeInlineCompletions(e){e.release()}_getTriggerCharacterInfo(e,t){let n=e.getValueInRange(S.fromPositions({lineNumber:t.lineNumber,column:t.column-1},t)),r=new Set;for(let t of this._languageFeatureService.completionProvider.all(e))t.triggerCharacters?.includes(n)&&r.add(t);if(r.size!==0)return{providers:r,ch:n}}};CF=yF([bF(0,W),bF(1,zt),bF(2,LT),bF(3,mt)],CF),at(CF),s(class extends D{constructor(){super({id:`editor.action.forceRetokenize`,label:B(1514,`Developer: Force Retokenize`),precondition:void 0})}run(e,t){if(!t.hasModel())return;let n=t.getModel();n.tokenization.resetTokenization();let r=new ad;n.tokenization.forceTokenization(n.getLineCount()),r.stop(),console.log(`tokenization took ${r.elapsed()}`)}});var wF=class e extends we{static{this.ID=`editor.action.toggleTabFocusMode`}constructor(){super({id:e.ID,title:B(1512,`Toggle Tab Key Moves Focus`),precondition:void 0,keybinding:{primary:2091,mac:{primary:1323},weight:100},metadata:{description:B(1513,`Determines whether the tab key moves focus around the workbench or inserts the tab character in the current editor. This is also called tab trapping, tab navigation, or tab focus mode.`)},f1:!0})}run(){let e=!rl.getTabFocusMode();rl.setTabFocusMode(e),Xi(e?H(1510,`Pressing Tab will now move focus to the next focusable element`):H(1511,`Pressing Tab will now insert the tab character`))}};y(wF);var TF=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},EF=function(e,t){return function(n,r){t(n,r,e)}},DF=class extends b{get enabled(){return this._enabled}set enabled(e){e?(this.el.setAttribute(`aria-disabled`,`false`),this.el.tabIndex=0,this.el.style.pointerEvents=`auto`,this.el.style.opacity=`1`,this.el.style.cursor=`pointer`,this._enabled=!1):(this.el.setAttribute(`aria-disabled`,`true`),this.el.tabIndex=-1,this.el.style.pointerEvents=`none`,this.el.style.opacity=`0.4`,this.el.style.cursor=`default`,this._enabled=!0),this._enabled=e}constructor(e,t,n={},r,i){super(),this._link=t,this._hoverService=r,this._enabled=!0,this.el=V(e,I(`a.monaco-link`,{tabIndex:t.tabIndex??0,href:t.href},t.label)),this.hoverDelegate=n.hoverDelegate??Jt(`mouse`),this.setTooltip(t.title),this.el.setAttribute(`role`,`button`);let a=this._register(new cu(this.el,`click`)),o=this._register(new cu(this.el,`keypress`)),s=vn.chain(o.event,e=>e.map(e=>new Fs(e)).filter(e=>e.keyCode===3)),c=this._register(new cu(this.el,zr.Tap)).event;this._register(ye.addTarget(this.el));let u=vn.any(a.event,s,c);this._register(u(e=>{this.enabled&&(l.stop(e,!0),n?.opener?n.opener(this._link.href):i.open(this._link.href,{allowCommands:!0}))})),this.enabled=!0}setTooltip(e){!this.hover&&e?this.hover=this._register(this._hoverService.setupManagedHover(this.hoverDelegate,this.el,e)):this.hover&&this.hover.update(e)}};DF=TF([EF(3,Ac),EF(4,cl)],DF);var OF=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},kF=function(e,t){return function(n,r){t(n,r,e)}},AF=class extends b{constructor(e,t){super(),this._editor=e,this.instantiationService=t,this.banner=this._register(this.instantiationService.createInstance(jF))}hide(){this._editor.setBanner(null,0),this.banner.clear()}show(e){this.banner.show({...e,onClose:()=>{this.hide(),e.onClose?.()}}),this._editor.setBanner(this.banner.element,26)}};AF=OF([kF(1,k)],AF);var jF=class extends b{constructor(e){super(),this.instantiationService=e,this.markdownRenderer=this.instantiationService.createInstance($r,{}),this.element=I(`div.editor-banner`),this.element.tabIndex=0}getAriaLabel(e){if(e.ariaLabel)return e.ariaLabel;if(typeof e.message==`string`)return e.message}getBannerMessage(e){if(typeof e==`string`){let t=I(`span`);return t.innerText=e,t}return this.markdownRenderer.render(e).element}clear(){Dl(this.element)}show(e){Dl(this.element);let t=this.getAriaLabel(e);t&&this.element.setAttribute(`aria-label`,t);let n=V(this.element,I(`div.icon-container`));n.setAttribute(`aria-hidden`,`true`),e.icon&&n.appendChild(I(`div${X.asCSSSelector(e.icon)}`));let r=V(this.element,I(`div.message-container`));if(r.setAttribute(`aria-hidden`,`true`),r.appendChild(this.getBannerMessage(e.message)),this.messageActionsContainer=V(this.element,I(`div.message-actions-container`)),e.actions)for(let t of e.actions)this._register(this.instantiationService.createInstance(DF,this.messageActionsContainer,{...t,tabIndex:-1},{}));let i=V(this.element,I(`div.action-container`));this.actionBar=this._register(new Bs(i)),this.actionBar.push(this._register(new pe(`banner.close`,H(1515,`Close Banner`),X.asClassName(Gl),!0,()=>{typeof e.onClose==`function`&&e.onClose()})),{icon:!0,label:!1}),this.actionBar.setFocusable(!1)}};jF=OF([kF(0,k)],jF);var MF=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},NF=function(e,t){return function(n,r){t(n,r,e)}};const PF=No(`extensions-warning-message`,J.warning,H(1516,`Icon shown with a warning message in the extensions editor.`));var FF=class extends b{static{this.ID=`editor.contrib.unicodeHighlighter`}constructor(e,t,n,r){super(),this._editor=e,this._editorWorkerService=t,this._workspaceTrustService=n,this._highlighter=null,this._bannerClosed=!1,this._updateState=e=>{if(e&&e.hasMore){if(this._bannerClosed)return;let t=Math.max(e.ambiguousCharacterCount,e.nonBasicAsciiCharacterCount,e.invisibleCharacterCount),n;if(e.nonBasicAsciiCharacterCount>=t)n={message:H(1517,`This document contains many non-basic ASCII unicode characters`),command:new XF};else if(e.ambiguousCharacterCount>=t)n={message:H(1518,`This document contains many ambiguous unicode characters`),command:new JF};else if(e.invisibleCharacterCount>=t)n={message:H(1519,`This document contains many invisible unicode characters`),command:new YF};else throw Error(`Unreachable`);this._bannerController.show({id:`unicodeHighlightBanner`,message:n.message,icon:PF,actions:[{label:n.command.shortLabel,href:`command:${n.command.desc.id}`}],onClose:()=>{this._bannerClosed=!0}})}else this._bannerController.hide()},this._bannerController=this._register(r.createInstance(AF,e)),this._register(this._editor.onDidChangeModel(()=>{this._bannerClosed=!1,this._updateHighlighter()})),this._options=e.getOption(141),this._register(n.onDidChangeTrust(e=>{this._updateHighlighter()})),this._register(e.onDidChangeConfiguration(t=>{t.hasChanged(141)&&(this._options=e.getOption(141),this._updateHighlighter())})),this._updateHighlighter()}dispose(){this._highlighter&&=(this._highlighter.dispose(),null),super.dispose()}_updateHighlighter(){if(this._updateState(null),this._highlighter&&=(this._highlighter.dispose(),null),!this._editor.hasModel())return;let e=IF(this._workspaceTrustService.isWorkspaceTrusted(),this._options);if([e.nonBasicASCII,e.ambiguousCharacters,e.invisibleCharacters].every(e=>e===!1))return;let t={nonBasicASCII:e.nonBasicASCII,ambiguousCharacters:e.ambiguousCharacters,invisibleCharacters:e.invisibleCharacters,includeComments:e.includeComments,includeStrings:e.includeStrings,allowedCodePoints:Object.keys(e.allowedCharacters).map(e=>e.codePointAt(0)),allowedLocales:Object.keys(e.allowedLocales).map(e=>e===`_os`?tt.NumberFormat().value.resolvedOptions().locale:e===`_vscode`?Ro:e)};this._editorWorkerService.canComputeUnicodeHighlights(this._editor.getModel().uri)?this._highlighter=new LF(this._editor,t,this._updateState,this._editorWorkerService):this._highlighter=new RF(this._editor,t,this._updateState)}getDecorationInfo(e){return this._highlighter?this._highlighter.getDecorationInfo(e):null}};FF=MF([NF(1,ne),NF(2,qi),NF(3,k)],FF);function IF(e,t){return{nonBasicASCII:t.nonBasicASCII===`inUntrustedWorkspace`?!e:t.nonBasicASCII,ambiguousCharacters:t.ambiguousCharacters,invisibleCharacters:t.invisibleCharacters,includeComments:t.includeComments===`inUntrustedWorkspace`?!e:t.includeComments,includeStrings:t.includeStrings===`inUntrustedWorkspace`?!e:t.includeStrings,allowedCharacters:t.allowedCharacters,allowedLocales:t.allowedLocales}}var LF=class extends b{constructor(e,t,n,r){super(),this._editor=e,this._options=t,this._updateState=n,this._editorWorkerService=r,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new ju(()=>this._update(),250)),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}let e=this._model.getVersionId();this._editorWorkerService.computedUnicodeHighlights(this._model.uri,this._options).then(t=>{if(this._model.isDisposed()||this._model.getVersionId()!==e)return;this._updateState(t);let n=[];if(!t.hasMore)for(let e of t.ranges)n.push({range:e,options:GF.instance.getDecorationFromOptions(this._options)});this._decorations.set(n)})}getDecorationInfo(e){if(!this._decorations.has(e))return null;let t=this._editor.getModel();if(!Tt(t,e))return null;let n=t.getValueInRange(e.range);return{reason:WF(n,this._options),inComment:fe(t,e),inString:Ci(t,e)}}};LF=MF([NF(3,ne)],LF);var RF=class extends b{constructor(e,t,n){super(),this._editor=e,this._options=t,this._updateState=n,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new ju(()=>this._update(),250)),this._register(this._editor.onDidLayoutChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidScrollChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeHiddenAreas(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}let e=this._editor.getVisibleRanges(),t=[],n={ranges:[],ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0,hasMore:!1};for(let t of e){let e=Yn.computeUnicodeHighlights(this._model,this._options,t);for(let t of e.ranges)n.ranges.push(t);n.ambiguousCharacterCount+=n.ambiguousCharacterCount,n.invisibleCharacterCount+=n.invisibleCharacterCount,n.nonBasicAsciiCharacterCount+=n.nonBasicAsciiCharacterCount,n.hasMore=n.hasMore||e.hasMore}if(!n.hasMore)for(let e of n.ranges)t.push({range:e,options:GF.instance.getDecorationFromOptions(this._options)});this._updateState(n),this._decorations.set(t)}getDecorationInfo(e){if(!this._decorations.has(e))return null;let t=this._editor.getModel(),n=t.getValueInRange(e.range);return Tt(t,e)?{reason:WF(n,this._options),inComment:fe(t,e),inString:Ci(t,e)}:null}},zF=H(1520,`Configure Unicode Highlight Options`),BF=class{constructor(e,t,n){this._editor=e,this._languageService=t,this._openerService=n,this.hoverOrdinal=5}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1)return[];let n=this._editor.getModel(),r=this._editor.getContribution(FF.ID);if(!r)return[];let i=[],a=new Set,o=300;for(let e of t){let t=r.getDecorationInfo(e);if(!t)continue;let s=n.getValueInRange(e.range).codePointAt(0),c=HF(s),l;switch(t.reason.kind){case 0:l=ut(t.reason.confusableWith)?H(1521,`The character {0} could be confused with the ASCII character {1}, which is more common in source code.`,c,HF(t.reason.confusableWith.codePointAt(0))):H(1522,`The character {0} could be confused with the character {1}, which is more common in source code.`,c,HF(t.reason.confusableWith.codePointAt(0)));break;case 1:l=H(1523,`The character {0} is invisible.`,c);break;case 2:l=H(1524,`The character {0} is not a basic ASCII character.`,c);break}if(a.has(l))continue;a.add(l);let u={codePoint:s,reason:t.reason,inComment:t.inComment,inString:t.inString},d=H(1525,`Adjust settings`),f=`command:${ZF.ID}?${encodeURIComponent(JSON.stringify(u))}`,p=new Tn(``,!0).appendMarkdown(l).appendText(` `).appendLink(f,d,zF);i.push(new fg(this,e.range,[p],!1,o++))}return i}renderHoverParts(e,t){return _g(e,t,this._editor,this._languageService,this._openerService)}};BF=MF([NF(1,ui),NF(2,cl)],BF);function VF(e){return`U+${e.toString(16).padStart(4,`0`)}`}function HF(e){let t=`\`${VF(e)}\``;return ar.isInvisibleCharacter(e)||(t+=` "${`${UF(e)}`}"`),t}function UF(e){return e===96?"`` ` ``":"`"+String.fromCodePoint(e)+"`"}function WF(e,t){return Yn.computeUnicodeHighlightReason(e,t)}var GF=class e{constructor(){this.map=new Map}static{this.instance=new e}getDecorationFromOptions(e){return this.getDecoration(!e.includeComments,!e.includeStrings)}getDecoration(e,t){let n=`${e}${t}`,r=this.map.get(n);return r||(r=R.createDynamic({description:`unicode-highlight`,stickiness:1,className:`unicode-highlight`,showIfCollapsed:!0,overviewRuler:null,minimap:null,hideInCommentTokens:e,hideInStringTokens:t}),this.map.set(n,r)),r}},KF=class extends D{constructor(){super({id:JF.ID,label:B(1534,`Disable highlighting of characters in comments`),precondition:void 0}),this.shortLabel=H(1526,`Disable Highlight In Comments`)}async run(e,t,n){let r=e.get(Ni);r&&this.runAction(r)}async runAction(e){await e.updateValue(Do.includeComments,!1,2)}},qF=class extends D{constructor(){super({id:JF.ID,label:B(1535,`Disable highlighting of characters in strings`),precondition:void 0}),this.shortLabel=H(1527,`Disable Highlight In Strings`)}async run(e,t,n){let r=e.get(Ni);r&&this.runAction(r)}async runAction(e){await e.updateValue(Do.includeStrings,!1,2)}},JF=class e extends we{static{this.ID=`editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters`}constructor(){super({id:e.ID,title:B(1536,`Disable highlighting of ambiguous characters`),precondition:void 0,f1:!1}),this.shortLabel=H(1528,`Disable Ambiguous Highlight`)}async run(e,t,n){let r=e.get(Ni);r&&this.runAction(r)}async runAction(e){await e.updateValue(Do.ambiguousCharacters,!1,2)}},YF=class e extends we{static{this.ID=`editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters`}constructor(){super({id:e.ID,title:B(1537,`Disable highlighting of invisible characters`),precondition:void 0,f1:!1}),this.shortLabel=H(1529,`Disable Invisible Highlight`)}async run(e,t,n){let r=e.get(Ni);r&&this.runAction(r)}async runAction(e){await e.updateValue(Do.invisibleCharacters,!1,2)}},XF=class e extends we{static{this.ID=`editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters`}constructor(){super({id:e.ID,title:B(1538,`Disable highlighting of non basic ASCII characters`),precondition:void 0,f1:!1}),this.shortLabel=H(1530,`Disable Non ASCII Highlight`)}async run(e,t,n){let r=e.get(Ni);r&&this.runAction(r)}async runAction(e){await e.updateValue(Do.nonBasicASCII,!1,2)}},ZF=class e extends we{static{this.ID=`editor.action.unicodeHighlight.showExcludeOptions`}constructor(){super({id:e.ID,title:B(1539,`Show Exclude Options`),precondition:void 0,f1:!1})}async run(e,t){let{codePoint:n,reason:r,inString:i,inComment:a}=t,o=String.fromCodePoint(n),s=e.get(xe),c=e.get(Ni);function l(e){return ar.isInvisibleCharacter(e)?H(1531,`Exclude {0} (invisible character) from being highlighted`,VF(e)):H(1532,`Exclude {0} from being highlighted`,`${VF(e)} "${o}"`)}let u=[];if(r.kind===0)for(let e of r.notAmbiguousInLocales)u.push({label:H(1533,`Allow unicode characters that are more common in the language "{0}".`,e),run:async()=>{$F(c,[e])}});if(u.push({label:l(n),run:()=>QF(c,[n])}),a){let e=new KF;u.push({label:e.label,run:async()=>e.runAction(c)})}else if(i){let e=new qF;u.push({label:e.label,run:async()=>e.runAction(c)})}function d(e){return typeof e.desc.title==`string`?e.desc.title:e.desc.title.value}if(r.kind===0){let e=new JF;u.push({label:d(e),run:async()=>e.runAction(c)})}else if(r.kind===1){let e=new YF;u.push({label:d(e),run:async()=>e.runAction(c)})}else if(r.kind===2){let e=new XF;u.push({label:d(e),run:async()=>e.runAction(c)})}else eI(r);let f=await s.pick(u,{title:zF});f&&await f.run()}};async function QF(e,t){let n=e.getValue(Do.allowedCharacters),r;r=typeof n==`object`&&n?n:{};for(let e of t)r[String.fromCodePoint(e)]=!0;await e.updateValue(Do.allowedCharacters,r,2)}async function $F(e,t){let n=e.inspect(Do.allowedLocales).user?.value,r;r=typeof n==`object`&&n?Object.assign({},n):{};for(let e of t)r[e]=!0;await e.updateValue(Do.allowedLocales,r,2)}function eI(e){throw Error(`Unexpected value: ${e}`)}y(JF),y(YF),y(XF),y(ZF),G(FF.ID,FF,1),th.register(BF);var tI=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},nI=function(e,t){return function(n,r){t(n,r,e)}},rI=`ignoreUnusualLineTerminators`;function iI(e,t,n){e.setModelProperty(t.uri,rI,n)}function aI(e,t){return e.getModelProperty(t.uri,rI)}var oI=class extends b{static{this.ID=`editor.contrib.unusualLineTerminatorsDetector`}constructor(e,t,n){super(),this._editor=e,this._dialogService=t,this._codeEditorService=n,this._isPresentingDialog=!1,this._config=this._editor.getOption(142),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(142)&&(this._config=this._editor.getOption(142),this._checkForUnusualLineTerminators())})),this._register(this._editor.onDidChangeModel(()=>{this._checkForUnusualLineTerminators()})),this._register(this._editor.onDidChangeModelContent(e=>{e.isUndoing||this._checkForUnusualLineTerminators()})),this._checkForUnusualLineTerminators()}async _checkForUnusualLineTerminators(){if(this._config===`off`||!this._editor.hasModel())return;let e=this._editor.getModel();if(!e.mightContainUnusualLineTerminators()||aI(this._codeEditorService,e)===!0||this._editor.getOption(103))return;if(this._config===`auto`){e.removeUnusualLineTerminators(this._editor.getSelections());return}if(this._isPresentingDialog)return;let t;try{this._isPresentingDialog=!0,t=await this._dialogService.confirm({title:H(1540,`Unusual Line Terminators`),message:H(1541,`Detected unusual line terminators`),detail:H(1542,`The file '{0}' contains one or more unusual line terminator characters, like Line Separator (LS) or Paragraph Separator (PS).

It is recommended to remove them from the file. This can be configured via \`editor.unusualLineTerminators\`.`,nu(e.uri)),primaryButton:H(1543,`&&Remove Unusual Line Terminators`),cancelButton:H(1544,`Ignore`)})}finally{this._isPresentingDialog=!1}if(!t.confirmed){iI(this._codeEditorService,e,!0);return}e.removeUnusualLineTerminators(this._editor.getSelections())}};oI=tI([nI(1,xo),nI(2,mt)],oI),G(oI.ID,oI,1);var sI=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},cI=function(e,t){return function(n,r){t(n,r,e)}},lI=class{constructor(){this.selector={language:`*`}}provideDocumentHighlights(e,t,n){let r=[],i=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});if(!i)return Promise.resolve(r);if(!e.isDisposed())return e.findMatches(i.word,!0,!1,!0,zl,!1).map(e=>({range:e.range,kind:Fl.Text}))}provideMultiDocumentHighlights(e,t,n,r){let i=new Fu,a=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});if(!a)return Promise.resolve(i);for(let t of[e,...n]){if(t.isDisposed())continue;let e=t.findMatches(a.word,!0,!1,!0,zl,!1).map(e=>({range:e.range,kind:Fl.Text}));e&&i.set(t.uri,e)}return i}},uI=class extends b{constructor(e){super(),this._register(e.documentHighlightProvider.register(`*`,new lI)),this._register(e.multiDocumentHighlightProvider.register(`*`,new lI))}};uI=sI([cI(0,W)],uI);var dI=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fI=function(e,t){return function(n,r){t(n,r,e)}},pI,mI,hI=new T(`hasWordHighlights`,!1);function gI(e,t,n,r){let i=e.ordered(t);return Ue(i.map(e=>()=>Promise.resolve(e.provideDocumentHighlights(t,n,r)).then(void 0,Ze)),e=>e!=null).then(e=>{if(e){let n=new Fu;return n.set(t.uri,e),n}return new Fu})}function _I(e,t,n,r,i){let a=e.ordered(t);return Ue(a.map(e=>()=>{let a=i.filter(e=>Rn(e)).filter(t=>Ra(e.selector,t.uri,t.getLanguageId(),!0,void 0,void 0)>0);return Promise.resolve(e.provideMultiDocumentHighlights(t,n,a,r)).then(void 0,Ze)}),e=>e!=null)}var vI=class{constructor(e,t,n){this._model=e,this._selection=t,this._wordSeparators=n,this._wordRange=this._getCurrentWordRange(e,t),this._result=null}get result(){return this._result||=bu(e=>this._compute(this._model,this._selection,this._wordSeparators,e)),this._result}_getCurrentWordRange(e,t){let n=e.getWordAtPosition(t.getPosition());return n?new S(t.startLineNumber,n.startColumn,t.startLineNumber,n.endColumn):null}cancel(){this.result.cancel()}},yI=class extends vI{constructor(e,t,n,r){super(e,t,n),this._providers=r}_compute(e,t,n,r){return gI(this._providers,e,t.getPosition(),r).then(e=>e||new Fu)}},bI=class extends vI{constructor(e,t,n,r,i){super(e,t,n),this._providers=r,this._otherModels=i}_compute(e,t,n,r){return _I(this._providers,e,t.getPosition(),r,this._otherModels).then(e=>e||new Fu)}};function xI(e,t,n,r){return new yI(t,n,r,e)}function SI(e,t,n,r,i){return new bI(t,n,r,e,i)}Sl(`_executeDocumentHighlights`,async(e,t,n)=>{let r=e.get(W);return(await gI(r.documentHighlightProvider,t,n,A.None))?.get(t.uri)});var CI=class{static{pI=this}static{this.storedDecorationIDs=new Fu}static{this.query=null}constructor(e,t,n,r,i,a,o,s){this.toUnhook=new P,this.workerRequestTokenId=0,this.workerRequestCompleted=!1,this.workerRequestValue=new Fu,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=void 0,this.runDelayer=this.toUnhook.add(new qa(50)),this.editor=e,this.providers=t,this.multiDocumentProviders=n,this.codeEditorService=a,this.textModelService=i,this.configurationService=o,this.logService=s,this._hasWordHighlights=hI.bindTo(r),this._ignorePositionChangeEvent=!1,this.occurrencesHighlightEnablement=this.editor.getOption(89),this.occurrencesHighlightDelay=this.configurationService.getValue(`editor.occurrencesHighlightDelay`),this.model=this.editor.getModel(),this.toUnhook.add(e.onDidChangeCursorPosition(e=>{this._ignorePositionChangeEvent||this.occurrencesHighlightEnablement!==`off`&&this.runDelayer.trigger(()=>{this._onPositionChanged(e)})})),this.toUnhook.add(e.onDidFocusEditorText(e=>{this.occurrencesHighlightEnablement!==`off`&&(this.workerRequest||this.runDelayer.trigger(()=>{this._run()}))})),this.toUnhook.add(e.onDidChangeModelContent(e=>{ds(this.model.uri,`output`)||this._stopAll()})),this.toUnhook.add(e.onDidChangeModel(e=>{!e.newModelUrl&&e.oldModelUrl?this._stopSingular():pI.query&&this._run()})),this.toUnhook.add(e.onDidChangeConfiguration(e=>{let t=this.editor.getOption(89);if(this.occurrencesHighlightEnablement!==t)switch(this.occurrencesHighlightEnablement=t,t){case`off`:this._stopAll();break;case`singleFile`:this._stopAll(pI.query?.modelInfo?.modelURI);break;case`multiFile`:pI.query&&this._run(!0);break;default:console.warn(`Unknown occurrencesHighlight setting value:`,t);break}})),this.toUnhook.add(this.configurationService.onDidChangeConfiguration(e=>{if(e.affectsConfiguration(`editor.occurrencesHighlightDelay`)){let e=o.getValue(`editor.occurrencesHighlightDelay`);this.occurrencesHighlightDelay!==e&&(this.occurrencesHighlightDelay=e)}})),this.toUnhook.add(e.onDidBlurEditorWidget(()=>{let e=this.codeEditorService.getFocusedCodeEditor();e?e.getModel()?.uri.scheme===hc.vscodeNotebookCell&&this.editor.getModel()?.uri.scheme!==hc.vscodeNotebookCell&&this._stopAll():this._stopAll()})),this.decorations=this.editor.createDecorationsCollection(),this.workerRequestTokenId=0,this.workerRequest=null,this.workerRequestCompleted=!1,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=void 0,pI.query&&this._run()}hasDecorations(){return this.decorations.length>0}restore(e){this.occurrencesHighlightEnablement!==`off`&&(this.runDelayer.cancel(),this.runDelayer.trigger(()=>{this._run(!1,e)}))}stop(){this.occurrencesHighlightEnablement!==`off`&&this._stopAll()}_getSortedHighlights(){return this.decorations.getRanges().sort(S.compareRangesUsingStarts)}moveNext(){let e=this._getSortedHighlights(),t=(e.findIndex(e=>e.containsPosition(this.editor.getPosition()))+1)%e.length,n=e[t];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(n.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(n);let r=this._getWord();if(r){let i=this.editor.getModel().getLineContent(n.startLineNumber);Xi(`${i}, ${t+1} of ${e.length} for '${r.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}moveBack(){let e=this._getSortedHighlights(),t=(e.findIndex(e=>e.containsPosition(this.editor.getPosition()))-1+e.length)%e.length,n=e[t];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(n.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(n);let r=this._getWord();if(r){let i=this.editor.getModel().getLineContent(n.startLineNumber);Xi(`${i}, ${t+1} of ${e.length} for '${r.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}_removeSingleDecorations(){if(!this.editor.hasModel())return;let e=pI.storedDecorationIDs.get(this.editor.getModel().uri);e&&(this.editor.removeDecorations(e),pI.storedDecorationIDs.delete(this.editor.getModel().uri),this.decorations.length>0&&(this.decorations.clear(),this._hasWordHighlights.set(!1)))}_removeAllDecorations(e){let t=this.codeEditorService.listCodeEditors(),n=[];for(let r of t){if(!r.hasModel()||hs(r.getModel().uri,e))continue;let t=pI.storedDecorationIDs.get(r.getModel().uri);if(!t)continue;r.removeDecorations(t),n.push(r.getModel().uri);let i=wI.get(r);if(!i?.wordHighlighter)continue;i.wordHighlighter.decorations.length>0&&(i.wordHighlighter.decorations.clear(),i.wordHighlighter.workerRequest=null,i.wordHighlighter._hasWordHighlights.set(!1))}for(let e of n)pI.storedDecorationIDs.delete(e)}_stopSingular(){this._removeSingleDecorations(),this.editor.hasTextFocus()&&(this.editor.getModel()?.uri.scheme!==hc.vscodeNotebookCell&&pI.query?.modelInfo?.modelURI.scheme!==hc.vscodeNotebookCell?(pI.query=null,this._run()):pI.query?.modelInfo&&(pI.query.modelInfo=null)),this.renderDecorationsTimer!==void 0&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=void 0),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||=(this.workerRequestTokenId++,!0)}_stopAll(e){this._removeAllDecorations(e),this.renderDecorationsTimer!==void 0&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=void 0),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||=(this.workerRequestTokenId++,!0)}_onPositionChanged(e){if(this.occurrencesHighlightEnablement===`off`){this._stopAll();return}if(e.source!==`api`&&e.reason!==3){this._stopAll();return}this._run()}_getWord(){let e=this.editor.getSelection(),t=e.startLineNumber,n=e.startColumn;return this.model.isDisposed()?null:this.model.getWordAtPosition({lineNumber:t,column:n})}getOtherModelsToHighlight(e){if(!e)return[];if(e.uri.scheme===hc.vscodeNotebookCell){let t=[],n=this.codeEditorService.listCodeEditors();for(let r of n){let n=r.getModel();n&&n!==e&&n.uri.scheme===hc.vscodeNotebookCell&&t.push(n)}return t}let t=[],n=this.codeEditorService.listCodeEditors();for(let r of n){if(!Fr(r))continue;let n=r.getModel();if(!n)continue;e===n.modified&&t.push(n.modified)}if(t.length)return t;if(this.occurrencesHighlightEnablement===`singleFile`)return[];for(let r of n){let n=r.getModel();n&&n!==e&&t.push(n)}return t}async _run(e,t){if(this.editor.hasTextFocus()){let e=this.editor.getSelection();if(!e||e.startLineNumber!==e.endLineNumber){pI.query=null,this._stopAll();return}let t=e.startColumn,n=e.endColumn,r=this._getWord();if(!r||r.startColumn>t||r.endColumn<n){pI.query=null,this._stopAll();return}pI.query={modelInfo:{modelURI:this.model.uri,selection:e}}}else if(!pI.query){this._stopAll();return}if(this.lastCursorPositionChangeTime=new Date().getTime(),hs(this.editor.getModel().uri,pI.query.modelInfo?.modelURI)){if(!e){let e=this.decorations.getRanges();for(let t of e)if(t.containsPosition(this.editor.getPosition()))return}this._stopAll(e?this.model.uri:void 0);let n=++this.workerRequestTokenId;this.workerRequestCompleted=!1;let r=this.getOtherModelsToHighlight(this.editor.getModel());if(!pI.query||!pI.query.modelInfo)return;let i=await this.textModelService.createModelReference(pI.query.modelInfo.modelURI);try{this.workerRequest=this.computeWithModel(i.object.textEditorModel,pI.query.modelInfo.selection,r),this.workerRequest?.result.then(e=>{n===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=e||[],this._beginRenderDecorations(t??this.occurrencesHighlightDelay))},rr)}catch(e){this.logService.error(`Unexpected error during occurrence request. Log: `,e)}finally{i.dispose()}}else if(this.model.uri.scheme===hc.vscodeNotebookCell){let e=++this.workerRequestTokenId;if(this.workerRequestCompleted=!1,!pI.query||!pI.query.modelInfo)return;let n=await this.textModelService.createModelReference(pI.query.modelInfo.modelURI);try{this.workerRequest=this.computeWithModel(n.object.textEditorModel,pI.query.modelInfo.selection,[this.model]),this.workerRequest?.result.then(n=>{e===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=n||[],this._beginRenderDecorations(t??this.occurrencesHighlightDelay))},rr)}catch(e){this.logService.error(`Unexpected error during occurrence request. Log: `,e)}finally{n.dispose()}}}computeWithModel(e,t,n){return n.length?SI(this.multiDocumentProviders,e,t,this.editor.getOption(147),n):xI(this.providers,e,t,this.editor.getOption(147))}_beginRenderDecorations(e){let t=new Date().getTime(),n=this.lastCursorPositionChangeTime+e;t>=n?(this.renderDecorationsTimer=void 0,this.renderDecorations()):this.renderDecorationsTimer=setTimeout(()=>{this.renderDecorations()},n-t)}renderDecorations(){this.renderDecorationsTimer=void 0;let e=this.codeEditorService.listCodeEditors();for(let t of e){let e=wI.get(t);if(!e)continue;let n=[],r=t.getModel()?.uri;if(r&&this.workerRequestValue.has(r)){let i=pI.storedDecorationIDs.get(r),a=this.workerRequestValue.get(r);if(a)for(let e of a){if(!e.range)continue;n.push({range:e.range,options:pN(e.kind)})}let o=[];t.changeDecorations(e=>{o=e.deltaDecorations(i??[],n)}),pI.storedDecorationIDs=pI.storedDecorationIDs.set(r,o),n.length>0&&(e.wordHighlighter?.decorations.set(n),e.wordHighlighter?._hasWordHighlights.set(!0))}}this.workerRequest=null}dispose(){this._stopSingular(),this.toUnhook.dispose()}};CI=pI=dI([fI(4,fi),fI(5,mt),fI(6,Ni),fI(7,za)],CI);var wI=class extends b{static{mI=this}static{this.ID=`editor.contrib.wordHighlighter`}static get(e){return e.getContribution(mI.ID)}constructor(e,t,n,r,i,a,o){super(),this._wordHighlighter=null;let s=()=>{e.hasModel()&&!e.getModel().isTooLargeForTokenization()&&e.getModel().uri.scheme!==hc.accessibleView&&(this._wordHighlighter=new CI(e,n.documentHighlightProvider,n.multiDocumentHighlightProvider,t,i,r,a,o))};this._register(e.onDidChangeModel(e=>{this._wordHighlighter&&=(!e.newModelUrl&&e.oldModelUrl?.scheme!==hc.vscodeNotebookCell&&this.wordHighlighter?.stop(),this._wordHighlighter.dispose(),null),s()})),s()}get wordHighlighter(){return this._wordHighlighter}saveViewState(){return!!(this._wordHighlighter&&this._wordHighlighter.hasDecorations())}moveNext(){this._wordHighlighter?.moveNext()}moveBack(){this._wordHighlighter?.moveBack()}restoreViewState(e){this._wordHighlighter&&e&&this._wordHighlighter.restore(250)}dispose(){this._wordHighlighter&&=(this._wordHighlighter.dispose(),null),super.dispose()}};wI=mI=dI([fI(1,w),fI(2,W),fI(3,mt),fI(4,fi),fI(5,Ni),fI(6,za)],wI);var TI=class extends D{constructor(e,t){super(t),this._isNext=e}run(e,t){let n=wI.get(t);n&&(this._isNext?n.moveNext():n.moveBack())}},EI=class extends TI{constructor(){super(!0,{id:`editor.action.wordHighlight.next`,label:B(1554,`Go to Next Symbol Highlight`),precondition:hI,kbOpts:{kbExpr:F.editorTextFocus,primary:65,weight:100}})}},DI=class extends TI{constructor(){super(!1,{id:`editor.action.wordHighlight.prev`,label:B(1555,`Go to Previous Symbol Highlight`),precondition:hI,kbOpts:{kbExpr:F.editorTextFocus,primary:1089,weight:100}})}},OI=class extends D{constructor(){super({id:`editor.action.wordHighlight.trigger`,label:B(1556,`Trigger Symbol Highlight`),precondition:void 0,kbOpts:{kbExpr:F.editorTextFocus,primary:0,weight:100}})}run(e,t,n){let r=wI.get(t);r&&r.restoreViewState(!0)}};G(wI.ID,wI,0),s(EI),s(DI),s(OI),at(uI);var kI=class extends Gi{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,n){if(!t.hasModel())return;let r=sr(t.getOption(147),t.getOption(146)),i=t.getModel(),a=t.getSelections(),o=a.length>1,s=a.map(e=>{let t=new x(e.positionLineNumber,e.positionColumn),n=this._move(r,i,t,this._wordNavigationType,o);return this._moveTo(e,n,this._inSelectionMode)});if(i.pushStackElement(),t._getViewModel().setCursorStates(`moveWordCommand`,3,s.map(e=>_o.fromModelSelection(e))),s.length===1){let e=new x(s[0].positionLineNumber,s[0].positionColumn);t.revealPosition(e,0)}}_moveTo(e,t,n){return n?new N(e.selectionStartLineNumber,e.selectionStartColumn,t.lineNumber,t.column):new N(t.lineNumber,t.column,t.lineNumber,t.column)}},AI=class extends kI{_move(e,t,n,r,i){return Pa.moveWordLeft(e,t,n,r,i)}},jI=class extends kI{_move(e,t,n,r,i){return Pa.moveWordRight(e,t,n,r)}},MI=class extends AI{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:`cursorWordStartLeft`,precondition:void 0})}},NI=class extends AI{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordEndLeft`,precondition:void 0})}},PI=class extends AI{constructor(){super({inSelectionMode:!1,wordNavigationType:1,id:`cursorWordLeft`,precondition:void 0,kbOpts:{kbExpr:j.and(F.textInputFocus,j.and(ot,lc)?.negate()),primary:2063,mac:{primary:527},weight:100}})}},FI=class extends AI{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:`cursorWordStartLeftSelect`,precondition:void 0})}},II=class extends AI{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordEndLeftSelect`,precondition:void 0})}},LI=class extends AI{constructor(){super({inSelectionMode:!0,wordNavigationType:1,id:`cursorWordLeftSelect`,precondition:void 0,kbOpts:{kbExpr:j.and(F.textInputFocus,j.and(ot,lc)?.negate()),primary:3087,mac:{primary:1551},weight:100}})}},RI=class extends AI{constructor(){super({inSelectionMode:!1,wordNavigationType:3,id:`cursorWordAccessibilityLeft`,precondition:void 0})}_move(e,t,n,r,i){return super._move(sr(_a.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},zI=class extends AI{constructor(){super({inSelectionMode:!0,wordNavigationType:3,id:`cursorWordAccessibilityLeftSelect`,precondition:void 0})}_move(e,t,n,r,i){return super._move(sr(_a.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},BI=class extends jI{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:`cursorWordStartRight`,precondition:void 0})}},VI=class extends jI{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordEndRight`,precondition:void 0,kbOpts:{kbExpr:j.and(F.textInputFocus,j.and(ot,lc)?.negate()),primary:2065,mac:{primary:529},weight:100}})}},HI=class extends jI{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordRight`,precondition:void 0})}},UI=class extends jI{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:`cursorWordStartRightSelect`,precondition:void 0})}},WI=class extends jI{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordEndRightSelect`,precondition:void 0,kbOpts:{kbExpr:j.and(F.textInputFocus,j.and(ot,lc)?.negate()),primary:3089,mac:{primary:1553},weight:100}})}},GI=class extends jI{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordRightSelect`,precondition:void 0})}},KI=class extends jI{constructor(){super({inSelectionMode:!1,wordNavigationType:3,id:`cursorWordAccessibilityRight`,precondition:void 0})}_move(e,t,n,r,i){return super._move(sr(_a.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},qI=class extends jI{constructor(){super({inSelectionMode:!0,wordNavigationType:3,id:`cursorWordAccessibilityRightSelect`,precondition:void 0})}_move(e,t,n,r,i){return super._move(sr(_a.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},JI=class extends Gi{constructor(e){super(e),this._whitespaceHeuristics=e.whitespaceHeuristics,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,n){let r=e?.get(Ar);if(!t.hasModel()||!r)return;let i=sr(t.getOption(147),t.getOption(146)),a=t.getModel(),o=t.getSelections(),s=t.getOption(10),c=t.getOption(15),l=r.getLanguageConfiguration(a.getLanguageId()).getAutoClosingPairs(),u=t._getViewModel(),d=o.map(e=>{let n=this._delete({wordSeparators:i,model:a,selection:e,whitespaceHeuristics:this._whitespaceHeuristics,autoClosingDelete:t.getOption(13),autoClosingBrackets:s,autoClosingQuotes:c,autoClosingPairs:l,autoClosedCharacters:u.getCursorAutoClosedCharacters()},this._wordNavigationType);return new io(n,``)});t.pushUndoStop(),t.executeCommands(this.id,d),t.pushUndoStop()}},YI=class extends JI{_delete(e,t){return Pa.deleteWordLeft(e,t)||new S(1,1,1,1)}},XI=class extends JI{_delete(e,t){let n=Pa.deleteWordRight(e,t);if(n)return n;let r=e.model.getLineCount(),i=e.model.getLineMaxColumn(r);return new S(r,i,r,i)}},ZI=class extends YI{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:0,id:`deleteWordStartLeft`,precondition:F.writable})}},QI=class extends YI{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:2,id:`deleteWordEndLeft`,precondition:F.writable})}},$I=class extends YI{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:0,id:`deleteWordLeft`,precondition:F.writable,kbOpts:{kbExpr:F.textInputFocus,primary:2049,mac:{primary:513},weight:100}})}},eL=class extends XI{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:0,id:`deleteWordStartRight`,precondition:F.writable})}},tL=class extends XI{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:2,id:`deleteWordEndRight`,precondition:F.writable})}},nL=class extends XI{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:2,id:`deleteWordRight`,precondition:F.writable,kbOpts:{kbExpr:F.textInputFocus,primary:2068,mac:{primary:532},weight:100}})}},rL=class extends D{constructor(){super({id:`deleteInsideWord`,precondition:F.writable,label:B(1557,`Delete Word`)})}run(e,t,n){if(!t.hasModel())return;let r=sr(t.getOption(147),t.getOption(146)),i=t.getModel(),a=t.getSelections().map(e=>{let t=Pa.deleteInsideWord(r,i,e);return new io(t,``)});t.pushUndoStop(),t.executeCommands(this.id,a),t.pushUndoStop()}};L(new MI),L(new NI),L(new PI),L(new FI),L(new II),L(new LI),L(new BI),L(new VI),L(new HI),L(new UI),L(new WI),L(new GI),L(new RI),L(new zI),L(new KI),L(new qI),L(new ZI),L(new QI),L(new $I),L(new eL),L(new tL),L(new nL),s(rL);var iL=class extends JI{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:0,id:`deleteWordPartLeft`,precondition:F.writable,kbOpts:{kbExpr:F.textInputFocus,primary:0,mac:{primary:769},weight:100}})}_delete(e,t){return Lc.deleteWordPartLeft(e)||new S(1,1,1,1)}},aL=class extends JI{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:2,id:`deleteWordPartRight`,precondition:F.writable,kbOpts:{kbExpr:F.textInputFocus,primary:0,mac:{primary:788},weight:100}})}_delete(e,t){let n=Lc.deleteWordPartRight(e);if(n)return n;let r=e.model.getLineCount(),i=e.model.getLineMaxColumn(r);return new S(r,i,r,i)}},oL=class extends kI{_move(e,t,n,r,i){return Lc.moveWordPartLeft(e,t,n,i)}},sL=class extends oL{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:`cursorWordPartLeft`,precondition:void 0,kbOpts:{kbExpr:F.textInputFocus,primary:0,mac:{primary:783},weight:100}})}};gn.registerCommandAlias(`cursorWordPartStartLeft`,`cursorWordPartLeft`);var cL=class extends oL{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:`cursorWordPartLeftSelect`,precondition:void 0,kbOpts:{kbExpr:F.textInputFocus,primary:0,mac:{primary:1807},weight:100}})}};gn.registerCommandAlias(`cursorWordPartStartLeftSelect`,`cursorWordPartLeftSelect`);var lL=class extends kI{_move(e,t,n,r,i){return Lc.moveWordPartRight(e,t,n)}},uL=class extends lL{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordPartRight`,precondition:void 0,kbOpts:{kbExpr:F.textInputFocus,primary:0,mac:{primary:785},weight:100}})}},dL=class extends lL{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordPartRightSelect`,precondition:void 0,kbOpts:{kbExpr:F.textInputFocus,primary:0,mac:{primary:1809},weight:100}})}};L(new iL),L(new aL),L(new sL),L(new cL),L(new uL),L(new dL);var fL=class extends b{static{this.ID=`editor.contrib.readOnlyMessageController`}constructor(e){super(),this.editor=e,this._register(this.editor.onDidAttemptReadOnlyEdit(()=>this._onDidAttemptReadOnlyEdit()))}_onDidAttemptReadOnlyEdit(){let e=ff.get(this.editor);if(e&&this.editor.hasModel()){let t=this.editor.getOptions().get(104);t||=this.editor.isSimpleWidget?new Tn(H(1360,`Cannot edit in read-only input`)):new Tn(H(1361,`Cannot edit in read-only editor`)),e.showMessage(t,this.editor.getPosition())}}};G(fL.ID,fL,2);var pL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},mL=function(e,t){return function(n,r){t(n,r,e)}},hL=class extends b{constructor(e,t,r){super(),this._textModel=e,this._languageFeaturesService=t,this._outlineModelService=r,this._currentModel=Vl(this,void 0);let i=Xe(`documentSymbolProvider.onDidChange`,this._languageFeaturesService.documentSymbolProvider.onDidChange),a=Xe(`_textModel.onDidChangeContent`,vn.debounce(e=>this._textModel.onDidChangeContent(e),()=>void 0,100));this._register(n(async(e,t)=>{i.read(e),a.read(e);let n=t.add(new kt),r=await this._outlineModelService.getOrCreate(this._textModel,n.token);t.isDisposed||this._currentModel.set(r,void 0)}))}getBreadcrumbItems(e,t){let n=this._currentModel.read(t);if(!n)return[];let r=n.asListOfDocumentSymbols().filter(t=>e.contains(t.range.startLineNumber)&&!e.contains(t.range.endLineNumber));return r.sort(ua(bt(e=>e.range.endLineNumber-e.range.startLineNumber,Qi))),r.map(e=>({name:e.name,kind:e.kind,startLineNumber:e.range.startLineNumber}))}};hL=pL([mL(1,W),mL(2,cC)],hL),De.setBreadcrumbsSourceFactory((e,t)=>t.createInstance(hL,e));var gL=class extends b{static{this.ID=`editor.contrib.iPadShowKeyboard`}constructor(e){super(),this.editor=e,this.widget=null,Na&&(this._register(e.onDidChangeConfiguration(()=>this.update())),this.update())}update(){let e=!this.editor.getOption(103);!this.widget&&e?this.widget=new _L(this.editor):this.widget&&!e&&(this.widget.dispose(),this.widget=null)}dispose(){super.dispose(),this.widget&&=(this.widget.dispose(),null)}},_L=class e extends b{static{this.ID=`editor.contrib.ShowKeyboardWidget`}constructor(e){super(),this.editor=e,this._domNode=document.createElement(`textarea`),this._domNode.className=`iPadShowKeyboard`,this._register(U(this._domNode,`touchstart`,e=>{this.editor.focus()})),this._register(U(this._domNode,`focus`,e=>{this.editor.focus()})),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),super.dispose()}getId(){return e.ID}getDomNode(){return this._domNode}getPosition(){return{preference:1}}};G(gL.ID,gL,3);var vL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},yL=function(e,t){return function(n,r){t(n,r,e)}},bL,xL=class extends b{static{bL=this}static{this.ID=`editor.contrib.inspectTokens`}static get(e){return e.getContribution(bL.ID)}constructor(e,t,n){super(),this._editor=e,this._languageService=n,this._widget=null,this._register(this._editor.onDidChangeModel(e=>this.stop())),this._register(this._editor.onDidChangeModelLanguage(e=>this.stop())),this._register(Lu.onDidChange(e=>this.stop())),this._register(this._editor.onKeyUp(e=>e.keyCode===9&&this.stop()))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&(this._widget=new TL(this._editor,this._languageService))}stop(){this._widget&&=(this._widget.dispose(),null)}};xL=bL=vL([yL(1,Yi),yL(2,ui)],xL);var SL=class extends D{constructor(){super({id:`editor.action.inspectTokens`,label:xr.inspectTokensAction,alias:`Developer: Inspect Tokens`,precondition:void 0})}run(e,t){xL.get(t)?.launch()}};function CL(e){let t=``;for(let n=0,r=e.length;n<r;n++){let r=e.charCodeAt(n);switch(r){case 9:t+=`→`;break;case 32:t+=`·`;break;default:t+=String.fromCharCode(r)}}return t}function wL(e,t){let n=Lu.get(t);if(n)return n;let r=e.encodeLanguageId(t);return{getInitialState:()=>Ts,tokenize:(e,n,r)=>La(t,r),tokenizeEncoded:(e,t,n)=>Bc(r,n)}}var TL=class e extends b{static{this._ID=`editor.contrib.inspectTokensWidget`}constructor(e,t){super(),this.allowEditorOverflow=!0,this._editor=e,this._languageService=t,this._model=this._editor.getModel(),this._domNode=document.createElement(`div`),this._domNode.className=`tokens-inspect-widget`,this._tokenizationSupport=wL(this._languageService.languageIdCodec,this._model.getLanguageId()),this._compute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition(e=>this._compute(this._editor.getPosition()))),this._editor.addContentWidget(this)}dispose(){this._editor.removeContentWidget(this),super.dispose()}getId(){return e._ID}_compute(e){let t=this._getTokensAtLine(e.lineNumber),n=0;for(let r=t.tokens1.length-1;r>=0;r--){let i=t.tokens1[r];if(e.column-1>=i.offset){n=r;break}}let r=0;for(let n=t.tokens2.length>>>1;n>=0;n--)if(e.column-1>=t.tokens2[n<<1]){r=n;break}let i=this._model.getLineContent(e.lineNumber),a=``;if(n<t.tokens1.length){let e=t.tokens1[n].offset,r=n+1<t.tokens1.length?t.tokens1[n+1].offset:i.length;a=i.substring(e,r)}Yr(this._domNode,I(`h2.tm-token`,void 0,CL(a),I(`span.tm-token-length`,void 0,`${a.length} ${a.length===1?`char`:`chars`}`))),V(this._domNode,I(`hr.tokens-inspect-separator`,{style:`clear:both`}));let o=(r<<1)+1<t.tokens2.length?this._decodeMetadata(t.tokens2[(r<<1)+1]):null;V(this._domNode,I(`table.tm-metadata-table`,void 0,I(`tbody`,void 0,I(`tr`,void 0,I(`td.tm-metadata-key`,void 0,`language`),I(`td.tm-metadata-value`,void 0,`${o?o.languageId:`-?-`}`)),I(`tr`,void 0,I(`td.tm-metadata-key`,void 0,`token type`),I(`td.tm-metadata-value`,void 0,`${o?this._tokenTypeToString(o.tokenType):`-?-`}`)),I(`tr`,void 0,I(`td.tm-metadata-key`,void 0,`font style`),I(`td.tm-metadata-value`,void 0,`${o?this._fontStyleToString(o.fontStyle):`-?-`}`)),I(`tr`,void 0,I(`td.tm-metadata-key`,void 0,`foreground`),I(`td.tm-metadata-value`,void 0,`${o?z.Format.CSS.formatHex(o.foreground):`-?-`}`)),I(`tr`,void 0,I(`td.tm-metadata-key`,void 0,`background`),I(`td.tm-metadata-value`,void 0,`${o?z.Format.CSS.formatHex(o.background):`-?-`}`))))),V(this._domNode,I(`hr.tokens-inspect-separator`)),n<t.tokens1.length&&V(this._domNode,I(`span.tm-token-type`,void 0,t.tokens1[n].type)),this._editor.layoutContentWidget(this)}_decodeMetadata(e){let t=Lu.getColorMap(),n=bl.getLanguageId(e),r=bl.getTokenType(e),i=bl.getFontStyle(e),a=bl.getForeground(e),o=bl.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(n),tokenType:r,fontStyle:i,foreground:t[a],background:t[o]}}_tokenTypeToString(e){switch(e){case 0:return`Other`;case 1:return`Comment`;case 2:return`String`;case 3:return`RegEx`;default:return`??`}}_fontStyleToString(e){let t=``;return e&1&&(t+=`italic `),e&2&&(t+=`bold `),e&4&&(t+=`underline `),e&8&&(t+=`strikethrough `),t.length===0&&(t=`---`),t}_getTokensAtLine(e){let t=this._getStateBeforeLine(e),n=this._tokenizationSupport.tokenize(this._model.getLineContent(e),!0,t),r=this._tokenizationSupport.tokenizeEncoded(this._model.getLineContent(e),!0,t);return{startState:t,tokens1:n.tokens,tokens2:r.tokens,endState:n.endState}}_getStateBeforeLine(e){let t=this._tokenizationSupport.getInitialState();for(let n=1;n<e;n++)t=this._tokenizationSupport.tokenize(this._model.getLineContent(n),!0,t).endState;return t}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[2,1]}}};G(xL.ID,xL,4),s(SL);var EL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},DL=function(e,t){return function(n,r){t(n,r,e)}},OL,kL=class{static{OL=this}static{this.PREFIX=`?`}constructor(e,t){this.quickInputService=e,this.keybindingService=t,this.registry=On.as(Je.Quickaccess)}provide(e){let t=new P;return t.add(e.onDidAccept(()=>{let[t]=e.selectedItems;t&&this.quickInputService.quickAccess.show(t.prefix,{preserveValue:!0})})),t.add(e.onDidChangeValue(e=>{let t=this.registry.getQuickAccessProvider(e.substr(OL.PREFIX.length));t&&t.prefix&&t.prefix!==OL.PREFIX&&this.quickInputService.quickAccess.show(t.prefix,{preserveValue:!0})})),e.items=this.getQuickAccessProviders().filter(e=>e.prefix!==OL.PREFIX),t}getQuickAccessProviders(){return this.registry.getQuickAccessProviders().sort((e,t)=>e.prefix.localeCompare(t.prefix)).flatMap(e=>this.createPicks(e))}createPicks(e){return e.helpEntries.map(t=>{let n=t.prefix||e.prefix,r=n||`…`;return{prefix:n,label:r,keybinding:t.commandId?this.keybindingService.lookupKeybinding(t.commandId):void 0,ariaLabel:H(1728,`{0}, {1}`,r,t.description),description:t.description}})}};kL=OL=EL([DL(0,xe),DL(1,zn)],kL),On.as(Je.Quickaccess).registerQuickAccessProvider({ctor:kL,prefix:``,helpEntries:[{description:Ao.helpQuickAccessActionLabel}]});var AL=class{constructor(e){this.options=e,this.rangeHighlightDecorationId=void 0}provide(e,t,n){let r=new P;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;let i=r.add(new Ot);return i.value=this.doProvide(e,t,n),r.add(this.onDidActiveTextEditorControlChange(()=>{i.value=void 0,i.value=this.doProvide(e,t)})),r}doProvide(e,t,n){let r=new P,i=this.activeTextEditorControl;if(i&&this.canProvideWithTextEditor(i)){let a={editor:i},o=Ha(i);if(o){let e=i.saveViewState()??void 0;r.add(o.onDidChangeCursorPosition(()=>{e=i.saveViewState()??void 0})),a.restoreViewState=()=>{e&&i===this.activeTextEditorControl&&i.restoreViewState(e)},r.add(Yt(t.onCancellationRequested)(()=>a.restoreViewState?.()))}r.add(pl(()=>this.clearDecorations(i))),r.add(this.provideWithTextEditor(a,e,t,n))}else r.add(this.provideWithoutTextEditor(e,t));return r}canProvideWithTextEditor(e){return!0}gotoLocation({editor:e},t){e.setSelection(t.range,`code.jump`),e.revealRangeInCenter(t.range,0),t.preserveFocus||e.focus();let n=e.getModel();n&&`getLineContent`in n&&zi(`${n.getLineContent(t.range.startLineNumber)}`)}getModel(e){return Fr(e)?e.getModel()?.modified:e.getModel()}addDecorations(e,t){e.changeDecorations(e=>{let n=[];this.rangeHighlightDecorationId&&=(n.push(this.rangeHighlightDecorationId.overviewRulerDecorationId),n.push(this.rangeHighlightDecorationId.rangeHighlightId),void 0);let r=[{range:t,options:{description:`quick-access-range-highlight`,className:`rangeHighlight`,isWholeLine:!0}},{range:t,options:{description:`quick-access-range-highlight-overview`,overviewRuler:{color:Kt(pt),position:En.Full}}}],[i,a]=e.deltaDecorations(n,r);this.rangeHighlightDecorationId={rangeHighlightId:i,overviewRulerDecorationId:a}})}clearDecorations(e){let t=this.rangeHighlightDecorationId;t&&(e.changeDecorations(e=>{e.deltaDecorations([t.overviewRulerDecorationId,t.rangeHighlightId],[])}),this.rangeHighlightDecorationId=void 0)}},jL=class e extends AL{static{this.PREFIX=`:`}constructor(){super({canAcceptInBackground:!0})}provideWithoutTextEditor(e){let t=H(1322,`Open a text editor first to go to a line.`);return e.items=[{label:t}],e.ariaLabel=t,b.None}provideWithTextEditor(t,n,r){let i=t.editor,a=new P;a.add(n.onDidAccept(e=>{let[r]=n.selectedItems;if(r){if(!this.isValidLineNumber(i,r.lineNumber))return;this.gotoLocation(t,{range:this.toRange(r.lineNumber,r.column),keyMods:n.keyMods,preserveFocus:e.inBackground}),e.inBackground||n.hide()}}));let o=()=>{let t=this.parsePosition(i,n.value.trim().substr(e.PREFIX.length)),r=this.getPickLabel(i,t.lineNumber,t.column);if(n.items=[{lineNumber:t.lineNumber,column:t.column,label:r}],n.ariaLabel=r,!this.isValidLineNumber(i,t.lineNumber)){this.clearDecorations(i);return}let a=this.toRange(t.lineNumber,t.column);i.revealRangeInCenter(a,0),this.addDecorations(i,a)};o(),a.add(n.onDidChangeValue(()=>o()));let s=Ha(i);return s&&s.getOptions().get(76).renderType===2&&(s.updateOptions({lineNumbers:`on`}),a.add(pl(()=>s.updateOptions({lineNumbers:`relative`})))),a}toRange(e=1,t=1){return{startLineNumber:e,startColumn:t,endLineNumber:e,endColumn:t}}parsePosition(e,t){let n=t.split(/,|:|#/).map(e=>parseInt(e,10)).filter(e=>!isNaN(e)),r=this.lineCount(e)+1;return{lineNumber:n[0]>0?n[0]:r+n[0],column:n[1]}}getPickLabel(e,t,n){if(this.isValidLineNumber(e,t))return this.isValidColumn(e,t,n)?H(1323,`Go to line {0} and character {1}.`,t,n):H(1324,`Go to line {0}.`,t);let r=e.getPosition()||{lineNumber:1,column:1},i=this.lineCount(e);return i>1?H(1325,`Current Line: {0}, Character: {1}. Type a line number between 1 and {2} to navigate to.`,r.lineNumber,r.column,i):H(1326,`Current Line: {0}, Character: {1}. Type a line number to navigate to.`,r.lineNumber,r.column)}isValidLineNumber(e,t){return!t||typeof t!=`number`?!1:t>0&&t<=this.lineCount(e)}isValidColumn(e,t,n){if(!n||typeof n!=`number`)return!1;let r=this.getModel(e);if(!r)return!1;let i={lineNumber:t,column:n};return r.validatePosition(i).equals(i)}lineCount(e){return this.getModel(e)?.getLineCount()??0}},ML=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},NL=function(e,t){return function(n,r){t(n,r,e)}},PL=class extends jL{constructor(e){super(),this.editorService=e,this.onDidActiveTextEditorControlChange=vn.None}get activeTextEditorControl(){return this.editorService.getFocusedCodeEditor()??void 0}};PL=ML([NL(0,mt)],PL);var FL=class e extends D{static{this.ID=`editor.action.gotoLine`}constructor(){super({id:e.ID,label:ga.gotoLineActionLabel,alias:`Go to Line/Column...`,precondition:void 0,kbOpts:{kbExpr:F.focus,primary:2085,mac:{primary:293},weight:100}})}run(e){e.get(xe).quickAccess.show(PL.PREFIX)}};s(FL),On.as(Je.Quickaccess).registerQuickAccessProvider({ctor:PL,prefix:PL.PREFIX,helpEntries:[{description:ga.gotoLineActionLabel,commandId:FL.ID}]});var IL=[void 0,[]];function LL(e,t,n=0,r=0){let i=t;return i.values&&i.values.length>1?RL(e,i.values,n,r):zL(e,t,n,r)}function RL(e,t,n,r){let i=0,a=[];for(let o of t){let[t,s]=zL(e,o,n,r);if(typeof t!=`number`)return IL;i+=t,a.push(...s)}return[i,BL(a)]}function zL(e,t,n,r){let i=ue(t.original,t.originalLowercase,n,e,e.toLowerCase(),r,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return i?[i[0],td(i)]:IL}Object.freeze({score:0});function BL(e){let t=e.sort((e,t)=>e.start-t.start),n=[],r;for(let e of t)!r||!VL(r,e)?(r=e,n.push(e)):(r.start=Math.min(r.start,e.start),r.end=Math.max(r.end,e.end));return n}function VL(e,t){return!(e.end<t.start||t.end<e.start)}function HL(e){return e.startsWith(`"`)&&e.endsWith(`"`)}function UL(e){typeof e!=`string`&&(e=``);let t=e.toLowerCase(),{pathNormalized:n,normalized:r,normalizedLowercase:i}=WL(e),a=n.indexOf(Vs)>=0,o=HL(e),s,c=e.split(` `);if(c.length>1)for(let e of c){let t=HL(e),{pathNormalized:n,normalized:r,normalizedLowercase:i}=WL(e);r&&(s||=[],s.push({original:e,originalLowercase:e.toLowerCase(),pathNormalized:n,normalized:r,normalizedLowercase:i,expectContiguousMatch:t}))}return{original:e,originalLowercase:t,pathNormalized:n,normalized:r,normalizedLowercase:i,values:s,containsPathSeparator:a,expectContiguousMatch:o}}function WL(e){let t;t=go?e.replace(/\//g,Vs):e.replace(/\\/g,Vs);let n=Po(t).replace(/\s|"/g,``);return{pathNormalized:t,normalized:n,normalizedLowercase:n.toLowerCase()}}function GL(e){return UL(Array.isArray(e)?e.map(e=>e.original).join(` `):e.original)}var KL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qL=function(e,t){return function(n,r){t(n,r,e)}},JL,YL=class extends AL{static{JL=this}static{this.PREFIX=`@`}static{this.SCOPE_PREFIX=`:`}static{this.PREFIX_BY_CATEGORY=`${this.PREFIX}${this.SCOPE_PREFIX}`}constructor(e,t,n=Object.create(null)){super(n),this._languageFeaturesService=e,this._outlineModelService=t,this.options=n,this.options.canAcceptInBackground=!0}provideWithoutTextEditor(e){return this.provideLabelPick(e,H(1327,`To go to a symbol, first open a text editor with symbol information.`)),b.None}provideWithTextEditor(e,t,n,r){let i=e.editor,a=this.getModel(i);return a?this._languageFeaturesService.documentSymbolProvider.has(a)?this.doProvideWithEditorSymbols(e,a,t,n,r):this.doProvideWithoutEditorSymbols(e,a,t,n):b.None}doProvideWithoutEditorSymbols(e,t,n,r){let i=new P;return this.provideLabelPick(n,H(1328,`The active text editor does not provide symbol information.`)),(async()=>{!await this.waitForLanguageSymbolRegistry(t,i)||r.isCancellationRequested||i.add(this.doProvideWithEditorSymbols(e,t,n,r))})(),i}provideLabelPick(e,t){e.items=[{label:t,index:0,kind:14}],e.ariaLabel=t}async waitForLanguageSymbolRegistry(e,t){if(this._languageFeaturesService.documentSymbolProvider.has(e))return!0;let n=new Uu,r=t.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>{this._languageFeaturesService.documentSymbolProvider.has(e)&&(r.dispose(),n.complete(!0))}));return t.add(pl(()=>n.complete(!1))),n.p}doProvideWithEditorSymbols(e,t,n,r,i){let a=e.editor,o=new P;o.add(n.onDidAccept(t=>{let[r]=n.selectedItems;r&&r.range&&(this.gotoLocation(e,{range:r.range.selection,keyMods:n.keyMods,preserveFocus:t.inBackground}),i?.handleAccept?.(r,t.inBackground),t.inBackground||n.hide())})),o.add(n.onDidTriggerItemButton(({item:t})=>{t&&t.range&&(this.gotoLocation(e,{range:t.range.selection,keyMods:n.keyMods,forceSideBySide:!0}),n.hide())}));let s=this.getDocumentSymbols(t,r),c=o.add(new Ot),l=async e=>{c?.value?.cancel(),n.busy=!1,c.value=new ur,n.busy=!0;try{let i=UL(n.value.substr(JL.PREFIX.length).trim()),a=await this.doGetSymbolPicks(s,i,void 0,c.value.token,t);if(r.isCancellationRequested)return;if(a.length>0){if(n.items=a,e&&i.original.length===0){let t=Su(a,t=>!!(t.type!==`separator`&&t.range&&S.containsPosition(t.range.decoration,e)));t&&(n.activeItems=[t])}}else i.original.length>0?this.provideLabelPick(n,H(1329,`No matching editor symbols`)):this.provideLabelPick(n,H(1330,`No editor symbols`))}finally{r.isCancellationRequested||(n.busy=!1)}};return o.add(n.onDidChangeValue(()=>l(void 0))),l(a.getSelection()?.getPosition()),o.add(n.onDidChangeActive(()=>{let[e]=n.activeItems;e&&e.range&&(a.revealRangeInCenter(e.range.selection,0),this.addDecorations(a,e.range.decoration))})),o}async doGetSymbolPicks(e,t,n,r,i){let a=await e;if(r.isCancellationRequested)return[];let o=t.original.indexOf(JL.SCOPE_PREFIX)===0,s=o?1:0,c,l;t.values&&t.values.length>1?(c=GL(t.values[0]),l=GL(t.values.slice(1))):c=t;let u,d=this.options?.openSideBySideDirection?.();d&&(u=[{iconClass:d===`right`?X.asClassName(J.splitHorizontal):X.asClassName(J.splitVertical),tooltip:d===`right`?H(1331,`Open to the Side`):H(1332,`Open to the Bottom`)}]);let f=[];for(let e=0;e<a.length;e++){let r=a[e],o=Kl(r.name),d=`$(${$a.toIcon(r.kind).id}) ${o}`,p=d.length-o.length,m=r.containerName;n?.extraContainerLabel&&(m=m?`${n.extraContainerLabel} • ${m}`:n.extraContainerLabel);let h,g,_,ee;if(t.original.length>s){let e=!1;if(c!==t&&([h,g]=LL(d,{...t,values:void 0},s,p),typeof h==`number`&&(e=!0)),typeof h!=`number`&&([h,g]=LL(d,c,s,p),typeof h!=`number`))continue;if(!e&&l){if(m&&l.original.length>0&&([_,ee]=LL(m,l)),typeof _!=`number`)continue;typeof h==`number`&&(h+=_)}}let v=r.tags&&r.tags.indexOf(1)>=0;f.push({index:e,kind:r.kind,score:h,label:d,ariaLabel:Kr(r.name,r.kind),description:m,highlights:v?void 0:{label:g,description:ee},range:{selection:S.collapseToStart(r.selectionRange),decoration:r.range},uri:i.uri,symbolName:o,strikethrough:v,buttons:u})}let p=f.sort((e,t)=>o?this.compareByKindAndScore(e,t):this.compareByScore(e,t)),m=[];if(o){let e,t,n=0;function r(){t&&typeof e==`number`&&n>0&&(t.label=ci(ZL[e]||XL,n))}for(let i of p)e===i.kind?n++:(r(),e=i.kind,n=1,t={type:`separator`},m.push(t)),m.push(i);r()}else p.length>0&&(m=[{label:H(1333,`symbols ({0})`,f.length),type:`separator`},...p]);return m}compareByScore(e,t){if(typeof e.score!=`number`&&typeof t.score==`number`)return 1;if(typeof e.score==`number`&&typeof t.score!=`number`)return-1;if(typeof e.score==`number`&&typeof t.score==`number`){if(e.score>t.score)return-1;if(e.score<t.score)return 1}return e.index<t.index?-1:e.index>t.index?1:0}compareByKindAndScore(e,t){let n=ZL[e.kind]||XL,r=ZL[t.kind]||XL,i=n.localeCompare(r);return i===0?this.compareByScore(e,t):i}async getDocumentSymbols(e,t){let n=await this._outlineModelService.getOrCreate(e,t);return t.isCancellationRequested?[]:n.asListOfDocumentSymbols()}};YL=JL=KL([qL(0,W),qL(1,cC)],YL);var XL=H(1334,`properties ({0})`),ZL={5:H(1335,`methods ({0})`),11:H(1336,`functions ({0})`),8:H(1337,`constructors ({0})`),12:H(1338,`variables ({0})`),4:H(1339,`classes ({0})`),22:H(1340,`structs ({0})`),23:H(1341,`events ({0})`),24:H(1342,`operators ({0})`),10:H(1343,`interfaces ({0})`),2:H(1344,`namespaces ({0})`),3:H(1345,`packages ({0})`),25:H(1346,`type parameters ({0})`),1:H(1347,`modules ({0})`),6:H(1348,`properties ({0})`),9:H(1349,`enumerations ({0})`),21:H(1350,`enumeration members ({0})`),14:H(1351,`strings ({0})`),0:H(1352,`files ({0})`),17:H(1353,`arrays ({0})`),15:H(1354,`numbers ({0})`),16:H(1355,`booleans ({0})`),18:H(1356,`objects ({0})`),19:H(1357,`keys ({0})`),7:H(1358,`fields ({0})`),13:H(1359,`constants ({0})`)},QL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$L=function(e,t){return function(n,r){t(n,r,e)}},eR=class extends YL{constructor(e,t,n){super(t,n),this.editorService=e,this.onDidActiveTextEditorControlChange=vn.None}get activeTextEditorControl(){return this.editorService.getFocusedCodeEditor()??void 0}};eR=QL([$L(0,mt),$L(1,W),$L(2,cC)],eR);var tR=class e extends D{static{this.ID=`editor.action.quickOutline`}constructor(){super({id:e.ID,label:Hl.quickOutlineActionLabel,alias:`Go to Symbol...`,precondition:F.hasDocumentSymbolProvider,kbOpts:{kbExpr:F.focus,primary:3117,weight:100},contextMenuOpts:{group:`navigation`,order:3}})}run(e){e.get(xe).quickAccess.show(YL.PREFIX,{itemActivation:xu.NONE})}};s(tR),On.as(Je.Quickaccess).registerQuickAccessProvider({ctor:eR,prefix:YL.PREFIX,helpEntries:[{description:Hl.quickOutlineActionLabel,prefix:YL.PREFIX,commandId:tR.ID},{description:Hl.quickOutlineByCategoryActionLabel,prefix:YL.PREFIX_BY_CATEGORY}]});function nR(e){let t=new Map;for(let n of e)t.set(n,(t.get(n)??0)+1);return t}var rR=class e{constructor(){this.chunkCount=0,this.chunkOccurrences=new Map,this.documents=new Map}calculateScores(e,t){let n=this.computeEmbedding(e),r=new Map,i=[];for(let[e,a]of this.documents){if(t.isCancellationRequested)return[];for(let t of a.chunks){let a=this.computeSimilarityScore(t,n,r);a>0&&i.push({key:e,score:a})}}return i}static termFrequencies(t){return nR(e.splitTerms(t))}static*splitTerms(e){let t=e=>e.toLowerCase();for(let[n]of e.matchAll(/\b\p{Letter}[\p{Letter}\d]{2,}\b/gu)){yield t(n);let e=n.replace(/([a-z])([A-Z])/g,`$1 $2`).split(/\s+/g);if(e.length>1)for(let n of e)n.length>2&&/\p{Letter}{3,}/gu.test(n)&&(yield t(n))}}updateDocuments(t){for(let{key:e}of t)this.deleteDocument(e);for(let n of t){let t=[];for(let r of n.textChunks){let n=e.termFrequencies(r);for(let e of n.keys())this.chunkOccurrences.set(e,(this.chunkOccurrences.get(e)??0)+1);t.push({text:r,tf:n})}this.chunkCount+=t.length,this.documents.set(n.key,{chunks:t})}return this}deleteDocument(e){let t=this.documents.get(e);if(t){this.documents.delete(e),this.chunkCount-=t.chunks.length;for(let e of t.chunks)for(let t of e.tf.keys()){let e=this.chunkOccurrences.get(t);if(typeof e==`number`){let n=e-1;n<=0?this.chunkOccurrences.delete(t):this.chunkOccurrences.set(t,n)}}}}computeSimilarityScore(e,t,n){let r=0;for(let[i,a]of Object.entries(t)){let t=e.tf.get(i);if(!t)continue;let o=n.get(i);typeof o!=`number`&&(o=this.computeIdf(i),n.set(i,o));let s=t*o;r+=s*a}return r}computeEmbedding(t){let n=e.termFrequencies(t);return this.computeTfidf(n)}computeIdf(e){let t=this.chunkOccurrences.get(e)??0;return t>0?Math.log((this.chunkCount+1)/t):0}computeTfidf(e){let t=Object.create(null);for(let[n,r]of e){let e=this.computeIdf(n);e>0&&(t[n]=r*e)}return t}};function iR(e){let t=e.slice(0);t.sort((e,t)=>t.score-e.score);let n=t[0]?.score??0;if(n>0)for(let e of t)e.score/=n;return t}var aR;(function(e){e[e.NO_ACTION=0]=`NO_ACTION`,e[e.CLOSE_PICKER=1]=`CLOSE_PICKER`,e[e.REFRESH_PICKER=2]=`REFRESH_PICKER`,e[e.REMOVE_ITEM=3]=`REMOVE_ITEM`})(aR||={});function oR(e){let t=e;return Array.isArray(t.items)}function sR(e){let t=e;return!!t.picks&&t.additionalPicks instanceof Promise}var cR=class extends b{constructor(e,t){super(),this.prefix=e,this.options=t}provide(e,t,n){let r=new P;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;let i,a=r.add(new Ot),o=async()=>{i?.dispose(!0),e.busy=!1;let r=a.value=new P;i=r.add(new ur(t));let o=i.token,s=e.value.substring(this.prefix.length);this.options?.shouldSkipTrimPickFilter||(s=s.trim());let c=this._getPicks(s,r,o,n),l=(t,n)=>{let r,i;if(oR(t)?(r=t.items,i=t.active):r=t,r.length===0){if(n)return!1;(s.length>0||e.hideInput)&&this.options?.noResultsPick&&(r=Ga(this.options.noResultsPick)?[this.options.noResultsPick(s)]:[this.options.noResultsPick])}return e.items=r,i&&(e.activeItems=[i]),!0},u=async t=>{let n=!1,r=!1;await Promise.all([(async()=>{typeof t.mergeDelay==`number`&&(await qs(t.mergeDelay),o.isCancellationRequested)||r||(n=l(t.picks,!0))})(),(async()=>{e.busy=!0;try{let r=await t.additionalPicks;if(o.isCancellationRequested)return;let i,a;oR(t.picks)?(i=t.picks.items,a=t.picks.active):i=t.picks;let s,c;if(oR(r)?(s=r.items,c=r.active):s=r,s.length>0||!n){let t;if(!a&&!c){let n=e.activeItems[0];n&&i.indexOf(n)!==-1&&(t=n)}l({items:[...i,...s],active:a||c||t})}}finally{o.isCancellationRequested||(e.busy=!1),r=!0}})()])};if(c!==null)if(sR(c))await u(c);else if(!(c instanceof Promise))l(c);else{e.busy=!0;try{let e=await c;if(o.isCancellationRequested)return;sR(e)?await u(e):l(e)}finally{o.isCancellationRequested||(e.busy=!1)}}};r.add(e.onDidChangeValue(()=>o())),o(),r.add(e.onDidAccept(t=>{if(n?.handleAccept){t.inBackground||e.hide(),n.handleAccept?.(e.activeItems[0],t.inBackground);return}let[r]=e.selectedItems;typeof r?.accept==`function`&&(t.inBackground||e.hide(),r.accept(e.keyMods,t))}));let s=async(n,r)=>{if(typeof r.trigger!=`function`)return;let i=r.buttons?.indexOf(n)??-1;if(i>=0){let n=r.trigger(i,e.keyMods),a=typeof n==`number`?n:await n;if(t.isCancellationRequested)return;switch(a){case aR.NO_ACTION:break;case aR.CLOSE_PICKER:e.hide();break;case aR.REFRESH_PICKER:o();break;case aR.REMOVE_ITEM:{let t=e.items.indexOf(r);if(t!==-1){let n=e.items.slice(),r=n.splice(t,1),i=e.activeItems.filter(e=>e!==r[0]),a=e.keepScrollPosition;e.keepScrollPosition=!0,e.items=n,i&&(e.activeItems=i),e.keepScrollPosition=a}break}}}};return r.add(e.onDidTriggerItemButton(({button:e,item:t})=>s(e,t))),r.add(e.onDidTriggerSeparatorButton(({button:e,separator:t})=>s(e,t))),r}},lR=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},uR=function(e,t){return function(n,r){t(n,r,e)}},dR,fR,pR=class extends cR{static{dR=this}static{this.PREFIX=`>`}static{this.TFIDF_THRESHOLD=.5}static{this.TFIDF_MAX_RESULTS=5}static{this.WORD_FILTER=tn(li,dt,Ct)}constructor(e,t,n,r,i,a){super(dR.PREFIX,e),this.keybindingService=n,this.commandService=r,this.telemetryService=i,this.dialogService=a,this.commandsHistory=this._register(t.createInstance(mR)),this.options=e}async _getPicks(e,t,n,r){let i=await this.getCommandPicks(n);if(n.isCancellationRequested)return[];let a=Yt(()=>{let t=new rR;t.updateDocuments(i.map(e=>({key:e.commandId,textChunks:[this.getTfIdfChunk(e)]})));let r=t.calculateScores(e,n);return iR(r).filter(e=>e.score>dR.TFIDF_THRESHOLD).slice(0,dR.TFIDF_MAX_RESULTS)}),o=[];for(let t of i){let r=dR.WORD_FILTER(e,t.label)??void 0,i=t.commandAlias?dR.WORD_FILTER(e,t.commandAlias)??void 0:void 0;if(r||i)t.highlights={label:r,detail:this.options.showAlias?i:void 0},o.push(t);else if(e===t.commandId)o.push(t);else if(e.length>=3){let e=a();if(n.isCancellationRequested)return[];let r=e.find(e=>e.key===t.commandId);r&&(t.tfIdfScore=r.score,o.push(t))}}let s=new Map;for(let e of o){let t=s.get(e.label);t?(e.description=e.commandId,t.description=t.commandId):s.set(e.label,e)}o.sort((e,t)=>{if(e.tfIdfScore&&t.tfIdfScore)return e.tfIdfScore===t.tfIdfScore?e.label.localeCompare(t.label):t.tfIdfScore-e.tfIdfScore;if(e.tfIdfScore)return 1;if(t.tfIdfScore)return-1;let n=this.commandsHistory.peek(e.commandId),r=this.commandsHistory.peek(t.commandId);if(n&&r)return n>r?-1:1;if(n)return-1;if(r)return 1;if(this.options.suggestedCommandIds){let n=this.options.suggestedCommandIds.has(e.commandId),r=this.options.suggestedCommandIds.has(t.commandId);if(n&&r)return 0;if(n)return-1;if(r)return 1}return e.label.localeCompare(t.label)});let c=[],l=!1,u=!0,d=!!this.options.suggestedCommandIds;for(let e=0;e<o.length;e++){let t=o[e];e===0&&this.commandsHistory.peek(t.commandId)&&(c.push({type:`separator`,label:H(1721,`recently used`)}),l=!0),u&&t.tfIdfScore!==void 0&&(c.push({type:`separator`,label:H(1722,`similar commands`)}),u=!1),d&&t.tfIdfScore===void 0&&!this.commandsHistory.peek(t.commandId)&&this.options.suggestedCommandIds?.has(t.commandId)&&(c.push({type:`separator`,label:H(1723,`commonly used`)}),l=!0,d=!1),l&&t.tfIdfScore===void 0&&!this.commandsHistory.peek(t.commandId)&&!this.options.suggestedCommandIds?.has(t.commandId)&&(c.push({type:`separator`,label:H(1724,`other commands`)}),l=!1),c.push(this.toCommandPick(t,r))}return this.hasAdditionalCommandPicks(e,n)?{picks:c,additionalPicks:(async()=>{let t=await this.getAdditionalCommandPicks(i,o,e,n);if(n.isCancellationRequested)return[];let a=t.map(e=>this.toCommandPick(e,r));return u&&a[0]?.type!==`separator`&&a.unshift({type:`separator`,label:H(1725,`similar commands`)}),a})()}:c}toCommandPick(e,t){if(e.type===`separator`)return e;let n=this.keybindingService.lookupKeybinding(e.commandId),r=n?H(1726,`{0}, {1}`,e.label,n.getAriaLabel()):e.label;return{...e,ariaLabel:r,detail:this.options.showAlias&&e.commandAlias!==e.label?e.commandAlias:void 0,keybinding:n,accept:async()=>{this.commandsHistory.push(e.commandId),this.telemetryService.publicLog2(`workbenchActionExecuted`,{id:e.commandId,from:t?.from??`quick open`});try{e.args?.length?await this.commandService.executeCommand(e.commandId,...e.args):await this.commandService.executeCommand(e.commandId)}catch(t){Pn(t)||this.dialogService.error(H(1727,`Command '{0}' resulted in an error`,e.label),Uf(t))}}}}getTfIdfChunk({label:e,commandAlias:t,commandDescription:n}){let r=e;return t&&t!==e&&(r+=` - ${t}`),n&&n.value!==e&&(r+=` - ${n.value===n.original?n.value:`${n.value} (${n.original})`}`),r}};pR=dR=lR([uR(1,k),uR(2,zn),uR(3,Mr),uR(4,Wr),uR(5,xo)],pR);var mR=class extends b{static{fR=this}static{this.DEFAULT_COMMANDS_HISTORY_LENGTH=50}static{this.PREF_KEY_CACHE=`commandPalette.mru.cache`}static{this.PREF_KEY_COUNTER=`commandPalette.mru.counter`}static{this.counter=1}static{this.hasChanges=!1}constructor(e,t,n){super(),this.storageService=e,this.configurationService=t,this.logService=n,this.configuredCommandsHistoryLength=0,this.updateConfiguration(),this.load(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.updateConfiguration(e))),this._register(this.storageService.onWillSaveState(e=>{e.reason===Vr.SHUTDOWN&&this.saveState()}))}updateConfiguration(e){e&&!e.affectsConfiguration(`workbench.commandPalette.history`)||(this.configuredCommandsHistoryLength=fR.getConfiguredCommandHistoryLength(this.configurationService),fR.cache&&fR.cache.limit!==this.configuredCommandsHistoryLength&&(fR.cache.limit=this.configuredCommandsHistoryLength,fR.hasChanges=!0))}load(){let e=this.storageService.get(fR.PREF_KEY_CACHE,0),t;if(e)try{t=JSON.parse(e)}catch(e){this.logService.error(`[CommandsHistory] invalid data: ${e}`)}let n=fR.cache=new Za(this.configuredCommandsHistoryLength,1);if(t){let e;e=t.usesLRU?t.entries:t.entries.sort((e,t)=>e.value-t.value),e.forEach(e=>n.set(e.key,e.value))}fR.counter=this.storageService.getNumber(fR.PREF_KEY_COUNTER,0,fR.counter)}push(e){fR.cache&&(fR.cache.set(e,fR.counter++),fR.hasChanges=!0)}peek(e){return fR.cache?.peek(e)}saveState(){if(!fR.cache||!fR.hasChanges)return;let e={usesLRU:!0,entries:[]};fR.cache.forEach((t,n)=>e.entries.push({key:n,value:t})),this.storageService.store(fR.PREF_KEY_CACHE,JSON.stringify(e),0,0),this.storageService.store(fR.PREF_KEY_COUNTER,fR.counter,0,0),fR.hasChanges=!1}static getConfiguredCommandHistoryLength(e){let t=e.getValue().workbench?.commandPalette?.history;return typeof t==`number`?t:fR.DEFAULT_COMMANDS_HISTORY_LENGTH}};mR=fR=lR([uR(0,Mu),uR(1,Ni),uR(2,za)],mR);var hR=class extends pR{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a)}getCodeEditorCommandPicks(){let e=this.activeTextEditorControl;if(!e)return[];let t=[];for(let n of e.getSupportedActions()){let e;n.metadata?.description&&(e=pi(n.metadata.description)?n.metadata.description:{original:n.metadata.description,value:n.metadata.description}),t.push({commandId:n.id,commandAlias:n.alias,commandDescription:e,label:et(n.label)||n.id})}return t}},gR=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},_R=function(e,t){return function(n,r){t(n,r,e)}},vR=class extends hR{get activeTextEditorControl(){return this.codeEditorService.getFocusedCodeEditor()??void 0}constructor(e,t,n,r,i,a){super({showAlias:!1},e,n,r,i,a),this.codeEditorService=t}async getCommandPicks(){return this.getCodeEditorCommandPicks()}hasAdditionalCommandPicks(){return!1}async getAdditionalCommandPicks(){return[]}};vR=gR([_R(0,k),_R(1,mt),_R(2,zn),_R(3,Mr),_R(4,Wr),_R(5,xo)],vR);var yR=class e extends D{static{this.ID=`editor.action.quickCommand`}constructor(){super({id:e.ID,label:u.quickCommandActionLabel,alias:`Command Palette`,precondition:void 0,kbOpts:{kbExpr:F.focus,primary:59,weight:100},contextMenuOpts:{group:`z_commands`,order:1}})}run(e){e.get(xe).quickAccess.show(vR.PREFIX)}};s(yR),On.as(Je.Quickaccess).registerQuickAccessProvider({ctor:vR,prefix:vR.PREFIX,helpEntries:[{description:u.quickCommandHelp,commandId:yR.ID}]});var bR=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},xR=function(e,t){return function(n,r){t(n,r,e)}},SR=class extends X_{constructor(e,t,n,r,i,a,o){super(!0,e,t,n,r,i,a,o)}};SR=bR([xR(1,w),xR(2,mt),xR(3,nt),xR(4,k),xR(5,Mu),xR(6,Ni)],SR),G(X_.ID,SR,4),s(class extends D{constructor(){super({id:`editor.action.toggleHighContrast`,label:Oc.toggleHighContrast,alias:`Toggle High Contrast Theme`,precondition:void 0}),this._originalThemeName=null}run(e,t){let n=e.get(Yi),r=n.getColorTheme();je(r.type)?(n.setTheme(this._originalThemeName||(He(r.type)?`vs-dark`:`vs`)),this._originalThemeName=null):(n.setTheme(He(r.type)?Ri:sa),this._originalThemeName=r.themeName)}});var CR=r({CancellationTokenSource:()=>Il,Emitter:()=>Sc,KeyCode:()=>ml,KeyMod:()=>vs,MarkerSeverity:()=>Aa,MarkerTag:()=>Pc,Position:()=>Tl,Range:()=>eo,Selection:()=>ec,SelectionDirection:()=>ql,Token:()=>po,Uri:()=>Fo,editor:()=>Gc,languages:()=>os}),wR=Object.defineProperty,TR=Object.getOwnPropertyDescriptor,ER=Object.getOwnPropertyNames,DR=Object.prototype.hasOwnProperty,OR=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of ER(t))!DR.call(e,i)&&i!==n&&wR(e,i,{get:()=>t[i],enumerable:!(r=TR(t,i))||r.enumerable});return e},kR=(e,t,n)=>(OR(e,t,`default`),n&&OR(n,t,`default`)),AR={};kR(AR,dc);var jR={},MR={},NR=class e{static getOrCreate(t){return MR[t]||(MR[t]=new e(t)),MR[t]}constructor(e){this._languageId=e,this._loadingTriggered=!1,this._lazyLoadPromise=new Promise((e,t)=>{this._lazyLoadPromiseResolve=e,this._lazyLoadPromiseReject=t})}load(){return this._loadingTriggered||(this._loadingTriggered=!0,jR[this._languageId].loader().then(e=>this._lazyLoadPromiseResolve(e),e=>this._lazyLoadPromiseReject(e))),this._lazyLoadPromise}};function $(e){let t=e.id;jR[t]=e,AR.languages.register(e);let n=NR.getOrCreate(t);AR.languages.registerTokensProviderFactory(t,{create:async()=>(await n.load()).language}),AR.languages.onLanguageEncountered(t,async()=>{let e=await n.load();AR.languages.setLanguageConfiguration(t,e.conf)})}$({id:`abap`,extensions:[`.abap`],aliases:[`abap`,`ABAP`],loader:()=>Z(()=>import(`./C1zozaxa.js`),[],import.meta.url)}),$({id:`apex`,extensions:[`.cls`],aliases:[`Apex`,`apex`],mimetypes:[`text/x-apex-source`,`text/x-apex`],loader:()=>Z(()=>import(`./RD0Ri2By.js`),[],import.meta.url)}),$({id:`azcli`,extensions:[`.azcli`],aliases:[`Azure CLI`,`azcli`],loader:()=>Z(()=>import(`./ClA-nPr3.js`),[],import.meta.url)}),$({id:`bat`,extensions:[`.bat`,`.cmd`],aliases:[`Batch`,`bat`],loader:()=>Z(()=>import(`./DP_GKYUw.js`),[],import.meta.url)}),$({id:`bicep`,extensions:[`.bicep`],aliases:[`Bicep`],loader:()=>Z(()=>import(`./CnOMefUR.js`),[],import.meta.url)}),$({id:`cameligo`,extensions:[`.mligo`],aliases:[`Cameligo`],loader:()=>Z(()=>import(`./CZommSrL.js`),[],import.meta.url)}),$({id:`clojure`,extensions:[`.clj`,`.cljs`,`.cljc`,`.edn`],aliases:[`clojure`,`Clojure`],loader:()=>Z(()=>import(`./BIczJnvJ.js`),[],import.meta.url)}),$({id:`coffeescript`,extensions:[`.coffee`],aliases:[`CoffeeScript`,`coffeescript`,`coffee`],mimetypes:[`text/x-coffeescript`,`text/coffeescript`],loader:()=>Z(()=>import(`./D0KdjBbJ.js`),[],import.meta.url)}),$({id:`c`,extensions:[`.c`,`.h`],aliases:[`C`,`c`],loader:()=>Z(()=>import(`./Ds9HdaXN.js`),[],import.meta.url)}),$({id:`cpp`,extensions:[`.cpp`,`.cc`,`.cxx`,`.hpp`,`.hh`,`.hxx`],aliases:[`C++`,`Cpp`,`cpp`],loader:()=>Z(()=>import(`./Ds9HdaXN.js`),[],import.meta.url)}),$({id:`csharp`,extensions:[`.cs`,`.csx`,`.cake`],aliases:[`C#`,`csharp`],loader:()=>Z(()=>import(`./Rl88DJL1.js`),[],import.meta.url)}),$({id:`csp`,extensions:[`.csp`],aliases:[`CSP`,`csp`],loader:()=>Z(()=>import(`./RerMYxWg.js`),[],import.meta.url)}),$({id:`css`,extensions:[`.css`],aliases:[`CSS`,`css`],mimetypes:[`text/css`],loader:()=>Z(()=>import(`./BjK7eEAy.js`),[],import.meta.url)}),$({id:`cypher`,extensions:[`.cypher`,`.cyp`],aliases:[`Cypher`,`OpenCypher`],loader:()=>Z(()=>import(`./C0JJbfFU.js`),[],import.meta.url)}),$({id:`dart`,extensions:[`.dart`],aliases:[`Dart`,`dart`],mimetypes:[`text/x-dart-source`,`text/x-dart`],loader:()=>Z(()=>import(`./DA7KIm5J.js`),[],import.meta.url)}),$({id:`dockerfile`,extensions:[`.dockerfile`],filenames:[`Dockerfile`],aliases:[`Dockerfile`],loader:()=>Z(()=>import(`./_jQGG0XJ.js`),[],import.meta.url)}),$({id:`ecl`,extensions:[`.ecl`],aliases:[`ECL`,`Ecl`,`ecl`],loader:()=>Z(()=>import(`./C6WehU5p.js`),[],import.meta.url)}),$({id:`elixir`,extensions:[`.ex`,`.exs`],aliases:[`Elixir`,`elixir`,`ex`],loader:()=>Z(()=>import(`./ChZgwCAU.js`),[],import.meta.url)}),$({id:`flow9`,extensions:[`.flow`],aliases:[`Flow9`,`Flow`,`flow9`,`flow`],loader:()=>Z(()=>import(`./0UgXDZt3.js`),[],import.meta.url)}),$({id:`fsharp`,extensions:[`.fs`,`.fsi`,`.ml`,`.mli`,`.fsx`,`.fsscript`],aliases:[`F#`,`FSharp`,`fsharp`],loader:()=>Z(()=>import(`./C98rD5aQ.js`),[],import.meta.url)}),$({id:`freemarker2`,extensions:[`.ftl`,`.ftlh`,`.ftlx`],aliases:[`FreeMarker2`,`Apache FreeMarker2`],loader:()=>Z(()=>import(`./CYRfCsR3.js`),__vite__mapDeps([0,1,2]),import.meta.url).then(e=>e.TagAutoInterpolationDollar)}),$({id:`freemarker2.tag-angle.interpolation-dollar`,aliases:[`FreeMarker2 (Angle/Dollar)`,`Apache FreeMarker2 (Angle/Dollar)`],loader:()=>Z(()=>import(`./CYRfCsR3.js`),__vite__mapDeps([0,1,2]),import.meta.url).then(e=>e.TagAngleInterpolationDollar)}),$({id:`freemarker2.tag-bracket.interpolation-dollar`,aliases:[`FreeMarker2 (Bracket/Dollar)`,`Apache FreeMarker2 (Bracket/Dollar)`],loader:()=>Z(()=>import(`./CYRfCsR3.js`),__vite__mapDeps([0,1,2]),import.meta.url).then(e=>e.TagBracketInterpolationDollar)}),$({id:`freemarker2.tag-angle.interpolation-bracket`,aliases:[`FreeMarker2 (Angle/Bracket)`,`Apache FreeMarker2 (Angle/Bracket)`],loader:()=>Z(()=>import(`./CYRfCsR3.js`),__vite__mapDeps([0,1,2]),import.meta.url).then(e=>e.TagAngleInterpolationBracket)}),$({id:`freemarker2.tag-bracket.interpolation-bracket`,aliases:[`FreeMarker2 (Bracket/Bracket)`,`Apache FreeMarker2 (Bracket/Bracket)`],loader:()=>Z(()=>import(`./CYRfCsR3.js`),__vite__mapDeps([0,1,2]),import.meta.url).then(e=>e.TagBracketInterpolationBracket)}),$({id:`freemarker2.tag-auto.interpolation-dollar`,aliases:[`FreeMarker2 (Auto/Dollar)`,`Apache FreeMarker2 (Auto/Dollar)`],loader:()=>Z(()=>import(`./CYRfCsR3.js`),__vite__mapDeps([0,1,2]),import.meta.url).then(e=>e.TagAutoInterpolationDollar)}),$({id:`freemarker2.tag-auto.interpolation-bracket`,aliases:[`FreeMarker2 (Auto/Bracket)`,`Apache FreeMarker2 (Auto/Bracket)`],loader:()=>Z(()=>import(`./CYRfCsR3.js`),__vite__mapDeps([0,1,2]),import.meta.url).then(e=>e.TagAutoInterpolationBracket)}),$({id:`go`,extensions:[`.go`],aliases:[`Go`],loader:()=>Z(()=>import(`./DEbnMyVh.js`),[],import.meta.url)}),$({id:`graphql`,extensions:[`.graphql`,`.gql`],aliases:[`GraphQL`,`graphql`,`gql`],mimetypes:[`application/graphql`],loader:()=>Z(()=>import(`./BdvdopLv.js`),[],import.meta.url)}),$({id:`handlebars`,extensions:[`.handlebars`,`.hbs`],aliases:[`Handlebars`,`handlebars`,`hbs`],mimetypes:[`text/x-handlebars-template`],loader:()=>Z(()=>import(`./sKJl-7Om.js`),__vite__mapDeps([3,1,2]),import.meta.url)}),$({id:`hcl`,extensions:[`.tf`,`.tfvars`,`.hcl`],aliases:[`Terraform`,`tf`,`HCL`,`hcl`],loader:()=>Z(()=>import(`./B6bk4SxR.js`),[],import.meta.url)}),$({id:`html`,extensions:[`.html`,`.htm`,`.shtml`,`.xhtml`,`.mdoc`,`.jsp`,`.asp`,`.aspx`,`.jshtm`],aliases:[`HTML`,`htm`,`html`,`xhtml`],mimetypes:[`text/html`,`text/x-jshtm`,`text/template`,`text/ng-template`],loader:()=>Z(()=>import(`./Cbj_R_eX.js`),__vite__mapDeps([4,1,2]),import.meta.url)}),$({id:`ini`,extensions:[`.ini`,`.properties`,`.gitconfig`],filenames:[`config`,`.gitattributes`,`.gitconfig`,`.editorconfig`],aliases:[`Ini`,`ini`],loader:()=>Z(()=>import(`./jS6TjIMi.js`),[],import.meta.url)}),$({id:`java`,extensions:[`.java`,`.jav`],aliases:[`Java`,`java`],mimetypes:[`text/x-java-source`,`text/x-java`],loader:()=>Z(()=>import(`./Dl_h2bpJ.js`),[],import.meta.url)}),$({id:`javascript`,extensions:[`.js`,`.es6`,`.jsx`,`.mjs`,`.cjs`],firstLine:`^#!.*\\bnode`,filenames:[`jakefile`],aliases:[`JavaScript`,`javascript`,`js`],mimetypes:[`text/javascript`],loader:()=>Z(()=>import(`./B_A7LuJU.js`),__vite__mapDeps([5,1,2,6]),import.meta.url)}),$({id:`julia`,extensions:[`.jl`],aliases:[`julia`,`Julia`],loader:()=>Z(()=>import(`./CV-NEXvS.js`),[],import.meta.url)}),$({id:`kotlin`,extensions:[`.kt`,`.kts`],aliases:[`Kotlin`,`kotlin`],mimetypes:[`text/x-kotlin-source`,`text/x-kotlin`],loader:()=>Z(()=>import(`./DWPPnX3x.js`),[],import.meta.url)}),$({id:`less`,extensions:[`.less`],aliases:[`Less`,`less`],mimetypes:[`text/x-less`,`text/less`],loader:()=>Z(()=>import(`./BxM0jsOI.js`),[],import.meta.url)}),$({id:`lexon`,extensions:[`.lex`],aliases:[`Lexon`],loader:()=>Z(()=>import(`./DLMknmpr.js`),[],import.meta.url)}),$({id:`lua`,extensions:[`.lua`],aliases:[`Lua`,`lua`],loader:()=>Z(()=>import(`./CIpU8no-.js`),[],import.meta.url)}),$({id:`liquid`,extensions:[`.liquid`,`.html.liquid`],aliases:[`Liquid`,`liquid`],mimetypes:[`application/liquid`],loader:()=>Z(()=>import(`./Bx0c16cM.js`),__vite__mapDeps([7,1,2]),import.meta.url)}),$({id:`m3`,extensions:[`.m3`,`.i3`,`.mg`,`.ig`],aliases:[`Modula-3`,`Modula3`,`modula3`,`m3`],loader:()=>Z(()=>import(`./DR0F1ZCW.js`),[],import.meta.url)}),$({id:`markdown`,extensions:[`.md`,`.markdown`,`.mdown`,`.mkdn`,`.mkd`,`.mdwn`,`.mdtxt`,`.mdtext`],aliases:[`Markdown`,`markdown`],loader:()=>Z(()=>import(`./fGon8j5E.js`),[],import.meta.url)}),$({id:`mdx`,extensions:[`.mdx`],aliases:[`MDX`,`mdx`],loader:()=>Z(()=>import(`./BP0yKN8i.js`),__vite__mapDeps([8,1,2]),import.meta.url)}),$({id:`mips`,extensions:[`.s`],aliases:[`MIPS`,`MIPS-V`],mimetypes:[`text/x-mips`,`text/mips`,`text/plaintext`],loader:()=>Z(()=>import(`./BZoS3tR4.js`),[],import.meta.url)}),$({id:`msdax`,extensions:[`.dax`,`.msdax`],aliases:[`DAX`,`MSDAX`],loader:()=>Z(()=>import(`./BfJVJc5-.js`),[],import.meta.url)}),$({id:`mysql`,extensions:[],aliases:[`MySQL`,`mysql`],loader:()=>Z(()=>import(`./BafTuPdz.js`),[],import.meta.url)}),$({id:`objective-c`,extensions:[`.m`],aliases:[`Objective-C`],loader:()=>Z(()=>import(`./D5g-HSxL.js`),[],import.meta.url)}),$({id:`pascal`,extensions:[`.pas`,`.p`,`.pp`],aliases:[`Pascal`,`pas`],mimetypes:[`text/x-pascal-source`,`text/x-pascal`],loader:()=>Z(()=>import(`./Co-LwRG1.js`),[],import.meta.url)}),$({id:`pascaligo`,extensions:[`.ligo`],aliases:[`Pascaligo`,`ligo`],loader:()=>Z(()=>import(`./B2rqx8uL.js`),[],import.meta.url)}),$({id:`perl`,extensions:[`.pl`,`.pm`],aliases:[`Perl`,`pl`],loader:()=>Z(()=>import(`./Bh_pWTMT.js`),[],import.meta.url)}),$({id:`pgsql`,extensions:[],aliases:[`PostgreSQL`,`postgres`,`pg`,`postgre`],loader:()=>Z(()=>import(`./D53IETB3.js`),[],import.meta.url)}),$({id:`php`,extensions:[`.php`,`.php4`,`.php5`,`.phtml`,`.ctp`],aliases:[`PHP`,`php`],mimetypes:[`application/x-php`],loader:()=>Z(()=>import(`./BnItFTHP.js`),[],import.meta.url)}),$({id:`pla`,extensions:[`.pla`],loader:()=>Z(()=>import(`./BPHLbPHw.js`),[],import.meta.url)}),$({id:`postiats`,extensions:[`.dats`,`.sats`,`.hats`],aliases:[`ATS`,`ATS/Postiats`],loader:()=>Z(()=>import(`./DaPkDAkH.js`),[],import.meta.url)}),$({id:`powerquery`,extensions:[`.pq`,`.pqm`],aliases:[`PQ`,`M`,`Power Query`,`Power Query M`],loader:()=>Z(()=>import(`./BkpBCCbM.js`),[],import.meta.url)}),$({id:`powershell`,extensions:[`.ps1`,`.psm1`,`.psd1`],aliases:[`PowerShell`,`powershell`,`ps`,`ps1`],loader:()=>Z(()=>import(`./BRZGMjye.js`),[],import.meta.url)}),$({id:`proto`,extensions:[`.proto`],aliases:[`protobuf`,`Protocol Buffers`],loader:()=>Z(()=>import(`./DpzeIubr.js`),[],import.meta.url)}),$({id:`pug`,extensions:[`.jade`,`.pug`],aliases:[`Pug`,`Jade`,`jade`],loader:()=>Z(()=>import(`./DFOOHwfI.js`),[],import.meta.url)}),$({id:`python`,extensions:[`.py`,`.rpy`,`.pyw`,`.cpy`,`.gyp`,`.gypi`],aliases:[`Python`,`py`],firstLine:`^#!/.*\\bpython[0-9.-]*\\b`,loader:()=>Z(()=>import(`./C7jQ0zpd.js`),__vite__mapDeps([9,1,2]),import.meta.url)}),$({id:`qsharp`,extensions:[`.qs`],aliases:[`Q#`,`qsharp`],loader:()=>Z(()=>import(`./BqrzIDyn.js`),[],import.meta.url)}),$({id:`r`,extensions:[`.r`,`.rhistory`,`.rmd`,`.rprofile`,`.rt`],aliases:[`R`,`r`],loader:()=>Z(()=>import(`./DYe8zBHD.js`),[],import.meta.url)}),$({id:`razor`,extensions:[`.cshtml`],aliases:[`Razor`,`razor`],mimetypes:[`text/x-cshtml`],loader:()=>Z(()=>import(`./C1wsuurP.js`),__vite__mapDeps([10,1,2]),import.meta.url)}),$({id:`redis`,extensions:[`.redis`],aliases:[`redis`],loader:()=>Z(()=>import(`./BV7XhCEs.js`),[],import.meta.url)}),$({id:`redshift`,extensions:[],aliases:[`Redshift`,`redshift`],loader:()=>Z(()=>import(`./DtmTZmET.js`),[],import.meta.url)}),$({id:`restructuredtext`,extensions:[`.rst`],aliases:[`reStructuredText`,`restructuredtext`],loader:()=>Z(()=>import(`./CSVfZtbS.js`),[],import.meta.url)}),$({id:`ruby`,extensions:[`.rb`,`.rbx`,`.rjs`,`.gemspec`,`.pp`],filenames:[`rakefile`,`Gemfile`],aliases:[`Ruby`,`rb`],loader:()=>Z(()=>import(`./DsFP6M-E.js`),[],import.meta.url)}),$({id:`rust`,extensions:[`.rs`,`.rlib`],aliases:[`Rust`,`rust`],loader:()=>Z(()=>import(`./DicgLPpA.js`),[],import.meta.url)}),$({id:`sb`,extensions:[`.sb`],aliases:[`Small Basic`,`sb`],loader:()=>Z(()=>import(`./vPDXsf21.js`),[],import.meta.url)}),$({id:`scala`,extensions:[`.scala`,`.sc`,`.sbt`],aliases:[`Scala`,`scala`,`SBT`,`Sbt`,`sbt`,`Dotty`,`dotty`],mimetypes:[`text/x-scala-source`,`text/x-scala`,`text/x-sbt`,`text/x-dotty`],loader:()=>Z(()=>import(`./CUTztkoW.js`),[],import.meta.url)}),$({id:`scheme`,extensions:[`.scm`,`.ss`,`.sch`,`.rkt`],aliases:[`scheme`,`Scheme`],loader:()=>Z(()=>import(`./-V_55kuD.js`),[],import.meta.url)}),$({id:`scss`,extensions:[`.scss`],aliases:[`Sass`,`sass`,`scss`],mimetypes:[`text/x-scss`,`text/scss`],loader:()=>Z(()=>import(`./BiJPZZLO.js`),[],import.meta.url)}),$({id:`shell`,extensions:[`.sh`,`.bash`],aliases:[`Shell`,`sh`],loader:()=>Z(()=>import(`./k4XIiWTI.js`),[],import.meta.url)}),$({id:`sol`,extensions:[`.sol`],aliases:[`sol`,`solidity`,`Solidity`],loader:()=>Z(()=>import(`./5GGerrkr.js`),[],import.meta.url)}),$({id:`aes`,extensions:[`.aes`],aliases:[`aes`,`sophia`,`Sophia`],loader:()=>Z(()=>import(`./4s45l0LI.js`),[],import.meta.url)}),$({id:`sparql`,extensions:[`.rq`],aliases:[`sparql`,`SPARQL`],loader:()=>Z(()=>import(`./DdeQgr3M.js`),[],import.meta.url)}),$({id:`sql`,extensions:[`.sql`],aliases:[`SQL`],loader:()=>Z(()=>import(`./FgwstBl4.js`),[],import.meta.url)}),$({id:`st`,extensions:[`.st`,`.iecst`,`.iecplc`,`.lc3lib`,`.TcPOU`,`.TcDUT`,`.TcGVL`,`.TcIO`],aliases:[`StructuredText`,`scl`,`stl`],loader:()=>Z(()=>import(`./DiQ6GTBD.js`),[],import.meta.url)}),$({id:`swift`,aliases:[`Swift`,`swift`],extensions:[`.swift`],mimetypes:[`text/swift`],loader:()=>Z(()=>import(`./B2r4pHin.js`),[],import.meta.url)}),$({id:`systemverilog`,extensions:[`.sv`,`.svh`],aliases:[`SV`,`sv`,`SystemVerilog`,`systemverilog`],loader:()=>Z(()=>import(`./Cau-_aej.js`),[],import.meta.url)}),$({id:`verilog`,extensions:[`.v`,`.vh`],aliases:[`V`,`v`,`Verilog`,`verilog`],loader:()=>Z(()=>import(`./Cau-_aej.js`),[],import.meta.url)}),$({id:`tcl`,extensions:[`.tcl`],aliases:[`tcl`,`Tcl`,`tcltk`,`TclTk`,`tcl/tk`,`Tcl/Tk`],loader:()=>Z(()=>import(`./DoqkSFNI.js`),[],import.meta.url)}),$({id:`twig`,extensions:[`.twig`],aliases:[`Twig`,`twig`],mimetypes:[`text/x-twig`],loader:()=>Z(()=>import(`./CU49rwJ-.js`),[],import.meta.url)}),$({id:`typescript`,extensions:[`.ts`,`.tsx`,`.cts`,`.mts`],aliases:[`TypeScript`,`ts`,`typescript`],mimetypes:[`text/typescript`],loader:()=>Z(()=>import(`./Dr2DanLJ.js`),__vite__mapDeps([11,1,2,6]),import.meta.url)}),$({id:`typespec`,extensions:[`.tsp`],aliases:[`TypeSpec`],loader:()=>Z(()=>import(`./HdEhttel.js`),[],import.meta.url)}),$({id:`vb`,extensions:[`.vb`],aliases:[`Visual Basic`,`vb`],loader:()=>Z(()=>import(`./WNPK0S-m.js`),[],import.meta.url)}),$({id:`wgsl`,extensions:[`.wgsl`],aliases:[`WebGPU Shading Language`,`WGSL`,`wgsl`],loader:()=>Z(()=>import(`./Cl-haBOj.js`),[],import.meta.url)}),$({id:`xml`,extensions:[`.xml`,`.xsd`,`.dtd`,`.ascx`,`.csproj`,`.config`,`.props`,`.targets`,`.wxi`,`.wxl`,`.wxs`,`.xaml`,`.svg`,`.svgz`,`.opf`,`.xslt`,`.xsl`],firstLine:`(\\<\\?xml.*)|(\\<svg)|(\\<\\!doctype\\s+svg)`,aliases:[`XML`,`xml`],mimetypes:[`text/xml`,`application/xml`,`application/xaml+xml`,`application/xml-dtd`],loader:()=>Z(()=>import(`./CKK20oDY.js`),__vite__mapDeps([12,1,2]),import.meta.url)}),$({id:`yaml`,extensions:[`.yaml`,`.yml`],aliases:[`YAML`,`yaml`,`YML`,`yml`],mimetypes:[`application/x-yaml`,`text/x-yaml`],loader:()=>Z(()=>import(`./CicF10Y2.js`),__vite__mapDeps([13,1,2]),import.meta.url)});
/*!-----------------------------------------------------------------------------
* Copyright (c) Microsoft Corporation. All rights reserved.
* Version: 0.53.0(4e45ba0c5ff45fc61c0ccac61c0987369df04a6e)
* Released under the MIT license
* https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
*-----------------------------------------------------------------------------*/
var PR=Object.defineProperty,FR=Object.getOwnPropertyDescriptor,IR=Object.getOwnPropertyNames,LR=Object.prototype.hasOwnProperty,RR=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of IR(t))!LR.call(e,i)&&i!==n&&PR(e,i,{get:()=>t[i],enumerable:!(r=FR(t,i))||r.enumerable});return e},zR=(e,t,n)=>(RR(e,t,`default`),n&&RR(n,t,`default`)),BR={};zR(BR,dc);var VR=class{constructor(e,t,n){this._onDidChange=new BR.Emitter,this._languageId=e,this.setOptions(t),this.setModeConfiguration(n)}get onDidChange(){return this._onDidChange.event}get languageId(){return this._languageId}get modeConfiguration(){return this._modeConfiguration}get diagnosticsOptions(){return this.options}get options(){return this._options}setOptions(e){this._options=e||Object.create(null),this._onDidChange.fire(this)}setDiagnosticsOptions(e){this.setOptions(e)}setModeConfiguration(e){this._modeConfiguration=e||Object.create(null),this._onDidChange.fire(this)}},HR={validate:!0,lint:{compatibleVendorPrefixes:`ignore`,vendorPrefix:`warning`,duplicateProperties:`warning`,emptyRules:`warning`,importStatement:`ignore`,boxModel:`ignore`,universalSelector:`ignore`,zeroUnits:`ignore`,fontFaceProperties:`warning`,hexColorLength:`error`,argumentsInColorFunction:`error`,unknownProperties:`warning`,ieHack:`ignore`,unknownVendorSpecificProperties:`ignore`,propertyIgnoredDueToDisplay:`warning`,important:`ignore`,float:`ignore`,idSelector:`ignore`},data:{useDefaultDataProvider:!0},format:{newlineBetweenSelectors:!0,newlineBetweenRules:!0,spaceAroundSelectorSeparator:!1,braceStyle:`collapse`,maxPreserveNewLines:void 0,preserveNewLines:!0}},UR={completionItems:!0,hovers:!0,documentSymbols:!0,definitions:!0,references:!0,documentHighlights:!0,rename:!0,colors:!0,foldingRanges:!0,diagnostics:!0,selectionRanges:!0,documentFormattingEdits:!0,documentRangeFormattingEdits:!0},WR=new VR(`css`,HR,UR),GR=new VR(`scss`,HR,UR),KR=new VR(`less`,HR,UR);BR.languages.css={cssDefaults:WR,lessDefaults:KR,scssDefaults:GR};function qR(){return Z(()=>import(`./CyKNYudn.js`),__vite__mapDeps([14,1,2]),import.meta.url)}BR.languages.onLanguage(`less`,()=>{qR().then(e=>e.setupMode(KR))}),BR.languages.onLanguage(`scss`,()=>{qR().then(e=>e.setupMode(GR))}),BR.languages.onLanguage(`css`,()=>{qR().then(e=>e.setupMode(WR))});
/*!-----------------------------------------------------------------------------
* Copyright (c) Microsoft Corporation. All rights reserved.
* Version: 0.53.0(4e45ba0c5ff45fc61c0ccac61c0987369df04a6e)
* Released under the MIT license
* https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
*-----------------------------------------------------------------------------*/
var JR=Object.defineProperty,YR=Object.getOwnPropertyDescriptor,XR=Object.getOwnPropertyNames,ZR=Object.prototype.hasOwnProperty,QR=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of XR(t))!ZR.call(e,i)&&i!==n&&JR(e,i,{get:()=>t[i],enumerable:!(r=YR(t,i))||r.enumerable});return e},$R=(e,t,n)=>(QR(e,t,`default`),n&&QR(n,t,`default`)),ez={};$R(ez,dc);var tz=class{constructor(e,t,n){this._onDidChange=new ez.Emitter,this._languageId=e,this.setOptions(t),this.setModeConfiguration(n)}get onDidChange(){return this._onDidChange.event}get languageId(){return this._languageId}get options(){return this._options}get modeConfiguration(){return this._modeConfiguration}setOptions(e){this._options=e||Object.create(null),this._onDidChange.fire(this)}setModeConfiguration(e){this._modeConfiguration=e||Object.create(null),this._onDidChange.fire(this)}},nz={format:{tabSize:4,insertSpaces:!1,wrapLineLength:120,unformatted:`default": "a, abbr, acronym, b, bdo, big, br, button, cite, code, dfn, em, i, img, input, kbd, label, map, object, q, samp, select, small, span, strong, sub, sup, textarea, tt, var`,contentUnformatted:`pre`,indentInnerHtml:!1,preserveNewLines:!0,maxPreserveNewLines:void 0,indentHandlebars:!1,endWithNewline:!1,extraLiners:`head, body, /html`,wrapAttributes:`auto`},suggest:{},data:{useDefaultDataProvider:!0}};function rz(e){return{completionItems:!0,hovers:!0,documentSymbols:!0,links:!0,documentHighlights:!0,rename:!0,colors:!0,foldingRanges:!0,selectionRanges:!0,diagnostics:e===iz,documentFormattingEdits:e===iz,documentRangeFormattingEdits:e===iz}}var iz=`html`,az=`handlebars`,oz=`razor`,sz=mz(iz,nz,rz(iz)),cz=sz.defaults,lz=mz(az,nz,rz(az)),uz=lz.defaults,dz=mz(oz,nz,rz(oz)),fz=dz.defaults;ez.languages.html={htmlDefaults:cz,razorDefaults:fz,handlebarDefaults:uz,htmlLanguageService:sz,handlebarLanguageService:lz,razorLanguageService:dz,registerHTMLLanguageService:mz};function pz(){return Z(()=>import(`./DC0sxOmR.js`),__vite__mapDeps([15,1,2]),import.meta.url)}function mz(e,t=nz,n=rz(e)){let r=new tz(e,t,n),i,a=ez.languages.onLanguage(e,async()=>{i=(await pz()).setupMode(r)});return{defaults:r,dispose(){a.dispose(),i?.dispose(),i=void 0}}}
/*!-----------------------------------------------------------------------------
* Copyright (c) Microsoft Corporation. All rights reserved.
* Version: 0.53.0(4e45ba0c5ff45fc61c0ccac61c0987369df04a6e)
* Released under the MIT license
* https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
*-----------------------------------------------------------------------------*/
var hz=Object.defineProperty,gz=Object.getOwnPropertyDescriptor,_z=Object.getOwnPropertyNames,vz=Object.prototype.hasOwnProperty,yz=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of _z(t))!vz.call(e,i)&&i!==n&&hz(e,i,{get:()=>t[i],enumerable:!(r=gz(t,i))||r.enumerable});return e},bz=(e,t,n)=>(yz(e,t,`default`),n&&yz(n,t,`default`)),xz={};bz(xz,dc);var Sz=new class{constructor(e,t,n){this._onDidChange=new xz.Emitter,this._languageId=e,this.setDiagnosticsOptions(t),this.setModeConfiguration(n)}get onDidChange(){return this._onDidChange.event}get languageId(){return this._languageId}get modeConfiguration(){return this._modeConfiguration}get diagnosticsOptions(){return this._diagnosticsOptions}setDiagnosticsOptions(e){this._diagnosticsOptions=e||Object.create(null),this._onDidChange.fire(this)}setModeConfiguration(e){this._modeConfiguration=e||Object.create(null),this._onDidChange.fire(this)}}(`json`,{validate:!0,allowComments:!0,schemas:[],enableSchemaRequest:!1,schemaRequest:`warning`,schemaValidation:`warning`,comments:`error`,trailingCommas:`error`},{documentFormattingEdits:!0,documentRangeFormattingEdits:!0,completionItems:!0,hovers:!0,documentSymbols:!0,tokens:!0,colors:!0,foldingRanges:!0,diagnostics:!0,selectionRanges:!0}),Cz=()=>wz().then(e=>e.getWorker());xz.languages.json={jsonDefaults:Sz,getWorker:Cz};function wz(){return Z(()=>import(`./BDJI3OX9.js`),__vite__mapDeps([16,1,2]),import.meta.url)}xz.languages.register({id:`json`,extensions:[`.json`,`.bowerrc`,`.jshintrc`,`.jscsrc`,`.eslintrc`,`.babelrc`,`.har`],aliases:[`JSON`,`json`],mimetypes:[`application/json`]}),xz.languages.onLanguage(`json`,()=>{wz().then(e=>e.setupMode(Sz))});
/*!-----------------------------------------------------------------------------
* Copyright (c) Microsoft Corporation. All rights reserved.
* Version: 0.53.0(4e45ba0c5ff45fc61c0ccac61c0987369df04a6e)
* Released under the MIT license
* https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
*-----------------------------------------------------------------------------*/
var Tz=Object.defineProperty,Ez=Object.getOwnPropertyDescriptor,Dz=Object.getOwnPropertyNames,Oz=Object.prototype.hasOwnProperty,kz=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of Dz(t))!Oz.call(e,i)&&i!==n&&Tz(e,i,{get:()=>t[i],enumerable:!(r=Ez(t,i))||r.enumerable});return e},Az=(e,t,n)=>(kz(e,t,`default`),n&&kz(n,t,`default`)),jz={};Az(jz,CR);function Mz(e,t){let n=globalThis.MonacoEnvironment;if(n?.createTrustedTypesPolicy)try{return n.createTrustedTypesPolicy(e,t)}catch(e){console.error(e);return}try{return globalThis.trustedTypes?.createPolicy(e,t)}catch(e){console.error(e);return}}var Nz=typeof self==`object`&&self.constructor&&self.constructor.name===`DedicatedWorkerGlobalScope`&&globalThis.workerttPolicy!==void 0?globalThis.workerttPolicy:Mz(`defaultWorkerFactory`,{createScriptURL:e=>e});function Pz(e){let t=e.label,n=globalThis.MonacoEnvironment;if(n){if(typeof n.getWorker==`function`)return n.getWorker(`workerMain.js`,t);if(typeof n.getWorkerUrl==`function`){let e=n.getWorkerUrl(`workerMain.js`,t);return new Worker(Nz?Nz.createScriptURL(e):e,{name:t,type:`module`})}}throw Error(`You must define a function MonacoEnvironment.getWorkerUrl or MonacoEnvironment.getWorker`)}function Fz(e){let t=Promise.resolve(Pz({label:e.label??`monaco-editor-worker`,moduleId:e.moduleId})).then(t=>(t.postMessage(`ignore`),t.postMessage(e.createData),t));return jz.editor.createWebWorker({worker:t,host:e.host,keepIdleModels:e.keepIdleModels})}var Iz=Gc.createWebWorker;Gc.createWebWorker=function(e){return e.worker===void 0?Fz(e):Iz(e)};export{Il as CancellationTokenSource,Sc as Emitter,ml as KeyCode,vs as KeyMod,Aa as MarkerSeverity,Pc as MarkerTag,Tl as Position,eo as Range,ec as Selection,ql as SelectionDirection,po as Token,Fo as Uri,Gc as editor,os as languages};